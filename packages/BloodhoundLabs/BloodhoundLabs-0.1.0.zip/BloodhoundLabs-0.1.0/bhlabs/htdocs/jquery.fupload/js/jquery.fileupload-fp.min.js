/*
 * jQuery File Upload File Processing Plugin 1.2
*/
!function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery","load-image","canvas-to-blob","./jquery.fileupload"],a):a(window.jQuery,window.loadImage)}(function(a,b){"use strict";a.widget("blueimp.fileupload",a.blueimp.fileupload,{options:{process:[],add:function(b,c){a(this).fileupload("process",c).done(function(){c.submit()})}},processActions:{load:function(c,d){var e=this,f=c.files[c.index],g=a.Deferred();return window.HTMLCanvasElement&&window.HTMLCanvasElement.prototype.toBlob&&("number"!==a.type(d.maxFileSize)||f.size<d.maxFileSize)&&(!d.fileTypes||d.fileTypes.test(f.type))?b(f,function(a){c.img=a,g.resolveWith(e,[c])}):g.rejectWith(e,[c]),g.promise()},resize:function(c,d){var f,e=c.img;return d=a.extend({canvas:!0},d),e&&(f=b.scale(e,d),(f.width!==e.width||f.height!==e.height)&&(c.canvas=f)),c},save:function(b){if(!b.canvas)return b;var d=this,e=b.files[b.index],f=e.name,g=a.Deferred(),h=function(a){a.name||(e.type===a.type?a.name=e.name:e.name&&(a.name=e.name.replace(/\..+$/,"."+a.type.substr(6)))),b.files[b.index]=a,g.resolveWith(d,[b])};return b.canvas.mozGetAsFile?h(b.canvas.mozGetAsFile(/^image\/(jpeg|png)$/.test(e.type)&&f||(f&&f.replace(/\..+$/,"")||"blob")+".png",e.type)):b.canvas.toBlob(h,e.type),g.promise()}},_processFile:function(b,c,d){var e=this,f=a.Deferred().resolveWith(e,[{files:b,index:c}]),g=f.promise();return e._processing+=1,a.each(d.process,function(a,b){g=g.pipe(function(a){return e.processActions[b.action].call(this,a,b)})}),g.always(function(){e._processing-=1,0===e._processing&&e.element.removeClass("fileupload-processing")}),1===e._processing&&e.element.addClass("fileupload-processing"),g},process:function(b){var c=this,d=a.extend({},this.options,b);return d.process&&d.process.length&&this._isXHRUpload(d)&&a.each(b.files,function(e){c._processingQueue=c._processingQueue.pipe(function(){var f=a.Deferred();return c._processFile(b.files,e,d).always(function(){f.resolveWith(c)}),f.promise()})}),this._processingQueue},_create:function(){this._super(),this._processing=0,this._processingQueue=a.Deferred().resolveWith(this).promise()}})});