/*
* Query File Upload User Interface Plugin 6.11
*/
!function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery","tmpl","load-image","./jquery.fileupload-fp"],a):a(window.jQuery,window.tmpl,window.loadImage)}(function(a,b,c){"use strict";a.widget("blueimp.fileupload",a.blueimp.fileupload,{options:{autoUpload:!1,maxNumberOfFiles:void 0,maxFileSize:void 0,minFileSize:void 0,acceptFileTypes:/.+$/i,previewSourceFileTypes:/^image\/(gif|jpeg|png)$/,previewSourceMaxFileSize:5e6,previewMaxWidth:80,previewMaxHeight:80,previewAsCanvas:!0,uploadTemplateId:"template-upload",downloadTemplateId:"template-download",filesContainer:void 0,prependFiles:!1,dataType:"json",add:function(b,c){var d=a(this).data("fileupload"),e=d.options,f=c.files;a(this).fileupload("process",c).done(function(){d._adjustMaxNumberOfFiles(-f.length),c.maxNumberOfFilesAdjusted=!0,c.files.valid=c.isValidated=d._validate(f),c.context=d._renderUpload(f).data("data",c),e.filesContainer[e.prependFiles?"prepend":"append"](c.context),d._renderPreviews(f,c.context),d._forceReflow(c.context),d._transition(c.context).done(function(){d._trigger("added",b,c)!==!1&&(e.autoUpload||c.autoUpload)&&c.autoUpload!==!1&&c.isValidated&&c.submit()})})},send:function(b,c){var d=a(this).data("fileupload");return c.isValidated||(c.maxNumberOfFilesAdjusted||(d._adjustMaxNumberOfFiles(-c.files.length),c.maxNumberOfFilesAdjusted=!0),d._validate(c.files))?(c.context&&c.dataType&&"iframe"===c.dataType.substr(0,6)&&c.context.find(".progress").addClass(!a.support.transition&&"progress-animated").attr("aria-valuenow",100).find(".bar").css("width","100%"),d._trigger("sent",b,c)):!1},done:function(b,c){var e,d=a(this).data("fileupload");c.context?c.context.each(function(f){var g=a.isArray(c.result)&&c.result[f]||{error:"Empty file upload result"};g.error&&d._adjustMaxNumberOfFiles(1),d._transition(a(this)).done(function(){var f=a(this);e=d._renderDownload([g]).replaceAll(f),d._forceReflow(e),d._transition(e).done(function(){c.context=a(this),d._trigger("completed",b,c)})})}):(a.isArray(c.result)&&(a.each(c.result,function(a,b){c.maxNumberOfFilesAdjusted&&b.error?d._adjustMaxNumberOfFiles(1):c.maxNumberOfFilesAdjusted||b.error||d._adjustMaxNumberOfFiles(-1)}),c.maxNumberOfFilesAdjusted=!0),e=d._renderDownload(c.result).appendTo(d.options.filesContainer),d._forceReflow(e),d._transition(e).done(function(){c.context=a(this),d._trigger("completed",b,c)}))},fail:function(b,c){var e,d=a(this).data("fileupload");c.maxNumberOfFilesAdjusted&&d._adjustMaxNumberOfFiles(c.files.length),c.context?c.context.each(function(f){if("abort"!==c.errorThrown){var g=c.files[f];g.error=g.error||c.errorThrown||!0,d._transition(a(this)).done(function(){var f=a(this);e=d._renderDownload([g]).replaceAll(f),d._forceReflow(e),d._transition(e).done(function(){c.context=a(this),d._trigger("failed",b,c)})})}else d._transition(a(this)).done(function(){a(this).remove(),d._trigger("failed",b,c)})}):"abort"!==c.errorThrown?(c.context=d._renderUpload(c.files).appendTo(d.options.filesContainer).data("data",c),d._forceReflow(c.context),d._transition(c.context).done(function(){c.context=a(this),d._trigger("failed",b,c)})):d._trigger("failed",b,c)},progress:function(a,b){if(b.context){var c=parseInt(100*(b.loaded/b.total),10);b.context.find(".progress").attr("aria-valuenow",c).find(".bar").css("width",c+"%")}},progressall:function(b,c){var d=a(this),e=parseInt(100*(c.loaded/c.total),10),f=d.find(".fileupload-progress"),g=f.find(".progress-extended");g.length&&g.html(d.data("fileupload")._renderExtendedProgress(c)),f.find(".progress").attr("aria-valuenow",e).find(".bar").css("width",e+"%")},start:function(b){var c=a(this).data("fileupload");c._transition(a(this).find(".fileupload-progress")).done(function(){c._trigger("started",b)})},stop:function(b){var c=a(this).data("fileupload");c._transition(a(this).find(".fileupload-progress")).done(function(){a(this).find(".progress").attr("aria-valuenow","0").find(".bar").css("width","0%"),a(this).find(".progress-extended").html("&nbsp;"),c._trigger("stopped",b)})},destroy:function(b,c){var d=a(this).data("fileupload");c.url&&(a.ajax(c),d._adjustMaxNumberOfFiles(1)),d._transition(c.context).done(function(){a(this).remove(),d._trigger("destroyed",b,c)})}},_enableDragToDesktop:function(){var b=a(this),c=b.prop("href"),d=b.prop("download"),e="application/octet-stream";b.bind("dragstart",function(a){try{a.originalEvent.dataTransfer.setData("DownloadURL",[e,d,c].join(":"))}catch(b){}})},_adjustMaxNumberOfFiles:function(a){"number"==typeof this.options.maxNumberOfFiles&&(this.options.maxNumberOfFiles+=a,this.options.maxNumberOfFiles<1?this._disableFileInputButton():this._enableFileInputButton())},_formatFileSize:function(a){return"number"!=typeof a?"":a>=1e9?(a/1e9).toFixed(2)+" GB":a>=1e6?(a/1e6).toFixed(2)+" MB":(a/1e3).toFixed(2)+" KB"},_formatBitrate:function(a){return"number"!=typeof a?"":a>=1e9?(a/1e9).toFixed(2)+" Gbit/s":a>=1e6?(a/1e6).toFixed(2)+" Mbit/s":a>=1e3?(a/1e3).toFixed(2)+" kbit/s":a+" bit/s"},_formatTime:function(a){var b=new Date(1e3*a),c=parseInt(a/86400,10);return c=c?c+"d ":"",c+("0"+b.getUTCHours()).slice(-2)+":"+("0"+b.getUTCMinutes()).slice(-2)+":"+("0"+b.getUTCSeconds()).slice(-2)},_formatPercentage:function(a){return(100*a).toFixed(2)+" %"},_renderExtendedProgress:function(a){return this._formatBitrate(a.bitrate)+" | "+this._formatTime(8*(a.total-a.loaded)/a.bitrate)+" | "+this._formatPercentage(a.loaded/a.total)+" | "+this._formatFileSize(a.loaded)+" / "+this._formatFileSize(a.total)},_hasError:function(a){return a.error?a.error:this.options.maxNumberOfFiles<0?"Maximum number of files exceeded":this.options.acceptFileTypes.test(a.type)||this.options.acceptFileTypes.test(a.name)?this.options.maxFileSize&&a.size>this.options.maxFileSize?"File is too big":"number"==typeof a.size&&a.size<this.options.minFileSize?"File is too small":null:"Filetype not allowed"},_validate:function(b){var c=this,d=!!b.length;return a.each(b,function(a,b){b.error=c._hasError(b),b.error&&(d=!1)}),d},_renderTemplate:function(b,c){if(!b)return a();var d=b({files:c,formatFileSize:this._formatFileSize,options:this.options});return d instanceof a?d:a(this.options.templatesContainer).html(d).children()},_renderPreview:function(b,d){var e=this,f=this.options,g=a.Deferred();return(c&&c(b,function(b){d.append(b),e._forceReflow(d),e._transition(d).done(function(){g.resolveWith(d)}),a.contains(e.document[0].body,d[0])||g.resolveWith(d)},{maxWidth:f.previewMaxWidth,maxHeight:f.previewMaxHeight,canvas:f.previewAsCanvas})||g.resolveWith(d))&&g},_renderPreviews:function(b,c){var d=this,e=this.options;return c.find(".preview span").each(function(c,f){var g=b[c];e.previewSourceFileTypes.test(g.type)&&("number"!==a.type(e.previewSourceMaxFileSize)||g.size<e.previewSourceMaxFileSize)&&(d._processingQueue=d._processingQueue.pipe(function(){var b=a.Deferred();return d._renderPreview(g,a(f)).done(function(){b.resolveWith(d)}),b.promise()}))}),this._processingQueue},_renderUpload:function(a){return this._renderTemplate(this.options.uploadTemplate,a)},_renderDownload:function(a){return this._renderTemplate(this.options.downloadTemplate,a).find("a[download]").each(this._enableDragToDesktop).end()},_startHandler:function(b){b.preventDefault();var c=a(b.currentTarget),d=c.closest(".template-upload"),e=d.data("data");e&&e.submit&&!e.jqXHR&&e.submit()&&c.prop("disabled",!0)},_cancelHandler:function(b){b.preventDefault();var c=a(b.currentTarget).closest(".template-upload"),d=c.data("data")||{};d.jqXHR?d.jqXHR.abort():(d.errorThrown="abort",this._trigger("fail",b,d))},_deleteHandler:function(b){b.preventDefault();var c=a(b.currentTarget);this._trigger("destroy",b,a.extend({context:c.closest(".template-download"),type:"DELETE",dataType:this.options.dataType},c.data()))},_forceReflow:function(b){return a.support.transition&&b.length&&b[0].offsetWidth},_transition:function(b){var c=a.Deferred();return a.support.transition&&b.hasClass("fade")?b.bind(a.support.transition.end,function(d){d.target===b[0]&&(b.unbind(a.support.transition.end),c.resolveWith(b))}).toggleClass("in"):(b.toggleClass("in"),c.resolveWith(b)),c},_initButtonBarEventHandlers:function(){var b=this.element.find(".fileupload-buttonbar"),c=this.options.filesContainer;this._on(b.find(".start"),{click:function(a){a.preventDefault(),c.find(".start button").click()}}),this._on(b.find(".cancel"),{click:function(a){a.preventDefault(),c.find(".cancel button").click()}}),this._on(b.find(".delete"),{click:function(a){a.preventDefault(),c.find(".delete input:checked").siblings("button").click(),b.find(".toggle").prop("checked",!1)}}),this._on(b.find(".toggle"),{change:function(b){c.find(".delete input").prop("checked",a(b.currentTarget).is(":checked"))}})},_destroyButtonBarEventHandlers:function(){this._off(this.element.find(".fileupload-buttonbar button"),"click"),this._off(this.element.find(".fileupload-buttonbar .toggle"),"change.")},_initEventHandlers:function(){this._super(),this._on(this.options.filesContainer,{"click .start button":this._startHandler,"click .cancel button":this._cancelHandler,"click .delete button":this._deleteHandler}),this._initButtonBarEventHandlers()},_destroyEventHandlers:function(){this._destroyButtonBarEventHandlers(),this._off(this.options.filesContainer,"click"),this._super()},_enableFileInputButton:function(){this.element.find(".fileinput-button input").prop("disabled",!1).parent().removeClass("disabled")},_disableFileInputButton:function(){this.element.find(".fileinput-button input").prop("disabled",!0).parent().addClass("disabled")},_initTemplates:function(){var a=this.options;a.templatesContainer=this.document[0].createElement(a.filesContainer.prop("nodeName")),b&&(a.uploadTemplateId&&(a.uploadTemplate=b(a.uploadTemplateId)),a.downloadTemplateId&&(a.downloadTemplate=b(a.downloadTemplateId)))},_initFilesContainer:function(){var b=this.options;void 0===b.filesContainer?b.filesContainer=this.element.find(".files"):b.filesContainer instanceof a||(b.filesContainer=a(b.filesContainer))},_stringToRegExp:function(a){var b=a.split("/"),c=b.pop();return b.shift(),new RegExp(b.join("/"),c)},_initRegExpOptions:function(){var b=this.options;"string"===a.type(b.acceptFileTypes)&&(b.acceptFileTypes=this._stringToRegExp(b.acceptFileTypes)),"string"===a.type(b.previewSourceFileTypes)&&(b.previewSourceFileTypes=this._stringToRegExp(b.previewSourceFileTypes))},_initSpecialOptions:function(){this._super(),this._initFilesContainer(),this._initTemplates(),this._initRegExpOptions()},_create:function(){this._super(),this._refreshOptionsList.push("filesContainer","uploadTemplateId","downloadTemplateId"),this._processingQueue||(this._processingQueue=a.Deferred().resolveWith(this).promise(),this.process=function(){return this._processingQueue})},enable:function(){var a=!1;this.options.disabled&&(a=!0),this._super(),a&&(this.element.find("input, button").prop("disabled",!1),this._enableFileInputButton())},disable:function(){this.options.disabled||(this.element.find("input, button").prop("disabled",!0),this._disableFileInputButton()),this._super()}})});