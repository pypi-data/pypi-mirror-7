<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Python Web Service API &mdash; Tangelo Web Framework 0.7 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.7',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="_static/tangelo.ico"/>
    <link rel="top" title="Tangelo Web Framework 0.7 documentation" href="index.html" />
    <link rel="next" title="Tangelo JavaScript API" href="tangelo-js.html" />
    <link rel="prev" title="tangelo-passwd" href="tangelo-passwd-manpage.html" />
<link rel=stylesheet type=text/css href=_static/tangelo-sphinx.css />

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="tangelo-js.html" title="Tangelo JavaScript API"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="tangelo-passwd-manpage.html" title="tangelo-passwd"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Tangelo Web Framework 0.7 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="python-web-service-api">
<h1>Python Web Service API<a class="headerlink" href="#python-web-service-api" title="Permalink to this headline">¶</a></h1>
<p>The web service API is a collection of Python functions meant to help write web
service scripts in as &#8220;Pythonic&#8221; a way as possible.  The functionality is
divided into severul areas:  core services for generally useful utilities; HTTP
interaction, for manipulating request headers, retrieving request bodies, and
formatting errors; and web service utilities to supercharge Python services.</p>
<div class="section" id="core-services">
<h2>Core Services<a class="headerlink" href="#core-services" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="tangelo.log">
<tt class="descclassname">tangelo.</tt><tt class="descname">log</tt><big>(</big><em>msg</em><span class="optional">[</span>, <em>context</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#tangelo.log" title="Permalink to this definition">¶</a></dt>
<dd><p>Writes a message <tt class="docutils literal"><span class="pre">msg</span></tt> to the log file.  If <tt class="docutils literal"><span class="pre">context</span></tt> is supplied, it
will be prepended to the message within the log file.  This function may be
useful for debugging or otherwise tracking a service&#8217;s activities as it
runs.</p>
</dd></dl>

<dl class="function">
<dt id="tangelo.abspath">
<tt class="descclassname">tangelo.</tt><tt class="descname">abspath</tt><big>(</big><em>webpath</em><big>)</big><a class="headerlink" href="#tangelo.abspath" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes a &#8220;web path&#8221; and computes a disk path to the referenced file, <em>if</em> it
references a location within Tangelo&#8217;s legal web space.</p>
<p>The path, passed into argument <cite>webpath</cite>, must be an absolute web path;
i.e., it must begin with a slash.  If the second character of the path is a
tilde, it will be converted to a user home directory path, while non-tilde
paths will resolve to a location within Tangelo&#8217;s web root directory.</p>
<p>Path components such as <tt class="docutils literal"><span class="pre">.</span></tt> and <tt class="docutils literal"><span class="pre">..</span></tt> are resolved to yield a possible
absolute disk path; if this path lies outside of the legal web space, then
the function returns <tt class="docutils literal"><span class="pre">None</span></tt>; otherwise, it returns this path.</p>
<p>This function is useful for preventing errant paths from allowing a Tangelo
service to manipulate files that it shouldn&#8217;t, while yielding access to
files that are allowed.</p>
<p>For example, <cite>/~troi/libs</cite> would yield something like
<cite>/home/troi/tangelo_html/lib</cite>, and <cite>/section31/common/</cite> would yield
something like <cite>/srv/tangelo/section31/common</cite> because both paths refer to
subdirectories of an allowed directory - one in a user&#8217;s home directory, and
the other under the web root.  However, <cite>/~picard/../../libs</cite> would yield
<tt class="docutils literal"><span class="pre">None</span></tt>, since it does not refer to any file accessible via Tangelo.</p>
</dd></dl>

</div>
<div class="section" id="http-interaction">
<h2>HTTP Interaction<a class="headerlink" href="#http-interaction" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="tangelo.content_type">
<tt class="descclassname">tangelo.</tt><tt class="descname">content_type</tt><big>(</big><span class="optional">[</span><em>type</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#tangelo.content_type" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the content type for the current request, as a string.  If <tt class="docutils literal"><span class="pre">type</span></tt>
is specified, also sets the content type to the specified string.</p>
</dd></dl>

<dl class="function">
<dt id="tangelo.request_path">
<tt class="descclassname">tangelo.</tt><tt class="descname">request_path</tt><big>(</big><big>)</big><a class="headerlink" href="#tangelo.request_path" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the path of the current request.  This is generally the sequence of
path components following the domain and port number in a URL.</p>
</dd></dl>

<dl class="function">
<dt id="tangelo.request_body">
<tt class="descclassname">tangelo.</tt><tt class="descname">request_body</tt><big>(</big><big>)</big><a class="headerlink" href="#tangelo.request_body" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a filelike object that streams out the body of the current request.
This can be useful, e.g., for retrieving data submitted in the body for a
POST request.</p>
</dd></dl>

<dl class="class">
<dt id="tangelo.HTTPStatusCode">
<em class="property">class </em><tt class="descclassname">tangelo.</tt><tt class="descname">HTTPStatusCode</tt><big>(</big><em>code</em><span class="optional">[</span>, <em>description</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#tangelo.HTTPStatusCode" title="Permalink to this definition">¶</a></dt>
<dd><p>Constructs an HTTP status object signalling the status code given by <tt class="docutils literal"><span class="pre">code</span></tt>
and a custom description of the status given by <tt class="docutils literal"><span class="pre">description</span></tt>.  If
<tt class="docutils literal"><span class="pre">description</span></tt> is not specified, then a standard description will appear
based on the code (e.g., &#8220;Not Found&#8221; for code 404, etc.).</p>
<p>An <tt class="docutils literal"><span class="pre">HTTPStatusCode</span></tt> object can be returned from a Python service to cause
the server to raise that code instead of sending back a response.  This can
be useful to signal situations like bad arguments, failure to find the
requested object, etc.</p>
</dd></dl>

</div>
<div class="section" id="web-services-utilities">
<h2>Web Services Utilities<a class="headerlink" href="#web-services-utilities" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="tangelo.paths">
<tt class="descclassname">tangelo.</tt><tt class="descname">paths</tt><big>(</big><em>paths</em><big>)</big><a class="headerlink" href="#tangelo.paths" title="Permalink to this definition">¶</a></dt>
<dd><p>Augments the Python system path with the list of web directories specified
in <tt class="docutils literal"><span class="pre">paths</span></tt>.  Each path must be <strong>within the web root directory</strong> or
<strong>within a user&#8217;s web home directory</strong> (i.e., the paths must be legal with
respect to <tt class="docutils literal"><span class="pre">tangelo.legal_path()</span></tt>).</p>
<p>This function can be used to let web services access commonly used functions
that are implemented in their own Python modules somewhere in the web
filesystem.</p>
<p>After a service calling this function returns, the system path will be
restored to its original state.  This requires calling <tt class="docutils literal"><span class="pre">tangelo.paths()</span></tt>
in every function wishing to change the path, but prevents shadowing of
expected locations by modules with the same name in other directories, and
the uncontrolled growth of the <tt class="docutils literal"><span class="pre">sys.path</span></tt> variable.</p>
</dd></dl>

<dl class="function">
<dt id="tangelo.restful">
<tt class="descclassname">&#64;</tt><tt class="descclassname">tangelo.</tt><tt class="descname">restful</tt><a class="headerlink" href="#tangelo.restful" title="Permalink to this definition">¶</a></dt>
<dd><p>Marks a function in a Python service file as being part of that service&#8217;s
RESTful API.  This prevents accidental exposure of unmarked support
functions as part of the API, and also enables the use of arbitrary words as
REST verbs (so long as those words are also valid Python function names).
An example usage might look like the following, which uses a both a standard
verb (&#8220;GET&#8221;) and a custom one (&#8220;NORMALIZE&#8221;).</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">tangelo</span>

<span class="nd">@tangelo.restful</span>
<span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">bar</span><span class="p">,</span> <span class="n">baz</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="nd">@tangelo.restful</span>
<span class="k">def</span> <span class="nf">normalize</span><span class="p">():</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>Note that Tangelo automatically converts the verb used by the web client to
all lowercase letters before searching the Python module for a matching
function to call.</p>
</dd></dl>

<dl class="function">
<dt id="tangelo.types">
<tt class="descclassname">&#64;</tt><tt class="descclassname">tangelo.</tt><tt class="descname">types</tt><big>(</big><span class="optional">[</span><em>ptype1</em>, <em>...</em>, <em>ptypeN</em>, <span class="optional">]</span><em>kwarg1=kwtype1</em>, <em>...</em>, <em>kwargN=kwtypeN</em><big>)</big><a class="headerlink" href="#tangelo.types" title="Permalink to this definition">¶</a></dt>
<dd><p>Decorates a service by converting it from a function of several string arguments
to a function taking typed arguments.  Each argument to <tt class="docutils literal"><span class="pre">tangelo.types()</span></tt> is a
function that converts strings to some other type - the standard Python
functions <tt class="docutils literal"><span class="pre">int()</span></tt>, <tt class="docutils literal"><span class="pre">float()</span></tt>, and <tt class="docutils literal"><span class="pre">json.loads()</span></tt> are good examples.  The
positional and keyword arguments represent the types of the positional and
keyword arguments, respectively, of the function.  For example, the following
code snippet</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">tangelo</span>

<span class="k">def</span> <span class="nf">stringfunc</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>

<span class="nd">@types</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">intfunc</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>

<span class="k">print</span> <span class="n">stringfunc</span><span class="p">(</span><span class="s">&quot;3&quot;</span><span class="p">,</span> <span class="s">&quot;4&quot;</span><span class="p">)</span>
<span class="k">print</span> <span class="n">intfunc</span><span class="p">(</span><span class="s">&quot;3&quot;</span><span class="p">,</span> <span class="s">&quot;4&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>will print:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="mi">34</span>
<span class="mi">7</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">stringfunc()</span></tt> performs string concatentation, while <tt class="docutils literal"><span class="pre">intfunc()</span></tt> performs
addition on strings that have been converted to integers.</p>
<p>Though the names of the built-in conversion functions make this decorator look
like it accepts &#8220;types&#8221; as arguments, any function that maps strings to any type
can be used.  For instance, a string representing the current time could be
consumed by a function that parses the string and returns a Python <tt class="docutils literal"><span class="pre">datetime</span></tt>
object, or, as mentioned above, <tt class="docutils literal"><span class="pre">json.loads()</span></tt> could be used to convert
arbitrary JSON data into Python objects.</p>
<p>If an exception is raised by any of the conversion functions, its error message
will be passed back to the client via a <a class="reference internal" href="#tangelo.HTTPStatusCode" title="tangelo.HTTPStatusCode"><tt class="xref py py-class docutils literal"><span class="pre">tangelo.HTTPStatusCode</span></tt></a>
object.</p>
</dd></dl>

<dl class="function">
<dt id="tangelo.return_type">
<tt class="descclassname">&#64;</tt><tt class="descclassname">tangelo.</tt><tt class="descname">return_type</tt><big>(</big><em>type</em><big>)</big><a class="headerlink" href="#tangelo.return_type" title="Permalink to this definition">¶</a></dt>
<dd><p>Similarly to how <a class="reference internal" href="#tangelo.types" title="tangelo.types"><tt class="xref py py-func docutils literal"><span class="pre">tangelo.types()</span></tt></a> works, this decorator can be used to
provide a function to convert the return value of a service function to some
other type or form.  By default, return values are converted to JSON via the
standard <tt class="docutils literal"><span class="pre">json.dumps()</span></tt> function.  However, this may not be sufficient in
certain cases.  For example, the <tt class="docutils literal"><span class="pre">bson.dumps()</span></tt> is a function provided by
PyMongo that can handle certain types of objects that <tt class="docutils literal"><span class="pre">json.dumps()</span></tt> cannot,
such as <tt class="docutils literal"><span class="pre">datetime</span></tt> objects.  In such a case, the service module can provide
whatever functions it needs (e.g., by <tt class="docutils literal"><span class="pre">import</span></tt>ing an appropriate module or
package) then naming the conversion function in this decorator.</p>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Python Web Service API</a><ul>
<li><a class="reference internal" href="#core-services">Core Services</a></li>
<li><a class="reference internal" href="#http-interaction">HTTP Interaction</a></li>
<li><a class="reference internal" href="#web-services-utilities">Web Services Utilities</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="tangelo-passwd-manpage.html"
                        title="previous chapter"><tt class="docutils literal"><span class="pre">tangelo-passwd</span></tt></a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="tangelo-js.html"
                        title="next chapter">Tangelo JavaScript API</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/tangelo-py.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="tangelo-js.html" title="Tangelo JavaScript API"
             >next</a> |</li>
        <li class="right" >
          <a href="tangelo-passwd-manpage.html" title="tangelo-passwd"
             >previous</a> |</li>
        <li><a href="index.html">Tangelo Web Framework 0.7 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Kitware, Inc..
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>