

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Schevo Transaction Hook Methods &mdash; libschevo 3.2.4 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.2.4',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="libschevo 3.2.4 documentation" href="../index.html" />
    <link rel="up" title="Schevo References" href="index.html" />
    <link rel="next" title="Schevo Database Usage Reference" href="database-usage.html" />
    <link rel="prev" title="t namespaces and transaction methods" href="t_namespaces.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="database-usage.html" title="Schevo Database Usage Reference"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="t_namespaces.html" title="t namespaces and transaction methods"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">libschevo 3.2.4 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Schevo References</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="schevo-transaction-hook-methods">
<h1>Schevo Transaction Hook Methods<a class="headerlink" href="#schevo-transaction-hook-methods" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Transaction hooks make it easy to change specific behavior of default
transaction classes.  You can customize the following behaviors:</p>
<ul class="simple">
<li>Setup of a transaction instance.</li>
<li>What happens just before standard transaction execution.</li>
<li>What happens just after standard transaction execution.</li>
</ul>
</div>
<div class="section" id="doctest-setup">
<h2>Doctest Setup<a class="headerlink" href="#doctest-setup" title="Permalink to this headline">¶</a></h2>
<p>This document also functions as a doctest:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">schevo.test</span> <span class="kn">import</span> <span class="n">DocTest</span>
</pre></div>
</div>
</div>
<div class="section" id="subclassing-in-general">
<h2>Subclassing in general<a class="headerlink" href="#subclassing-in-general" title="Permalink to this headline">¶</a></h2>
<p>Define each subclass as an inner class of the entity class that you are
overriding.  Begin the class name with an underscore, then the name of
the transaction you are overriding.  Inherit from the name of the transaction
in the <tt class="docutils literal"><span class="pre">T</span></tt> namespace.  For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">Entity</span><span class="p">):</span>

    <span class="n">bar</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">string</span><span class="p">()</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">integer</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">_Create</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">Create</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="k">class</span> <span class="nc">_Delete</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">Delete</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="k">class</span> <span class="nc">_Update</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">Update</span><span class="p">):</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>You can also create custom transactions that have names that differ
from the standard ones shown above.  Remember to set up a <cite>t</cite> method
so you can create instances of your new transaction:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">Entity</span><span class="p">):</span>

    <span class="n">bar</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">string</span><span class="p">()</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">integer</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">t_custom_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">E</span><span class="o">.</span><span class="n">Foo</span><span class="o">.</span><span class="n">_CustomUpdate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">_CustomUpdate</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">Update</span><span class="p">):</span>
        <span class="o">...</span>
</pre></div>
</div>
<div class="section" id="overriding-init-and-execute-not-allowed">
<h3>Overriding __init__ and _execute not allowed<a class="headerlink" href="#overriding-init-and-execute-not-allowed" title="Permalink to this headline">¶</a></h3>
<p>Overriding <cite>__init__</cite> or <cite>_execute</cite> in most <cite>Transaction</cite> subclasses
is not allowed.  If you attempt to do so, Schevo will raise a
<cite>schevo.error.TransactionExecuteRedefinitionRestricted</cite> exception:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">DocTest</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="gp">... </span><span class="s">    class Foo(E.Entity):</span>
<span class="gp">...</span><span class="s"></span>
<span class="gp">... </span><span class="s">        bar = f.string()</span>
<span class="gp">...</span><span class="s"></span>
<span class="gp">... </span><span class="s">        class _Create(T.Create):</span>
<span class="gp">...</span><span class="s"></span>
<span class="gp">... </span><span class="s">            def _execute(self, db):</span>
<span class="gp">... </span><span class="s">                pass</span>
<span class="gp">... </span><span class="s">&quot;&quot;&quot;</span><span class="p">)</span> 
<span class="gt">Traceback (most recent call last):</span>
    <span class="o">...</span>
<span class="nc">TransactionExecuteRedefinitionRestricted</span>: <span class="n-Identifier">...</span>
</pre></div>
</div>
<p>Classes that have a <cite>_restrict_subclasses</cite> attribute set to <cite>True</cite>
enforce the above restriction.  They include the following:</p>
<ul class="simple">
<li>Combination</li>
<li>Create</li>
<li>Delete</li>
<li>Update</li>
<li>Inverse</li>
<li>Initialize</li>
<li>Populate</li>
<li>CallableWrapper</li>
</ul>
</div>
<div class="section" id="overriding-hook-methods">
<h3>Overriding hook methods<a class="headerlink" href="#overriding-hook-methods" title="Permalink to this headline">¶</a></h3>
<p>When implementing the hooks listed below, remember that you can raise
an exception at any point to veto an operation.  Any changes to the database
made by the transaction will be reversed, and control will return to the
parent transaction execution, if one exists.</p>
</div>
<div class="section" id="adding-and-overriding-fields">
<h3>Adding and overriding fields<a class="headerlink" href="#adding-and-overriding-fields" title="Permalink to this headline">¶</a></h3>
<p>Subclasses of Create, Delete, and Update transactions that are defined as
inner classes of an entity class inherit the field definitions from the
entity class.</p>
<p>When a field with a new name is defined in a transaction subclass, it is
added to the end of the existing field definitions.  For example, the
Update class here has three fields, <tt class="docutils literal"><span class="pre">bar</span></tt>, <tt class="docutils literal"><span class="pre">count</span></tt>, and <tt class="docutils literal"><span class="pre">baz</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">Entity</span><span class="p">):</span>

    <span class="n">bar</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">string</span><span class="p">()</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">integer</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">_Update</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">Update</span><span class="p">):</span>

        <span class="n">baz</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="s">&#39;Baz&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>When a field with an existing name is defined, it replaces the old field
definition and is added to the end.  For example, the Update class here has
two fields, <tt class="docutils literal"><span class="pre">count</span></tt> and <tt class="docutils literal"><span class="pre">bar</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">Entity</span><span class="p">):</span>

    <span class="n">bar</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">string</span><span class="p">()</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">integer</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">_Update</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">Update</span><span class="p">):</span>

        <span class="n">bar</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="s">&#39;Bar&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>To change the properties of a field without changing the order of it,
make those changes in the <tt class="docutils literal"><span class="pre">_setup</span></tt> method by using the <tt class="docutils literal"><span class="pre">f</span></tt> namespace:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">Entity</span><span class="p">):</span>

    <span class="n">bar</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">string</span><span class="p">()</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">integer</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">_Update</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">Update</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">count</span><span class="o">.</span><span class="n">hidden</span> <span class="o">=</span> <span class="bp">True</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="available-hook-methods">
<h2>Available hook methods<a class="headerlink" href="#available-hook-methods" title="Permalink to this headline">¶</a></h2>
<div class="section" id="create-subclasses">
<h3>Create subclasses<a class="headerlink" href="#create-subclasses" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">_setup(self)</span></tt></dt>
<dd>Called during <tt class="docutils literal"><span class="pre">__init__</span></tt> after setting fields based on keyword
arguments, before setting default values for fields that weren&#8217;t assigned
a value.</dd>
<dt><tt class="docutils literal"><span class="pre">_before_execute(self,</span> <span class="pre">db)</span></tt></dt>
<dd>Called during transaction execution, before the create operation takes
place.</dd>
<dt><tt class="docutils literal"><span class="pre">_after_execute(self,</span> <span class="pre">db,</span> <span class="pre">entity)</span></tt></dt>
<dd>Called during transaction execution, after the create operation takes
place.  The newly-created entity is passed in.</dd>
</dl>
</div>
<div class="section" id="delete-subclasses">
<h3>Delete subclasses<a class="headerlink" href="#delete-subclasses" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">_setup(self)</span></tt></dt>
<dd>Called at end of <tt class="docutils literal"><span class="pre">__init__</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">_before_execute(self,</span> <span class="pre">db,</span> <span class="pre">entity)</span></tt></dt>
<dd>Called during transaction execution, before the delete operation takes
place.  The entity about to be deleted is passed in.</dd>
<dt><tt class="docutils literal"><span class="pre">_after_execute(self,</span> <span class="pre">db)</span></tt></dt>
<dd>Called during transaction execution, after the delete operation has
taken place.</dd>
</dl>
</div>
<div class="section" id="update-subclasses">
<h3>Update subclasses<a class="headerlink" href="#update-subclasses" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">_setup(self)</span></tt></dt>
<dd>Called at end of <tt class="docutils literal"><span class="pre">__init__</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">_before_execute(self,</span> <span class="pre">db,</span> <span class="pre">entity)</span></tt></dt>
<dd>Called during transaction execution, before the update operation takes
place.  The entity about to be updated is passed in.</dd>
<dt><tt class="docutils literal"><span class="pre">_after_execute(self,</span> <span class="pre">db,</span> <span class="pre">entity)</span></tt></dt>
<dd>Called during transaction execution, after the update operation has
taken place.  The entity that was just updated is passed in.</dd>
</dl>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Schevo Transaction Hook Methods</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#doctest-setup">Doctest Setup</a></li>
<li><a class="reference internal" href="#subclassing-in-general">Subclassing in general</a><ul>
<li><a class="reference internal" href="#overriding-init-and-execute-not-allowed">Overriding __init__ and _execute not allowed</a></li>
<li><a class="reference internal" href="#overriding-hook-methods">Overriding hook methods</a></li>
<li><a class="reference internal" href="#adding-and-overriding-fields">Adding and overriding fields</a></li>
</ul>
</li>
<li><a class="reference internal" href="#available-hook-methods">Available hook methods</a><ul>
<li><a class="reference internal" href="#create-subclasses">Create subclasses</a></li>
<li><a class="reference internal" href="#delete-subclasses">Delete subclasses</a></li>
<li><a class="reference internal" href="#update-subclasses">Update subclasses</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="t_namespaces.html"
                        title="previous chapter">t namespaces and transaction methods</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="database-usage.html"
                        title="next chapter">Schevo Database Usage Reference</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/reference/transaction-hook-methods.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="database-usage.html" title="Schevo Database Usage Reference"
             >next</a> |</li>
        <li class="right" >
          <a href="t_namespaces.html" title="t namespaces and transaction methods"
             >previous</a> |</li>
        <li><a href="../index.html">libschevo 3.2.4 documentation</a> &raquo;</li>
          <li><a href="index.html" >Schevo References</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Etienne Robillard.
      Last updated on Nov 17, 2012.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>