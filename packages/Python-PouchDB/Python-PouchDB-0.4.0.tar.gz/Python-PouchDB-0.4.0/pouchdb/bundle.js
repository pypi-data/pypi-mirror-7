!function e(t,n,r){function o(s,u){if(!n[s]){if(!t[s]){var a="function"==typeof require&&require;if(!u&&a)return a(s,!0);if(i)return i(s,!0);throw new Error("Cannot find module '"+s+"'")}var c=n[s]={exports:{}};t[s][0].call(c.exports,function(e){var n=t[s][1][e];return o(n?n:e)},c,c.exports,e,t,n,r)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(e,t,n){(function(e){"use strict";function t(t,n){t=t||[],n=n||{};try{return new e.Blob(t,n)}catch(r){if("TypeError"!==r.name)throw r;for(var o=e.BlobBuilder||e.MSBlobBuilder||e.MozBlobBuilder||e.WebKitBlobBuilder,i=new o,s=0;s<t.length;s+=1)i.append(t[s]);return i.getBlob(n.type)}}function r(e,t,n){function r(e){return function(t){i[e]=t,i._count+=1,s===i._count&&n(i)}}var o,i={_count:0},s=0;for(o in t)s+=1;for(o in t){var u=r(o);try{e(t[o],u)}catch(a){u(void 0)}}s||n(i)}function o(t,c,l){if(c instanceof e.Blob)i(c,function(e){l({type:"_js_returned_blob",blobType:c.type,data:e})});else if("object"==typeof c&&null!==c&&c.constructor!==Date)if(u+=1,u>a)l("recursion limit reached");else{var f=o.bind(null,c);r(f,c,function(e){u-=1,c instanceof Array?(e.length=e._count,e=s(e)):c instanceof Error&&(e.message=c.toString()),delete e._count,l(e)})}else if("function"==typeof c){var d=n.functions.push(c.bind(t))-1;l({type:"_js_returned_function",functionId:d})}else l(c)}function i(t,n){var r=new e.FileReader;r.onload=function(){var e=r.result,t=e.split(",")[1];n(t)},r.readAsDataURL(t)}function s(e){return Array.prototype.slice.call(e,0)}n.objects={},n.functions=[];var u,a=5;n.debug=function(){console.log(1===arguments.length?arguments[0]:s(arguments))},n.b64toBlob=function(n){function r(e){return e.charCodeAt(0)}for(var o=1024,i=e.atob(n),s=[],u=0;u<i.length;u+=o){var a=i.slice(u,u+o),c=Array.prototype.map.call(a,r),l=new e.Uint8Array(c);s.push(l.buffer)}return t(s)};var c={};n.createCallback=function(e){return"undefined"==typeof c[e]&&(c[e]=function(){u=0;var t=o.bind(null,null);r(t,s(arguments),function(t){t.length=t._count;var n=s(t);gate.callbackCalled(e,JSON.stringify(n))})}),c[e]}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(){"use strict";Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,r=function(){},o=function(){var o=this instanceof r&&e?this:e,i=t.concat(Array.prototype.slice.call(arguments));return n.apply(o,i)};return r.prototype=this.prototype,o.prototype=new r,o})},{}],3:[function(e){(function(t){"use strict";e("./compat.js");var n=e("extend"),r=e("./bridge.js"),o=e("pouchdb"),i=e("pouchdb-gql"),s=e("geopouch"),u=e("pouchdb-search"),a=e("pouchdb-validation"),c=e("pouchdb-show"),l=e("pouchdb-list"),f=e("pouchdb-update");o.prefix="",o.plugin(i),o.plugin(s),o.plugin({search:u}),o.plugin(a),o.plugin(c),o.plugin(l),o.plugin(f),t.PouchDB=o,n(t,r);var d=e("pouchdb-authentication");o.plugin(d)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./bridge.js":1,"./compat.js":2,extend:4,geopouch:5,pouchdb:101,"pouchdb-authentication":16,"pouchdb-gql":20,"pouchdb-list":21,"pouchdb-search":48,"pouchdb-show":49,"pouchdb-update":65,"pouchdb-validation":78}],4:[function(e,t){function n(e){if(!e||"[object Object]"!==o.call(e)||e.nodeType||e.setInterval)return!1;var t=r.call(e,"constructor"),n=r.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!t&&!n)return!1;var i;for(i in e);return void 0===i||r.call(e,i)}var r=Object.prototype.hasOwnProperty,o=Object.prototype.toString;t.exports=function i(){var e,t,r,o,s,u,a=arguments[0]||{},c=1,l=arguments.length,f=!1;for("boolean"==typeof a&&(f=a,a=arguments[1]||{},c=2),"object"!=typeof a&&"function"!=typeof a&&(a={});l>c;c++)if(null!=(e=arguments[c]))for(t in e)r=a[t],o=e[t],a!==o&&(f&&o&&(n(o)||(s=Array.isArray(o)))?(s?(s=!1,u=r&&Array.isArray(r)?r:[]):u=r&&n(r)?r:{},a[t]=i(f,u,o)):void 0!==o&&(a[t]=o));return a}},{}],5:[function(require,module,exports){function normalizeKey(e){var t=[],n=null;if(!isArray(e)&&"object"==typeof e)return{key:calculateBbox(e),geometry:e};isArray(e[0])||"object"!=typeof e[0]||(t=calculateBbox(e[0]),n=e[0],e=e.slice(1));for(var r=0;r<e.length;r++)t.push(isArray(e[r])?e[r]:[e[r],e[r]]);return{key:t,geometry:n}}function within(e,t,n){for(var r,o,i=0;i<e.length;i++)if(r=e[i][0],o=e[i][1],!(null===t[i]&&(r<=n[i]||null===n[i])||r<=n[i]||null===n[i])||!(null===n[i]&&(o>=t[i]||null===t[i])||o>=t[i]||null===t[i]))return!1;return!0}function viewQuery(db,fun,options){return promise(function(success,failure){function emit(e,t){var n=normalizeKey(e),r={id:current.doc._id,key:n.key,value:t,geometry:n.geometry};if(void 0===options.start_range||void 0===options.end_range||within(n.key,options.start_range,options.end_range)){if(num_started++,options.include_docs){if(t&&"object"==typeof t&&t._id)return void db.get(t._id).then(function(e){r.doc=e},function(){}).then(function(){results.push(r),checkComplete()});r.doc=current.doc}results.push(r)}}function checkComplete(){return completed&&results.length==num_started?success({rows:results}):void 0}var results=[],current=null,num_started=0,completed=!1;eval("fun = "+fun.toString()+";");var conflicts="conflicts"in options?options.conflicts:!1;db.changes({conflicts:conflicts,include_docs:!0,onChange:function(e){"deleted"in e||0===e.id.indexOf("_design/")||(current={doc:e.doc},fun.call(this,e.doc))},complete:function(){completed=!0,checkComplete()}})})}function httpQuery(e,t,n){var r=denodify(e.request),o=[];"undefined"!=typeof n.skip&&o.push("skip="+encodeURIComponent(JSON.stringify(n.skip))),"undefined"!=typeof n.limit&&o.push("limit="+encodeURIComponent(JSON.stringify(n.limit))),"undefined"!=typeof n.start_range&&o.push("start_range="+encodeURIComponent(JSON.stringify(n.start_range))),"undefined"!=typeof n.end_range&&o.push("end_range="+encodeURIComponent(JSON.stringify(n.end_range))),"undefined"!=typeof n.key&&o.push("key="+encodeURIComponent(JSON.stringify(n.key))),o=o.join("&"),o=""===o?"":"?"+o;var i=t.split("/");return r({method:"GET",url:"_design/"+i[0]+"/_spatial/"+i[1]+o})}function spatialQuery(e,t,n){if("http"===e.type())return httpQuery(e,t,n);var r=t.split("/");return e.get("_design/"+r[0]).then(function(t){return viewQuery(e,t.spatial[r[1]],n)})}function rotateCoords(e){var t=e[0],n=e[1];return t.map(function(e,t){return[e,n[t]]})}function calculateBbox(e){return rotateCoords(calculatebounds(e))}var promise=require("lie"),denodify=require("lie-denodify"),calculatebounds=require("geojson-bounding-volume"),isArray=Array.isArray||function(e){return e instanceof Array};exports.spatial=function(e,t,n){"function"==typeof t&&(n=t,t={}),n=n||function(){},t=t||{};var r;return r="string"!=typeof e?promise(function(e,t){t({status:400,error:"invalid_request",reason:"Querying with a function is not supported for Spatial Views"})}):spatialQuery(this,e,t),r.then(function(e){n(null,e)},n),r},exports.calculateBbox=calculateBbox},{"geojson-bounding-volume":6,lie:8,"lie-denodify":7}],6:[function(e,t){function n(e){var t=e.coordinates;if("Point"===e.type)return[t,t];for("GeometryCollection"===e.type&&(t=e.geometries.map(function(e){return n(e)}));Array.isArray(t[0][0]);)t=t.reduce(function(e,t){return e.concat(t)});return t.reduce(function(e,t){return null===e?[t,t]:[e[0].map(function(e,n){return Math.min(e,t[n])}),e[1].map(function(e,n){return Math.max(e,t[n])})]},null)}t.exports=n},{}],7:[function(e,t){function n(e){return function(){var t=Array.prototype.concat.apply([],arguments);return r(function(n,r){t.push(function(e,t){e?r(e):n(t)}),e.apply(void 0,t)})}}var r=e("lie");t.exports=n},{lie:8}],8:[function(e,t){"use strict";function n(e,t,n){a?Object.defineProperty(e,t,{value:n,configurable:!0,writable:!0}):e[t]=n}function r(e){return this instanceof r?(n(this,"successQueue",[]),n(this,"failureQueue",[]),n(this,"resolved",!1),void("function"==typeof e&&this.resolvePassed(e))):new r(e)}function o(e,t,n){n&&"function"==typeof n.then?n.then(e,t):e(n)}function i(e,t,n){function o(){var o=arguments[n];return"function"!=typeof o?e:new r(function(e,n){u(s,o,t,e,n)})}return o}function s(e,t,n,r){try{o(n,r,e(t))}catch(i){r(i)}}var u=e("immediate"),a=!1;!function(){try{Object.defineProperty({},"test",{value:!0}),a=!0}catch(e){}}(),n(r.prototype,"resolvePassed",function(e){try{e(this.fulfillUnwrap.bind(this),this.reject.bind(this))}catch(t){this.reject(t)}}),n(r.prototype,"reject",function(e){this.resolve(!1,e)}),n(r.prototype,"fulfill",function(e){this.resolve(!0,e)}),n(r.prototype,"fulfillUnwrap",function(e){o(this.fulfill.bind(this),this.reject.bind(this),e)}),r.prototype.then=function(e,t){return this.resolved?this.resolved(e,t):this.pending(e,t)},function(){try{r.prototype["catch"]=function(e){return this.then(null,e)}}catch(e){}}(),n(r.prototype,"pending",function(e,t){var n=this;return new r(function(r,o){n.successQueue.push("function"==typeof e?{resolve:r,reject:o,callback:e}:{next:r,callback:!1}),n.failureQueue.push("function"==typeof t?{resolve:r,reject:o,callback:t}:{next:o,callback:!1})})}),n(r.prototype,"resolve",function(e,t){if(!this.resolved){this.resolved=i(this,t,e?0:1);for(var n=e?this.successQueue:this.failureQueue,r=n.length,o=-1;++o<r;)n[o].callback?u(s,n[o].callback,t,n[o].resolve,n[o].reject):n[o].next(t)}}),t.exports=r},{immediate:10}],9:[function(e,t,n){"use strict";n.test=function(){return!1}},{}],10:[function(e,t){"use strict";function n(){var e,t=0,n=i;for(i=[];e=n[t++];)e()}for(var r,o=[e("./nextTick"),e("./mutation"),e("./postMessage"),e("./messageChannel"),e("./stateChange"),e("./timeout")],i=[],s=-1,u=o.length;++s<u;)if(o[s].test()){r=o[s].install(n);break}t.exports=function(e){var t,o,s,u=e;if(arguments.length>1&&"function"==typeof e){for(s=new Array(arguments.length-1),o=0;++o<arguments.length;)s[o-1]=arguments[o];u=function(){e.apply(void 0,s)}}return 1===(t=i.push(u))&&r(n),t},t.exports.clear=function(e){return e<=i.length&&(i[e-1]=function(){}),this}},{"./messageChannel":11,"./mutation":12,"./nextTick":9,"./postMessage":13,"./stateChange":14,"./timeout":15}],11:[function(e,t,n){(function(e){"use strict";n.test=function(){return"undefined"!=typeof e.MessageChannel},n.install=function(t){var n=new e.MessageChannel;return n.port1.onmessage=t,function(){n.port2.postMessage(0)}}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],12:[function(e,t,n){(function(e){"use strict";var t=e.MutationObserver||e.WebKitMutationObserver;n.test=function(){return t},n.install=function(n){var r=0,o=new t(n),i=e.document.createTextNode("");return o.observe(i,{characterData:!0}),function(){i.data=r=++r%2}}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],13:[function(e,t,n){(function(e){"use strict";n.test=function(){if(!e.postMessage||e.importScripts)return!1;var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t},n.install=function(t){function n(n){n.source===e&&n.data===r&&t()}var r="com.calvinmetcalf.setImmediate"+Math.random();return e.addEventListener?e.addEventListener("message",n,!1):e.attachEvent("onmessage",n),function(){e.postMessage(r,"*")}}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],14:[function(e,t,n){(function(e){"use strict";n.test=function(){return"document"in e&&"onreadystatechange"in e.document.createElement("script")},n.install=function(t){return function(){var n=e.document.createElement("script");return n.onreadystatechange=function(){t(),n.onreadystatechange=null,n.parentNode.removeChild(n),n=null},e.document.documentElement.appendChild(n),t}}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],15:[function(e,t,n){"use strict";n.test=function(){return!0},n.install=function(e){return function(){setTimeout(e,0)}}},{}],16:[function(e,t,n){"use strict";function r(e){return function(t,n){return t&&"unknown_error"===t.name&&(t.message=(t.message||"")+" Unknown error!  Did you remember to enable CORS?"),e(t,n)}}function o(e){this.status=400,this.name="authentication_error",this.message=e,this.error=!0;try{Error.captureStackTrace(this,o)}catch(t){}}var i=e("./utils");n.signup=i.toPromise(function(e,t,n,s){var u=this,a=u.constructor,c=a.utils;if("undefined"==typeof s&&(s="undefined"==typeof n?"undefined"==typeof t?e:t:n,n={}),-1===["http","https"].indexOf(u.type()))return s(new o("this plugin only works for the http/https adapter"));if(!e)return s(new o("you must provide a username"));if(!t)return s(new o("you must provide a password"));var l="org.couchdb.user:"+e,f={name:e,password:t,roles:n.roles||[],type:"user",_id:l},d=["name","password","roles","type"];if(n.metadata){for(var p in n.metadata)if(n.hasOwnProperty(p)&&(-1!==d.indexOf(p)||p.startsWith("_")))return s(new o('cannot use reserved word in metadata: "'+p+'"'));f=c.extend(!0,f,n.metadata)}var h=i.getUsersUrl(u)+"/"+encodeURIComponent(l),v=c.extend(!0,{method:"PUT",url:h,body:f},n.ajax||{});c.ajax(v,r(s))}),n.signUp=n.signup,n.login=i.toPromise(function(e,t,n,s){var u=this,a=u.constructor,c=a.utils;if("undefined"==typeof s&&(s=n,n={}),-1===["http","https"].indexOf(u.type()))return s(new o("this plugin only works for the http/https adapter"));if(!e)return s(new o("you must provide a username"));if(!t)return s(new o("you must provide a password"));var l=c.extend(!0,{method:"POST",url:i.getSessionUrl(u),body:{name:e,password:t}},n.ajax||{});c.ajax(l,r(s))}),n.logIn=n.login,n.logout=i.toPromise(function(e,t){var n=this,o=n.constructor,s=o.utils;"undefined"==typeof t&&(t=e,e={});var u=s.extend(!0,{method:"DELETE",url:i.getSessionUrl(n)},e.ajax||{});s.ajax(u,r(t))}),n.logOut=n.logout,n.getSession=i.toPromise(function(e,t){var n=this,o=n.constructor,s=o.utils;"undefined"==typeof t&&(t=e,e={});var u=i.getSessionUrl(n),a=s.extend(!0,{method:"GET",url:u},e.ajax||{});s.ajax(a,r(t))}),n.getUser=i.toPromise(function(e,t,n){var s=this,u=s.constructor,a=u.utils;if("undefined"==typeof n&&(n="undefined"==typeof t?e:t,t={}),!e)return n(new o("you must provide a username"));var c=i.getUsersUrl(s),l=a.extend(!0,{method:"GET",url:c+"/"+encodeURIComponent("org.couchdb.user:"+e)},t.ajax||{});a.ajax(l,r(n))}),i.inherits(o,Error),"undefined"!=typeof window&&window.PouchDB&&window.PouchDB.plugin(n)},{"./utils":18}],17:[function(e,t){t.exports="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],18:[function(e,t,n){(function(t,r){"use strict";function o(e){return e.getUrl().replace(/\/[^\/]+\/?$/,"")}var i;i="undefined"!=typeof window&&window.PouchDB?window.PouchDB.utils.Promise:"function"==typeof r.Promise?r.Promise:e("lie"),n.getUsersUrl=function(e){return o(e)+"/_users"},n.getSessionUrl=function(e){return o(e)+"/_session"},n.once=function(e){var t=!1;return n.getArguments(function(n){if(t)throw console.trace(),new Error("once called  more than once");t=!0,e.apply(this,n)})},n.getArguments=function(e){return function(){for(var t=arguments.length,n=new Array(t),r=-1;++r<t;)n[r]=arguments[r];return e.call(this,n)}},n.toPromise=function(e){return n.getArguments(function(r){var o,s=this,u="function"==typeof r[r.length-1]?r.pop():!1;u&&(o=function(e,n){t.nextTick(function(){u(e,n)})});var a=new i(function(t,o){try{var i=n.once(function(e,n){e?o(e):t(n)});r.push(i),e.apply(s,r)}catch(u){o(u)}});return o&&a.then(function(e){o(null,e)},o),a.cancel=function(){return this},a})},n.inherits=e("inherits")}).call(this,e("/home/marten/npm/lib/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"/home/marten/npm/lib/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":139,inherits:17,lie:137}],19:[function(e,t){"use strict";function n(e,t){for(var n=Math.min(e.length,t.length),r=0;n>r;r++){var o=s(e[r],t[r]);if(0!==o)return o}return e.length===t.length?0:e.length>t.length?1:-1}function r(e,t){return e===t?0:e>t?1:-1}function o(e,t){for(var n=Object.keys(e),r=Object.keys(t),o=Math.min(n.length,r.length),i=0;o>i;i++){var u=s(n[i],r[i]);if(0!==u)return u;if(u=s(e[n[i]],t[r[i]]),0!==u)return u}return n.length===r.length?0:n.length>r.length?1:-1}function i(e){var t=["boolean","number","string","object"];return-1!==t.indexOf(typeof e)?null===e?1:t.indexOf(typeof e)+2:Array.isArray(e)?4.5:void 0}function s(e,t){var s=i(e),u=i(t);return s-u!==0?s-u:null===e?0:"number"==typeof e?e-t:"boolean"==typeof e?e===t?0:t>e?-1:1:"string"==typeof e?r(e,t):Array.isArray(e)?n(e,t):"object"==typeof e?o(e,t):void 0}t.exports=s},{}],20:[function(e,t,n){"use strict";function r(e,t,n){function r(e){return/max|average|min|sum|count/.test(e)}function s(e){var t;return e?(t=-1===e.indexOf(",")?[e.trim()]:e.trim().split(/\s*,\s*/),t.map(function(e){return e.replace(/`([^`]*)`/,"$1")})):[]}function u(e){function t(){return v<d.length?(f=o(d[v++]),!0):!1}function n(e){return e=e||0,v+e<d.length?o(d[v+e]):null}function o(e){var t=Object.create(h[e.type]);return t.type=e.type,t.value=e.value,t}function s(e){return r(e)||/lower|upper/.test(e.toLowerCase())}function u(e){var r;if(t(),!f.nud)throw i.Errors.PARSING_ERROR("Unexpected token: "+f.type);for(r=f.nud(f);e<n().lbp;){if(t(),!f.led)throw i.Errors.PARSING_ERROR("Unexpected token: "+f.type);r=f.led(r)}return r}function a(e,t,n,r){var o=h[e]||{};h[e]={lbp:o.lbp||n,nud:o.nud||t,led:o.led||r}}function c(e,t,n,r){n=n||t,a(e,null,t,r||function(t){return{type:e,left:t,right:u(n)}})}function l(e,t){a(e,function(){return{type:e,right:u(t)}})}var f,d=function(){function t(e){return/[=<>!+\-*\/(),]/.test(e)}function n(e){return/^and$|^or$|^not$|^is$/.test(e)}function r(e){return/true|false/.test(e)}function o(e){return/[0-9.]/.test(e)}function s(e){return/\s/.test(e)}function u(e){return/null/.test(e)}function a(e){return/^".*"$|^'.*'$/.test(e)}function c(){return m<e.length?(h=e[m++],!0):!1}function l(e,t){y="",v.push({type:e,value:t})}function f(){var e=y.toLowerCase();""!==e&&(n(e)?l(e):r(e)?l("boolean","true"===e):o(e[0])?l("number",parseFloat(e)):u(e)?l("constant",e):a(y)?l("string",y):l("identifier",e))}function d(){l(h+e[m]),c()}function p(e,t){for(;c();){if(h===e)return void l(t,y);y+=h}throw i.Errors.LEXER_ERROR(t+" needs a closing "+e,m)}var h,v=[],m=0,y="";for(e+=" ";c();)if("`"===h)p("`","identifier");else if("'"===h)p("'","string");else if('"'===h)p('"',"string");else if(t(h))switch(f(),h){case"<":"="===e[m]||">"===e[m]?d():l(h);break;case">":"="===e[m]?d():l(h);break;case"!":if("="!==e[m])throw i.Errors.LEXER_ERROR("'!' not followed by '='",m);d();break;default:l(h)}else s(h)?f():y+=h;return l("(end)"),v}(),p=[],h={},v=0;c("+",50),c("-",50),c("*",60),c("/",60),l("-",70),c("=",40),c("<",40),c("<=",40),c(">",40),c(">=",40),c("!=",40),c("<>",40),c("and",30),c("or",30),l("not",70),a(")"),a("(end)"),a("(",function(){var e=u(20);if(")"!==n().type)throw i.Errors.PARSING_ERROR("Expected closing parenthesis ')'");return t(),e}),a("number",function(e){return e}),a("boolean",function(e){return e}),a("constant",function(e){return e}),a("string",function(e){return e}),a(",",function(){return u(20)}),a("is",null,40,function(e){var r="is";return"not"===n().type&&(r="!=",t()),{type:r,left:e,right:u(40)}}),a("identifier",function(e){if(s(e.value)&&"("===n().type){for(var r=[];t();){if(")"===f.type)return{type:"call",args:r,name:e.value};r.push(u(20))}throw i.Errors.PARSING_ERROR("Expected closing parenthesis for function "+e.value)}return e});do p.push(u(0));while("(end)"!==n().type);return p}function a(e){p(e)&&f.push({id:e._id,key:h(e),value:e})}function c(e,t){return d(t)}function l(){f.sort(function(e,t){return o(e.key,t.key)}),n.descending&&f.reverse();var e=[];f.forEach(function(t){var n=e[e.length-1]||null;return n&&0===o(n.key[0][0],t.key)?(n.key.push([t.key,t.id]),void n.value.push(t.value)):void e.push({key:[[t.key,t.id]],value:[t.value]})}),e.forEach(function(e){e.value=c(e.key,e.value),e.value="undefined"==typeof e.value?null:e.value,e.key=e.key[0][0]});var t=[];e.forEach(function(e){e.value.forEach(function(e){t.push(e)})}),n.complete(null,{rows:t})}if(n.complete){var f=[],d=function(){if(!t.select||"*"===t.select.trim()){if(t.pivot||t.groupBy)throw i.Errors.SELECT_ERROR("If a pivot or group by is present, select columns must be specified explicitly.");return function(e){return e}}var e=function(){function e(e){function t(e){switch(e.type){case"boolean":return e.value.toString();case"number":return e.value.toString();case"string":return e.value;case"call":var n=[];if(r(e.name))return e.name+"("+e.args[0].value+")";for(var o=0;o<e.args.length;o++)n.push(t(e.args[o]));return e.name+"("+n.join(", ")+")";case"identifier":return e.value;default:var i="";return e.left&&(i+=t(e.left)+" "),i+=e.type+" ",i+=t(e.right)}}var n=[];return n.push(t(e)),n.join(" ")}var n={};if(t.label){var o=u(t.label);o.length/2!==0||0===o.length;for(var i=1;i<o.length;i+=2)n[e(o[i-1])]=o[i].value}var s=u(t.select);return s.forEach(function(t){var r=e(t);t.label=n[r]?n[r]:r}),s}();return function(){function n(t){function n(e){return e?t(e)?!0:n(e.left)?!0:n(e.right):!1}for(var r=!1,o=0;o<e.length;o++)if(n(e[o])){r=!0;break}return r}function o(){return n(function(e){return"call"===e.type&&r(e.name)})}function u(){return n(function(e){if("call"===e.type)return r(e.name)?!1:!0;if("identifier"===e.type){var n=new RegExp("\\b"+e.value+"\\b");return t.groupBy&&n.test(t.groupBy)?!1:!0}})}function a(n){function r(e){if(e){if("call"===e.type&&i.push(e.args[0].value),"identifier"===e.type)return void i.push(e.value);r(e.left),r(e.right)}}var o=s(t.groupBy),i=[];e.forEach(function(e){r(e)});for(var u=0;u<n.length;u++)if(-1!==o.indexOf(n[u])||-1!==i.indexOf(n[u]))return!0;return!1}function c(e,t){switch(e.type){case"boolean":return e.value;case"number":return e.value;case"string":return e.value;case"call":if(f[e.name]){var n=[];if(r(e.name))return f[e.name].apply(null,[t,e.args[0].value]);for(var o=0;o<e.args.length;o++)n.push(c(e.args[o],t));return f[e.name].apply(null,n)}throw i.Errors.PARSING_ERROR("Unrecognized function: "+e.name);case"identifier":return Array.isArray(t)?void 0===t[0][e.value]?null:t[0][e.value]:void 0===t[e.value]?null:t[e.value];default:if(l[e.type])return e.left?l[e.type](c(e.left,t),c(e.right,t)):l[e.type](c(e.right,t));throw i.Errors.PARSING_ERROR("Unknown token type: "+e.type)}}var l={"+":function(e,t){return e+t},"-":function(e,t){return"undefined"==typeof t?-e:e-t},"*":function(e,t){return e*t},"/":function(e,t){return e/t},"=":function(e,t){return e===t},"<":function(e,t){return t>e},"<=":function(e,t){return t>=e},">":function(e,t){return e>t},">=":function(e,t){return e>=t},"!=":function(e,t){return e!==t},"<>":function(e,t){return e!==t},and:function(e,t){return e&&t},or:function(e,t){return e||t},not:function(e){return!e}},f={upper:function(e){return e.toUpperCase()},lower:function(e){return e.toLowerCase()},max:function(e,t){return e.reduce(function(e,n){return n[t]&&(!e||n[t]>e)&&(e=n[t]),e},null)},min:function(e,t){return e.reduce(function(e,n){return n[t]&&(!e||n[t]<e)&&(e=n[t]),e},null)},average:function(e,t){var n=e.reduce(function(e,n){if(n[t]){if("number"!=typeof n[t])throw i.Errors.SELECT_ERROR("All values being averaged must be numbers, but "+n[t]+" is not.");return{count:++e.count,total:e.total+n[t]}}return e},{count:0,total:0});return n.total/n.count},count:function(e,t){return e.reduce(function(e,n){return n[t]?++e:e},0)},sum:function(e,t){return e.reduce(function(e,n){if(n[t]){if("number"!=typeof n[t])throw i.Errors.SELECT_ERROR("All values being summed must be numbers, but "+n[t]+" is not.");return e+n[t]}return e},0)}};return function(){if(t.pivot||(t.pivot=""),o()||t.pivot){if(u())throw i.Errors.SELECT_ERROR("If an aggregation function is used in the select clause, all identifiers in the select clause must be wrapped by an aggregation function or appear in the group-by clause.");if(t.pivot){var n=s(t.pivot);if(a(n))throw i.Errors.PIVOT_ERROR("Columns that appear in the pivot clause may not appear in the group by or select clauses.");return function(t){function o(e){"identifier"===e.type?i[e.label]=c(e,s[u]):"call"===e.type&&r(e.name)&&(i[u+" "+e.label]=c(e,s[u]))}var i={},s={};t.forEach(function(e){var t=n.map(function(t){return e[t]}).join(", ");s[t]?s[t].push(e):s[t]=[e]});for(var u in s)e.forEach(o);return 0!==Object.keys(i).length?[i]:void 0}}return function(t){var n={};return e.forEach(function(e){n[e.label]=c(e,t)}),0!==Object.keys(n).length?[n]:void 0}}return function(t){var n=[];return t.forEach(function(t){var r={};e.forEach(function(e){r[e.label]=c(e,t)}),0!==Object.keys(r).length&&n.push(r)}),n}}()}()}(),p=function(){function e(e){function t(n){switch(n.type){case"boolean":return n.value;case"number":return n.value;case"constant":if("null"===n.value)return null;throw i.Errors.PARSING_ERROR("Unknown constant: "+n.value);case"string":return n.value;case"identifier":return void 0===e[n.value]?null:e[n.value];default:if(r[n.type]){if(n.left){var o=t(n.left),s=t(n.right);return r[n.type](o,s)}return r[n.type](t(n.right))}throw i.Errors.PARSING_ERROR("Unknown token type "+n.type)}}var r={"+":function(e,t){return e+t},"-":function(e,t){return"undefined"==typeof t?-e:e-t},"*":function(e,t){return e*t},"/":function(e,t){return e/t},"=":function(e,t){return e===t},is:function(e,t){return e===t},"<":function(e,t){return t>e},"<=":function(e,t){return t>=e},">":function(e,t){return e>t},">=":function(e,t){return e>=t},"!=":function(e,t){return e!==t},"<>":function(e,t){return e!==t},and:function(e,t){return e&&t},or:function(e,t){return e||t},not:function(e){return!e}};return t(n[0])}if(!t.where)return function(){return!0};var n=u(t.where);return e}(),h=function(){function e(e){var t=[];return n.forEach(function(n){t.push(e[n])}),t}if(!t.groupBy)return function(){return""};var n=s(t.groupBy);return e}(),v="conflicts"in n?n.conflicts:!1;e.changes({conflicts:v,include_docs:!0,onChange:function(e){"deleted"in e||a(e.doc)},complete:function(){l()}})}}var o=e("pouchdb-collate");n.gql=function(e,t,n){return"function"==typeof t&&(n=t,t={}),n&&(t.complete=n),"object"==typeof e?r(this,e,t):t.complete(i.Errors.UNRECOGNIZED_QUERY)};var i={};i.Errors={UNRECOGNIZED_QUERY:{status:400,error:"not_recognized",reason:"Format of input query is not valid"},LEXER_ERROR:function(e,t){return{status:400,error:"tokenizing_error",reason:e+" on character "+t+"."||"Generic tokenizing error"}},PARSING_ERROR:function(e){return{status:400,error:"parsing_error",reason:e||"Generic parsing error"}},SELECT_ERROR:function(e){return{status:400,error:"select_error",reason:e||"Generic select error"}},PIVOT_ERROR:function(e){return{status:400,error:"pivot_error",reason:e||"Generic pivot error"}}},"undefined"!=typeof window&&window.PouchDB&&window.PouchDB.plugin(n)},{"pouchdb-collate":19}],21:[function(e,t,n){"use strict";function r(e,t,n,r,i,s){var a=e.constructor.utils.Promise;if(i.headers["Content-Type"]&&"application/json"!==i.headers["Content-Type"])return a.reject({status:400,name:"bad_request",message:"invalid_json"});var c=e.get("_design/"+t).then(function(e){if(!(e.lists||{}).hasOwnProperty(n))throw{status:404,name:"not_found",message:"missing list function "+n+" on design doc _design/"+t};return e}),l=e.query(t+"/"+r,s);return a.all([c,l]).then(function(e){var t,r=e[0],s=e[1],a={offset:s.offset,total_rows:s.total_rows},c=[],l={getRow:function(){return l.start({}),s.rows.shift()||null},send:function(e){l.start({}),c.push(e)},start:function(e){t||(t=e)}},f=u(r.lists[n],r,a,i,l);return t&&(o(f,t),f.body=c.join("")+f.body,f.headers["Transfer-Encoding"]="chunked"),f})}var o=e("extend"),i=e("promise-nodify"),s=e("couchdb-objects"),u=e("couchdb-render"),a=e("pouchdb-req-http-query");n.list=function(e,t,n){var o=this;"function"==typeof t&&(n=t,t={});var u=e.split("/")[0],c=e.split("/")[1],l=e.split("/")[2],f=o.info(),d=f.then(function(e){var t=[e.db_name,"_design",u,"_list",c];return l&&t.push(l),t}),p=s.buildRequestObject(t,d,f,o);return p.then(function(e){var s;return s=-1===["http","https"].indexOf(o.type())?r(o,u,c,l,e,t):a(o,e),i(s,n),s})}},{"couchdb-objects":25,"couchdb-render":28,extend:35,"pouchdb-req-http-query":36,"promise-nodify":37}],22:[function(e,t){(function(n){"use strict";function r(e,t,n,r,c){var f={body:"undefined",cookie:{},form:{},headers:{Host:"localhost:5984",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Language":o(),"User-Agent":i()},info:n,method:"GET",path:t.slice(0),peer:"127.0.0.1",query:{},requested_path:t.slice(0),raw_path:"/"+t.join("/"),secObj:l(),userCtx:r,uuid:c};-1===["_show","_update"].indexOf(t[3])?f.id=null:(f.id=t[5]||null,"_design"===f.id&&t[6]&&(f.id+="/"+t[6])),s(!0,f,e);var d=f.requested_path.length-1,p=f.requested_path[d];return u(f.query)||-1!==p.indexOf("?")||(f.requested_path[d]=p+"?"+a.stringify(f.query)),u(f.query)||-1!==f.raw_path.indexOf("?")||(f.raw_path+="?"+a.stringify(f.query)),u(f.form)||"undefined"!==f.body||(f.body=a.stringify(f.form),f.headers["Content-Type"]="application/x-www-form-urlencoded",f.headers["Content-Length"]=f.body.length.toString()),"undefined"!==f.body&&-1===["POST","PUT","PATCH"].indexOf(f.method)&&(f.method="POST"),f}function o(){var e=(n.navigator||{}).language||(n.navigator||{}).userLanguage;return e=(e||"en").toLowerCase(),-1!==["en","en-us"].indexOf(e)?"en-us,en;q=0.5":e+",en-us;q=0.7,en;q=0.3"}function i(){var e=(n.navigator||{}).userAgent;return e||"Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:28.0) Gecko/20100101 Firefox/28.0"}var s=e("extend"),u=e("is-empty"),a=e("querystring"),c=e("./couchusercontextobject.js"),l=e("./couchsecurityobject.js");t.exports=function(e,t,n,o){var i=o.constructor.utils.Promise,s=n.then(c),u=o.id();return i.all([t,n,s,u]).then(function(t){return t.unshift(e),r.apply(null,t)})}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./couchsecurityobject.js":23,"./couchusercontextobject.js":24,extend:26,"is-empty":27,querystring:142}],23:[function(e,t){"use strict";t.exports=function(){return{admins:{names:[],roles:[]},members:{names:[],roles:[]}}}},{}],24:[function(e,t){"use strict";t.exports=function(e){return{db:e.db_name,name:null,roles:["_admin"]}}},{}],25:[function(e,t,n){"use strict";n.buildUserContextObject=e("./couchusercontextobject.js"),n.buildSecurityObject=e("./couchsecurityobject.js"),n.buildRequestObject=e("./couchrequestobject.js")},{"./couchrequestobject.js":22,"./couchsecurityobject.js":23,"./couchusercontextobject.js":24}],26:[function(e,t){t.exports=e(4)},{}],27:[function(e,t){function n(e){if(null==e)return!0;if("number"==typeof e)return 0===e;if(void 0!==e.length)return 0===e.length;for(var t in e)if(r.call(e,t))return!1;return!0}t.exports=n;var r=Object.prototype.hasOwnProperty},{}],28:[function(e,t){"use strict";function n(e){return"[object Object]"===Object.prototype.toString.call(e)}function r(){function e(e){var t=Array.prototype.slice.call(arguments,1);f.push([e,t])}function t(e){try{return l[e]()}catch(t){throw u.wrapExecutionError(t)}}function n(){return f.filter(function(e){return l.hasOwnProperty(e[0])})}function r(e){for(var t=0;t<f.length;t+=1)if(f[t][0]===e)return f[t][1][0]}function i(e){for(var t=o(e),i=n(),s=0;s<t.length;s+=1)for(var u=t[s],a=u.split(";")[0].trim().split("/"),c=0;c<i.length;c+=1)for(var f=i[c][0],d=i[c][1],p=0;p<d.length;p+=1){var h=d[p],v=h.split(";")[0].trim().split("/"),m=!(a[0]!==v[0]&&"*"!==a[0]&&"*"!==v[0]||a[1]!==v[1]&&"*"!==a[1]&&"*"!==v[1]);if(m)return[f,h]}throw{status:406,name:"not_acceptable",message:["Content-Type(s)",t.join(", "),"not supported, try one of:",Object.keys(l).map(r)].join(" ")}
}function a(e,t){l[e]=t}function c(e){if(s(l))return[""];if(e.query.format){if(!l.hasOwnProperty(e.query.format))throw{status:500,name:"render_error",message:["the format option is set to '",e.query.format,"', but there's no provider registered for that format."].join("")};return[t(e.query.format),r(e.query.format)]}var n=i(e.headers.Accept);return[t(n[0]),n[1]]}var l={},f=[];return e("all","*/*"),e("text","text/plain; charset=utf-8","txt"),e("html","text/html; charset=utf-8"),e("xhtml","application/xhtml+xml","xhtml"),e("xml","application/xml","text/xml","application/x-xml"),e("js","text/javascript","application/javascript","application/x-javascript"),e("css","text/css"),e("ics","text/calendar"),e("csv","text/csv"),e("rss","application/rss+xml"),e("atom","application/atom+xml"),e("yaml","application/x-yaml","text/yaml"),e("multipart_form","multipart/form-data"),e("url_encoded_form","application/x-www-form-urlencoded"),e("json","application/json","text/x-json"),{api:{provides:a,registerType:e},getResult:c}}function o(e){return e.split(",").map(function(e){return e.split(";")[0].trim()})}var i=e("extend"),s=e("is-empty"),u=e("couchdb-eval"),a=e("couchdb-resp-completer");t.exports=function(e,t,o,s,c){c||(c={});var l=r();i(c,l.api);var f,d,p=u.evaluate(t,c,e);try{f=p(o,s)}catch(h){throw u.wrapExecutionError(h)}if("string"!=typeof f&&!n(f)){var v=l.getResult(s);f=v[0],d=v[1]}return a(f,d)}},{"couchdb-eval":29,"couchdb-resp-completer":30,extend:33,"is-empty":34}],29:[function(require,module,exports){"use strict";exports.evaluate=function(requireContext,extraVars,program){var require;requireContext&&(require=function(libPath){for(var module={id:libPath,current:void 0,parent:void 0,exports:{}},exports=module.exports,path=libPath.split("/"),lib=requireContext,i=0;i<path.length;i+=1)lib=lib[path[i]];return eval(lib),module.exports});var isArray=Array.isArray,toJSON=JSON.stringify,log=console.log.bind(console),sum=function(e){return e.reduce(function(e,t){return e+t})},statements="";for(var name in extraVars)extraVars.hasOwnProperty(name)&&(statements+="var "+name+" = extraVars['"+name+"'];\n");var func;try{if(func=eval(statements+"("+program+");"),"function"!=typeof func)throw"no function"}catch(e){throw{name:"compilation_error",status:500,message:"Expression does not eval to a function. "+program}}return func},exports.wrapExecutionError=function(e){return{name:e.name,message:e.toString()+"\n\n"+e.stack,status:500}}},{}],30:[function(e,t){"use strict";var n=e("extend"),r=e("is-empty");t.exports=function(e,t){"string"==typeof e&&(e={body:e}),"[object Object]"!==Object.prototype.toString.call(e)&&(e={body:""});var o=n({},e);if(delete o.code,delete o.json,delete o.body,delete o.base64,delete o.headers,delete o.stop,!r(o)){var i=Object.keys(o)[0];throw{status:500,name:"external_response_error",message:"Invalid data from external server: {<<"+JSON.stringify(i)+">>,<<"+JSON.stringify(o[i])+">>}"}}return e.code=e.code||200,e.headers=e.headers||{},e.headers.Vary=e.headers.Vary||"Accept",e.headers["Content-Type"]=e.headers["Content-Type"]||t,e.json&&(e.body=JSON.stringify(e.json),e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json"),e.base64&&(e.headers["Content-Type"]=e.headers["Content-Type"]||"application/binary"),e.headers["Content-Type"]=e.headers["Content-Type"]||"text/html; charset=utf-8",e}},{extend:31,"is-empty":32}],31:[function(e,t){t.exports=e(4)},{}],32:[function(e,t){t.exports=e(27)},{}],33:[function(e,t){t.exports=e(4)},{}],34:[function(e,t){t.exports=e(27)},{}],35:[function(e,t){t.exports=e(4)},{}],36:[function(e,t){"use strict";t.exports=function(e,t){var n=e.constructor.utils.ajax,r=e.constructor.utils.Promise;return new r(function(r,o){function i(e,t,n){if(e)return void o(e);var i={};n.getAllResponseHeaders().split("\r\n").forEach(function(e){e&&(i[e.split(":")[0]]=e.split(":")[1].trim())});var s={body:n.responseText,headers:i,code:n.status};"application/json"===i["Content-Type"]&&(s.json=JSON.parse(s.body)),r(s)}var s=t.requested_path.slice(1).join("/");n({method:t.method,url:e.getUrl()+s,headers:t.headers,body:"undefined"===t.body?null:t.body,cache:!0,processData:!1,json:!1},i)})}},{}],37:[function(e,t){"use strict";t.exports=function(e,t){"function"==typeof t&&e.then(function(e){t(null,e)},function(e){t(e,null)})}},{}],38:[function(e,t){"use strict";function n(e){function t(e,t){return new n(function(n,r){f.push("function"==typeof e?{resolve:n,reject:r,callback:e}:{next:n,callback:!1}),d.push("function"==typeof t?{resolve:n,reject:r,callback:t}:{next:r,callback:!1})})}function u(e,t){if(!p){p=o(h,t,e?0:1);for(var n=e?f:d,r=n.length,u=-1;++u<r;)n[u].callback?s(i,n[u].callback,t,n[u].resolve,n[u].reject):n[u].next(t)}}function a(e){u(!1,e)}function c(e){u(!0,e)}function l(e){r(c,a,e)}if(!(this instanceof n))return new n(e);var f=[],d=[],p=!1;this.then=function(e,n){return p?p(e,n):t(e,n)};var h=this;try{e(l,a)}catch(v){a(v)}}function r(e,t,n){n&&"function"==typeof n.then?n.then(e,t):e(n)}function o(e,t,r){function o(){var o=arguments[r];return"function"!=typeof o?e:new n(function(e,n){s(i,o,t,e,n)})}return o}function i(e,t,n,o){try{r(n,o,e(t))}catch(i){o(i)}}var s=e("immediate");t.exports=n},{immediate:40}],39:[function(e,t){t.exports=e(9)},{}],40:[function(e,t){t.exports=e(10)},{"./messageChannel":41,"./mutation":42,"./nextTick":39,"./postMessage":43,"./stateChange":44,"./timeout":45}],41:[function(e,t){t.exports=e(11)},{}],42:[function(e,t){t.exports=e(12)},{}],43:[function(e,t){t.exports=e(13)},{}],44:[function(e,t){t.exports=e(14)},{}],45:[function(e,t){t.exports=e(15)},{}],46:[function(e,t){var n=function(e){var t=new n.Index;return t.pipeline.add(n.stopWordFilter,n.stemmer),e&&e.call(t,t),t};n.version="0.4.5","undefined"!=typeof t&&(t.exports=n),n.utils={},n.utils.warn=function(e){return function(t){e.console&&console.warn&&console.warn(t)}}(this),n.utils.zeroFillArray=function(){var e=[0];return function(t){for(;e.length<t;)e=e.concat(e);return e.slice(0,t)}}(),n.EventEmitter=function(){this.events={}},n.EventEmitter.prototype.addListener=function(){var e=Array.prototype.slice.call(arguments),t=e.pop(),n=e;if("function"!=typeof t)throw new TypeError("last argument must be a function");n.forEach(function(e){this.hasHandler(e)||(this.events[e]=[]),this.events[e].push(t)},this)},n.EventEmitter.prototype.removeListener=function(e,t){if(this.hasHandler(e)){var n=this.events[e].indexOf(t);this.events[e].splice(n,1),this.events[e].length||delete this.events[e]}},n.EventEmitter.prototype.emit=function(e){if(this.hasHandler(e)){var t=Array.prototype.slice.call(arguments,1);this.events[e].forEach(function(e){e.apply(void 0,t)})}},n.EventEmitter.prototype.hasHandler=function(e){return e in this.events},n.tokenizer=function(e){if(!arguments.length||null==e||void 0==e)return[];if(Array.isArray(e))return e.map(function(e){return e.toLowerCase()});for(var t=e.toString().replace(/^\s+/,""),n=t.length-1;n>=0;n--)if(/\S/.test(t.charAt(n))){t=t.substring(0,n+1);break}return t.split(/\s+/).map(function(e){return e.replace(/^\W+/,"").replace(/\W+$/,"").toLowerCase()})},n.Pipeline=function(){this._stack=[]},n.Pipeline.registeredFunctions={},n.Pipeline.registerFunction=function(e,t){t in this.registeredFunctions&&n.utils.warn("Overwriting existing registered function: "+t),e.label=t,n.Pipeline.registeredFunctions[e.label]=e},n.Pipeline.warnIfFunctionNotRegistered=function(e){var t=e.label&&e.label in this.registeredFunctions;t||n.utils.warn("Function is not registered with pipeline. This may cause problems when serialising the index.\n",e)},n.Pipeline.load=function(e){var t=new n.Pipeline;return e.forEach(function(e){var r=n.Pipeline.registeredFunctions[e];if(!r)throw new Error("Cannot load un-registered function: "+e);t.add(r)}),t},n.Pipeline.prototype.add=function(){var e=Array.prototype.slice.call(arguments);e.forEach(function(e){n.Pipeline.warnIfFunctionNotRegistered(e),this._stack.push(e)},this)},n.Pipeline.prototype.after=function(e,t){n.Pipeline.warnIfFunctionNotRegistered(t);var r=this._stack.indexOf(e)+1;this._stack.splice(r,0,t)},n.Pipeline.prototype.before=function(e,t){n.Pipeline.warnIfFunctionNotRegistered(t);var r=this._stack.indexOf(e);this._stack.splice(r,0,t)},n.Pipeline.prototype.remove=function(e){var t=this._stack.indexOf(e);this._stack.splice(t,1)},n.Pipeline.prototype.run=function(e){for(var t=[],n=e.length,r=this._stack.length,o=0;n>o;o++){for(var i=e[o],s=0;r>s&&(i=this._stack[s](i,o,e),void 0!==i);s++);void 0!==i&&t.push(i)}return t},n.Pipeline.prototype.toJSON=function(){return this._stack.map(function(e){return n.Pipeline.warnIfFunctionNotRegistered(e),e.label})},n.Vector=function(e){this.elements=e},n.Vector.prototype.magnitude=function(){if(this._magnitude)return this._magnitude;for(var e,t=0,n=this.elements,r=n.length,o=0;r>o;o++)e=n[o],t+=e*e;return this._magnitude=Math.sqrt(t)},n.Vector.prototype.dot=function(e){for(var t=this.elements,n=e.elements,r=t.length,o=0,i=0;r>i;i++)o+=t[i]*n[i];return o},n.Vector.prototype.similarity=function(e){return this.dot(e)/(this.magnitude()*e.magnitude())},n.Vector.prototype.toArray=function(){return this.elements},n.SortedSet=function(){this.length=0,this.elements=[]},n.SortedSet.load=function(e){var t=new this;return t.elements=e,t.length=e.length,t},n.SortedSet.prototype.add=function(){Array.prototype.slice.call(arguments).forEach(function(e){~this.indexOf(e)||this.elements.splice(this.locationFor(e),0,e)},this),this.length=this.elements.length},n.SortedSet.prototype.toArray=function(){return this.elements.slice()},n.SortedSet.prototype.map=function(e,t){return this.elements.map(e,t)},n.SortedSet.prototype.forEach=function(e,t){return this.elements.forEach(e,t)},n.SortedSet.prototype.indexOf=function(e,t,n){var t=t||0,n=n||this.elements.length,r=n-t,o=t+Math.floor(r/2),i=this.elements[o];return 1>=r?i===e?o:-1:e>i?this.indexOf(e,o,n):i>e?this.indexOf(e,t,o):i===e?o:void 0},n.SortedSet.prototype.locationFor=function(e,t,n){var t=t||0,n=n||this.elements.length,r=n-t,o=t+Math.floor(r/2),i=this.elements[o];if(1>=r){if(i>e)return o;if(e>i)return o+1}return e>i?this.locationFor(e,o,n):i>e?this.locationFor(e,t,o):void 0},n.SortedSet.prototype.intersect=function(e){for(var t=new n.SortedSet,r=0,o=0,i=this.length,s=e.length,u=this.elements,a=e.elements;;){if(r>i-1||o>s-1)break;u[r]!==a[o]?u[r]<a[o]?r++:u[r]>a[o]&&o++:(t.add(u[r]),r++,o++)}return t},n.SortedSet.prototype.clone=function(){var e=new n.SortedSet;return e.elements=this.toArray(),e.length=e.elements.length,e},n.SortedSet.prototype.union=function(e){var t,n,r;return this.length>=e.length?(t=this,n=e):(t=e,n=this),r=t.clone(),r.add.apply(r,n.toArray()),r},n.SortedSet.prototype.toJSON=function(){return this.toArray()},n.Index=function(){this._fields=[],this._ref="id",this.pipeline=new n.Pipeline,this.documentStore=new n.Store,this.tokenStore=new n.TokenStore,this.corpusTokens=new n.SortedSet,this.eventEmitter=new n.EventEmitter,this._idfCache={},this.on("add","remove","update",function(){this._idfCache={}}.bind(this))},n.Index.prototype.on=function(){var e=Array.prototype.slice.call(arguments);return this.eventEmitter.addListener.apply(this.eventEmitter,e)},n.Index.prototype.off=function(e,t){return this.eventEmitter.removeListener(e,t)},n.Index.load=function(e){e.version!==n.version&&n.utils.warn("version mismatch: current "+n.version+" importing "+e.version);var t=new this;return t._fields=e.fields,t._ref=e.ref,t.documentStore=n.Store.load(e.documentStore),t.tokenStore=n.TokenStore.load(e.tokenStore),t.corpusTokens=n.SortedSet.load(e.corpusTokens),t.pipeline=n.Pipeline.load(e.pipeline),t},n.Index.prototype.field=function(e,t){var t=t||{},n={name:e,boost:t.boost||1};return this._fields.push(n),this},n.Index.prototype.ref=function(e){return this._ref=e,this},n.Index.prototype.add=function(e,t){var r={},o=new n.SortedSet,i=e[this._ref],t=void 0===t?!0:t;this._fields.forEach(function(t){var i=this.pipeline.run(n.tokenizer(e[t.name]));r[t.name]=i,n.SortedSet.prototype.add.apply(o,i)},this),this.documentStore.set(i,o),n.SortedSet.prototype.add.apply(this.corpusTokens,o.toArray());for(var s=0;s<o.length;s++){var u=o.elements[s],a=this._fields.reduce(function(e,t){var n=r[t.name].length;if(!n)return e;var o=r[t.name].filter(function(e){return e===u}).length;return e+o/n*t.boost},0);this.tokenStore.add(u,{ref:i,tf:a})}t&&this.eventEmitter.emit("add",e,this)},n.Index.prototype.remove=function(e,t){var n=e[this._ref],t=void 0===t?!0:t;if(this.documentStore.has(n)){var r=this.documentStore.get(n);this.documentStore.remove(n),r.forEach(function(e){this.tokenStore.remove(e,n)},this),t&&this.eventEmitter.emit("remove",e,this)}},n.Index.prototype.update=function(e,t){var t=void 0===t?!0:t;this.remove(e,!1),this.add(e,!1),t&&this.eventEmitter.emit("update",e,this)},n.Index.prototype.idf=function(e){var t="@"+e;if(Object.prototype.hasOwnProperty.call(this._idfCache,t))return this._idfCache[t];var n=this.tokenStore.count(e),r=1;return n>0&&(r=1+Math.log(this.tokenStore.length/n)),this._idfCache[t]=r},n.Index.prototype.search=function(e){var t=this.pipeline.run(n.tokenizer(e)),r=n.utils.zeroFillArray(this.corpusTokens.length),o=[],i=this._fields.reduce(function(e,t){return e+t.boost},0),s=t.some(function(e){return this.tokenStore.has(e)},this);if(!s)return[];t.forEach(function(e,t,s){var u=1/s.length*this._fields.length*i,a=this,c=this.tokenStore.expand(e).reduce(function(t,o){var i=a.corpusTokens.indexOf(o),s=a.idf(o),c=1,l=new n.SortedSet;if(o!==e){var f=Math.max(3,o.length-e.length);c=1/Math.log(f)}return i>-1&&(r[i]=u*s*c),Object.keys(a.tokenStore.get(o)).forEach(function(e){l.add(e)}),t.union(l)},new n.SortedSet);o.push(c)},this);var u=o.reduce(function(e,t){return e.intersect(t)}),a=new n.Vector(r);return u.map(function(e){return{ref:e,score:a.similarity(this.documentVector(e))}},this).sort(function(e,t){return t.score-e.score})},n.Index.prototype.documentVector=function(e){for(var t=this.documentStore.get(e),r=t.length,o=n.utils.zeroFillArray(this.corpusTokens.length),i=0;r>i;i++){var s=t.elements[i],u=this.tokenStore.get(s)[e].tf,a=this.idf(s);o[this.corpusTokens.indexOf(s)]=u*a}return new n.Vector(o)},n.Index.prototype.toJSON=function(){return{version:n.version,fields:this._fields,ref:this._ref,documentStore:this.documentStore.toJSON(),tokenStore:this.tokenStore.toJSON(),corpusTokens:this.corpusTokens.toJSON(),pipeline:this.pipeline.toJSON()}},n.Store=function(){this.store={},this.length=0},n.Store.load=function(e){var t=new this;return t.length=e.length,t.store=Object.keys(e.store).reduce(function(t,r){return t[r]=n.SortedSet.load(e.store[r]),t},{}),t},n.Store.prototype.set=function(e,t){this.store[e]=t,this.length=Object.keys(this.store).length},n.Store.prototype.get=function(e){return this.store[e]},n.Store.prototype.has=function(e){return e in this.store},n.Store.prototype.remove=function(e){this.has(e)&&(delete this.store[e],this.length--)},n.Store.prototype.toJSON=function(){return{store:this.store,length:this.length}},n.stemmer=function(){var e={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},t={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""},n="[^aeiou]",r="[aeiouy]",o=n+"[^aeiouy]*",i=r+"[aeiou]*",s="^("+o+")?"+i+o,u="^("+o+")?"+i+o+"("+i+")?$",a="^("+o+")?"+i+o+i+o,c="^("+o+")?"+r;return function(n){var i,l,f,d,p,h,v;if(n.length<3)return n;if(f=n.substr(0,1),"y"==f&&(n=f.toUpperCase()+n.substr(1)),d=/^(.+?)(ss|i)es$/,p=/^(.+?)([^s])s$/,d.test(n)?n=n.replace(d,"$1$2"):p.test(n)&&(n=n.replace(p,"$1$2")),d=/^(.+?)eed$/,p=/^(.+?)(ed|ing)$/,d.test(n)){var m=d.exec(n);d=new RegExp(s),d.test(m[1])&&(d=/.$/,n=n.replace(d,""))}else if(p.test(n)){var m=p.exec(n);i=m[1],p=new RegExp(c),p.test(i)&&(n=i,p=/(at|bl|iz)$/,h=new RegExp("([^aeiouylsz])\\1$"),v=new RegExp("^"+o+r+"[^aeiouwxy]$"),p.test(n)?n+="e":h.test(n)?(d=/.$/,n=n.replace(d,"")):v.test(n)&&(n+="e"))}if(d=/^(.+?)y$/,d.test(n)){var m=d.exec(n);i=m[1],d=new RegExp(c),d.test(i)&&(n=i+"i")}if(d=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/,d.test(n)){var m=d.exec(n);i=m[1],l=m[2],d=new RegExp(s),d.test(i)&&(n=i+e[l])}if(d=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/,d.test(n)){var m=d.exec(n);i=m[1],l=m[2],d=new RegExp(s),d.test(i)&&(n=i+t[l])}if(d=/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/,p=/^(.+?)(s|t)(ion)$/,d.test(n)){var m=d.exec(n);i=m[1],d=new RegExp(a),d.test(i)&&(n=i)}else if(p.test(n)){var m=p.exec(n);i=m[1]+m[2],p=new RegExp(a),p.test(i)&&(n=i)}if(d=/^(.+?)e$/,d.test(n)){var m=d.exec(n);i=m[1],d=new RegExp(a),p=new RegExp(u),h=new RegExp("^"+o+r+"[^aeiouwxy]$"),(d.test(i)||p.test(i)&&!h.test(i))&&(n=i)}return d=/ll$/,p=new RegExp(a),d.test(n)&&p.test(n)&&(d=/.$/,n=n.replace(d,"")),"y"==f&&(n=f.toLowerCase()+n.substr(1)),n}}(),n.Pipeline.registerFunction(n.stemmer,"stemmer"),n.stopWordFilter=function(e){return-1===n.stopWordFilter.stopWords.indexOf(e)?e:void 0},n.stopWordFilter.stopWords=new n.SortedSet,n.stopWordFilter.stopWords.length=119,n.stopWordFilter.stopWords.elements=["","a","able","about","across","after","all","almost","also","am","among","an","and","any","are","as","at","be","because","been","but","by","can","cannot","could","dear","did","do","does","either","else","ever","every","for","from","get","got","had","has","have","he","her","hers","him","his","how","however","i","if","in","into","is","it","its","just","least","let","like","likely","may","me","might","most","must","my","neither","no","nor","not","of","off","often","on","only","or","other","our","own","rather","said","say","says","she","should","since","so","some","than","that","the","their","them","then","there","these","they","this","tis","to","too","twas","us","wants","was","we","were","what","when","where","which","while","who","whom","why","will","with","would","yet","you","your"],n.Pipeline.registerFunction(n.stopWordFilter,"stopWordFilter"),n.TokenStore=function(){this.root={docs:{}},this.length=0},n.TokenStore.load=function(e){var t=new this;return t.root=e.root,t.length=e.length,t},n.TokenStore.prototype.add=function(e,t,n){var n=n||this.root,r=e[0],o=e.slice(1);return r in n||(n[r]={docs:{}}),0===o.length?(n[r].docs[t.ref]=t,void(this.length+=1)):this.add(o,t,n[r])},n.TokenStore.prototype.has=function(e){if(!e)return!1;for(var t=this.root,n=0;n<e.length;n++){if(!t[e[n]])return!1;t=t[e[n]]}return!0},n.TokenStore.prototype.getNode=function(e){if(!e)return{};for(var t=this.root,n=0;n<e.length;n++){if(!t[e[n]])return{};t=t[e[n]]}return t},n.TokenStore.prototype.get=function(e,t){return this.getNode(e,t).docs||{}},n.TokenStore.prototype.count=function(e,t){return Object.keys(this.get(e,t)).length},n.TokenStore.prototype.remove=function(e,t){if(e){for(var n=this.root,r=0;r<e.length;r++){if(!(e[r]in n))return;n=n[e[r]]}delete n.docs[t]}},n.TokenStore.prototype.expand=function(e,t){var n=this.getNode(e),r=n.docs||{},t=t||[];return Object.keys(r).length&&t.push(e),Object.keys(n).forEach(function(n){"docs"!==n&&t.concat(this.expand(e+n,t))},this),t},n.TokenStore.prototype.toJSON=function(){return{root:this.root,length:this.length}}},{}],47:[function(e,t){"use strict";function n(e,t){for(var n=Math.min(e.length,t.length),r=0;n>r;r++){var o=s(e[r],t[r]);if(0!==o)return o}return e.length===t.length?0:e.length>t.length?1:-1}function r(e,t){return e===t?0:e>t?1:-1}function o(e,t){for(var n=Object.keys(e),r=Object.keys(t),o=Math.min(n.length,r.length),i=0;o>i;i++){var u=s(n[i],r[i]);if(0!==u)return u;if(u=s(e[n[i]],t[r[i]]),0!==u)return u}return n.length===r.length?0:n.length>r.length?1:-1}function i(e){var t=["boolean","number","string","object"];return-1!==t.indexOf(typeof e)?null===e?1:t.indexOf(typeof e)+2:Array.isArray(e)?4.5:void 0}function s(e,t){var s=i(e),u=i(t);return s-u!==0?s-u:null===e?0:"number"==typeof e?e-t:"boolean"==typeof e?t>e?-1:1:"string"==typeof e?r(e,t):Array.isArray(e)?n(e,t):"object"==typeof e?o(e,t):void 0}t.exports=s},{}],48:[function(require,module,exports){"use strict";function lunrfunc(){this.field("text"),this.ref("id")}function viewQuery(db,fun,indexes,options){return lie(function(fulfill,reject){indexes.default=lunr(lunrfunc),db.changes({include_docs:!0,onChange:function(row){function index(e,t){e in indexes||(indexes[e]=lunr(lunrfunc)),e in text||(text[e]=[]),text[e].push(t)}if(0!==row.id.indexOf("_design/")&&0!==row.id.indexOf("_local/")){if("deleted"in row)return void Object.keys(indexes).forEach(function(e){indexes[e].documentStore.has(row.id)&&indexes[e].remove(row)});var efun,doc=row.doc,id=row.id,text={"default":[]},name;eval("efun = "+fun.toString()+";"),efun(doc),Object.keys(text).forEach(function(e){indexes[e].documentStore.has(id)?indexes[e].update({id:id,text:text[e].join(" ")}):indexes[e].add({id:id,text:text[e].join(" ")})})}},complete:function(){var e=options.q,t="default";~e.indexOf(":")&&(e=e.split(":"),t=e[0],e=e[1]);var n=indexes[t].search(e).map(function(e){return e.ref}),r={};r.keys=n,options.include_docs&&(r.include_docs=options.include_docs),options.conflicts&&(r.conflicts=options.conflicts),options.attachments&&(r.attachments=options.attachments);var o=options.sort;o&&("-"===o.slice(0,1)&&(r.decending=!0,o=o.slice(1)),o=o.split("<")[0]),fulfill(db.allDocs(r).then(function(e){return o&&e.rows.sort(function(e,t){return collate(e[o],t[o])}),e}))}})})}function httpQuery(e,t,n){var r=[];"undefined"!=typeof n.q&&r.push("q="+n.q),"undefined"!=typeof n.include_docs&&r.push("include_docs="+n.include_docs),"undefined"!=typeof n.limit&&r.push("limit="+n.limit),"undefined"!=typeof n.sort&&r.push("sort="+n.sort),"undefined"!=typeof n.bookmark&&r.push("bookmark="+n.bookmark),"undefined"!=typeof n.stale&&r.push("stale="+stale),r=r.join("&"),r=""===r?"":"?"+r;var o=t.split("/");return e.request({method:"GET",url:"_design/"+o[0]+"/_search/"+o[1]+r})}function query(e,t,n){if("http"===e.type())return httpQuery(e,t,n);if("function"==typeof t)return viewQuery(e,t,{"default":lunr(lunrfunc)},n);var r=t.split("/");return e.get("_design/"+r[0]).then(function(t){if(!t.indexes[r[1]])throw{error:"not_found",eason:"missing_named_view"};return viewQuery(e,t.indexes[r[1]].index,{"default":lunr(lunrfunc)},n)})}var lunr=require("lunr"),collate=require("pouchdb-collate"),lie=require("lie");module.exports=function(e,t,n){var r=this,o=query(r,e,t);return"function"==typeof n?o.then(function(e){return n(null,e)},n):o}},{lie:38,lunr:46,"pouchdb-collate":47}],49:[function(e,t,n){"use strict";function r(e,t,n,r,o,s){var u=e.constructor.utils.Promise,a=e.get("_design/"+t).then(function(e){if(!(e.shows||{}).hasOwnProperty(n))throw{status:404,name:"not_found",message:"missing show function "+n+" on design doc _design/"+t};return e}),c=e.get(r,s)["catch"](function(){return null});return u.all([a,c]).then(function(e){var t=e[0],r=e[1],s=t.shows[n];return i(s,t,r,o)})}var o=e("couchdb-objects"),i=e("couchdb-render"),s=e("promise-nodify"),u=e("pouchdb-req-http-query");n.show=function(e,t,n){"function"==typeof t&&(n=t,t={});var i=this,a=e.split("/"),c=a[0],l=a[1],f=a[2];"_design"===f&&a.length>3&&(f+="/"+a[3]);var d=i.info(),p=d.then(function(e){var t=[e.db_name,"_design",c,"_show",l];return f&&t.push.apply(t,f.split("/")),t}),h=o.buildRequestObject(t,p,d,i);return h.then(function(e){var o;return o=-1===["http","https"].indexOf(i.type())?r(i,c,l,f,e,t):u(i,e),s(o,n),o})}},{"couchdb-objects":53,"couchdb-render":56,"pouchdb-req-http-query":63,"promise-nodify":64}],50:[function(e,t){t.exports=e(22)},{"./couchsecurityobject.js":51,"./couchusercontextobject.js":52,extend:54,"is-empty":55,querystring:142}],51:[function(e,t){t.exports=e(23)},{}],52:[function(e,t){t.exports=e(24)},{}],53:[function(e,t){t.exports=e(25)},{"./couchrequestobject.js":50,"./couchsecurityobject.js":51,"./couchusercontextobject.js":52}],54:[function(e,t){t.exports=e(4)},{}],55:[function(e,t){t.exports=e(27)},{}],56:[function(e,t){t.exports=e(28)},{"couchdb-eval":57,"couchdb-resp-completer":58,extend:61,"is-empty":62}],57:[function(e,t){t.exports=e(29)},{}],58:[function(e,t){t.exports=e(30)},{extend:59,"is-empty":60}],59:[function(e,t){t.exports=e(4)},{}],60:[function(e,t){t.exports=e(27)},{}],61:[function(e,t){t.exports=e(4)},{}],62:[function(e,t){t.exports=e(27)},{}],63:[function(e,t){t.exports=e(36)},{}],64:[function(e,t){t.exports=e(37)},{}],65:[function(e,t,n){"use strict";function r(e,t,n,r){"function"==typeof n&&(r=n,n={});var u=t.split("/")[0],c=t.split("/")[1],l=t.split("/")[2],f=e.info(),d=f.then(function(e){var t=[e.db_name,"_design",u,"_update",c];return l&&t.push(l),t}),p=i.buildRequestObject(n,d,f,e);return p.then(function(t){delete t.withValidation;var i;return i=-1===["http","https"].indexOf(e.type())?o(e,u,c,l,t,n):a(e,t),s(i,r),i})}function o(e,t,n,r,o,i){var s=e.constructor.utils.Promise,a=e.get("_design/"+t).then(function(e){if(!(e.updates||{}).hasOwnProperty(n))throw{status:404,name:"not_found",message:"missing update function "+n+" on design doc _design/"+t};return e}),l=e.get(r)["catch"](function(){return null});return s.all([a,l]).then(function(t){var r,s=t[0],a=t[1],l=u.evaluate(s,{},s.updates[n]);try{r=l(a,o)}catch(f){throw u.wrapExecutionError(f)}var d=c(r[1]);if(null===r[0])return d;var p=i.withValidation?"validatingPut":"put";return e[p](r[0],i).then(function(){return d})})}var i=e("couchdb-objects"),s=e("promise-nodify"),u=e("couchdb-eval"),a=e("pouchdb-req-http-query"),c=e("couchdb-resp-completer");n.updatingPut=function(e,t,n){var o=this;return t.method="PUT",r(o,e,t,n)},n.updatingPost=function(e,t,n){var o=this;return t.method="POST",r(o,e,t,n)}},{"couchdb-eval":66,"couchdb-objects":70,"couchdb-resp-completer":73,"pouchdb-req-http-query":76,"promise-nodify":77}],66:[function(e,t){t.exports=e(29)},{}],67:[function(e,t){t.exports=e(22)},{"./couchsecurityobject.js":68,"./couchusercontextobject.js":69,extend:71,"is-empty":72,querystring:142}],68:[function(e,t){t.exports=e(23)},{}],69:[function(e,t){t.exports=e(24)},{}],70:[function(e,t){t.exports=e(25)},{"./couchrequestobject.js":67,"./couchsecurityobject.js":68,"./couchusercontextobject.js":69}],71:[function(e,t){t.exports=e(4)},{}],72:[function(e,t){t.exports=e(27)},{}],73:[function(e,t){t.exports=e(30)},{extend:74,"is-empty":75}],74:[function(e,t){t.exports=e(4)},{}],75:[function(e,t){t.exports=e(27)},{}],76:[function(e,t){t.exports=e(36)},{}],77:[function(e,t){t.exports=e(37)},{}],78:[function(e,t,n){"use strict";function r(e,t,n){return e.get(t,{revs:!0}).then(function(e){return n.push(e),n},function(){return n.push(null),n})}function o(e,t,n){var o=e.constructor.utils.Promise;return new o(function(u,a){function l(e){var n=e[0],r=e[1],o=e[2];t._revisions=(o||{})._revisions;try{n.forEach(function(e){e(t,o,r.userCtx,r.secObj)})}catch(i){throw a("undefined"!=typeof i.unauthorized?{name:"unauthorized",message:i.unauthorized,status:401}:"undefined"!=typeof i.forbidden?{name:"forbidden",message:i.forbidden,status:403}:c.wrapExecutionError(i)),"done"}u()}var f=-1!==["http","https"].indexOf(e.type());if(f&&!n.checkHttp)return void u();if(0===(t._id||"").indexOf("_design/"))return void u();var d=s(e).then(function(e){if(!e.length)throw u(),"done";return e}),p=i(e,n);o.all([d,p]).then(function(n){r(e,t._id,n).then(l)})["catch"](a)})}function i(e,t){if(t||(t={}),t.secObj||(t.secObj=l.buildSecurityObject()),!t.userCtx){var n=l.buildUserContextObject;return e.info().then(n).then(function(e){return t.userCtx=e,t})}return e.constructor.utils.Promise.resolve(t)}function s(e){return e.allDocs({startkey:"_design/",endkey:"_design0",include_docs:!0}).then(u)}function u(e){var t=e.rows.map(function(e){return{doc:e.doc,func:e.doc.validate_doc_update}});return t=t.filter(function(e){return"undefined"!=typeof e.func}),t=t.map(function(e){return c.evaluate(e.doc,{},e.func)})}function a(e,t,n){return"function"==typeof n&&(t=n,n={}),{db:e,callback:t,options:n}}var c=e("couchdb-eval"),l=e("couchdb-objects"),f=e("promise-nodify");n.validatingPut=function(e,t,n){var r=a(this,n,t),i=o(r.db,e,r.options).then(function(){return r.db.put(e,r.options)});return f(i,n),i},n.validatingPost=function(e,t,n){var r,i=a(this,n,t),s=i.db.constructor.utils.Promise;r=e._id?s.resolve(e._id):i.db.id();var u=r.then(function(t){return e._id=t,o(i.db,e,i.options).then(function(){return i.db.post(e,i.options)})});return f(u,n),u},n.validatingRemove=function(e,t,n){var r=a(this,n,t);e._deleted=!0;var i=o(r.db,e,r.options).then(function(){return r.db.remove(e,r.options)});return f(i,n),i},n.validatingBulkDocs=function(e,t,n){var r=a(this,n,t),i=r.db.constructor.utils.Promise,s=[],u=[],c=e.docs.map(function(e){var t;return t=e._id?i.resolve(e._id):r.db.id(),t.then(function(t){return e._id=t,o(r.db,e,r.options)}).then(function(){u.push(e)})["catch"](function(t){t.id=e._id,s.push(t)})}),l=i.all(c).then(function(){return r.db.bulkDocs({docs:u},r.options)}).then(function(e){return s.concat(e)});return f(l,n),l};var d=function(e,t,n,r,i,s,u){var c=a(this,u,s),l=c.db.get(e,{rev:n,revs:!0})["catch"](function(){return{_id:e}}).then(function(e){return e._attachments=e._attachments||{},e._attachments[t]={content_type:i,data:r},o(c.db,e,c.options)}).then(function(){return c.db.putAttachment(e,t,n,r,i)});return f(l,u),l};n.validatingPutAttachment=d;var p=function(e,t,n,r,i){var s=a(this,i,r),u=s.db.get(e,{rev:n,revs:!0}).then(function(e){return delete e._attachments[t],o(s.db,e,s.options)}).then(function(){return s.db.removeAttachment(e,t,n)});return f(u,i),u};n.validatingRemoveAttachment=p},{"couchdb-eval":79,"couchdb-objects":83,"promise-nodify":86}],79:[function(e,t){t.exports=e(29)},{}],80:[function(e,t){t.exports=e(22)},{"./couchsecurityobject.js":81,"./couchusercontextobject.js":82,extend:84,"is-empty":85,querystring:142}],81:[function(e,t){t.exports=e(23)},{}],82:[function(e,t){t.exports=e(24)},{}],83:[function(e,t){t.exports=e(25)},{"./couchrequestobject.js":80,"./couchsecurityobject.js":81,"./couchusercontextobject.js":82}],84:[function(e,t){t.exports=e(4)},{}],85:[function(e,t){t.exports=e(27)},{}],86:[function(e,t){t.exports=e(37)},{}],87:[function(e,t){t.exports="2.2.2"},{}],88:[function(e,t){"use strict";function n(e,t){for(var n=0;n<e.length;n++)if(t(e[n],n)===!0)return e[n];return!1}function r(e){return function(t,n){t||n[0].error?e(t||n[0]):e(null,n[0])}}function o(e){var t={},n=[];return a.traverseRevTree(e,function(e,r,o,i){var s=r+"-"+o;return e&&(t[s]=0),void 0!==i&&n.push({from:i,to:s}),s}),n.reverse(),n.forEach(function(e){t[e.from]=void 0===t[e.from]?1+t[e.to]:Math.min(t[e.from],1+t[e.to])}),t}function i(e,t,n){var r="limit"in t?t.keys.slice(t.skip,t.limit+t.skip):t.skip>0?t.keys.slice(t.skip):t.keys;if(t.descending&&r.reverse(),!r.length)return e._allDocs({limit:0},n);var o={offset:t.skip};return p.all(r.map(function(n){var r=u.extend(!0,{key:n,deleted:"ok"},t);return["limit","skip","keys"].forEach(function(e){delete r[e]}),new p(function(t,i){e._allDocs(r,function(e,r){return e?i(e):(o.total_rows=r.total_rows,void t(r.rows[0]||{key:n,error:"not_found"}))})})})).then(function(e){return o.rows=e,o})}function s(){var e=this;l.call(this),e.autoCompact=function(t){return e.auto_compaction?function(n,r){if(n)t(n);else{var o=r.length,i=function(){o--,o||t(null,r)};r.forEach(function(t){t.ok?e.compactDocument(t.id,1,i):i()})}}:t};var t,n=0,r=["change","delete","create","update"];this.on("newListener",function(o){if(~r.indexOf(o)){if(n)return void n++;n++;var i=0;t=this.changes({conflicts:!0,include_docs:!0,continuous:!0,since:"latest",onChange:function(t){t.seq<=i||(i=t.seq,e.emit("change",t),t.doc._deleted?e.emit("delete",t):"1"===t.doc._rev.split("-")[0]?e.emit("create",t):e.emit("update",t))}})}}),this.on("removeListener",function(e){~r.indexOf(e)&&(n--,n||t.cancel())
})}var u=e("./utils"),a=e("./merge"),c=e("./deps/errors"),l=e("events").EventEmitter,f=e("./deps/upsert"),d=e("./changes"),p=u.Promise;u.inherits(s,l),t.exports=s,s.prototype.post=u.adapterFun("post",function(e,t,n){return"function"==typeof t&&(n=t,t={}),"object"!=typeof e||Array.isArray(e)?n(c.NOT_AN_OBJECT):void this.bulkDocs({docs:[e]},t,this.autoCompact(r(n)))}),s.prototype.put=u.adapterFun("put",u.getArguments(function(e){var t,n,o,i,s=e.shift(),a="_id"in s;if("object"!=typeof s||Array.isArray(s))return(i=e.pop())(c.NOT_AN_OBJECT);for(s=u.clone(s);;)if(t=e.shift(),n=typeof t,"string"!==n||a?"string"!==n||!a||"_rev"in s?"object"===n?o=t:"function"===n&&(i=t):s._rev=t:(s._id=t,a=!0),!e.length)break;o=o||{};var l=u.invalidIdError(s._id);return l?i(l):void this.bulkDocs({docs:[s]},o,this.autoCompact(r(i)))})),s.prototype.putAttachment=u.adapterFun("putAttachment",function(e,t,n,r,o,i){function s(e){return e._attachments=e._attachments||{},e._attachments[t]={content_type:o,data:r},u.put(e)}var u=this;return"function"==typeof o&&(i=o,o=r,r=n,n=null),"undefined"==typeof o&&(o=r,r=n,n=null),u.get(e).then(function(e){if(e._rev!==n)throw c.REV_CONFLICT;return s(e)},function(t){if(t.error===c.MISSING_DOC.error)return s({_id:e});throw t})}),s.prototype.removeAttachment=u.adapterFun("removeAttachment",function(e,t,n,r){var o=this;o.get(e,function(e,i){return e?void r(e):i._rev!==n?void r(c.REV_CONFLICT):i._attachments?(delete i._attachments[t],0===Object.keys(i._attachments).length&&delete i._attachments,void o.put(i,r)):r()})}),s.prototype.remove=u.adapterFun("remove",function(e,t,n){"function"==typeof t?(n=t,t={}):"string"==typeof t?e={_id:e,_rev:t}:void 0===t&&(t={}),t=u.clone(t),t.was_delete=!0;var o={_id:e._id,_rev:e._rev};o._deleted=!0,this.bulkDocs({docs:[o]},t,r(n))}),s.prototype.revsDiff=u.adapterFun("revsDiff",function(e,t,n){function r(e,t){c[e]||(c[e]={missing:[]}),c[e].missing.push(t)}function o(t,n){var o=e[t].slice(0);a.traverseRevTree(n,function(e,n,i,s,u){var a=n+"-"+i,c=o.indexOf(a);-1!==c&&(o.splice(c,1),"available"!==u.status&&r(t,a))}),o.forEach(function(e){r(t,e)})}"function"==typeof t&&(n=t,t={}),t=u.clone(t);var i=Object.keys(e),s=0,c={};i.map(function(t){this._getRevisionTree(t,function(r,u){if(r&&"not_found"===r.name&&"missing"===r.message)c[t]={missing:e[t]};else{if(r)return n(r);o(t,u)}return++s===i.length?n(null,c):void 0})},this)}),s.prototype.compactDocument=function(e,t,n){var r=this;this._getRevisionTree(e,function(i,s){if(i)return n(i);var u=o(s),c=[],l=[];Object.keys(u).forEach(function(e){u[e]>t&&c.push(e)}),a.traverseRevTree(s,function(e,t,n,r,o){var i=t+"-"+n;"available"===o.status&&-1!==c.indexOf(i)&&(o.status="missing",l.push(i))}),r._doCompaction(e,s,l,n)})},s.prototype.compact=u.adapterFun("compact",function(e,t){"function"==typeof e&&(t=e,e={});var n=this;this.changes({complete:function(e,r){if(e)return void t();var o=r.results.length;return o?void r.results.forEach(function(e){n.compactDocument(e.id,0,function(){o--,o||t()})}):void t()}})}),s.prototype.get=u.adapterFun("get",function(e,t,r){function o(){var n=[],o=i.length;return o?void i.forEach(function(i){s.get(e,{rev:i,revs:t.revs,attachments:t.attachments},function(e,t){n.push(e?{missing:i}:{ok:t}),o--,o||r(null,n)})}):r(null,n)}if("function"==typeof t&&(r=t,t={}),"string"!=typeof e)return r(c.INVALID_ID);var i=[],s=this;if(!t.open_revs)return this._get(e,t,function(e,o){if(t=u.clone(t),e)return r(e);var i=o.doc;if(!i)return r(new Error("no doc!"));var c=o.metadata,l=o.ctx;if(t.conflicts){var f=a.collectConflicts(c);f.length&&(i._conflicts=f)}if(t.revs||t.revs_info){var d=a.rootToLeaf(c.rev_tree),p=n(d,function(e){return-1!==e.ids.map(function(e){return e.id}).indexOf(i._rev.split("-")[1])});if(p.ids.splice(p.ids.map(function(e){return e.id}).indexOf(i._rev.split("-")[1])+1),p.ids.reverse(),t.revs&&(i._revisions={start:p.pos+p.ids.length-1,ids:p.ids.map(function(e){return e.id})}),t.revs_info){var h=p.pos+p.ids.length;i._revs_info=p.ids.map(function(e){return h--,{rev:h+"-"+e.id,status:e.opts.status}})}}if(t.local_seq&&(i._local_seq=o.metadata.seq),t.attachments&&i._attachments){var v=i._attachments,m=Object.keys(v).length;if(0===m)return r(null,i);Object.keys(v).forEach(function(e){this._getAttachment(v[e],{encode:!0,ctx:l},function(t,n){i._attachments[e].data=n,--m||r(null,i)})},s)}else{if(i._attachments)for(var y in i._attachments)i._attachments.hasOwnProperty(y)&&(i._attachments[y].stub=!0);r(null,i)}});if("all"===t.open_revs)this._getRevisionTree(e,function(e,t){e&&(t=[]),i=a.collectLeaves(t).map(function(e){return e.rev}),o()});else{if(!Array.isArray(t.open_revs))return r(c.error(c.UNKNOWN_ERROR,"function_clause"));i=t.open_revs;for(var l=0;l<i.length;l++){var f=i[l];if("string"!=typeof f||!/^\d+-/.test(f))return r(c.error(c.BAD_REQUEST,"Invalid rev format"))}o()}}),s.prototype.getAttachment=u.adapterFun("getAttachment",function(e,t,n,r){var o=this;n instanceof Function&&(r=n,n={}),n=u.clone(n),this._get(e,n,function(e,i){return e?r(e):i.doc._attachments&&i.doc._attachments[t]?(n.ctx=i.ctx,void o._getAttachment(i.doc._attachments[t],n,r)):r(c.MISSING_DOC)})}),s.prototype.allDocs=u.adapterFun("allDocs",function(e,t){if("function"==typeof e&&(t=e,e={}),e=u.clone(e),e.skip="undefined"!=typeof e.skip?e.skip:0,"keys"in e){if(!Array.isArray(e.keys))return t(new TypeError("options.keys must be an array"));var n=["startkey","endkey","key"].filter(function(t){return t in e})[0];if(n)return void t(c.error(c.QUERY_PARSE_ERROR,"Query parameter `"+n+"` is not compatible with multi-get"));if("http"!==this.type())return i(this,e,t)}return this._allDocs(e,t)}),s.prototype.changes=function(e,t){return"function"==typeof e&&(t=e,e={}),new d(this,e,t)},s.prototype.close=u.adapterFun("close",function(e){return this._close(e)}),s.prototype.info=u.adapterFun("info",function(e){var t=this;this._info(function(n,r){if(n)return e(n);var o=t.prefix.length;r.db_name.length>o&&r.db_name.slice(0,o)===t.prefix&&(r.db_name=r.db_name.slice(o)),e(null,r)})}),s.prototype.id=u.adapterFun("id",function(e){return this._id(e)}),s.prototype.type=function(){return"function"==typeof this._type?this._type():this.adapter},s.prototype.bulkDocs=u.adapterFun("bulkDocs",function(e,t,n){if("function"==typeof t&&(n=t,t={}),t=u.clone(t),Array.isArray(e)&&(e={docs:e}),!e||!e.docs||!Array.isArray(e.docs))return n(c.MISSING_BULK_DOCS);for(var r=0;r<e.docs.length;++r)if("object"!=typeof e.docs[r]||Array.isArray(e.docs[r]))return n(c.NOT_AN_OBJECT);return e=u.clone(e),"new_edits"in t||(t.new_edits="new_edits"in e?e.new_edits:!0),this._bulkDocs(e,t,this.autoCompact(n))}),s.prototype.registerDependentDatabase=u.adapterFun("registerDependentDatabase",function(e,t){function n(t){return t.dependentDbs=t.dependentDbs||{},t.dependentDbs[e]?!1:(t.dependentDbs[e]=!0,t)}var r=new this.constructor(e,{adapter:this._adapter});f(this,"_local/_pouch_dependentDbs",n,function(e){return e?t(e):t(null,{db:r})})})},{"./changes":92,"./deps/errors":96,"./deps/upsert":97,"./merge":102,"./utils":107,events:138}],89:[function(e,t){"use strict";function n(e){for(var t=n.options,r=t.parser[t.strictMode?"strict":"loose"].exec(e),o={},i=14;i--;)o[t.key[i]]=r[i]||"";return o[t.q.name]={},o[t.key[12]].replace(t.q.parser,function(e,n,r){n&&(o[t.q.name][n]=r)}),o}function r(e){return/^_(design|local)/.test(e)?e:encodeURIComponent(e)}function o(e,t){if(/http(s?):/.test(e)){var r=n(e);r.remote=!0,(r.user||r.password)&&(r.auth={username:r.user,password:r.password});var o=r.path.replace(/(^\/|\/$)/g,"").split("/");if(r.db=o.pop(),r.path=o.join("/"),t=t||{},t=a.clone(t),r.headers=t.headers||{},t.auth||r.auth){var i=t.auth||r.auth,s=a.btoa(i.username+":"+i.password);r.headers.Authorization="Basic "+s}return t.headers&&(r.headers=t.headers),r}return{host:"",path:"/",db:e,auth:!1}}function i(e,t){return s(e,e.db+"/"+t)}function s(e,t){if(e.remote){var n=e.path?"/":"";return e.protocol+"://"+e.host+":"+e.port+"/"+e.path+n+t}return"/"+t}function u(e,t){function n(e,t){return a.ajax(a.extend({},p,e),t)}function u(e,r,o,i){r=a.clone(r);var u=l.getHost(i),c={source:f.db,target:u.protocol===f.protocol&&u.authority===f.authority?u.db:u.source};r.continuous&&(c.continuous=!0),r.create_target&&(c.create_target=!0),r.doc_ids&&(c.doc_ids=r.doc_ids),r.filter&&"string"==typeof r.filter&&(c.filter=r.filter),r.query_params&&(c.query_params=r.query_params);var d,p={},h={headers:f.headers,method:"POST",url:s(f,"_replicate"),body:c};o.cancel=function(){this.cancelled=!0,d&&!p.ok&&d.abort(),p._local_id&&(h.body={replication_id:p._local_id}),h.body.cancel=!0,n(h,function(e,n,o){return e?t(e):void a.call(r.complete,null,p,o)})},o.cancelled||(d=n(h,function(e,n,o){return e?t(e):(p.ok=!0,n._local_id&&(p._local_id=n._local_id),void a.call(r.complete,null,n,o))}))}var l=this;l.getHost=e.getHost?e.getHost:o;var f=l.getHost(e.name,e),d=i(f,"");l.getUrl=function(){return d};var p=e.ajax||{};e=a.clone(e);var h={list:[],get:function(e,t){"function"==typeof e&&(t=e,e={count:10});var r=function(e,n){!e&&"uuids"in n?(h.list=h.list.concat(n.uuids),t(null,"OK")):t(e||c.UNKNOWN_ERROR)},o="?count="+e.count;n({headers:f.headers,method:"GET",url:s(f,"_uuids")+o},r)}},v=function(){n({headers:f.headers,method:"PUT",url:d},function(e){e&&401===e.status?n({headers:f.headers,method:"HEAD",url:d},function(e){e?t(e):t(null,l)}):e&&412!==e.status?t(e):t(null,l)})};e.skipSetup||n({headers:f.headers,method:"GET",url:d},function(e){e?404===e.status?v():t(e):t(null,l)}),l.type=function(){return"http"},l.id=a.adapterFun("id",function(e){n({headers:f.headers,method:"GET",url:s(f,"")},function(t,n){var r=n&&n.uuid?n.uuid+f.db:i(f,"");e(null,r)})}),l.request=a.adapterFun("request",function(e,t){e.headers=f.headers,e.url=i(f,e.url),n(e,t)}),l.compact=a.adapterFun("compact",function(e,t){"function"==typeof e&&(t=e,e={}),e=a.clone(e),n({headers:f.headers,url:i(f,"_compact"),method:"POST"},function(){function n(){l.info(function(r,o){o.compact_running?setTimeout(n,e.interval||200):t()})}"function"==typeof t&&n()})}),l._info=function(e){n({headers:f.headers,method:"GET",url:i(f,"")},function(t,n){t?e(t):(n.host=i(f,""),e(null,n))})},l.get=a.adapterFun("get",function(e,t,o){"function"==typeof t&&(o=t,t={}),t=a.clone(t),void 0===t.auto_encode&&(t.auto_encode=!0);var s=[];t.revs&&s.push("revs=true"),t.revs_info&&s.push("revs_info=true"),t.local_seq&&s.push("local_seq=true"),t.open_revs&&("all"!==t.open_revs&&(t.open_revs=JSON.stringify(t.open_revs)),s.push("open_revs="+t.open_revs)),t.attachments&&s.push("attachments=true"),t.rev&&s.push("rev="+t.rev),t.conflicts&&s.push("conflicts="+t.conflicts),s=s.join("&"),s=""===s?"":"?"+s,t.auto_encode&&(e=r(e));var u={headers:f.headers,method:"GET",url:i(f,e+s)},c=e.split("/");(c.length>1&&"_design"!==c[0]&&"_local"!==c[0]||c.length>2&&"_design"===c[0]&&"_local"!==c[0])&&(u.binary=!0),n(u,function(e,t,n){return e?o(e):void o(null,t,n)})}),l.remove=a.adapterFun("remove",function(e,t,o){"function"==typeof t?(o=t,t={}):"string"==typeof t?e={_id:e,_rev:t}:void 0===t&&(t={}),n({headers:f.headers,method:"DELETE",url:i(f,r(e._id))+"?rev="+e._rev},o)}),l.getAttachment=a.adapterFun("getAttachment",function(e,t,n,o){"function"==typeof n&&(o=n,n={}),n=a.clone(n),void 0===n.auto_encode&&(n.auto_encode=!0),n.auto_encode&&(e=r(e)),n.auto_encode=!1,l.get(e+"/"+t,n,o)}),l.removeAttachment=a.adapterFun("removeAttachment",function(e,t,o,s){n({headers:f.headers,method:"DELETE",url:i(f,r(e)+"/"+t)+"?rev="+o},s)}),l.putAttachment=a.adapterFun("putAttachment",function(e,t,o,s,u,a){"function"==typeof u&&(a=u,u=s,s=o,o=null),"undefined"==typeof u&&(u=s,s=o,o=null);var c=r(e)+"/"+t,l=i(f,c);o&&(l+="?rev="+o);var d={headers:f.headers,method:"PUT",url:l,processData:!1,body:s,timeout:6e4};d.headers["Content-Type"]=u,n(d,a)}),l.put=a.adapterFun("put",a.getArguments(function(e){var t,o,s,u,l=e.shift(),d="_id"in l;if("object"!=typeof l||Array.isArray(l))return(u=e.pop())(c.NOT_AN_OBJECT);for(l=a.clone(l);;)if(t=e.shift(),o=typeof t,"string"!==o||d?"string"!==o||!d||"_rev"in l?"object"===o?s=a.clone(t):"function"===o&&(u=t):l._rev=t:(l._id=t,d=!0),!e.length)break;s=s||{};var p=a.invalidIdError(l._id);if(p)return u(p);var h=[];s&&"undefined"!=typeof s.new_edits&&h.push("new_edits="+s.new_edits),h=h.join("&"),""!==h&&(h="?"+h),n({headers:f.headers,method:"PUT",url:i(f,r(l._id))+h,body:l},u)})),l.post=a.adapterFun("post",function(e,t,n){return"function"==typeof t&&(n=t,t={}),t=a.clone(t),"object"!=typeof e?n(c.NOT_AN_OBJECT):void("_id"in e?l.put(e,t,n):h.list.length>0?(e._id=h.list.pop(),l.put(e,t,n)):h.get(function(r){return r?n(c.UNKNOWN_ERROR):(e._id=h.list.pop(),void l.put(e,t,n))}))}),l._bulkDocs=function(e,t,r){"undefined"!=typeof t.new_edits&&(e.new_edits=t.new_edits),n({headers:f.headers,method:"POST",url:i(f,"_bulk_docs"),body:e},r)},l.allDocs=a.adapterFun("allDocs",function(e,t){"function"==typeof e&&(t=e,e={}),e=a.clone(e);var r,o=[],s="GET";if(e.conflicts&&o.push("conflicts=true"),e.descending&&o.push("descending=true"),e.include_docs&&o.push("include_docs=true"),e.key&&o.push("key="+encodeURIComponent(JSON.stringify(e.key))),e.startkey&&o.push("startkey="+encodeURIComponent(JSON.stringify(e.startkey))),e.endkey&&o.push("endkey="+encodeURIComponent(JSON.stringify(e.endkey))),"undefined"!=typeof e.inclusive_end&&o.push("inclusive_end="+!!e.inclusive_end),"undefined"!=typeof e.limit&&o.push("limit="+e.limit),"undefined"!=typeof e.skip&&o.push("skip="+e.skip),o=o.join("&"),""!==o&&(o="?"+o),"undefined"!=typeof e.keys){var u=2e3,c="keys="+encodeURIComponent(JSON.stringify(e.keys));c.length+o.length+1<=u?o+=(-1!==o.indexOf("?")?"&":"?")+c:(s="POST",r=JSON.stringify({keys:e.keys}))}n({headers:f.headers,method:s,url:i(f,"_all_docs"+o),body:r},t)}),l._changes=function(e){var t=25;e=a.clone(e),e.timeout=e.timeout||0;var r={timeout:2e4},o="undefined"!=typeof e.limit?e.limit:!1;0===o&&(o=1);var s;s="returnDocs"in e?e.returnDocs:!0;var u=o;if(e.style&&(r.style=e.style),(e.include_docs||e.filter&&"function"==typeof e.filter)&&(r.include_docs=!0),e.continuous&&(r.feed="longpoll"),e.conflicts&&(r.conflicts=!0),e.descending&&(r.descending=!0),e.filter&&"string"==typeof e.filter&&(r.filter=e.filter,"_view"===e.filter&&e.view&&"string"==typeof e.view&&(r.view=e.view)),e.query_params&&"object"==typeof e.query_params)for(var l in e.query_params)e.query_params.hasOwnProperty(l)&&(r[l]=e.query_params[l]);var d,p,h=function(s,a){if(!e.aborted){r.since=s,e.descending?o&&(r.limit=u):r.limit=!o||u>t?t:u;var c="?"+Object.keys(r).map(function(e){return e+"="+r[e]}).join("&"),l={headers:f.headers,method:"GET",url:i(f,"_changes"+c),timeout:e.timeout};p=s,e.aborted||(d=n(l,a))}},v=10,m=0,y={results:[]},g=function(n,r){if(!e.aborted){var i=0;if(r&&r.results){i=r.results.length,y.last_seq=r.last_seq;var l={};l.query=e.query_params,r.results=r.results.filter(function(t){u--;var n=a.filterChange(e)(t);return n&&(s&&y.results.push(t),a.call(e.onChange,t)),n})}else if(n)return e.aborted=!0,void a.call(e.complete,n);r&&r.last_seq&&(p=r.last_seq);var f=o&&0>=u||r&&t>i||e.descending;if((!e.continuous||o&&0>=u)&&f)a.call(e.complete,null,y);else{n?m+=1:m=0;var d=1<<m,_=v*d,b=e.maximumWait||3e4;if(_>b)return void a.call(e.complete,n||c.UNKNOWN_ERROR);setTimeout(function(){h(p,g)},_)}}};return h(e.since||0,g),{cancel:function(){e.aborted=!0,d&&d.abort()}}},l.revsDiff=a.adapterFun("revsDif",function(e,t,r){"function"==typeof t&&(r=t,t={}),n({headers:f.headers,method:"POST",url:i(f,"_revs_diff"),body:e},function(e,t){r(e,t)})}),l.close=a.adapterFun("close",function(e){e()}),l.replicateOnServer=function(e,t,n){return l.taskqueue.isReady?void e.info(function(r,o){u(e,t,n,o.host)}):(l.taskqueue.addTask("replicateOnServer",[e,t,n]),n)},l.destroy=a.adapterFun("destroy",function(e){n({url:i(f,""),method:"DELETE",headers:f.headers},function(t,n){t?(l.emit("error",t),e(t)):(l.emit("destroyed"),e(null,n))})})}var a=e("../utils"),c=e("../deps/errors");n.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},u.destroy=a.toPromise(function(e,t,n){var r=o(e,t);t=t||{},"function"==typeof t&&(n=t,t={}),t=a.clone(t),t.headers=r.headers,t.method="DELETE",t.url=i(r,"");var s=t.ajax||{};t=a.extend({},t,s),a.ajax(t,n)}),u.valid=function(){return!0},t.exports=u},{"../deps/errors":96,"../utils":107}],90:[function(e,t){(function(n){"use strict";function r(e){return function(t){e(a.error(a.IDB_ERROR,t.target,t.type))}}function o(){var e="_pouch__checkModernIdb_"+(n.navigator&&n.navigator.appVersion),t=s.hasLocalStorage()&&n.localStorage[e];if(t)return JSON.parse(t);var r="_pouch__checkModernIdb",o=null===n.indexedDB.open(r,1).onupgradeneeded;return n.indexedDB.deleteDatabase&&n.indexedDB.deleteDatabase(r),s.hasLocalStorage()&&(n.localStorage[e]=JSON.stringify(o)),o}function i(e,t){function o(e){e.createObjectStore(h,{keyPath:"id"}).createIndex("seq","seq",{unique:!0}),e.createObjectStore(v,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),e.createObjectStore(m,{keyPath:"digest"}),e.createObjectStore(y,{keyPath:"id",autoIncrement:!1}),e.createObjectStore(g)}function c(e){var t=e.currentTarget.transaction.objectStore(h);t.openCursor().onsuccess=function(e){var n=e.target.result;if(n){var r=n.value,o=s.isDeleted(r),i=s.isLocalId(r.id);r.deletedOrLocal=o||i?"1":"0",t.put(r),n["continue"]()}else t.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1})}}function l(e,t){return e._bulk_seq-t._bulk_seq}function f(e,t,r){var o="startkey"in t?t.startkey:!1,i="endkey"in t?t.endkey:!1,c="key"in t?t.key:!1,l=t.skip||0,f="number"==typeof t.limit?t.limit:-1,d=t.inclusive_end!==!1,p="descending"in t&&t.descending?"prev":null,m=!1;p&&o&&i&&(m=i,i=!1);var y;try{y=o&&i?n.IDBKeyRange.bound(o,i,!1,!d):o?p?n.IDBKeyRange.upperBound(o):n.IDBKeyRange.lowerBound(o):i?p?n.IDBKeyRange.lowerBound(i,!d):n.IDBKeyRange.upperBound(i,!d):c?n.IDBKeyRange.only(c):null}catch(g){return"DataError"===g.name&&0===g.code?r(null,{total_rows:e,offset:t.skip,rows:[]}):r(a.error(a.IDB_ERROR,g.name,g.message))}var _=k.transaction([h,v],"readonly");_.oncomplete=function(){r(null,{total_rows:e,offset:t.skip,rows:x})};var b=_.objectStore(h),w=p?b.openCursor(y,p):b.openCursor(y),x=[];w.onsuccess=function(e){function n(e,n){if(s.isLocalId(e.id))return r["continue"]();var o={id:e.id,key:e.id,value:{rev:i}};if(t.include_docs){o.doc=n,o.doc._rev=i,o.doc._doc_id_rev&&delete o.doc._doc_id_rev,t.conflicts&&(o.doc._conflicts=u.collectConflicts(e));for(var a in o.doc._attachments)o.doc._attachments.hasOwnProperty(a)&&(o.doc._attachments[a].stub=!0)}var c=s.isDeleted(e,i);if("ok"===t.deleted)c&&(o.value.deleted=!0,o.doc=null),x.push(o);else if(!c&&l--<=0){if(m&&o.key<m)return;if(x.push(o),0===--f)return}r["continue"]()}if(e.target.result){var r=e.target.result,o=r.value,i=o.winningRev||u.winningRev(o);if(t.include_docs){var a=_.objectStore(v).index("_doc_id_rev"),c=o.id+"::"+i;a.get(c).onsuccess=function(e){n(r.value,e.target.result)}}else n(o)}}}function d(e){if(-1!==w)return e(null,w);var t,o=k.transaction([h],"readonly"),i=o.objectStore(h).index("deletedOrLocal");i.count(n.IDBKeyRange.only("0")).onsuccess=function(e){t=e.target.result},o.onerror=r(e),o.oncomplete=function(){w=t,e(null,w)}}var p=2,h="document-store",v="by-sequence",m="attach-store",y="meta-store",g="detect-blob-support",_=e.name,b=n.indexedDB.open(_,p),w=-1;"openReqList"in i||(i.openReqList={}),i.openReqList[_]=b;var x=null,E=null,S=this,k=null;b.onupgradeneeded=function(e){var t=e.target.result;e.oldVersion<1&&o(t),e.oldVersion<2&&c(e)},b.onsuccess=function(e){k=e.target.result,k.onversionchange=function(){k.close()};var n=k.transaction([y,g],"readwrite"),r=n.objectStore(y).get(y);r.onsuccess=function(e){var r=!1,o=function(){null!==x&&r&&t(null,S)},i=e.target.result||{id:y};_+"_id"in i?(E=i[_+"_id"],r=!0,o()):(E=s.uuid(),i[_+"_id"]=E,n.objectStore(y).put(i).onsuccess=function(){r=!0,o()});try{n.objectStore(g).put(s.createBlob(),"key"),x=!0}catch(u){x=!1}finally{o()}}},b.onerror=r(t),S.type=function(){return"idb"},S._id=s.toPromise(function(e){e(null,E)}),S._bulkDocs=function(e,t,n){function o(e){var t=e.target.result;t.updateSeq=(t.updateSeq||0)+I,C.objectStore(y).put(t)}function c(){if(!R.length)return void(C.objectStore(y).get(y).onsuccess=o);var e=R.shift(),t=C.objectStore(h).get(e.metadata.id);t.onsuccess=function(t){var n=t.target.result;n?b(n,e):E(e)}}function f(){var e=[];A.sort(l),A.forEach(function(t){if(delete t._bulk_seq,t.error)return void e.push(t);var n=t.metadata,r=u.winningRev(n);e.push({ok:!0,id:n.id,rev:r}),s.isLocalId(n.id)||(i.Changes.notify(_),i.Changes.notifyLocalWindows(_))}),w=-1,n(null,e)}function d(e,t){if(e.stub)return t();if("string"==typeof e.data){var r;try{r=atob(e.data)}catch(o){var i=a.error(a.BAD_ARG,"Attachments need to be base64 encoded");return n(i)}if(e.digest="md5-"+s.MD5(r),x){var u=e.content_type;r=s.fixBinary(r),e.data=s.createBlob([r],{type:u})}return t()}var c=new FileReader;c.onloadend=function(){var n=s.arrayBufferToBinaryString(this.result);e.digest="md5-"+s.MD5(n),x||(e.data=btoa(n)),t()},c.readAsArrayBuffer(e.data)}function p(e){function t(){n++,R.length===n&&e()}if(!R.length)return e();var n=0;R.forEach(function(e){function n(){o++,o===r.length&&t()}var r=e.data&&e.data._attachments?Object.keys(e.data._attachments):[];if(!r.length)return t();var o=0;for(var i in e.data._attachments)e.data._attachments.hasOwnProperty(i)&&d(e.data._attachments[i],n)})}function g(e,t,n,r){function o(e){c||(e?(c=e,r(c)):l===f.length&&a())}function i(e){l++,o(e)}function a(){e.data._doc_id_rev=e.data._id+"::"+e.data._rev;var t=C.objectStore(v).index("_doc_id_rev");t.getKey(e.data._doc_id_rev).onsuccess=function(t){var o=t.target.result?C.objectStore(v).put(e.data,t.target.result):C.objectStore(v).put(e.data);o.onsuccess=function(t){var o=e.metadata;o.seq=t.target.result,delete o.rev;var i=s.isLocalId(o.id);o.deletedOrLocal=n||i?"1":"0",o.winningRev=u.winningRev(o);var a=C.objectStore(h).put(o);a.onsuccess=function(){delete o.deletedOrLocal,delete o.winningRev,A.push(e),s.call(r)}}}}var c=null,l=0;e.data._id=e.metadata.id,e.data._rev=e.metadata.rev,I++,n&&(e.data._deleted=!0);var f=e.data._attachments?Object.keys(e.data._attachments):[];for(var d in e.data._attachments)if(e.data._attachments[d].stub)l++,o();else{var p=e.data._attachments[d].data;delete e.data._attachments[d].data;var m=e.data._attachments[d].digest;O(e,m,p,i)}f.length||a()}function b(e,t){var n=u.winningRev(t.metadata),r=s.isDeleted(t.metadata,n),o=u.merge(e.rev_tree,t.metadata.rev_tree[0],1e3),i=s.isDeleted(e),l=i&&r&&j||!i&&j&&"new_leaf"!==o.conflicts;return l?(A.push(S(a.REV_CONFLICT,t._bulk_seq)),c()):(t.metadata.rev_tree=o.tree,void g(t,n,r,c))}function E(e){var n=u.winningRev(e.metadata),r=s.isDeleted(e.metadata,n);return"was_delete"in t&&r?(A.push(a.MISSING_DOC),c()):void g(e,n,r,c)}function S(e,t){return e._bulk_seq=t,e}function O(e,t,n,r){var o=C.objectStore(m);o.get(t).onsuccess=function(i){var u=i.target.result&&i.target.result.refs||{},a=[e.metadata.id,e.metadata.rev].join("@"),c={digest:t,body:n,refs:u};c.refs[a]=!0,o.put(c).onsuccess=function(){s.call(r)}}}var j=t.new_edits,q=e.docs,R=q.map(function(e,t){var n=s.parseDoc(e,j);return n._bulk_seq=t,n}),T=R.filter(function(e){return e.error});if(T.length)return n(T[0]);var C,A=[],I=0;p(function(){C=k.transaction([h,v,m,y],"readwrite"),C.onerror=r(n),C.ontimeout=r(n),C.oncomplete=f,c()})},S._get=function(e,t,n){function r(){n(c,{doc:o,metadata:i,ctx:l})}var o,i,c,l;t=s.clone(t),l=t.ctx?t.ctx:k.transaction([h,v,m],"readonly"),l.objectStore(h).get(e).onsuccess=function(e){if(i=e.target.result,!i)return c=a.MISSING_DOC,r();if(s.isDeleted(i)&&!t.rev)return c=a.error(a.MISSING_DOC,"deleted"),r();var n=l.objectStore(v),f=t.rev||i.winningRev||u.winningRev(i),d=i.id+"::"+f;n.index("_doc_id_rev").get(d).onsuccess=function(e){return o=e.target.result,o&&o._doc_id_rev&&delete o._doc_id_rev,o?void r():(c=a.MISSING_DOC,r())}}},S._getAttachment=function(e,t,n){var r,o;t=s.clone(t),o=t.ctx?t.ctx:k.transaction([h,v,m],"readonly");var i=e.digest,u=e.content_type;o.objectStore(m).get(i).onsuccess=function(e){var o=e.target.result.body;if(t.encode)if(x){var i=new FileReader;i.onloadend=function(){var e=s.arrayBufferToBinaryString(this.result);r=btoa(e),n(null,r)},i.readAsArrayBuffer(o)}else r=o,n(null,r);else x?r=o:(o=s.fixBinary(atob(o)),r=s.createBlob([o],{type:u})),n(null,r)}},S._allDocs=function(e,t){d(function(n,r){return n?t(n):0===e.limit?t(null,{total_rows:r,offset:e.skip,rows:[]}):void f(r,e,t)})},S._info=function(e){d(function(t,n){if(t)return e(t);if(null===k){var r=new Error("db isn't open");return r.id="idbNull",e(r)}var o=0,i=k.transaction([y],"readonly");i.objectStore(y).get(y).onsuccess=function(e){o=e.target.result&&e.target.result.updateSeq||0},i.oncomplete=function(){e(null,{db_name:_,doc_count:n,update_seq:o})}})},S._changes=function(e){function t(){p=k.transaction([h,v]),p.oncomplete=o;var t;t=c?p.objectStore(v).openCursor(n.IDBKeyRange.lowerBound(e.since,!0),c):p.objectStore(v).openCursor(n.IDBKeyRange.lowerBound(e.since,!0)),t.onsuccess=r,t.onerror=onerror}function r(t){var n=t.target.result;if(n){var r=n.value;if(s.isLocalId(r._id)||e.doc_ids&&-1===e.doc_ids.indexOf(r._id))return n["continue"]();var o=p.objectStore(h);o.get(r._id).onsuccess=function(t){var o=t.target.result;l<o.seq&&(l=o.seq);var i=o.winningRev||u.winningRev(o);if(r._rev!==i)return n["continue"]();delete r._doc_id_rev;var s=e.processChange(r,o,e);s.seq=n.key,g(s)&&(y++,d&&m.push(s),e.onChange(s)),y!==f&&n["continue"]()}}}function o(){e.continuous||e.complete(null,{results:m,last_seq:l})}if(e=s.clone(e),e.continuous){var a=_+":"+s.uuid();return i.Changes.addListener(_,a,S,e),i.Changes.notify(_),{cancel:function(){i.Changes.removeListener(_,a)}}}var c=e.descending?"prev":null,l=0;e.since=e.since&&!c?e.since:0;var f="limit"in e?e.limit:-1;0===f&&(f=1);var d;d="returnDocs"in e?e.returnDocs:!0;var p,m=[],y=0,g=s.filterChange(e);t()},S._close=function(e){return null===k?e(a.NOT_OPEN):(k.close(),k=null,void e())},S._getRevisionTree=function(e,t){var n=k.transaction([h],"readonly"),r=n.objectStore(h).get(e);r.onsuccess=function(e){var n=e.target.result;n?t(null,n.rev_tree):t(a.MISSING_DOC)}},S._doCompaction=function(e,t,n,r){var o=k.transaction([h,v],"readwrite"),i=o.objectStore(h);i.get(e).onsuccess=function(r){var i=r.target.result;i.rev_tree=t;var s=n.length;n.forEach(function(t){var n=o.objectStore(v).index("_doc_id_rev"),r=e+"::"+t;n.getKey(r).onsuccess=function(e){var t=e.target.result;t&&(o.objectStore(v)["delete"](t),s--,s||o.objectStore(h).put(i))}})},o.oncomplete=function(){s.call(r)}}}var s=e("../utils"),u=e("../merge"),a=e("../deps/errors");i.valid=function(){return n.indexedDB&&o()},i.destroy=s.toPromise(function(e,t,o){"openReqList"in i||(i.openReqList={}),i.Changes.clearListeners(e),i.openReqList[e]&&i.openReqList[e].result&&i.openReqList[e].result.close();var u=n.indexedDB.deleteDatabase(e);u.onsuccess=function(){i.openReqList[e]&&(i.openReqList[e]=null),s.hasLocalStorage()&&delete n.localStorage[e],o(null,{ok:!0})},u.onerror=r(o)}),i.Changes=new s.Changes,t.exports=i}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../deps/errors":96,"../merge":102,"../utils":107}],91:[function(e,t){(function(n){"use strict";function r(e){return"'"+e+"'"}function o(e,t,n,r,o){return"SELECT "+e+" FROM "+("string"==typeof t?t:t.join(" JOIN "))+(n?" ON "+n:"")+(r?" WHERE "+("string"==typeof r?r:r.join(" AND ")):"")+(o?" ORDER BY "+o:"")}function i(e){return function(t){var n=t&&t.constructor.toString().match(/function ([^\(]+)/),r=n&&n[1]||t.type,o=t.target||t.message;e(f.error(f.WSQ_ERROR,o,r))}}function s(e){return decodeURIComponent(window.escape(e))}function u(e,t){for(var n="",r="UTF-8"===t?2:4,o=0,i=e.length;i>o;o+=r){var u=e.substring(o,o+r);4===r&&(u=u.substring(2,4)+u.substring(0,2)),n+=String.fromCharCode(parseInt(u,16))}return n="UTF-8"===t?s(n):n}function a(e,t){function r(){c.hasLocalStorage()&&(n.localStorage["_pouch__websqldb_"+I]=!0),t(null,C)}function s(e){e.executeSql(E),e.executeSql("ALTER TABLE "+g+" ADD COLUMN deleted TINYINT(1) DEFAULT 0",[],function(){e.executeSql(w),e.executeSql("ALTER TABLE "+y+" ADD COLUMN local TINYINT(1) DEFAULT 0",[],function(){e.executeSql(x);var t="SELECT "+y+".winningseq AS seq, "+y+".json AS metadata FROM "+g+" JOIN "+y+" ON "+g+".seq = "+y+".winningseq";e.executeSql(t,[],function(e,t){for(var n=[],r=[],o=0;o<t.rows.length;o++){var i=t.rows.item(o),s=i.seq,u=JSON.parse(i.metadata);c.isDeleted(u)&&n.push(s),c.isLocalId(u.id)&&r.push(u.id)}e.executeSql("UPDATE "+y+"SET local = 1 WHERE id IN ("+r.map(function(){return"?"}).join(",")+")",r),e.executeSql("UPDATE "+g+" SET deleted = 1 WHERE seq IN ("+n.map(function(){return"?"}).join(",")+")",n)})})})}function d(e){for(;N.length>0;){var t=N.pop();t(null,A)}O(e)}function O(e){e.executeSql("SELECT dbid, hex(dbid) AS hexId FROM "+b,[],function(e,t){var n=t.rows.item(0).dbid,r=t.rows.item(0).hexId;T=r.length===2*n.length?"UTF-8":"UTF-16"})}function j(e,t){if(0===t){var n="CREATE TABLE IF NOT EXISTS "+b+" (update_seq, dbid, db_version INTEGER)",r="CREATE TABLE IF NOT EXISTS "+_+" (digest, json, body BLOB)",o="CREATE TABLE IF NOT EXISTS "+y+" (id unique, json, winningseq, local TINYINT(1))",i="CREATE TABLE IF NOT EXISTS "+g+" (seq INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, doc_id_rev UNIQUE, json, deleted TINYINT(1))";e.executeSql(r),e.executeSql(o,[],function(){e.executeSql(E),e.executeSql(x)}),e.executeSql(i,[],function(){e.executeSql(w)}),e.executeSql(n,[],function(){var t="INSERT INTO "+b+" (update_seq, db_version, dbid) VALUES (?, ?, ?)";A=c.uuid(),e.executeSql(t,[0,m,A]),d(e)})}else 1===t&&(s(e),e.executeSql("UPDATE "+b+" SET db_version = "+m)),e.executeSql("SELECT dbid FROM "+b,[],function(e,t){A=t.rows.item(0).dbid,d(e)})}function q(){L.transaction(function(e){e.executeSql("SELECT sql FROM sqlite_master WHERE tbl_name = "+b,[],function(e,t){t.rows.length?/db_version/.test(t.rows.item(0).sql)?e.executeSql("SELECT db_version FROM "+b,[],function(e,t){var n=t.rows.item(0).db_version;j(e,n)}):e.executeSql("ALTER TABLE "+b+" ADD COLUMN db_version INTEGER",[],function(){j(e,1)}):j(e,0)})},i(t),r)}function R(e,t){if(-1!==D)return t(D);var n=o("COUNT("+y+".id) AS 'num'",[y,g],S,[g+".deleted=0",y+".local=0"]);e.executeSql(n,[],function(e,n){D=n.rows.item(0).num,t(D)})}var T,C=this,A=null,I=e.name,N=[],D=-1,L=p(I,h,I,v);return L?("function"!=typeof L.readTransaction&&(L.readTransaction=L.transaction),c.isCordova()&&"undefined"!=typeof n?n.addEventListener(I+"_pouch",function P(){n.removeEventListener(I+"_pouch",P,!1),q()},!1):q(),C.type=function(){return"websql"},C._id=c.toPromise(function(e){e(null,A)}),C._info=function(e){L.readTransaction(function(t){R(t,function(n){var r="SELECT update_seq FROM "+b;t.executeSql(r,[],function(t,r){var o=r.rows.item(0).update_seq;e(null,{db_name:I,doc_count:n,update_seq:o})})})},i(e))},C._bulkDocs=function(e,t,n){function r(e,t){return e._bulk_seq-t._bulk_seq}function s(){var e=[];A.sort(r),A.forEach(function(t){if(delete t._bulk_seq,t.error)return void e.push(t);var n=t.metadata,r=l.winningRev(n);e.push({ok:!0,id:n.id,rev:r}),c.isLocalId(n.id)||(j++,a.Changes.notify(I),a.Changes.notifyLocalWindows(I))});var t="SELECT update_seq FROM "+b;C.executeSql(t,[],function(t,r){var o=r.rows.item(0).update_seq+j,i="UPDATE "+b+" SET update_seq=?";t.executeSql(i,[o],function(){n(null,e)})})}function d(e,t){if(e.stub)return t();
if("string"==typeof e.data){try{e.data=atob(e.data)}catch(r){var o=f.error(f.BAD_ARG,"Attachments need to be base64 encoded");return n(o)}var i=c.fixBinary(e.data);e.data=c.createBlob([i],{type:e.content_type})}var s=new FileReader;s.onloadend=function(){var n=c.arrayBufferToBinaryString(this.result);e.data=n,e.digest="md5-"+c.MD5(n),t()},s.readAsArrayBuffer(e.data)}function p(e){function t(){n++,q.length===n&&e()}if(!q.length)return e();var n=0;q.forEach(function(e){function n(){o++,o===r.length&&t()}var r=e.data&&e.data._attachments?Object.keys(e.data._attachments):[],o=0;if(!r.length)return t();for(var i in e.data._attachments)e.data._attachments.hasOwnProperty(i)&&d(e.data._attachments[i],n)})}function h(e,t,n,r){function i(){var n=e.data,r=n._id+"::"+n._rev,i=t?1:0,s=o("seq",g,null,"doc_id_rev=?");C.executeSql(s,[r],function(e,t){var o,s;t.rows.length?(o="UPDATE "+g+" SET json=?, deleted=? WHERE doc_id_rev=?;",s=[JSON.stringify(n),i,r],C.executeSql(o,s,function(e){a(e,t.rows.item(0).seq)})):(o="INSERT INTO "+g+" (doc_id_rev, json, deleted) VALUES (?, ?, ?);",s=[r,JSON.stringify(n),i],C.executeSql(o,s,function(e,t){a(e,t.insertId)}))})}function s(e){f||(e?(f=e,n(f)):d===p.length&&i())}function u(e){d++,s(e)}function a(t,o){e.metadata.seq=o,delete e.metadata.rev;var i=l.winningRev(e.metadata),s=r?"UPDATE "+y+" SET json=?, winningseq=(SELECT seq FROM "+g+" WHERE doc_id_rev=?) WHERE id=?":"INSERT INTO "+y+" (id, winningseq, json, local) VALUES (?, ?, ?, ?);",u=JSON.stringify(e.metadata),a=e.metadata.id+"::"+i,f=c.isLocalId(e.metadata.id)?1:0,d=r?[u,a,e.metadata.id]:[e.metadata.id,o,u,f];t.executeSql(s,d,function(){A.push(e),n()})}var f=null,d=0;e.data._id=e.metadata.id,e.data._rev=e.metadata.rev,t&&(e.data._deleted=!0);var p=e.data._attachments?Object.keys(e.data._attachments):[];for(var h in e.data._attachments)if(e.data._attachments[h].stub)d++,s();else{var v=e.data._attachments[h].data;delete e.data._attachments[h].data;var m=e.data._attachments[h].digest;E(e,m,v,u)}p.length||i()}function v(e,t){var n=l.merge(e.rev_tree,t.metadata.rev_tree[0],1e3),r=c.isDeleted(t.metadata),o=c.isDeleted(e),i=o&&r&&k||!o&&k&&"new_leaf"!==n.conflicts;return i?(A.push(x(f.REV_CONFLICT,t._bulk_seq)),w()):(t.metadata.rev_tree=n.tree,void h(t,r,w,!0))}function m(e){var n=c.isDeleted(e.metadata);return"was_delete"in t&&n?(A.push(f.MISSING_DOC),w()):void h(e,n,w,!1)}function w(){if(!q.length)return s();var e=q.shift(),t=e.metadata.id;t in N?v(N[t],e):(N[t]=e.metadata,m(e))}function x(e,t){return e._bulk_seq=t,e}function E(e,t,n,r){var o=[e.metadata.id,e.metadata.rev].join("@"),i={digest:t},s="SELECT digest, json FROM "+_+" WHERE digest=?";C.executeSql(s,[t],function(e,u){u.rows.length?(i.refs=JSON.parse(u.rows.item(0).json).refs,s="UPDATE "+_+" SET json=?, body=? WHERE digest=?",e.executeSql(s,[JSON.stringify(i),n,t],function(){r()})):(i.refs={},i.refs[o]=!0,s="INSERT INTO "+_+"(digest, json, body) VALUES (?, ?, ?)",e.executeSql(s,[t,JSON.stringify(i),n],function(){r()}))})}function S(e,t){for(var n=0;n<t.rows.length;n++){var r=t.rows.item(n),o=u(r.hexId,T);N[o]=JSON.parse(r.json)}w()}var k=t.new_edits,O=e.docs,j=0,q=O.map(function(e,t){var n=c.parseDoc(e,k);return n._bulk_seq=t,n}),R=q.filter(function(e){return e.error});if(R.length)return n(R[0]);var C,A=[],N={};p(function(){L.transaction(function(e){C=e;var t="SELECT hex(id) AS hexId, json FROM "+y+" WHERE id IN ("+q.map(function(){return"?"}).join(",")+")",n=q.map(function(e){return e.metadata.id});C.executeSql(t,n,S)},i(n),function(){D=-1})})},C._get=function(e,t,n){function r(){n(u,{doc:i,metadata:s,ctx:d})}t=c.clone(t);var i,s,u;if(!t.ctx)return void L.readTransaction(function(r){t.ctx=r,C._get(e,t,n)});var a,l,d=t.ctx;t.rev?(a=o(k,[y,g],null,[g+".doc_id_rev=?",y+".id=?"]),l=[e+"::"+t.rev,e]):(a=o(k,[y,g],S,y+".id=?"),l=[e]),d.executeSql(a,l,function(e,n){if(!n.rows.length)return u=f.MISSING_DOC,r();var o=n.rows.item(0);return s=JSON.parse(o.metadata),o.deleted&&!t.rev?(u=f.error(f.MISSING_DOC,"deleted"),r()):(i=JSON.parse(o.data),void r())})},C._allDocs=function(e,t){var n,r=[],s="startkey"in e?e.startkey:!1,u="endkey"in e?e.endkey:!1,a="key"in e?e.key:!1,c="descending"in e?e.descending:!1,f="limit"in e?e.limit:-1,d="skip"in e?e.skip:0,p=e.inclusive_end!==!1,h=[],v=[y+".local = 0"];if(a!==!1)v.push(y+".id = ?"),h.push(a);else if(s!==!1||u!==!1){if(s!==!1&&(v.push(y+".id "+(c?"<=":">=")+" ?"),h.push(s)),u!==!1){var m=c?">":"<";p&&(m+="="),v.push(y+".id "+m+" ?"),h.push(u)}a!==!1&&(v.push(y+".id = ?"),h.push(a))}"ok"!==e.deleted&&v.push(g+".deleted = 0"),L.readTransaction(function(t){R(t,function(i){if(n=i,0!==f){var s=o(k,[y,g],S,v,y+".id "+(c?"DESC":"ASC"));s+=" LIMIT "+f+" OFFSET "+d,t.executeSql(s,h,function(t,n){for(var o=0,i=n.rows.length;i>o;o++){var s=n.rows.item(o),u=JSON.parse(s.metadata),a=JSON.parse(s.data),c=a._rev,f={id:u.id,key:u.id,value:{rev:c}};if(e.include_docs){f.doc=a,f.doc._rev=c,e.conflicts&&(f.doc._conflicts=l.collectConflicts(u));for(var d in f.doc._attachments)f.doc._attachments.hasOwnProperty(d)&&(f.doc._attachments[d].stub=!0)}if(s.deleted){if("ok"!==e.deleted)continue;f.value.deleted=!0,f.doc=null}r.push(f)}})}})},i(t),function(){t(null,{total_rows:n,offset:e.skip,rows:r})})},C._changes=function(e){function t(){var t=[y+".winningseq > "+e.since,y+".local = 0"],n=[];e.doc_ids&&(t.push(y+".id IN ("+e.doc_ids.map(function(){return"?"}).join(",")+")"),n=e.doc_ids);var a=o(k,[y,g],S,t,y+".winningseq "+(r?"DESC":"ASC")),f=c.filterChange(e);e.view||e.filter||(a+=" LIMIT "+i),L.readTransaction(function(t){t.executeSql(a,n,function(t,n){for(var r=0,o=0,a=n.rows.length;a>o;o++){var c=n.rows.item(o),d=JSON.parse(c.metadata);r<c.seq&&(r=c.seq);var p=JSON.parse(c.data),h=e.processChange(p,d,e);if(h.seq=c.seq,f(h)&&(l++,s&&u.push(h),e.onChange(h)),l===i)break}e.continuous||e.complete(null,{results:u,last_seq:r})})})}if(e=c.clone(e),e.continuous){var n=I+":"+c.uuid();return a.Changes.addListener(I,n,C,e),a.Changes.notify(I),{cancel:function(){a.Changes.removeListener(I,n)}}}var r=e.descending;e.since=e.since&&!r?e.since:0;var i="limit"in e?e.limit:-1;0===i&&(i=1);var s;s="returnDocs"in e?e.returnDocs:!0;var u=[],l=0;t()},C._close=function(e){e()},C._getAttachment=function(e,t,n){var r,o=t.ctx,i=e.digest,s=e.content_type,a="SELECT hex(body) as body FROM "+_+" WHERE digest=?";o.executeSql(a,[i],function(e,o){var i=u(o.rows.item(0).body,T);t.encode?r=btoa(i):(i=c.fixBinary(i),r=c.createBlob([i],{type:s})),n(null,r)})},C._getRevisionTree=function(e,t){L.readTransaction(function(n){var r="SELECT json AS metadata FROM "+y+" WHERE id = ?";n.executeSql(r,[e],function(e,n){if(n.rows.length){var r=JSON.parse(n.rows.item(0).metadata);t(null,r.rev_tree)}else t(f.MISSING_DOC)})})},void(C._doCompaction=function(e,t,n,r){return n.length?void L.transaction(function(o){var i="SELECT json AS metadata FROM "+y+" WHERE id = ?";o.executeSql(i,[e],function(o,i){if(!i.rows.length)return c.call(r);var s=JSON.parse(i.rows.item(0).metadata);s.rev_tree=t;var u=0;n.forEach(function(t){var i=e+"::"+t,a="DELETE FROM "+g+" WHERE doc_id_rev = ?";o.executeSql(a,[i],function(t){if(++u===n.length){var o="UPDATE "+y+" SET json = ? WHERE id = ?";t.executeSql(o,[JSON.stringify(s),e],function(){r()})}})})})}):r()})):t(f.UNKNOWN_ERROR)}var c=e("../utils"),l=e("../merge"),f=e("../deps/errors"),d={},p=c.getArguments(function(e){if("undefined"!=typeof n){if(n.navigator&&n.navigator.sqlitePlugin&&n.navigator.sqlitePlugin.openDatabase)return navigator.sqlitePlugin.openDatabase.apply(navigator.sqlitePlugin,e);if(n.sqlitePlugin&&n.sqlitePlugin.openDatabase)return n.sqlitePlugin.openDatabase.apply(n.sqlitePlugin,e);var t=d[e[0]];return t||(t=d[e[0]]=n.openDatabase.apply(n,e)),t}}),h=1,v=3e6,m=2,y=r("document-store"),g=r("by-sequence"),_=r("attach-store"),b=r("metadata-store"),w="CREATE INDEX IF NOT EXISTS 'by-seq-deleted-idx' ON "+g+" (seq, deleted)",x="CREATE INDEX IF NOT EXISTS 'doc-store-local-idx' ON "+y+" (local, id)",E="CREATE INDEX IF NOT EXISTS 'doc-winningseq-idx' ON "+y+" (winningseq)",S=g+".seq = "+y+".winningseq",k=g+".seq AS seq, "+g+".deleted AS deleted, "+g+".json AS data, "+y+".json AS metadata";a.valid=function(){if("undefined"!=typeof n){if(n.navigator&&n.navigator.sqlitePlugin&&n.navigator.sqlitePlugin.openDatabase)return!0;if(n.sqlitePlugin&&n.sqlitePlugin.openDatabase)return!0;if(n.openDatabase)return!0}return!1},a.destroy=c.toPromise(function(e,t,r){var o=p(e,h,e,v);o.transaction(function(e){var t=[y,g,_,b];t.forEach(function(t){e.executeSql("DROP TABLE IF EXISTS "+t,[])})},i(r),function(){c.hasLocalStorage()&&(delete n.localStorage["_pouch__websqldb_"+e],delete n.localStorage[e]),r(null,{ok:!0})})}),a.Changes=new c.Changes,t.exports=a}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../deps/errors":96,"../merge":102,"../utils":107}],92:[function(e,t){"use strict";function n(e,t,n){function r(){i.cancel()}u.call(this);var i=this;this.db=e,t=t?o.clone(t):{};var s=n||t.complete||function(){},a=t.complete=o.once(function(t,n){t?i.emit("error",t):i.emit("complete",n),i.removeAllListeners(),e.removeListener("destroyed",r)});s&&(i.on("complete",function(e){s(null,e)}),i.on("error",function(e){s(e)}));var c=t.onChange;c&&i.on("change",c),e.once("destroyed",r),t.onChange=function(e){t.isCancelled||(i.emit("change",e),i.startSeq&&i.startSeq<=e.seq&&(i.emit("uptodate"),i.startSeq=!1),e.deleted?i.emit("delete",e):1===e.changes.length&&"1-"===e.changes[0].rev.slice(0,2)?i.emit("create",e):i.emit("update",e))};var l=new o.Promise(function(e,n){t.complete=function(t,r){t?n(t):e(r)}});i.once("cancel",function(){c&&i.removeListener("change",c),t.complete(null,{status:"cancelled"})}),this.then=l.then.bind(l),this["catch"]=l["catch"].bind(l),this.then(function(e){a(null,e)},a),e.taskqueue.isReady?i.doChanges(t):e.taskqueue.addTask(function(){i.isCancelled?i.emit("cancel"):i.doChanges(t)})}function r(e,t,n){var r=[{rev:e._rev}];"all_docs"===n.style&&(r=i.collectLeaves(t.rev_tree).map(function(e){return{rev:e.rev}}));var s={id:t.id,changes:r,doc:e};return o.isDeleted(t,e._rev)&&(s.deleted=!0),n.conflicts&&(s.doc._conflicts=i.collectConflicts(t),s.doc._conflicts.length||delete s.doc._conflicts),s}var o=e("./utils"),i=e("./merge"),s=e("./deps/errors"),u=e("events").EventEmitter,a=e("./evalFilter"),c=e("./evalView");t.exports=n,o.inherits(n,u),n.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},n.prototype.doChanges=function(e){var t=this,n=e.complete;if(e=o.clone(e),"live"in e&&!("continuous"in e)&&(e.continuous=e.live),e.processChange=r,e.since||(e.since=0),"latest"===e.since)return void this.db.info().then(function(r){return t.isCancelled?void n(null,{status:"cancelled"}):(e.since=r.update_seq-1,void t.doChanges(e))},n);if(e.continuous&&"latest"!==e.since&&this.db.info().then(function(e){t.startSeq=e.update_seq-1},function(e){if("idbNull"!==e.id)throw e}),"http"!==this.db.type()&&e.filter&&"string"==typeof e.filter)return this.filterChanges(e);"descending"in e||(e.descending=!1),e.limit=0===e.limit?1:e.limit,e.complete=n;var i=this.db._changes(e);if(i&&"function"==typeof i.cancel){var s=t.cancel;t.cancel=o.getArguments(function(e){i.cancel(),s.apply(this,e)})}},n.prototype.filterChanges=function(e){var t=this,n=e.complete;if("_view"===e.filter){if(!e.view||"string"!=typeof e.view){var r=new Error("`view` filter parameter is not provided.");return r.status=s.BAD_REQUEST.status,r.name=s.BAD_REQUEST.name,r.error=!0,void n(r)}var o=e.view.split("/");this.db.get("_design/"+o[0],function(r,i){if(t.isCancelled)return void n(null,{status:"cancelled"});if(r)return void n(r);if(i&&i.views&&i.views[o[1]]){var u=c(i.views[o[1]].map);return e.filter=u,void t.doChanges(e)}var a=i.views?"missing json key: "+o[1]:"missing json key: views";r||(r=new Error(a),r.status=s.MISSING_DOC.status,r.name=s.MISSING_DOC.name,r.error=!0),n(r)})}else{var i=e.filter.split("/");this.db.get("_design/"+i[0],function(r,o){if(t.isCancelled)return void n(null,{status:"cancelled"});if(r)return void n(r);if(o&&o.filters&&o.filters[i[1]]){var u=a(o.filters[i[1]]);return e.filter=u,void t.doChanges(e)}var c=o&&o.filters?"missing json key: "+i[1]:"missing json key: filters";return r||(r=new Error(c),r.status=s.MISSING_DOC.status,r.name=s.MISSING_DOC.name,r.error=!0),void n(r)})}}},{"./deps/errors":96,"./evalFilter":99,"./evalView":100,"./merge":102,"./utils":107,events:138}],93:[function(e,t){(function(n){"use strict";function r(e){e&&n.debug&&console.error(e)}function o(e,t,n){if(!(this instanceof o))return new o(e,t,n);var c=this;("function"==typeof t||"undefined"==typeof t)&&(n=t,t={}),"object"==typeof e&&(t=e,e=void 0),"undefined"==typeof n&&(n=r),t=t||{};var l=n;c.auto_compaction=t.auto_compaction,c.prefix=o.prefix,i.call(c),c.taskqueue=new u;var f=new a(function(r,i){n=function(e,t){return e?i(e):(delete t.then,void r(t))},t=s.clone(t);var u,a,l=t.name||e;return function(){try{if("string"!=typeof l)throw a=new Error("Missing/invalid DB name"),a.code=400,a;if(u=o.parseAdapter(l,t),t.originalName=l,t.name=u.name,t.adapter=t.adapter||u.adapter,c._adapter=t.adapter,!o.adapters[t.adapter])throw a=new Error("Adapter is missing"),a.code=404,a;if(!o.adapters[t.adapter].valid())throw a=new Error("Invalid Adapter"),a.code=404,a}catch(e){c.taskqueue.fail(e),c.changes=s.toPromise(function(t){t.complete&&t.complete(e)})}}(),a?i(a):(c.adapter=t.adapter,c.replicate={},c.replicate.from=function(e,t,n){return o.replicate(e,c,t,n)},c.replicate.to=function(e,t,n){return o.replicate(c,e,t,n)},c.sync=function(e,t,n){return o.sync(c,e,t,n)},c.replicate.sync=c.sync,c.destroy=s.adapterFun("destroy",function(e){var t=this;t.info(function(t,n){return t?e(t):void o.destroy(n.db_name,e)})}),o.adapters[t.adapter].call(c,t,function(e){function r(e){"destroyed"===e&&(c.emit("destroyed"),o.removeListener(t.name,r))}return e?void(n&&(c.taskqueue.fail(e),n(e))):(o.on(t.name,r),c.emit("created",c),o.emit("created",t.originalName),c.taskqueue.ready(c),void n(null,c))}),t.skipSetup&&c.taskqueue.ready(c),void(s.isCordova()&&cordova.fireWindowEvent(t.name+"_pouch",{})))});f.then(function(e){l(null,e)},l),c.then=f.then.bind(f),c["catch"]=f["catch"].bind(f)}var i=e("./adapter"),s=e("./utils"),u=e("./taskqueue"),a=s.Promise;s.inherits(o,i),t.exports=o}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./adapter":88,"./taskqueue":106,"./utils":107}],94:[function(e,t){"use strict";function n(e,t){function n(t,n,r){if(e.binary||e.json||!e.processData||"string"==typeof t){if(!e.binary&&e.json&&"string"==typeof t)try{t=JSON.parse(t)}catch(i){return r(i)}}else t=JSON.stringify(t);Array.isArray(t)&&(t=t.map(function(e){var t;return e.ok?e:e.error&&"conflict"===e.error?(t=o.REV_CONFLICT,t.id=e.id,t):e.error&&"forbidden"===e.error?(t=o.FORBIDDEN,t.id=e.id,t.reason=e.reason,t):e.missing?(t=o.MISSING_DOC,t.missing=e.missing,t):e})),r(null,t,n)}function s(e,t){var n,r,i,s;try{n=JSON.parse(e.responseText);for(s in o)if(o.hasOwnProperty(s)&&o[s].name===n.error){i=o[s];break}i||(i=o.UNKNOWN_ERROR,e.status&&(i.status=e.status),e.statusText&&(e.name=e.statusText)),r=o.error(i,n.reason)}catch(u){for(var s in o)if(o.hasOwnProperty(s)&&o[s].status===e.status){i=o[s];break}i||(i=o.UNKNOWN_ERROR,e.status&&(i.status=e.status),e.statusText&&(e.name=e.statusText)),r=o.error(i)}t(r)}var u=!1,a=i.getArguments(function(e){u||(t.apply(this,e),u=!0)});"function"==typeof e&&(a=e,e={}),e=i.clone(e);var c={method:"GET",headers:{},json:!0,processData:!0,timeout:1e4,cache:!1};if(e=i.extend(!0,c,e),"GET"===e.method&&!e.cache){var l=-1!==e.url.indexOf("?");e.url+=(l?"&":"?")+"_nonce="+i.uuid(16)}var f,d;d=e.xhr?new e.xhr:new XMLHttpRequest,d.open(e.method,e.url),d.withCredentials=!0,e.json&&(e.headers.Accept="application/json",e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.body&&e.processData&&"string"!=typeof e.body&&(e.body=JSON.stringify(e.body))),e.binary&&(d.responseType="arraybuffer");var p=function(e,t,n){var r="";if(n){var o=new Date;o.setTime(o.getTime()+24*n*60*60*1e3),r="; expires="+o.toGMTString()}document.cookie=e+"="+t+r+"; path=/"};for(var h in e.headers)if("Cookie"===h){var v=e.headers[h].split("=");p(v[0],v[1],10)}else d.setRequestHeader(h,e.headers[h]);"body"in e||(e.body=null);var m=function(){u||(d.abort(),s(d,a))};return d.onreadystatechange=function(){if(4===d.readyState&&!u)if(clearTimeout(f),d.status>=200&&d.status<300){var t;t=e.binary?r([d.response||""],{type:d.getResponseHeader("Content-Type")}):d.responseText,n(t,d,a)}else s(d,a)},e.timeout>0&&(f=setTimeout(m,e.timeout),d.onprogress=function(){clearTimeout(f),f=setTimeout(m,e.timeout)},d.upload&&(d.upload.onprogress=d.onprogress)),d.send(e.body),{abort:m}}var r=e("./blob.js"),o=e("./errors"),i=e("../utils");t.exports=n},{"../utils":107,"./blob.js":95,"./errors":96}],95:[function(e,t){(function(e){"use strict";function n(t,n){t=t||[],n=n||{};try{return new Blob(t,n)}catch(r){if("TypeError"!==r.name)throw r;for(var o=e.BlobBuilder||e.MSBlobBuilder||e.MozBlobBuilder||e.WebKitBlobBuilder,i=new o,s=0;s<t.length;s+=1)i.append(t[s]);return i.getBlob(n.type)}}t.exports=n}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],96:[function(e,t,n){"use strict";function r(e){this.status=e.status,this.name=e.error,this.message=e.reason,this.error=!0}r.prototype__proto__=Error.prototype,r.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message})},n.UNAUTHORIZED=new r({status:401,error:"unauthorized",reason:"Name or password is incorrect."}),n.MISSING_BULK_DOCS=new r({status:400,error:"bad_request",reason:"Missing JSON list of 'docs'"}),n.MISSING_DOC=new r({status:404,error:"not_found",reason:"missing"}),n.REV_CONFLICT=new r({status:409,error:"conflict",reason:"Document update conflict"}),n.INVALID_ID=new r({status:400,error:"invalid_id",reason:"_id field must contain a string"}),n.MISSING_ID=new r({status:412,error:"missing_id",reason:"_id is required for puts"}),n.RESERVED_ID=new r({status:400,error:"bad_request",reason:"Only reserved document ids may start with underscore."}),n.NOT_OPEN=new r({status:412,error:"precondition_failed",reason:"Database not open so cannot close"}),n.UNKNOWN_ERROR=new r({status:500,error:"unknown_error",reason:"Database encountered an unknown error"}),n.BAD_ARG=new r({status:500,error:"badarg",reason:"Some query argument is invalid"}),n.INVALID_REQUEST=new r({status:400,error:"invalid_request",reason:"Request was invalid"}),n.QUERY_PARSE_ERROR=new r({status:400,error:"query_parse_error",reason:"Some query parameter is invalid"}),n.DOC_VALIDATION=new r({status:500,error:"doc_validation",reason:"Bad special document member"}),n.BAD_REQUEST=new r({status:400,error:"bad_request",reason:"Something wrong with the request"}),n.NOT_AN_OBJECT=new r({status:400,error:"bad_request",reason:"Document must be a JSON object"}),n.DB_MISSING=new r({status:404,error:"not_found",reason:"Database not found"}),n.IDB_ERROR=new r({status:500,error:"indexed_db_went_bad",reason:"unknown"}),n.WSQ_ERROR=new r({status:500,error:"web_sql_went_bad",reason:"unknown"}),n.LDB_ERROR=new r({status:500,error:"levelDB_went_went_bad",reason:"unknown"}),n.FORBIDDEN=new r({status:403,error:"forbidden",reason:"Forbidden by design doc validate_doc_update function"}),n.error=function(e,t,n){function r(){this.message=t,n&&(this.name=n)}return r.prototype=e,new r(t)}},{}],97:[function(e,t){"use strict";function n(e,t,n){return new o(function(o,i){return t&&"object"==typeof t&&(t=t._id),"string"!=typeof t?i(new Error("doc id is required")):void e.get(t,function(s,u){if(s)return"not_found"!==s.name?i(s):o(r(e,n({_id:t}),n));var a=n(u);return a?void o(r(e,a,n)):o(u)})})}function r(e,t,r){return e.put(t)["catch"](function(o){if("conflict"!==o.name)throw o;return n(e,t,r)})}var o=e("../utils").Promise;t.exports=function(e,t,r,o){return"function"!=typeof o?n(e,t,r):void n(e,t,r).then(function(e){o(null,e)},o)}},{"../utils":107}],98:[function(e,t){"use strict";function n(e){return 0|Math.random()*e}function r(e,t){t=t||o.length;var r="",i=-1;if(e){for(;++i<e;)r+=o[n(t)];return r}for(;++i<36;)switch(i){case 8:case 13:case 18:case 23:r+="-";break;case 19:r+=o[3&n(16)|8];break;default:r+=o[n(16)]}return r}var o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");t.exports=r},{}],99:[function(require,module,exports){"use strict";function evalFilter(input){return eval(["(function () { return ",input," })()"].join(""))}module.exports=evalFilter},{}],100:[function(require,module,exports){"use strict";function evalView(input){return eval(["(function () {","  return function (doc) {","    var emitted = false;","    var emit = function (a, b) {","      emitted = true;","    };","    var view = "+input+";","    view(doc);","    if (emitted) {","      return true;","    }","  }","})()"].join("\n"))}module.exports=evalView},{}],101:[function(e,t){(function(n){"use strict";var r=e("./setup");t.exports=r,r.ajax=e("./deps/ajax"),r.extend=e("extend"),r.utils=e("./utils"),r.Errors=e("./deps/errors"),r.replicate=e("./replicate").replicate,r.sync=e("./sync"),r.version=e("./version");var o=e("./adapters/http");if(r.adapter("http",o),r.adapter("https",o),r.adapter("idb",e("./adapters/idb")),r.adapter("websql",e("./adapters/websql")),r.plugin(e("pouchdb-mapreduce")),!n.browser){var i=e("./adapters/leveldb");r.adapter("ldb",i),r.adapter("leveldb",i)}}).call(this,e("/home/marten/npm/lib/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"))},{"./adapters/http":89,"./adapters/idb":90,"./adapters/leveldb":137,"./adapters/websql":91,"./deps/ajax":94,"./deps/errors":96,"./replicate":103,"./setup":104,"./sync":105,"./utils":107,"./version":87,"/home/marten/npm/lib/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":139,extend:4,"pouchdb-mapreduce":131}],102:[function(e,t){"use strict";function n(e){for(var t,n=e.shift(),r=[n.id,n.opts,[]],o=r;e.length;)n=e.shift(),t=[n.id,n.opts,[]],o[2].push(t),o=t;return r}function r(e,t){for(var n=[{tree1:e,tree2:t}],r=!1;n.length>0;){var o=n.pop(),i=o.tree1,s=o.tree2;(i[1].status||s[1].status)&&(i[1].status="available"===i[1].status||"available"===s[1].status?"available":"missing");for(var u=0;u<s[2].length;u++)if(i[2][0]){for(var a=!1,c=0;c<i[2].length;c++)i[2][c][0]===s[2][u][0]&&(n.push({tree1:i[2][c],tree2:s[2][u]}),a=!0);a||(r="new_branch",i[2].push(s[2][u]),i[2].sort())}else r="new_leaf",i[2][0]=s[2][u]}return{conflicts:r,tree:e}}function o(e,t,n){var o,i=[],s=!1,u=!1;return e.length?(e.forEach(function(e){if(e.pos===t.pos&&e.ids[0]===t.ids[0])o=r(e.ids,t.ids),i.push({pos:e.pos,ids:o.tree}),s=s||o.conflicts,u=!0;else if(n!==!0){var a=e.pos<t.pos?e:t,c=e.pos<t.pos?t:e,l=c.pos-a.pos,f=[],d=[];for(d.push({ids:a.ids,diff:l,parent:null,parentIdx:null});d.length>0;){var p=d.pop();0!==p.diff?p.ids&&p.ids[2].forEach(function(e,t){d.push({ids:e,diff:p.diff-1,parent:p.ids,parentIdx:t})}):p.ids[0]===c.ids[0]&&f.push(p)}var h=f[0];h?(o=r(h.ids,c.ids),h.parent[2][h.parentIdx]=o.tree,i.push({pos:a.pos,ids:a.ids}),s=s||o.conflicts,u=!0):i.push(e)}else i.push(e)}),u||i.push(t),i.sort(function(e,t){return e.pos-t.pos}),{tree:i,conflicts:s||"internal_node"}):{tree:[t],conflicts:"new_leaf"}}function i(e,t){var r=u.rootToLeaf(e).map(function(e){var r=e.ids.slice(-t);return{pos:e.pos+(e.ids.length-r.length),ids:n(r)}});return r.reduce(function(e,t){return o(e,t,!0).tree},[r.shift()])}var s=e("./utils"),u={};u.merge=function(e,t,n){e=s.extend(!0,[],e),t=s.clone(t);var r=o(e,t);return{tree:i(r.tree,n),conflicts:r.conflicts}},u.winningRev=function(e){var t=[];return u.traverseRevTree(e.rev_tree,function(e,n,r,o,i){e&&t.push({pos:n,id:r,deleted:!!i.deleted})}),t.sort(function(e,t){return e.deleted!==t.deleted?e.deleted>t.deleted?1:-1:e.pos!==t.pos?t.pos-e.pos:e.id<t.id?1:-1}),t[0].pos+"-"+t[0].id},u.traverseRevTree=function(e,t){for(var n,r=e.slice();n=r.pop();)for(var o=n.pos,i=n.ids,s=i[2],u=t(0===s.length,o,i[0],n.ctx,i[1]),a=0,c=s.length;c>a;a++)r.push({pos:o+1,ids:s[a],ctx:u})},u.collectLeaves=function(e){var t=[];return u.traverseRevTree(e,function(e,n,r,o,i){e&&t.unshift({rev:n+"-"+r,pos:n,opts:i})}),t.sort(function(e,t){return t.pos-e.pos}),t.map(function(e){delete e.pos}),t},u.collectConflicts=function(e){var t=u.winningRev(e),n=u.collectLeaves(e.rev_tree),r=[];return n.forEach(function(e){e.rev===t||e.opts.deleted||r.push(e.rev)}),r},u.rootToLeaf=function(e){var t=[];return u.traverseRevTree(e,function(e,n,r,o,i){if(o=o?o.slice(0):[],o.push({id:r,opts:i}),e){var s=n+1-o.length;t.unshift({pos:s,ids:o})}return o}),t},t.exports=u},{"./utils":107}],103:[function(e,t,n){"use strict";function r(){d.call(this),this.cancelled=!1;var e=this,t=new l.Promise(function(t,n){e.once("complete",t),e.once("error",n)});e.then=function(e,n){return t.then(e,n)},e["catch"]=function(e){return t["catch"](e)}}function o(e,t,n){var r=n.filter?n.filter.toString():"";return e.id().then(function(e){return t.id().then(function(t){var o=e+t+r+JSON.stringify(n.query_params)+n.doc_ids;return"_local/"+l.MD5(o)})})}function i(e,t,n){return e.get(t)["catch"](function(e){if(404===e.status)return{_id:t};throw e}).then(function(t){return t.last_seq=n,e.put(t)})}function s(e,t,n){this.src=e,this.target=t,this.id=n}function u(e,t,n,r,o){function i(){if(0!==E.docs.length){var e=E.docs;return n.bulkDocs({docs:e},{new_edits:!1}).then(function(e){if(o.cancelled)throw y(),new Error("cancelled");var t=[];if(e.forEach(function(e){e.ok||(P.doc_write_failures++,t.push(new Error(e.reason||e.message||"Unknown reason")))}),t.length>0){var n=new Error("bulkDocs error");throw n.other_errors=t,m("target.bulkDocs failed to write docs",n),new Error("bulkWrite partial failure")}},function(t){throw P.doc_write_failures+=e.length,t})}}function u(){var e=E.diffs,n=Object.keys(e)[0],r=e[n].missing;return t.get(n,{revs:!0,open_revs:r,attachments:!0}).then(function(t){t.forEach(function(t){return o.cancelled?y():void(t.ok&&(P.docs_read++,E.pendingRevs++,E.docs.push(t.ok),delete e[t.ok._id]))})})}function a(){return Object.keys(E.diffs).length>0?u().then(a):l.Promise.resolve()}function c(){var e=Object.keys(E.diffs).filter(function(e){var t=E.diffs[e].missing;return 1===t.length&&"1-"===t[0].slice(0,2)});return t.allDocs({keys:e,include_docs:!0}).then(function(e){if(o.cancelled)throw y(),new Error("cancelled");e.rows.forEach(function(e){!e.doc||e.deleted||"1-"!==e.value.rev.slice(0,2)||e.doc._attachments&&0!==Object.keys(e.doc._attachments).length||(P.docs_read++,E.pendingRevs++,E.docs.push(e.doc),delete E.diffs[e.id])})})}function f(){return"http"===t.type()?c().then(a):a()}function d(){return O=!0,L.writeCheckpoint(E.seq).then(function(){if(O=!1,o.cancelled)throw y(),new Error("cancelled");P.last_seq=R=E.seq,P.docs_written+=E.docs.length,o.emit("change",l.clone(P)),E=void 0,w()})["catch"](function(e){throw O=!1,m("writeCheckpoint completed with error",e),e})}function p(){var e={};return E.changes.forEach(function(t){e[t.id]=t.changes.map(function(e){return e.rev})}),n.revsDiff(e).then(function(e){if(o.cancelled)throw y(),new Error("cancelled");E.diffs=e,E.pendingRevs=0})}function h(){if(!o.cancelled&&!E){if(0===S.length)return void v(!0);E=S.shift(),p().then(f).then(i).then(d).then(h)["catch"](function(e){m("batch processing terminated with error",e)})}}function v(e){return 0===k.changes.length?void(0!==S.length||E||((T&&F.live||j)&&o.emit("uptodate",l.clone(P)),j&&y())):void((e||j||k.changes.length>=C)&&(S.push(k),k={seq:0,changes:[],docs:[]},h()))}function m(e,t){q||(P.ok=!1,P.status="aborted",t.message=e,P.errors.push(t),S=[],k={seq:0,changes:[],docs:[]},y())}function y(){if(!(q||o.cancelled&&(P.status="cancelled",O)))if(P.status=P.status||"complete",P.end_time=new Date,P.last_seq=R,q=o.cancelled=!0,P.errors.length>0){var e=P.errors.pop();P.errors.length>0&&(e.other_errors=P.errors),e.result=P,o.emit("error",e)}else o.emit("complete",P)}function g(e){return o.cancelled?y():(N++,0!==k.changes.length||0!==S.length||E||o.emit("outofdate",l.clone(P)),k.seq=e.seq,k.changes.push(e),void v(0===S.length))}function _(e){return I=!1,o.cancelled?y():(N>0?(F.since=e.last_seq,w()):T?(F.live=!0,w()):j=!0,void v(!0))}function b(e){return I=!1,o.cancelled?y():void m("changes rejected",e)}function w(){!I&&!j&&S.length<A&&(I=!0,N=0,t.changes(F).on("change",g).then(_)["catch"](b))}function x(){L.getCheckpoint().then(function(e){R=e,F={since:R,limit:C,style:"all_docs",doc_ids:D,returnDocs:!1},r.filter&&(F.filter=r.filter),r.query_params&&(F.query_params=r.query_params),w()})["catch"](function(e){m("getCheckpoint rejected with ",e)})}var E,S=[],k={seq:0,changes:[],docs:[]},O=!1,j=!1,q=!1,R=0,T=r.continuous||r.live||!1,C=r.batch_size||100,A=r.batches_limit||10,I=!1,N=0,D=r.doc_ids,L=new s(t,n,e),P={ok:!0,start_time:new Date,docs_read:0,docs_written:0,doc_write_failures:0,errors:[]},F={};o.ready(t,n),o.once("cancel",y),"function"==typeof r.onChange&&o.on("change",r.onChange),"function"==typeof r.complete&&(o.once("error",r.complete),o.once("complete",function(e){r.complete(null,e)})),"undefined"==typeof r.since?x():(O=!0,L.writeCheckpoint(r.since).then(function(){return O=!1,o.cancelled?void y():(R=r.since,void x())})["catch"](function(e){throw O=!1,m("writeCheckpoint completed with error",e),e}))}function a(e){return"string"==typeof e?new f(e):e.then?e:l.Promise.resolve(e)}function c(e,t,n,i){"function"==typeof n&&(i=n,n={}),"undefined"==typeof n&&(n={}),n.complete||(n.complete=i||function(){}),n=l.clone(n),n.continuous=n.continuous||n.live;var s=new r(n);return a(e).then(function(e){return a(t).then(function(t){if(!n.server)return o(e,t,n).then(function(r){u(r,e,t,n,s)});if("function"!=typeof e.replicateOnServer)throw new TypeError("Server replication not supported for "+e.type()+" adapter");if(e.type()!==t.type())throw new TypeError("Server replication for different adapter types ("+e.type()+" and "+t.type()+") is not supported");e.replicateOnServer(t,n,s)})})["catch"](function(e){n.complete(e)}),s}var l=e("./utils"),f=e("./index"),d=e("events").EventEmitter;l.inherits(r,d),r.prototype.cancel=function(){this.cancelled=!0,this.emit("cancel")},r.prototype.ready=function(e,t){function n(){o.cancel()}function r(){o.removeAllListeners(),e.removeListener("destroyed",n),t.removeListener("destroyed",n)}var o=this;e.once("destroyed",n),t.once("destroyed",n),this.then(r,r)},s.prototype.writeCheckpoint=function(e){var t=this;return this.updateTarget(e).then(function(){return t.updateSource(e)})},s.prototype.updateTarget=function(e){return i(this.target,this.id,e)},s.prototype.updateSource=function(e){var t=this;return this.readOnlySource?l.Promise.resolve(!0):i(this.src,this.id,e)["catch"](function(e){if(401===e.status)return t.readOnlySource=!0,!0;throw e})},s.prototype.getCheckpoint=function(){var e=this;return e.target.get(e.id).then(function(t){return e.src.get(e.id).then(function(e){return t.last_seq===e.last_seq?e.last_seq:0},function(n){if(404===n.status&&t.last_seq)return e.src.put({_id:e.id,last_seq:0}).then(function(){return 0},function(n){return 401===n.status?(e.readOnlySource=!0,t.last_seq):0});throw n})})["catch"](function(e){if(404!==e.status)throw e;return 0})},n.replicate=c},{"./index":101,"./utils":107,events:138}],104:[function(e,t){(function(n){"use strict";var r=e("./constructor"),o=e("./utils"),i=o.Promise,s=e("events").EventEmitter;r.adapters={},r.prefix="_pouch_";var u=new s,a=["on","addListener","emit","listeners","once","removeAllListeners","removeListener","setMaxListeners"],c=["levelalt","idb","leveldb","websql"];a.forEach(function(e){r[e]=u[e].bind(u)}),r.setMaxListeners(0),r.parseAdapter=function(e,t){var i,s,u=e.match(/([a-z\-]*):\/\/(.*)/);if(u){if(e=/http(s?)/.test(u[1])?u[1]+"://"+u[2]:u[2],i=u[1],!r.adapters[i].valid())throw"Invalid adapter";return{name:e,adapter:u[1]}}var a="idb"in r.adapters&&"websql"in r.adapters&&o.hasLocalStorage()&&n.localStorage["_pouch__websqldb_"+r.prefix+e];
if("undefined"!=typeof t&&t.db)s="leveldb";else for(var l=0;l<c.length;++l)if(s=c[l],s in r.adapters){if(a&&"idb"===s)continue;break}if(s){i=r.adapters[s];var f="use_prefix"in i?i.use_prefix:!0;return{name:f?r.prefix+e:e,adapter:s}}throw"No valid adapter found"},r.destroy=o.toPromise(function(e,t,n){function o(){a.destroy(u,t,function(e,t){e?n(e):(r.emit("destroyed",u),r.emit(u,"destroyed"),n(null,t||{ok:!0}))})}("function"==typeof t||"undefined"==typeof t)&&(n=t,t={}),"object"==typeof e&&(t=e,e=void 0);var s=r.parseAdapter(t.name||e,t),u=s.name,a=r.adapters[s.adapter],c="use_prefix"in a?a.use_prefix:!0,l=c?u.replace(new RegExp("^"+r.prefix),""):u;new r(l,{adapter:s.adapter},function(e,t){return e?n(e):void t.get("_local/_pouch_dependentDbs",function(e,t){if(e)return"not_found"!==e.name?n(e):o();var u=t.dependentDbs,a=Object.keys(u).map(function(e){var t=c?e.replace(new RegExp("^"+r.prefix),""):e;return r.destroy(t,{adapter:s.adapter})});i.all(a).then(o,function(e){n(e)})})})}),r.allDbs=o.toPromise(function(e){var t=new Error("allDbs method removed");t.stats="400",e(t)}),r.adapter=function(e,t){t.valid()&&(r.adapters[e]=t)},r.plugin=function(e){Object.keys(e).forEach(function(t){r.prototype[t]=e[t]})},t.exports=r}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./constructor":93,"./utils":107,events:138}],105:[function(e,t){"use strict";function n(e,t,i,s){function u(e){h||(h=!0,f.emit("cancel",e))}function a(e){f.emit("change",{direction:"pull",change:e})}function c(e){f.emit("change",{direction:"push",change:e})}function l(e,t){"change"!==e||t!==a&&t!==c?"cancel"===e&&t===u?f.removeAllListeners("cancel"):e in v&&t===v[e]&&f.removeAllListeners(e):f.removeAllListeners("change")}if(!(this instanceof n))return new n(e,t,i,s);var f=this;"function"==typeof i&&(s=i,i={}),"undefined"==typeof i&&(i={}),this.canceled=!1,i=r.clone(i);var d,p;"onChange"in i&&(d=i.onChange,delete i.onChange),"function"!=typeof s||i.complete?"complete"in i&&(p=i.complete,delete i.complete):p=s,this.push=o(e,t,i),this.pull=o(t,e,i);var h=!1,v={};this.on("newListener",function(e){"change"===e?(f.pull.on("change",a),f.push.on("change",c)):"cancel"===e?(f.pull.on("cancel",u),f.push.on("cancel",u)):"error"===e||"complete"===e||e in v||(v[e]=function(t){f.emit(e,t)},f.pull.on(e,v[e]),f.push.on(e,v[e]))}),this.on("removeListener",function(e){"change"===e?(f.pull.removeListener("change",a),f.push.removeListener("change",c)):"cancel"===e?(f.pull.removeListener("cancel",u),f.push.removeListener("cancel",u)):e in v&&"function"==typeof v[e]&&(f.pull.removeListener(e,v[e]),f.push.removeListener(e,v[e]),delete v[e])}),this.pull.on("removeListener",l),this.push.on("removeListener",l);var m=r.Promise.all([this.push,this.pull]).then(function(e){var t={push:e[0],pull:e[1]};return f.emit("complete",t),p&&p(null,t),f.removeAllListeners(),t},function(e){throw f.cancel(),f.emit("error",e),p&&p(e),f.removeAllListeners(),e});this.then=function(e,t){return m.then(e,t)},this["catch"]=function(e){return m["catch"](e)}}var r=e("./utils"),o=e("./replicate").replicate,i=e("events").EventEmitter;t.exports=n,r.inherits(n,i),n.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())}},{"./replicate":103,"./utils":107,events:138}],106:[function(e,t){"use strict";function n(){this.isReady=!1,this.failed=!1,this.queue=[]}t.exports=n,n.prototype.execute=function(){var e,t;if(this.failed)for(;e=this.queue.shift();)"function"!=typeof e?(t=e.parameters[e.parameters.length-1],"function"==typeof t?t(this.failed):"changes"===e.name&&"function"==typeof t.complete&&t.complete(this.failed)):e(this.failed);else if(this.isReady)for(;e=this.queue.shift();)"function"==typeof e?e():e.task=this.db[e.name].apply(this.db,e.parameters)},n.prototype.fail=function(e){this.failed=e,this.execute()},n.prototype.ready=function(e){return this.failed?!1:0===arguments.length?this.isReady:(this.isReady=e?!0:!1,this.db=e,void this.execute())},n.prototype.addTask=function(e,t){if("function"!=typeof e){var n={name:e,parameters:t};return this.queue.push(n),this.failed&&this.execute(),n}this.queue.push(e),this.failed&&this.execute()}},{}],107:[function(e,t,n){(function(t,r){function o(e){var t={};return e.forEach(function(e){t[e]=!0}),t}function i(){return"undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage&&"undefined"!=typeof chrome.storage.local}var s=e("crypto"),u=e("md5-jkmyers"),a=e("./merge");n.extend=e("extend"),n.ajax=e("./deps/ajax"),n.createBlob=e("./deps/blob"),n.uuid=e("./deps/uuid"),n.getArguments=e("argsarray");var c=e("./deps/buffer"),l=e("./deps/errors"),f=e("events").EventEmitter;n.Promise="function"==typeof r.Promise?r.Promise:e("bluebird");var d=n.Promise,p=o(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree"]);n.clone=function(e){return n.extend(!0,{},e)},n.inherits=e("inherits"),n.invalidIdError=function(e){return e?"string"!=typeof e?l.INVALID_ID:/^_/.test(e)&&!/^_(design|local)/.test(e)?l.RESERVED_ID:void 0:l.MISSING_ID},n.call=n.getArguments(function(e){if(e.length){var t=e.shift();"function"==typeof t&&t.apply(this,e)}}),n.isLocalId=function(e){return/^_local/.test(e)},n.isDeleted=function(e,t){t||(t=a.winningRev(e));var n=t.indexOf("-");-1!==n&&(t=t.substring(n+1));var r=!1;return a.traverseRevTree(e.rev_tree,function(e,n,o,i,s){o===t&&(r=!!s.deleted)}),r},n.filterChange=function(e){return function(t){var n={},r=e.filter&&"function"==typeof e.filter;if(n.query=e.query_params,e.filter&&r&&!e.filter.call(this,t.doc,n))return!1;if(e.doc_ids&&-1===e.doc_ids.indexOf(t.id))return!1;if(e.include_docs)for(var o in t.doc._attachments)t.doc._attachments.hasOwnProperty(o)&&(t.doc._attachments[o].stub=!0);else delete t.doc;return!0}},n.parseDoc=function(e,t){var r,o,i,s={status:"available"};if(e._deleted&&(s.deleted=!0),t)if(e._id||(e._id=n.uuid()),o=n.uuid(32,16).toLowerCase(),e._rev){if(i=/^(\d+)-(.+)$/.exec(e._rev),!i)throw"invalid value for property '_rev'";e._rev_tree=[{pos:parseInt(i[1],10),ids:[i[2],{status:"missing"},[[o,s,[]]]]}],r=parseInt(i[1],10)+1}else e._rev_tree=[{pos:1,ids:[o,s,[]]}],r=1;else if(e._revisions&&(e._rev_tree=[{pos:e._revisions.start-e._revisions.ids.length+1,ids:e._revisions.ids.reduce(function(e,t){return null===e?[t,s,[]]:[t,{status:"missing"},[e]]},null)}],r=e._revisions.start,o=e._revisions.ids[0]),!e._rev_tree){if(i=/^(\d+)-(.+)$/.exec(e._rev),!i)return l.BAD_ARG;r=parseInt(i[1],10),o=i[2],e._rev_tree=[{pos:parseInt(i[1],10),ids:[i[2],s,[]]}]}var u=n.invalidIdError(e._id);if(u)return u;e._id=decodeURIComponent(e._id),e._rev=[r,o].join("-");var a={metadata:{},data:{}};for(var c in e)if(e.hasOwnProperty(c)){var f="_"===c[0];if(f&&!p[c])return u=l.error(l.DOC_VALIDATION),u.reason+=": "+c,u;f&&"_attachments"!==c?a.metadata[c.slice(1)]=e[c]:a.data[c]=e[c]}return a},n.isCordova=function(){return"undefined"!=typeof cordova||"undefined"!=typeof PhoneGap||"undefined"!=typeof phonegap},n.hasLocalStorage=function(){if(i())return!1;try{return r.localStorage}catch(e){return!1}},n.Changes=function(){var e={},t=new f,o=i(),s={},u=!1;return o||(u=n.hasLocalStorage()),o?chrome.storage.onChanged.addListener(function(e){null!=e.db_name&&t.emit(e.dbName.newValue)}):u&&(r.addEventListener?r.addEventListener("storage",function(e){t.emit(e.key)}):r.attachEvent("storage",function(e){t.emit(e.key)})),e.addListener=function(e,r,o,i){function u(){o.changes({include_docs:i.include_docs,conflicts:i.conflicts,continuous:!1,descending:!1,filter:i.filter,view:i.view,since:i.since,query_params:i.query_params,onChange:function(e){e.seq>i.since&&!i.cancelled&&(i.since=e.seq,n.call(i.onChange,e))}})}s[r]||(s[r]=u,t.on(e,u))},e.removeListener=function(e,n){n in s&&t.removeListener(e,s[n])},e.clearListeners=function(e){t.removeAllListeners(e)},e.notifyLocalWindows=function(e){o?chrome.storage.local.set({dbName:e}):u&&(localStorage[e]="a"===localStorage[e]?"b":"a")},e.notify=function(e){t.emit(e)},e},n.atob=t.browser&&"atob"in r?function(e){return atob(e)}:function(e){var t=new c(e,"base64");if(t.toString("base64")!==e)throw"Cannot base64 encode full string";return t.toString("binary")},n.btoa=t.browser&&"btoa"in r?function(e){return btoa(e)}:function(e){return new c(e,"binary").toString("base64")},n.fixBinary=function(e){if(!t.browser)return e;for(var n=e.length,r=new ArrayBuffer(n),o=new Uint8Array(r),i=0;n>i;i++)o[i]=e.charCodeAt(i);return r},n.once=function(e){var t=!1;return n.getArguments(function(n){if(t)throw console.trace(),new Error("once called  more than once");t=!0,e.apply(this,n)})},n.toPromise=function(e){return n.getArguments(function(r){var o,i=this,s="function"==typeof r[r.length-1]?r.pop():!1;s&&(o=function(e,n){t.nextTick(function(){s(e,n)})});var u=new d(function(t,o){var s;try{var u=n.once(function(e,n){e?o(e):t(n)});r.push(u),s=e.apply(i,r),s&&"function"==typeof s.then&&t(s)}catch(a){o(a)}});return o&&u.then(function(e){o(null,e)},o),u.cancel=function(){return this},u})},n.adapterFun=function(e,t){return n.toPromise(n.getArguments(function(r){var o=this;return this.taskqueue.isReady?t.apply(this,r):new n.Promise(function(t,n){o.taskqueue.addTask(function(i){i?n(i):t(o[e].apply(o,r))})})}))},n.arrayBufferToBinaryString=function(e){for(var t="",n=new Uint8Array(e),r=n.byteLength,o=0;r>o;o++)t+=String.fromCharCode(n[o]);return t},n.cancellableFun=function(e,t,r){r=r?n.clone(!0,{},r):{};var o=new f,i=r.complete||function(){},s=r.complete=n.once(function(e,t){e?i(e):(o.emit("end",t),i(null,t)),o.removeAllListeners()}),u=r.onChange||function(){},a=0;t.on("destroyed",function(){o.removeAllListeners()}),r.onChange=function(e){u(e),e.seq<=a||(a=e.seq,o.emit("change",e),e.deleted?o.emit("delete",e):1===e.changes.length&&"1-"===e.changes[0].rev.slice(0,1)?o.emit("create",e):o.emit("update",e))};var c=new d(function(e,t){r.complete=function(n,r){n?t(n):e(r)}});return c.then(function(e){s(null,e)},s),c.cancel=function(){c.isCancelled=!0,t.taskqueue.isReady&&r.complete(null,{status:"cancelled"})},t.taskqueue.isReady?e(t,r,c):t.taskqueue.addTask(function(){c.isCancelled?r.complete(null,{status:"cancelled"}):e(t,r,c)}),c.on=o.on.bind(o),c.once=o.once.bind(o),c.addListener=o.addListener.bind(o),c.removeListener=o.removeListener.bind(o),c.removeAllListeners=o.removeAllListeners.bind(o),c.setMaxListeners=o.setMaxListeners.bind(o),c.listeners=o.listeners.bind(o),c.emit=o.emit.bind(o),c},n.Crypto={},n.MD5=n.Crypto.MD5=function(e){return t.browser?u(e):s.createHash("md5").update(e).digest("hex")}}).call(this,e("/home/marten/npm/lib/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./deps/ajax":94,"./deps/blob":95,"./deps/buffer":137,"./deps/errors":96,"./deps/uuid":98,"./merge":102,"/home/marten/npm/lib/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":139,argsarray:108,bluebird:114,crypto:137,events:138,extend:4,inherits:109,"md5-jkmyers":128}],108:[function(e,t){"use strict";function n(e){return function(){var t=arguments.length;if(t){for(var n=[],r=-1;++r<t;)n[r]=arguments[r];return e.call(this,n)}return e.call(this,[])}}t.exports=n},{}],109:[function(e,t){t.exports=e(17)},{}],110:[function(e,t){"use strict";function n(){}t.exports=n},{}],111:[function(e,t){"use strict";var n=e("./promise"),r=e("./reject"),o=e("./resolve"),i=e("./INTERNAL"),s=e("./handlers"),u=r(new TypeError("must be an array"));t.exports=function(e){function t(e,t){function n(e){a[t]=e,++c===r&&s.resolve(f,a)}o(e).then(n,function(e){s.reject(f,e)})}if("[object Array]"!==Object.prototype.toString.call(e))return u;var r=e.length;if(!r)return o([]);for(var a=new Array(r),c=0,l=-1,f=new n(i);++l<r;)t(e[l],l);return f}},{"./INTERNAL":110,"./handlers":113,"./promise":115,"./reject":117,"./resolve":118}],112:[function(e,t){"use strict";function n(e){var t=e&&e.then;return e&&"object"==typeof e&&"function"==typeof t?function(){t.apply(e,arguments)}:void 0}t.exports=n},{}],113:[function(e,t,n){"use strict";var r=e("./tryCatch"),o=e("./getThen"),i=e("./resolveThenable"),s=e("./states");n.resolve=function(e,t){var u=r(o,t);if("error"===u.status)return n.reject(e,u.value);var a=u.value;if(a)i.safely(e,a);else{e.state=s.FULFILLED,e.outcome=t;for(var c=-1,l=e.queue.length;++c<l;)e.queue[c].callFulfilled(t)}return e},n.reject=function(e,t){e.state=s.REJECTED,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e}},{"./getThen":112,"./resolveThenable":119,"./states":120,"./tryCatch":121}],114:[function(e,t,n){t.exports=n=e("./promise"),n.resolve=e("./resolve"),n.reject=e("./reject"),n.all=e("./all")},{"./all":111,"./promise":115,"./reject":117,"./resolve":118}],115:[function(e,t){"use strict";function n(e){if(!(this instanceof n))return new n(e);if("function"!=typeof e)throw new TypeError("reslover must be a function");this.state=s.PENDING,this.queue=[],e!==o&&i.safely(this,e)}var r=e("./unwrap"),o=e("./INTERNAL"),i=e("./resolveThenable"),s=e("./states"),u=e("./queueItem");t.exports=n,n.prototype["catch"]=function(e){return this.then(null,e)},n.prototype.then=function(e,t){if("function"!=typeof e&&this.state===s.FULFILLED||"function"!=typeof t&&this.state===s.REJECTED)return this;var i=new n(o);if(this.state!==s.PENDING){var a=this.state===s.FULFILLED?e:t;r(i,a,this.outcome)}else this.queue.push(new u(i,e,t));return i}},{"./INTERNAL":110,"./queueItem":116,"./resolveThenable":119,"./states":120,"./unwrap":122}],116:[function(e,t){"use strict";function n(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}var r=e("./handlers"),o=e("./unwrap");t.exports=n,n.prototype.callFulfilled=function(e){r.resolve(this.promise,e)},n.prototype.otherCallFulfilled=function(e){o(this.promise,this.onFulfilled,e)},n.prototype.callRejected=function(e){r.reject(this.promise,e)},n.prototype.otherCallRejected=function(e){o(this.promise,this.onRejected,e)}},{"./handlers":113,"./unwrap":122}],117:[function(e,t){"use strict";function n(e){var t=new r(o);return i.reject(t,e)}var r=e("./promise"),o=e("./INTERNAL"),i=e("./handlers");t.exports=n},{"./INTERNAL":110,"./handlers":113,"./promise":115}],118:[function(e,t){"use strict";function n(e){if(e)return e instanceof r?e:i.resolve(new r(o),e);var t=typeof e;switch(t){case"boolean":return s;case"undefined":return a;case"object":return u;case"number":return c;case"string":return l}}var r=e("./promise"),o=e("./INTERNAL"),i=e("./handlers");t.exports=n;var s=i.resolve(new r(o),!1),u=i.resolve(new r(o),null),a=i.resolve(new r(o),void 0),c=i.resolve(new r(o),0),l=i.resolve(new r(o),"")},{"./INTERNAL":110,"./handlers":113,"./promise":115}],119:[function(e,t,n){"use strict";function r(e,t){function n(t){u||(u=!0,o.reject(e,t))}function r(t){u||(u=!0,o.resolve(e,t))}function s(){t(r,n)}var u=!1,a=i(s);"error"===a.status&&n(a.value)}var o=e("./handlers"),i=e("./tryCatch");n.safely=r},{"./handlers":113,"./tryCatch":121}],120:[function(e,t,n){n.REJECTED=["REJECTED"],n.FULFILLED=["FULFILLED"],n.PENDING=["PENDING"]},{}],121:[function(e,t){"use strict";function n(e,t){var n={};try{n.value=e(t),n.status="success"}catch(r){n.status="error",n.value=r}return n}t.exports=n},{}],122:[function(e,t){"use strict";function n(e,t,n){r(function(){var r;try{r=t(n)}catch(i){return o.reject(e,i)}r===e?o.reject(e,new TypeError("Cannot resolve promise with itself")):o.resolve(e,r)})}var r=e("immediate"),o=e("./handlers");t.exports=n},{"./handlers":113,immediate:123}],123:[function(e,t){"use strict";function n(){o=!0;for(var e,t,n=u.length;n;){for(t=u,u=[],e=-1;++e<n;)t[e]();n=u.length}o=!1}function r(e){1!==u.push(e)||o||i()}for(var o,i,s=[e("./nextTick"),e("./mutation.js"),e("./messageChannel"),e("./stateChange"),e("./timeout")],u=[],a=-1,c=s.length;++a<c;)if(s[a]&&s[a].test&&s[a].test()){i=s[a].install(n);break}t.exports=r},{"./messageChannel":124,"./mutation.js":125,"./nextTick":137,"./stateChange":126,"./timeout":127}],124:[function(e,t,n){(function(e){"use strict";n.test=function(){return e.setImmediate?!1:"undefined"!=typeof e.MessageChannel},n.install=function(t){var n=new e.MessageChannel;return n.port1.onmessage=t,function(){n.port2.postMessage(0)}}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],125:[function(e,t){t.exports=e(12)},{}],126:[function(e,t){t.exports=e(14)},{}],127:[function(e,t){t.exports=e(15)},{}],128:[function(e,t,n){!function(e,r){"function"==typeof define&&define.amd?define(r):"object"==typeof n?t.exports=r():e.md5=r()}(this,function(){function e(e,t){var s=e[0],u=e[1],a=e[2],c=e[3];s=n(s,u,a,c,t[0],7,-680876936),c=n(c,s,u,a,t[1],12,-389564586),a=n(a,c,s,u,t[2],17,606105819),u=n(u,a,c,s,t[3],22,-1044525330),s=n(s,u,a,c,t[4],7,-176418897),c=n(c,s,u,a,t[5],12,1200080426),a=n(a,c,s,u,t[6],17,-1473231341),u=n(u,a,c,s,t[7],22,-45705983),s=n(s,u,a,c,t[8],7,1770035416),c=n(c,s,u,a,t[9],12,-1958414417),a=n(a,c,s,u,t[10],17,-42063),u=n(u,a,c,s,t[11],22,-1990404162),s=n(s,u,a,c,t[12],7,1804603682),c=n(c,s,u,a,t[13],12,-40341101),a=n(a,c,s,u,t[14],17,-1502002290),u=n(u,a,c,s,t[15],22,1236535329),s=r(s,u,a,c,t[1],5,-165796510),c=r(c,s,u,a,t[6],9,-1069501632),a=r(a,c,s,u,t[11],14,643717713),u=r(u,a,c,s,t[0],20,-373897302),s=r(s,u,a,c,t[5],5,-701558691),c=r(c,s,u,a,t[10],9,38016083),a=r(a,c,s,u,t[15],14,-660478335),u=r(u,a,c,s,t[4],20,-405537848),s=r(s,u,a,c,t[9],5,568446438),c=r(c,s,u,a,t[14],9,-1019803690),a=r(a,c,s,u,t[3],14,-187363961),u=r(u,a,c,s,t[8],20,1163531501),s=r(s,u,a,c,t[13],5,-1444681467),c=r(c,s,u,a,t[2],9,-51403784),a=r(a,c,s,u,t[7],14,1735328473),u=r(u,a,c,s,t[12],20,-1926607734),s=o(s,u,a,c,t[5],4,-378558),c=o(c,s,u,a,t[8],11,-2022574463),a=o(a,c,s,u,t[11],16,1839030562),u=o(u,a,c,s,t[14],23,-35309556),s=o(s,u,a,c,t[1],4,-1530992060),c=o(c,s,u,a,t[4],11,1272893353),a=o(a,c,s,u,t[7],16,-155497632),u=o(u,a,c,s,t[10],23,-1094730640),s=o(s,u,a,c,t[13],4,681279174),c=o(c,s,u,a,t[0],11,-358537222),a=o(a,c,s,u,t[3],16,-722521979),u=o(u,a,c,s,t[6],23,76029189),s=o(s,u,a,c,t[9],4,-640364487),c=o(c,s,u,a,t[12],11,-421815835),a=o(a,c,s,u,t[15],16,530742520),u=o(u,a,c,s,t[2],23,-995338651),s=i(s,u,a,c,t[0],6,-198630844),c=i(c,s,u,a,t[7],10,1126891415),a=i(a,c,s,u,t[14],15,-1416354905),u=i(u,a,c,s,t[5],21,-57434055),s=i(s,u,a,c,t[12],6,1700485571),c=i(c,s,u,a,t[3],10,-1894986606),a=i(a,c,s,u,t[10],15,-1051523),u=i(u,a,c,s,t[1],21,-2054922799),s=i(s,u,a,c,t[8],6,1873313359),c=i(c,s,u,a,t[15],10,-30611744),a=i(a,c,s,u,t[6],15,-1560198380),u=i(u,a,c,s,t[13],21,1309151649),s=i(s,u,a,c,t[4],6,-145523070),c=i(c,s,u,a,t[11],10,-1120210379),a=i(a,c,s,u,t[2],15,718787259),u=i(u,a,c,s,t[9],21,-343485551),e[0]=f(s,e[0]),e[1]=f(u,e[1]),e[2]=f(a,e[2]),e[3]=f(c,e[3])}function t(e,t,n,r,o,i){return t=f(f(t,e),f(r,i)),f(t<<o|t>>>32-o,n)}function n(e,n,r,o,i,s,u){return t(n&r|~n&o,e,n,i,s,u)}function r(e,n,r,o,i,s,u){return t(n&o|r&~o,e,n,i,s,u)}function o(e,n,r,o,i,s,u){return t(n^r^o,e,n,i,s,u)}function i(e,n,r,o,i,s,u){return t(r^(n|~o),e,n,i,s,u)}function s(t){txt="";var n,r=t.length,o=[1732584193,-271733879,-1732584194,271733878];for(n=64;n<=t.length;n+=64)e(o,u(t.substring(n-64,n)));t=t.substring(n-64);var i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(n=0;n<t.length;n++)i[n>>2]|=t.charCodeAt(n)<<(n%4<<3);if(i[n>>2]|=128<<(n%4<<3),n>55)for(e(o,i),n=0;16>n;n++)i[n]=0;return i[14]=8*r,e(o,i),o}function u(e){var t,n=[];for(t=0;64>t;t+=4)n[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return n}function a(e){for(var t="",n=0;4>n;n++)t+=d[e>>8*n+4&15]+d[e>>8*n&15];return t}function c(e){for(var t=0;t<e.length;t++)e[t]=a(e[t]);return e.join("")}function l(e){return c(s(e))}function f(e,t){return e+t&4294967295}function f(e,t){var n=(65535&e)+(65535&t),r=(e>>16)+(t>>16)+(n>>16);return r<<16|65535&n}var d="0123456789abcdef".split("");return"5d41402abc4b2a76b9719d911017c592"!=l("hello"),l})},{}],129:[function(e,t){"use strict";var n=e("./upsert"),r=e("./utils"),o=r.Promise;t.exports=function(e){var t=e.db,i=e.viewName,s=e.map,u=e.reduce,a=e.temporary,c=s.toString()+(u&&u.toString())+"undefined";if(!a&&t._cachedViews){var l=t._cachedViews[c];if(l)return o.resolve(l)}return t.info().then(function(e){function o(e){e.views=e.views||{};var t=i;-1===t.indexOf("/")&&(t=i+"/"+i);var n=e.views[t]=e.views[t]||{};if(!n[l])return n[l]=!0,e}var l=e.db_name+"-mrview-"+(a?"temp":r.MD5(c));return n(t,"_local/mrviews",o).then(function(){return t.registerDependentDatabase(l).then(function(e){var n=e.db;n.auto_compaction=!0;var r={name:l,db:n,sourceDB:t,adapter:t.adapter,mapFun:s,reduceFun:u};return r.db.get("_local/lastSeq")["catch"](function(e){if("not_found"!==e.name)throw e}).then(function(e){return r.seq=e?e.seq:0,a||(t._cachedViews=t._cachedViews||{},t._cachedViews[c]=r,r.db.on("destroyed",function(){delete t._cachedViews[c]})),r})})})})}},{"./upsert":135,"./utils":136}],130:[function(require,module,exports){"use strict";module.exports=function(func,emit,sum,log,isArray,toJSON){return eval("'use strict'; ("+func+");")}},{}],131:[function(e,t,n){"use strict";function r(e){return-1===e.indexOf("/")?[e,e]:e.split("/")}function o(e,t,n){try{return{output:t.apply(null,n)}}catch(r){return e.emit("error",r),{error:r}}}function i(e,t){var n=x(e.key,t.key);return 0!==n?n:x(e.value,t.value)}function s(e,t,n){return n=n||0,"number"==typeof t?e.slice(n,t+n):n>0?e.slice(n):e}function u(e){var t=new Error("builtin "+e+" function requires map values to be numbers or number arrays");return t.name="invalid_value",t.status=500,t}function a(e){for(var t=0,n=0,r=e.length;r>n;n++){var o=e[n];if("number"!=typeof o){if(!Array.isArray(o))throw u("_sum");t="number"==typeof t?[t]:t;for(var i=0,s=o.length;s>i;i++){var a=o[i];if("number"!=typeof a)throw u("_sum");"undefined"==typeof t[i]?t.push(a):t[i]+=a}}else"number"==typeof t?t+=o:t[0]+=o}return t}function c(e,t,n,r){var o=t[e];"undefined"!=typeof o&&(r&&(o=encodeURIComponent(JSON.stringify(o))),n.push(e+"="+o))}function l(e,t){var n=e.descending?"endkey":"startkey",r=e.descending?"startkey":"endkey";if("undefined"!=typeof e[n]&&"undefined"!=typeof e[r]&&x(e[n],e[r])>0)throw new g("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(t.reduce&&e.reduce!==!1){if(e.include_docs)throw new g("{include_docs:true} is invalid for reduce");if(e.keys&&e.keys.length>1&&!e.group&&!e.group_level)throw new g("Multi-key fetches for reduce views must use {group: true}")}if(e.group_level){if("number"!=typeof e.group_level)throw new g('Invalid value for integer: "'+e.group_level+'"');if(e.group_level<0)throw new g('Invalid value for positive integer: "'+e.group_level+'"')}}function f(e,t,n){var o,i=[],s="GET";if(c("reduce",n,i),c("include_docs",n,i),c("limit",n,i),c("descending",n,i),c("group",n,i),c("group_level",n,i),c("skip",n,i),c("startkey",n,i,!0),c("endkey",n,i,!0),c("inclusive_end",n,i),c("key",n,i,!0),i=i.join("&"),i=""===i?"":"?"+i,"undefined"!=typeof n.keys){var u=2e3,a="keys="+encodeURIComponent(JSON.stringify(n.keys));a.length+i.length+1<=u?i+=("?"===i[0]?"&":"?")+a:(s="POST","string"==typeof t?o=JSON.stringify({keys:n.keys}):t.keys=n.keys)}if("string"==typeof t){var l=r(t);return e.request({method:s,url:"_design/"+l[0]+"/_view/"+l[1]+i,body:o})}return o=o||{},Object.keys(t).forEach(function(e){o[e]=Array.isArray(t[e])?t[e]:t[e].toString()}),e.request({method:"POST",url:"_temp_view"+i,body:o})}function d(e){return function(t){if("not_found"===t.name)return e;throw t}}function p(e,t,n){var r="_local/doc_"+e;return t.db.get(r)["catch"](d({_id:r,keys:[]})).then(function(r){return t.db.allDocs({keys:r.keys,include_docs:!0}).then(function(t){var o=t.rows.map(function(e){return e.doc}).filter(function(e){return e}),i=n[e],s={};o.forEach(function(e){s[e._id]=!0,e._deleted=!i[e._id],e._deleted||(e.value=i[e._id])});var u=Object.keys(i);return u.forEach(function(e){s[e]||o.push({_id:e,value:i[e]})}),r.keys=j.uniq(u.concat(r.keys)),o.splice(0,0,r),o})})}function h(e,t,n){var r="_local/lastSeq";return e.db.get(r)["catch"](d({_id:r,seq:0})).then(function(r){var o=Object.keys(t);return q.all(o.map(function(n){return p(n,e,t)})).then(function(t){var o=[];return t.forEach(function(e){o=o.concat(e)}),r.seq=n,o.push(r),e.db.bulkDocs({docs:o})})})}function v(e,t,n){0===n.group_level&&delete n.group_level;var r,i=n.group||n.group_level;r=A[e.reduceFun]?A[e.reduceFun]:O(e.reduceFun.toString(),null,a,_,Array.isArray,JSON.parse);var u=[],c=n.group_level;t.forEach(function(e){var t=u[u.length-1],n=i?e.key:null;return i&&Array.isArray(n)&&"number"==typeof c&&(n=n.length>c?n.slice(0,c):n),t&&0===x(t.key[0][0],n)?(t.key.push([n,e.id]),void t.value.push(e.value)):void u.push({key:[[n,e.id]],value:[e.value]})});for(var l=0,f=u.length;f>l;l++){var d=u[l],p=o(e.sourceDB,r,[d.key,d.value,!1]);d.value=p.error?null:p.output,d.key=d.key[0][0]}return{rows:s(u,n.limit,n.skip)}}function m(e){return e.request({method:"POST",url:"_view_cleanup"})}function y(e,t,n){if("http"===e.type())return f(e,t,n);if("string"!=typeof t){l(n,t);var o={db:e,viewName:"temp_view/temp_view",map:t.map,reduce:t.reduce,temporary:!0};return T.add(function(){return k(o).then(function(e){function t(){return e.db.destroy()}return j.fin(I(e).then(function(){return N(e,n)}),t)})}),T.finish()}var i=t,s=r(i),u=s[0],a=s[1];return e.get("_design/"+u).then(function(t){var r=t.views&&t.views[a];if(!r||"string"!=typeof r.map){var o=new Error("ddoc "+u+" has no view named "+a);throw o.name="not_found",o.status=400,o}l(n,r);var s={db:e,viewName:i,map:r.map,reduce:r.reduce};return k(s).then(function(e){return"ok"===n.stale||"update_after"===n.stale?("update_after"===n.stale&&I(e),N(e,n)):I(e).then(function(){return N(e,n)})})})}function g(e){this.status=400,this.name="query_parse_error",this.message=e,this.error=!0;try{Error.captureStackTrace(this,g)}catch(t){}}var _,b=e("pouchdb-collate"),w=e("./taskqueue"),x=b.collate,E=b.toIndexableString,S=b.normalizeKey,k=e("./create-view"),O=e("./evalfunc");_="undefined"!=typeof console&&"function"==typeof console.log?Function.prototype.bind.call(console.log,console):function(){};var j=e("./utils"),q=j.Promise,R=new w,T=new w,C=50,A={_sum:function(e,t){return a(t)},_count:function(e,t){return t.length},_stats:function(e,t){function n(e){for(var t=0,n=0,r=e.length;r>n;n++){var o=e[n];t+=o*o}return t}return{sum:a(t),min:Math.min.apply(null,t),max:Math.max.apply(null,t),count:t.length,sumsqr:n(t)}}},I=j.sequentialize(R,function(e){function t(e,t){r.push({id:s._id,key:S(e),value:S(t)})}function n(t,n){return function(){return h(e,t,n)}}var r,s,u;if("function"==typeof e.mapFun&&2===e.mapFun.length){var c=e.mapFun;u=function(e){return c(e,t)}}else u=O(e.mapFun.toString(),t,a,_,Array.isArray,JSON.parse);var l=e.seq||0,f=new w;return new q(function(t,a){function c(){f.finish().then(function(){e.seq=l,t()})}function d(){function t(e){a(e)}e.sourceDB.changes({conflicts:!0,include_docs:!0,since:l,limit:C}).on("complete",function(t){var a=t.results;if(!a.length)return c();for(var p={},h=0,v=a.length;v>h;h++){var m=a[h];if("_"!==m.doc._id[0]){r=[],s=m.doc,s._deleted||o(e.sourceDB,u,[s]),r.sort(i);for(var y={},g=0,_=r.length;_>g;g++){var b=r[g],w=E([b.key,b.id,g]);y[w]=b}p[m.doc._id]=y}l=m.seq}return f.add(n(p,l)),a.length<C?c():d()}).on("error",t)}d()})}),N=j.sequentialize(R,function(e,t){function n(t){return t.include_docs=!0,e.db.allDocs(t).then(function(e){return o=e.total_rows,e.rows.map(function(e){return e.doc.value})})}function r(n){var r;if(r=i?v(e,n,t):{total_rows:o,offset:s,rows:n},t.include_docs){var u=n.map(function(t){var n=t.value,r=n&&"object"==typeof n&&n._id||t.id;return e.sourceDB.get(r).then(function(e){t.doc=e},function(){})});return q.all(u).then(function(){return r})}return r}var o,i=e.reduceFun&&t.reduce!==!1,s=t.skip||0;"undefined"==typeof t.keys||t.keys.length||(t.limit=0,delete t.keys);var u=function(e){return e.reduce(function(e,t){return e.concat(t)})};if("undefined"!=typeof t.keys){var a=t.keys,c=a.map(function(e){var t={startkey:E([e]),endkey:E([e,{}])};return n(t)});return q.all(c).then(u).then(r)}var l={descending:t.descending};if("undefined"!=typeof t.startkey&&(l.startkey=E(t.descending?[t.startkey,{}]:[t.startkey])),"undefined"!=typeof t.endkey){var f=t.inclusive_end!==!1;t.descending&&(f=!f),l.endkey=E(f?[t.endkey,{}]:[t.endkey])}if("undefined"!=typeof t.key){var d=E([t.key]),p=E([t.key,{}]);l.descending?(l.endkey=d,l.startkey=p):(l.startkey=d,l.endkey=p)}return i||("number"==typeof t.limit&&(l.limit=t.limit),l.skip=s),n(l).then(r)}),D=j.sequentialize(R,function(e){return e.get("_local/mrviews").then(function(t){var n={};Object.keys(t.views).forEach(function(e){var t=r(e),o="_design/"+t[0],i=t[1];n[o]=n[o]||{},n[o][i]=!0});var o={keys:Object.keys(n),include_docs:!0};return e.allDocs(o).then(function(r){var o={};r.rows.forEach(function(e){var r=e.key.substring(8);Object.keys(n[e.key]).forEach(function(n){var i=r+"/"+n;t.views[i]||(i=n);var s=Object.keys(t.views[i]),u=e.doc&&e.doc.views&&e.doc.views[n];s.forEach(function(e){o[e]=o[e]||u})})});var i=Object.keys(o).filter(function(e){return!o[e]}),s=i.map(function(t){return e.constructor.destroy(t,{adapter:e.adapter})});return q.all(s).then(function(){return{ok:!0}})})},d({ok:!0}))});n.viewCleanup=j.callbackify(function(){var e=this;return"http"===e.type()?m(e):D(e)}),n.query=function(e,t,n){"function"==typeof t&&(n=t,t={}),t=j.extend({},t),"function"==typeof e&&(e={map:e});var r=this,o=q.resolve().then(function(){return y(r,e,t)});return j.promisedCallback(o,n),o},n.putView=function(e,t,n,r,o){"object"==typeof n?(o=r,r=n,n=null):"function"==typeof n?(o=n,n=r=null):"function"==typeof r&&(o=r,r=null),r=j.extend({},r||{}),("function"==typeof t||"string"==typeof t)&&(t={map:t});var i;if("string"!=typeof e)return i=new Error("you must supply a design doc/view name"),i.name="putview_error",i.status=400,j.promisedCallback(q.reject(i),o);if(!t||-1===["function","string"].indexOf(typeof t.map))return i=new Error("you must supply a map function"),i.name="putview_error",i.status=400,j.promisedCallback(q.reject(i),o);"function"==typeof t.map&&(t.map=t.map.toString()),"function"==typeof t.reduce&&(t.reduce=t.reduce.toString());var s=e.split("/"),u="_design/"+s[0],a=s[1],c={_id:u,views:{}};return c.views[a]=t,n&&(c._rev=n),this.put(c,o)},j.inherits(g,Error)},{"./create-view":129,"./evalfunc":130,"./taskqueue":134,"./utils":136,"pouchdb-collate":132}],132:[function(e,t,n){"use strict";function r(e){if(null!==e)switch(typeof e){case"boolean":return e?1:0;case"number":return a(e);case"string":return e.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var t=Array.isArray(e),r=t?e:Object.keys(e),o=-1,i=r.length,s="";if(t)for(;++o<i;)s+=n.toIndexableString(r[o]);else for(;++o<i;){var u=r[o];s+=n.toIndexableString(u)+n.toIndexableString(e[u])}return s}return""}function o(e,t){for(var r=Math.min(e.length,t.length),o=0;r>o;o++){var i=n.collate(e[o],t[o]);if(0!==i)return i}return e.length===t.length?0:e.length>t.length?1:-1}function i(e,t){return e===t?0:e>t?1:-1}function s(e,t){for(var r=Object.keys(e),o=Object.keys(t),i=Math.min(r.length,o.length),s=0;i>s;s++){var u=n.collate(r[s],o[s]);if(0!==u)return u;if(u=n.collate(e[r[s]],t[o[s]]),0!==u)return u}return r.length===o.length?0:r.length>o.length?1:-1}function u(e){var t=["boolean","number","string","object"],n=t.indexOf(typeof e);return~n?null===e?1:Array.isArray(e)?5:3>n?n+2:n+3:Array.isArray(e)?5:void 0}function a(e){if(0===e)return"1";var t=e.toExponential().split(/e\+?/),n=parseInt(t[1],10),r=0>e,o=r?"0":"2",i=(r?-n:n)-c,s=d.padLeft(i.toString(),"0",l);o+=f+s;var u=Math.abs(parseFloat(t[0]));r&&(u=10-u);var a=u.toFixed(20);return a=a.replace(/\.?0+$/,""),o+=f+a}var c=-324,l=3,f="",d=e("./utils");n.collate=function(e,t){if(e===t)return 0;
e=n.normalizeKey(e),t=n.normalizeKey(t);var r=u(e),a=u(t);if(r-a!==0)return r-a;if(null===e)return 0;switch(typeof e){case"number":return e-t;case"boolean":return e===t?0:t>e?-1:1;case"string":return i(e,t)}return Array.isArray(e)?o(e,t):s(e,t)},n.normalizeKey=function(e){switch(typeof e){case"undefined":return null;case"number":return 1/0===e||e===-1/0||isNaN(e)?null:e;case"object":var t=e;if(Array.isArray(e)){var r=e.length;e=new Array(r);for(var o=0;r>o;o++)e[o]=n.normalizeKey(t[o])}else{if(e instanceof Date)return e.toJSON();if(null!==e){e={};for(var i in t)if(t.hasOwnProperty(i)){var s=t[i];"undefined"!=typeof s&&(e[i]=n.normalizeKey(s))}}}}return e},n.toIndexableString=function(e){var t="\x00";return e=n.normalizeKey(e),u(e)+f+r(e)+t}},{"./utils":133}],133:[function(e,t,n){"use strict";function r(e,t,n){for(var r="",o=n-e.length;r.length<o;)r+=t;return r}n.padLeft=function(e,t,n){var o=r(e,t,n);return o+e},n.padRight=function(e,t,n){var o=r(e,t,n);return e+o},n.stringLexCompare=function(e,t){var n,r=e.length,o=t.length;for(n=0;r>n;n++){if(n===o)return 1;var i=e.charAt(n),s=t.charAt(n);if(i!==s)return s>i?-1:1}return o>r?-1:0},n.intToDecimalForm=function(e){var t=0>e,n="";do{var r=t?-Math.ceil(e%10):Math.floor(e%10);n=r+n,e=t?Math.ceil(e/10):Math.floor(e/10)}while(e);return t&&"0"!==n&&(n="-"+n),n}},{}],134:[function(e,t){"use strict";function n(){this.promise=new r(function(e){e()})}var r=e("./utils").Promise;n.prototype.add=function(e){return this.promise=this.promise["catch"](function(){}).then(function(){return e()}),this.promise},n.prototype.finish=function(){return this.promise},t.exports=n},{"./utils":136}],135:[function(e,t){"use strict";function n(e,t,n){return new o(function(o,i){return t&&"object"==typeof t&&(t=t._id),"string"!=typeof t?i(new Error("doc id is required")):void e.get(t,function(s,u){if(s)return"not_found"!==s.name?i(s):o(r(e,n({_id:t}),n));var a=n(u);return a?void o(r(e,a,n)):o(u)})})}function r(e,t,r){return e.put(t)["catch"](function(o){if("conflict"!==o.name)throw o;return n(e,t,r)})}var o=e("./utils").Promise;t.exports=n},{"./utils":136}],136:[function(e,t,n){(function(t,r){"use strict";n.Promise="function"==typeof r.Promise?r.Promise:e("lie"),n.uniq=function(e){var t={};return e.forEach(function(e){t[e]=!0}),Object.keys(t)},n.inherits=e("inherits"),n.extend=e("extend");var o=e("argsarray");n.promisedCallback=function(e,t){return t&&e.then(function(e){t(null,e)},function(e){t(e)}),e},n.callbackify=function(e){return o(function(t){var r=t.pop(),o=e.apply(this,t);return"function"==typeof r&&n.promisedCallback(o,r),o})},n.fin=function(e,t){return e.then(function(e){var n=t();return"function"==typeof n.then?n.then(function(){return e}):e},function(e){var n=t();if("function"==typeof n.then)return n.then(function(){throw e});throw e})},n.sequentialize=function(e,t){return function(){var n=arguments,r=this;return e.add(function(){return t.apply(r,n)})}};var i=e("crypto"),s=e("md5-jkmyers");n.MD5=function(e){return t.browser?s(e):i.createHash("md5").update(e).digest("hex")}}).call(this,e("/home/marten/npm/lib/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"/home/marten/npm/lib/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":139,argsarray:108,crypto:137,extend:4,inherits:109,lie:114,"md5-jkmyers":128}],137:[function(){},{}],138:[function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function o(e){return"number"==typeof e}function i(e){return"object"==typeof e&&null!==e}function s(e){return void 0===e}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!o(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,o,u,a,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||i(this._events.error)&&!this._events.error.length))throw t=arguments[1],t instanceof Error?t:TypeError('Uncaught, unspecified "error" event.');if(n=this._events[e],s(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:for(o=arguments.length,u=new Array(o-1),a=1;o>a;a++)u[a-1]=arguments[a];n.apply(this,u)}else if(i(n)){for(o=arguments.length,u=new Array(o-1),a=1;o>a;a++)u[a-1]=arguments[a];for(c=n.slice(),o=c.length,a=0;o>a;a++)c[a].apply(this,u)}return!0},n.prototype.addListener=function(e,t){var o;if(!r(t))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?i(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,i(this._events[e])&&!this._events[e].warned){var o;o=s(this._maxListeners)?n.defaultMaxListeners:this._maxListeners,o&&o>0&&this._events[e].length>o&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),console.trace())}return this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function n(){this.removeListener(e,n),o||(o=!0,t.apply(this,arguments))}if(!r(t))throw TypeError("listener must be a function");var o=!1;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,t){var n,o,s,u;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],s=n.length,o=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(i(n)){for(u=s;u-->0;)if(n[u]===t||n[u].listener&&n[u].listener===t){o=u;break}if(0>o)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(o,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],r(n))this.removeListener(e,n);else for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.listenerCount=function(e,t){var n;return n=e._events&&e._events[t]?r(e._events[t])?1:e._events[t].length:0}},{}],139:[function(e,t){function n(){}var r=t.exports={};r.nextTick=function(){var e="undefined"!=typeof window&&window.setImmediate,t="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(e)return function(e){return window.setImmediate(e)};if(t){var n=[];return window.addEventListener("message",function(e){var t=e.source;if((t===window||null===t)&&"process-tick"===e.data&&(e.stopPropagation(),n.length>0)){var r=n.shift();r()}},!0),function(e){n.push(e),window.postMessage("process-tick","*")}}return function(e){setTimeout(e,0)}}(),r.title="browser",r.browser=!0,r.env={},r.argv=[],r.on=n,r.once=n,r.off=n,r.emit=n,r.binding=function(){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(){throw new Error("process.chdir is not supported")}},{}],140:[function(e,t){"use strict";function n(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.exports=function(e,t,o,i){t=t||"&",o=o||"=";var s={};if("string"!=typeof e||0===e.length)return s;var u=/\+/g;e=e.split(t);var a=1e3;i&&"number"==typeof i.maxKeys&&(a=i.maxKeys);var c=e.length;a>0&&c>a&&(c=a);for(var l=0;c>l;++l){var f,d,p,h,v=e[l].replace(u,"%20"),m=v.indexOf(o);m>=0?(f=v.substr(0,m),d=v.substr(m+1)):(f=v,d=""),p=decodeURIComponent(f),h=decodeURIComponent(d),n(s,p)?r(s[p])?s[p].push(h):s[p]=[s[p],h]:s[p]=h}return s};var r=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{}],141:[function(e,t){"use strict";function n(e,t){if(e.map)return e.map(t);for(var n=[],r=0;r<e.length;r++)n.push(t(e[r],r));return n}var r=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};t.exports=function(e,t,s,u){return t=t||"&",s=s||"=",null===e&&(e=void 0),"object"==typeof e?n(i(e),function(n){var i=encodeURIComponent(r(n))+s;return o(e[n])?e[n].map(function(e){return i+encodeURIComponent(r(e))}).join(t):i+encodeURIComponent(r(e[n]))}).join(t):u?encodeURIComponent(r(u))+s+encodeURIComponent(r(e)):""};var o=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},i=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}},{}],142:[function(e,t,n){"use strict";n.decode=n.parse=e("./decode"),n.encode=n.stringify=e("./encode")},{"./decode":140,"./encode":141}]},{},[3]);