<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Databases &mdash; peewee 2.2.3 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.2.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="peewee 2.2.3 documentation" href="../index.html" />
    <link rel="next" title="API Reference" href="api.html" />
    <link rel="prev" title="Querying" href="querying.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="api.html" title="API Reference"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="querying.html" title="Querying"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">peewee 2.2.3 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="databases">
<span id="id1"></span><h1>Databases<a class="headerlink" href="#databases" title="Permalink to this headline">¶</a></h1>
<p>Below the <a class="reference internal" href="api.html#Model" title="Model"><tt class="xref py py-class docutils literal"><span class="pre">Model</span></tt></a> level, peewee uses an abstraction for representing the database.  The
<a class="reference internal" href="api.html#Database" title="Database"><tt class="xref py py-class docutils literal"><span class="pre">Database</span></tt></a> is responsible for establishing and closing connections, making queries,
and gathering information from the database.  The <a class="reference internal" href="api.html#Database" title="Database"><tt class="xref py py-class docutils literal"><span class="pre">Database</span></tt></a> encapsulates functionality
specific to a given db driver.  For example difference in column types across database engines,
or support for certain features like sequences.  The database is responsible for smoothing out
the quirks of each backend driver to provide a consistent interface.</p>
<p>The <a class="reference internal" href="api.html#Database" title="Database"><tt class="xref py py-class docutils literal"><span class="pre">Database</span></tt></a> also uses a subclass of <tt class="xref py py-class docutils literal"><span class="pre">QueryCompiler</span></tt> to generate
valid SQL.  The QueryCompiler maps the internal data structures used by peewee to
SQL statements.</p>
<p>For a high-level overview of working with transactions, check out the <a class="reference internal" href="cookbook.html#working-with-transactions"><em>transactions cookbook</em></a>.</p>
<p>For notes on deferring instantiation of database, for example if loading configuration
at run-time, see the notes on <a class="reference internal" href="cookbook.html#deferring-initialization"><em>deferring initialization</em></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The internals of the <a class="reference internal" href="api.html#Database" title="Database"><tt class="xref py py-class docutils literal"><span class="pre">Database</span></tt></a> and <tt class="xref py py-class docutils literal"><span class="pre">QueryCompiler</span></tt> will be
of interest to anyone interested in adding support for another database driver.</p>
</div>
<div class="section" id="writing-a-database-driver">
<h2>Writing a database driver<a class="headerlink" href="#writing-a-database-driver" title="Permalink to this headline">¶</a></h2>
<p>Peewee currently supports Sqlite, MySQL and Postgresql.  These databases are very
popular and run the gamut from fast, embeddable databases to heavyweight servers
suitable for large-scale deployments.  That being said, there are a ton of cool
databases out there and adding support for your database-of-choice should be really
easy, provided the driver supports the <a class="reference external" href="http://www.python.org/dev/peps/pep-0249/">DB-API 2.0 spec</a>.</p>
<p>The db-api 2.0 spec should be familiar to you if you&#8217;ve used the standard library
sqlite3 driver, psycopg2 or the like.  Peewee currently relies on a handful of parts:</p>
<ul class="simple">
<li><cite>Connection.commit</cite></li>
<li><cite>Connection.execute</cite></li>
<li><cite>Connection.rollback</cite></li>
<li><cite>Cursor.description</cite></li>
<li><cite>Cursor.fetchone</cite></li>
</ul>
<p>These methods are generally wrapped up in higher-level abstractions and exposed
by the <a class="reference internal" href="api.html#Database" title="Database"><tt class="xref py py-class docutils literal"><span class="pre">Database</span></tt></a>, so even if your driver doesn&#8217;t
do these exactly you can still get a lot of mileage out of peewee.  An example
is the <a class="reference external" href="http://code.google.com/p/apsw/">apsw sqlite driver</a> in the &#8220;playhouse&#8221;
module.</p>
<div class="section" id="starting-out">
<h3>Starting out<a class="headerlink" href="#starting-out" title="Permalink to this headline">¶</a></h3>
<p>The first thing is to provide a subclass of <a class="reference internal" href="api.html#Database" title="Database"><tt class="xref py py-class docutils literal"><span class="pre">Database</span></tt></a> that will open
a connection.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">peewee</span> <span class="kn">import</span> <span class="n">Database</span>
<span class="kn">import</span> <span class="nn">foodb</span> <span class="c"># our fictional driver</span>


<span class="k">class</span> <span class="nc">FooDatabase</span><span class="p">(</span><span class="n">Database</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">database</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">foodb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">database</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="essential-methods-to-override">
<h3>Essential methods to override<a class="headerlink" href="#essential-methods-to-override" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="api.html#Database" title="Database"><tt class="xref py py-class docutils literal"><span class="pre">Database</span></tt></a> provides a higher-level API and is responsible for executing queries,
creating tables and indexes, and introspecting the database to get lists of tables. The above
implementation is the absolute minimum needed, though some features will not work &#8211; for best
results you will want to additionally add a method for extracting a list of tables
and indexes for a table from the database.  We&#8217;ll pretend that <tt class="docutils literal"><span class="pre">FooDB</span></tt> is a lot like
MySQL and has special &#8220;SHOW&#8221; statements:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">FooDatabase</span><span class="p">(</span><span class="n">Database</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">database</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">foodb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">database</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;SHOW TABLES;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>

    <span class="k">def</span> <span class="nf">get_indexes_for_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;SHOW INDEXES IN </span><span class="si">%s</span><span class="s">;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">quote_name</span><span class="p">(</span><span class="n">table</span><span class="p">))</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([(</span><span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()])</span>
        <span class="k">return</span> <span class="n">rows</span>
</pre></div>
</div>
<p>Other things the database handles that are not covered here include:</p>
<ul class="simple">
<li><a class="reference internal" href="api.html#Database.last_insert_id" title="Database.last_insert_id"><tt class="xref py py-meth docutils literal"><span class="pre">last_insert_id()</span></tt></a> and <a class="reference internal" href="api.html#Database.rows_affected" title="Database.rows_affected"><tt class="xref py py-meth docutils literal"><span class="pre">rows_affected()</span></tt></a></li>
<li><tt class="xref py py-attr docutils literal"><span class="pre">interpolation</span></tt> and <tt class="xref py py-attr docutils literal"><span class="pre">quote_char</span></tt></li>
<li><tt class="xref py py-attr docutils literal"><span class="pre">op_overrides</span></tt> for mapping operations such as &#8220;LIKE/ILIKE&#8221; to their database equivalent</li>
</ul>
<p>Refer to the <a class="reference internal" href="api.html#Database" title="Database"><tt class="xref py py-class docutils literal"><span class="pre">Database</span></tt></a> API reference or the <a class="reference external" href="https://github.com/coleifer/peewee/blob/master/peewee.py">source code</a>. for details.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If your driver conforms to the db-api 2.0 spec, there shouldn&#8217;t be
much work needed to get up and running.</p>
</div>
</div>
<div class="section" id="using-our-new-database">
<h3>Using our new database<a class="headerlink" href="#using-our-new-database" title="Permalink to this headline">¶</a></h3>
<p>Our new database can be used just like any of the other database subclasses:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">peewee</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">foodb_ext</span> <span class="kn">import</span> <span class="n">FooDatabase</span>

<span class="n">db</span> <span class="o">=</span> <span class="n">FooDatabase</span><span class="p">(</span><span class="s">&#39;my_database&#39;</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&#39;secret&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">BaseModel</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">database</span> <span class="o">=</span> <span class="n">db</span>

<span class="k">class</span> <span class="nc">Blog</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>
    <span class="n">contents</span> <span class="o">=</span> <span class="n">TextField</span><span class="p">()</span>
    <span class="n">pub_date</span> <span class="o">=</span> <span class="n">DateTimeField</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="peewee-and-other-databases">
<h2>Peewee and Other Databases<a class="headerlink" href="#peewee-and-other-databases" title="Permalink to this headline">¶</a></h2>
<p>This section will document how peewee has been used with other databases. If
someone has written an integration between peewee and another database I will
be happy to list the project name, database it works with and a link to the
project.</p>
<div class="section" id="google-cloud-sql">
<h3>Google Cloud SQL<a class="headerlink" href="#google-cloud-sql" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://github.com/coleifer/peewee/issues/183">Code shared on a GitHub issue</a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">google.appengine.api</span> <span class="kn">import</span> <span class="n">rdbms</span>
<span class="kn">from</span> <span class="nn">peewee</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">class</span> <span class="nc">AppEngineDatabase</span><span class="p">(</span><span class="n">MySQLDatabase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">database</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="s">&#39;instance&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ImproperlyConfigured</span><span class="p">(</span>
                <span class="s">&#39;Missing &quot;instance&quot; keyword to connect to database&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rdbms</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Databases</a><ul>
<li><a class="reference internal" href="#writing-a-database-driver">Writing a database driver</a><ul>
<li><a class="reference internal" href="#starting-out">Starting out</a></li>
<li><a class="reference internal" href="#essential-methods-to-override">Essential methods to override</a></li>
<li><a class="reference internal" href="#using-our-new-database">Using our new database</a></li>
</ul>
</li>
<li><a class="reference internal" href="#peewee-and-other-databases">Peewee and Other Databases</a><ul>
<li><a class="reference internal" href="#google-cloud-sql">Google Cloud SQL</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="querying.html"
                        title="previous chapter">Querying</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="api.html"
                        title="next chapter">API Reference</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/peewee/database.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="api.html" title="API Reference"
             >next</a> |</li>
        <li class="right" >
          <a href="querying.html" title="Querying"
             >previous</a> |</li>
        <li><a href="../index.html">peewee 2.2.3 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright charles leifer.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>