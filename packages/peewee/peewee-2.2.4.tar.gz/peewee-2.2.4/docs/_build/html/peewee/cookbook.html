<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Peewee Cookbook &mdash; peewee 2.2.3 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.2.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="peewee 2.2.3 documentation" href="../index.html" />
    <link rel="next" title="Model and Fields" href="models.html" />
    <link rel="prev" title="Example app" href="example.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="models.html" title="Model and Fields"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="example.html" title="Example app"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">peewee 2.2.3 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="peewee-cookbook">
<span id="cookbook"></span><h1>Peewee Cookbook<a class="headerlink" href="#peewee-cookbook" title="Permalink to this headline">¶</a></h1>
<p>Below are outlined some of the ways to perform typical database-related tasks
with peewee.</p>
<p>Examples will use the following models:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">peewee</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Tweet</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">ForeignKeyField</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">&#39;tweets&#39;</span><span class="p">)</span>
    <span class="n">message</span> <span class="o">=</span> <span class="n">TextField</span><span class="p">()</span>
    <span class="n">created_date</span> <span class="o">=</span> <span class="n">DateTimeField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>
    <span class="n">is_published</span> <span class="o">=</span> <span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="database-and-connection-recipes">
<h2>Database and Connection Recipes<a class="headerlink" href="#database-and-connection-recipes" title="Permalink to this headline">¶</a></h2>
<div class="section" id="creating-a-database-connection-and-tables">
<h3>Creating a database connection and tables<a class="headerlink" href="#creating-a-database-connection-and-tables" title="Permalink to this headline">¶</a></h3>
<p>While it is not necessary to explicitly connect to the database before using it,
managing connections explicitly is a good practice.  This way if the connection
fails, the exception can be caught during the &#8220;connect&#8221; step, rather than some
arbitrary time later when a query is executed.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">database</span> <span class="o">=</span> <span class="n">SqliteDatabase</span><span class="p">(</span><span class="s">&#39;stats.db&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">database</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
</pre></div>
</div>
<p>To use this database with your models, specify it in an inner &#8220;Meta&#8221; class:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">some_field</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">database</span> <span class="o">=</span> <span class="n">database</span>
</pre></div>
</div>
<p>It is possible to use multiple databases (provided that you don&#8217;t try and mix
models from each):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">custom_db</span> <span class="o">=</span> <span class="n">SqliteDatabase</span><span class="p">(</span><span class="s">&#39;custom.db&#39;</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">CustomModel</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">whatev</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<span class="gp">... </span>        <span class="n">database</span> <span class="o">=</span> <span class="n">custom_db</span>
<span class="gp">...</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">custom_db</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">CustomModel</span><span class="o">.</span><span class="n">create_table</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Best practice:</strong> define a base model class that points at the database object
you wish to use, and then all your models will extend it:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">custom_db</span> <span class="o">=</span> <span class="n">SqliteDatabase</span><span class="p">(</span><span class="s">&#39;custom.db&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">CustomModel</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">database</span> <span class="o">=</span> <span class="n">custom_db</span>

<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">CustomModel</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Tweet</span><span class="p">(</span><span class="n">CustomModel</span><span class="p">):</span>
    <span class="c"># etc, etc</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Remember to specify a database in a model class (or its parent class),
otherwise peewee will fall back to a default sqlite database named &#8220;peewee.db&#8221;.</p>
</div>
</div>
<div class="section" id="using-with-postgresql">
<span id="postgresql"></span><h3>Using with Postgresql<a class="headerlink" href="#using-with-postgresql" title="Permalink to this headline">¶</a></h3>
<p>Point models at an instance of <a class="reference internal" href="api.html#PostgresqlDatabase" title="PostgresqlDatabase"><tt class="xref py py-class docutils literal"><span class="pre">PostgresqlDatabase</span></tt></a>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">psql_db</span> <span class="o">=</span> <span class="n">PostgresqlDatabase</span><span class="p">(</span><span class="s">&#39;my_database&#39;</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s">&#39;code&#39;</span><span class="p">)</span>
<span class="c"># if your Postgres template doesn&#39;t use UTF8, you can set the connection encoding like so:</span>
<span class="n">psql_db</span><span class="o">.</span><span class="n">get_conn</span><span class="p">()</span><span class="o">.</span><span class="n">set_client_encoding</span><span class="p">(</span><span class="s">&#39;UTF8&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">PostgresqlModel</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A base model that will use our Postgresql database&quot;&quot;&quot;</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">database</span> <span class="o">=</span> <span class="n">psql_db</span>

<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">PostgresqlModel</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>
    <span class="c"># etc, etc</span>
</pre></div>
</div>
</div>
<div class="section" id="using-with-mysql">
<span id="mysql"></span><h3>Using with MySQL<a class="headerlink" href="#using-with-mysql" title="Permalink to this headline">¶</a></h3>
<p>Point models at an instance of <a class="reference internal" href="api.html#MySQLDatabase" title="MySQLDatabase"><tt class="xref py py-class docutils literal"><span class="pre">MySQLDatabase</span></tt></a>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">mysql_db</span> <span class="o">=</span> <span class="n">MySQLDatabase</span><span class="p">(</span><span class="s">&#39;my_database&#39;</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s">&#39;code&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">MySQLModel</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A base model that will use our MySQL database&quot;&quot;&quot;</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">database</span> <span class="o">=</span> <span class="n">mysql_db</span>

<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">MySQLModel</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>
    <span class="c"># etc, etc</span>


<span class="c"># when you&#39;re ready to start querying, remember to connect</span>
<span class="n">mysql_db</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="using-with-sqlite">
<span id="sqlite"></span><h3>Using with SQLite<a class="headerlink" href="#using-with-sqlite" title="Permalink to this headline">¶</a></h3>
<p>Point models at an instance of <a class="reference internal" href="api.html#SqliteDatabase" title="SqliteDatabase"><tt class="xref py py-class docutils literal"><span class="pre">SqliteDatabase</span></tt></a>.  See also <a class="reference internal" href="playhouse.html#apsw"><em>Alternate Python SQLite Driver</em></a>,
it&#8217;s really neat.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">sqlite_db</span> <span class="o">=</span> <span class="n">SqliteDatabase</span><span class="p">(</span><span class="s">&#39;sq.db&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SqliteModel</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A base model that will use our Sqlite database&quot;&quot;&quot;</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">database</span> <span class="o">=</span> <span class="n">sqlite_db</span>

<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">SqliteModel</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>
    <span class="c"># etc, etc</span>


<span class="c"># when you&#39;re ready to start querying, remember to connect</span>
<span class="n">sqlite_db</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="multi-threaded-applications">
<h3>Multi-threaded applications<a class="headerlink" href="#multi-threaded-applications" title="Permalink to this headline">¶</a></h3>
<p>Some database engines may not allow a connection to be shared across threads, notably
sqlite.  If you would like peewee to maintain a single connection per-thread,
instantiate your database with <tt class="docutils literal"><span class="pre">threadlocals=True</span></tt> (<em>recommended</em>):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">concurrent_db</span> <span class="o">=</span> <span class="n">SqliteDatabase</span><span class="p">(</span><span class="s">&#39;stats.db&#39;</span><span class="p">,</span> <span class="n">threadlocals</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>With the above peewee stores connection state in a thread local; each thread gets its
own separate connection.</p>
<p>Alternatively, Python sqlite3 module can share a connection across different threads,
but you have to disable runtime checks to reuse the single connection:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">concurrent_db</span> <span class="o">=</span> <span class="n">SqliteDatabase</span><span class="p">(</span><span class="s">&#39;stats.db&#39;</span><span class="p">,</span> <span class="n">check_same_thread</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="deferring-initialization">
<span id="id1"></span><h3>Deferring initialization<a class="headerlink" href="#deferring-initialization" title="Permalink to this headline">¶</a></h3>
<p>Sometimes the database information is not known until run-time, when it might
be loaded from a configuration file/etc.  In this case, you can &#8220;defer&#8221; the initialization
of the database by passing in <tt class="docutils literal"><span class="pre">None</span></tt> as the database_name.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">deferred_db</span> <span class="o">=</span> <span class="n">SqliteDatabase</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">SomeModel</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">database</span> <span class="o">=</span> <span class="n">deferred_db</span>
</pre></div>
</div>
<p>If you try to connect or issue any queries while your database is uninitialized
you will get an exception:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">deferred_db</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="go">Exception: Error, database not properly initialized before opening connection</span>
</pre></div>
</div>
<p>To initialize your database, you simply call the <tt class="docutils literal"><span class="pre">init</span></tt> method with the database_name
and any additional kwargs:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">database_name</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="s">&#39;What is the name of the db? &#39;</span><span class="p">)</span>
<span class="n">deferred_db</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">database_name</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="dynamically-defining-a-database">
<span id="dynamic-db"></span><h3>Dynamically defining a database<a class="headerlink" href="#dynamically-defining-a-database" title="Permalink to this headline">¶</a></h3>
<p>For even more control over how your database is defined/initialized, you can
use the <a class="reference internal" href="api.html#Proxy" title="Proxy"><tt class="xref py py-class docutils literal"><span class="pre">Proxy</span></tt></a> helper, which is included as part of peewee.  You
can use the proxy as a &#8220;placeholder&#8221;, and then at run-time swap it out for a
different object.  In the example below, we will swap out the database depending
on how the app is configured:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">database_proxy</span> <span class="o">=</span> <span class="n">Proxy</span><span class="p">()</span>  <span class="c"># Create a proxy for our db.</span>

<span class="k">class</span> <span class="nc">BaseModel</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">database</span> <span class="o">=</span> <span class="n">database_proxy</span>  <span class="c"># Use proxy for our DB.</span>

<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>

<span class="c"># Based on configuration, use a different database.</span>
<span class="k">if</span> <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;DEBUG&#39;</span><span class="p">]:</span>
    <span class="n">database</span> <span class="o">=</span> <span class="n">SqliteDatabase</span><span class="p">(</span><span class="s">&#39;local.db&#39;</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;TESTING&#39;</span><span class="p">]:</span>
    <span class="n">database</span> <span class="o">=</span> <span class="n">SqliteDatabase</span><span class="p">(</span><span class="s">&#39;:memory:&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">database</span> <span class="o">=</span> <span class="n">PostgresqlDatabase</span><span class="p">(</span><span class="s">&#39;mega_production_db&#39;</span><span class="p">)</span>

<span class="c"># Configure our proxy to use the db we specified in config.</span>
<span class="n">database_proxy</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="n">database</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="logging-queries">
<h3>Logging queries<a class="headerlink" href="#logging-queries" title="Permalink to this headline">¶</a></h3>
<p>All queries are logged to the <tt class="docutils literal"><span class="pre">peewee</span></tt> namespace using the standard library
logging module. Queries are logged using the <tt class="docutils literal"><span class="pre">DEBUG</span></tt> level.  If you&#8217;re
interested in doing something with the queries, you can simply register a
handler.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Print all queries to stderr.</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&#39;peewee&#39;</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="creating-reading-updating-and-deleting">
<h2>Creating, Reading, Updating and Deleting<a class="headerlink" href="#creating-reading-updating-and-deleting" title="Permalink to this headline">¶</a></h2>
<div class="section" id="creating-a-new-record">
<h3>Creating a new record<a class="headerlink" href="#creating-a-new-record" title="Permalink to this headline">¶</a></h3>
<p>You can use the <a class="reference internal" href="api.html#Model.create" title="Model.create"><tt class="xref py py-meth docutils literal"><span class="pre">Model.create()</span></tt></a> method on the model:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">User</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;Charlie&#39;</span><span class="p">)</span>
<span class="go">&lt;__main__.User object at 0x2529350&gt;</span>
</pre></div>
</div>
<p>This will <tt class="docutils literal"><span class="pre">INSERT</span></tt> a new row into the database.  The primary key will automatically
be retrieved and stored on the model instance.</p>
<p>Alternatively, you can build up a model instance programmatically and then
save it:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="s">&#39;Charlie&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">id</span>
<span class="go">1</span>
</pre></div>
</div>
<p>See also <a class="reference internal" href="api.html#Model.save" title="Model.save"><tt class="xref py py-meth docutils literal"><span class="pre">Model.save()</span></tt></a>, <a class="reference internal" href="api.html#Model.insert" title="Model.insert"><tt class="xref py py-meth docutils literal"><span class="pre">Model.insert()</span></tt></a> and <a class="reference internal" href="api.html#InsertQuery" title="InsertQuery"><tt class="xref py py-class docutils literal"><span class="pre">InsertQuery</span></tt></a></p>
</div>
<div class="section" id="updating-existing-records">
<h3>Updating existing records<a class="headerlink" href="#updating-existing-records" title="Permalink to this headline">¶</a></h3>
<p>Once a model instance has a primary key, any attempt to re-save it will result
in an <tt class="docutils literal"><span class="pre">UPDATE</span></tt> rather than another <tt class="docutils literal"><span class="pre">INSERT</span></tt>:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">id</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">id</span>
<span class="go">1</span>
</pre></div>
</div>
<p>If you want to update multiple records, issue an <tt class="docutils literal"><span class="pre">UPDATE</span></tt> query.  The following
example will update all <tt class="docutils literal"><span class="pre">Entry</span></tt> objects, marking them as &#8220;published&#8221;, if their
pub_date is less than today&#8217;s date.</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">today</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">update_query</span> <span class="o">=</span> <span class="n">Tweet</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">is_published</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Tweet</span><span class="o">.</span><span class="n">creation_date</span> <span class="o">&lt;</span> <span class="n">today</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">update_query</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="go">4 # &lt;--- number of rows updated</span>
</pre></div>
</div>
<p>For more information, see the documentation on <a class="reference internal" href="api.html#UpdateQuery" title="UpdateQuery"><tt class="xref py py-class docutils literal"><span class="pre">UpdateQuery</span></tt></a>.</p>
</div>
<div class="section" id="deleting-a-record">
<h3>Deleting a record<a class="headerlink" href="#deleting-a-record" title="Permalink to this headline">¶</a></h3>
<p>To delete a single model instance, you can use the <a class="reference internal" href="api.html#Model.delete_instance" title="Model.delete_instance"><tt class="xref py py-meth docutils literal"><span class="pre">Model.delete_instance()</span></tt></a>
shortcut:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">delete_instance</span><span class="p">()</span>
<span class="go">1 # &lt;--- number of rows deleted</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">User</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
<span class="go">UserDoesNotExist: instance matching query does not exist:</span>
<span class="go">SQL: SELECT t1.&quot;id&quot;, t1.&quot;username&quot; FROM &quot;user&quot; AS t1 WHERE t1.&quot;id&quot; = ?</span>
<span class="go">PARAMS: [1]</span>
</pre></div>
</div>
<p>To delete an arbitrary group of records, you can issue a <tt class="docutils literal"><span class="pre">DELETE</span></tt> query.  The
following will delete all <tt class="docutils literal"><span class="pre">Tweet</span></tt> objects that are a year old.</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">delete_query</span> <span class="o">=</span> <span class="n">Tweet</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Tweet</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">&lt;</span> <span class="n">one_year_ago</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">delete_query</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="go">7 # &lt;--- number of rows deleted</span>
</pre></div>
</div>
<p>For more information, see the documentation on <a class="reference internal" href="api.html#DeleteQuery" title="DeleteQuery"><tt class="xref py py-class docutils literal"><span class="pre">DeleteQuery</span></tt></a>.</p>
</div>
<div class="section" id="selecting-a-single-record">
<h3>Selecting a single record<a class="headerlink" href="#selecting-a-single-record" title="Permalink to this headline">¶</a></h3>
<p>You can use the <a class="reference internal" href="api.html#Model.get" title="Model.get"><tt class="xref py py-meth docutils literal"><span class="pre">Model.get()</span></tt></a> method to retrieve a single instance matching
the given query.</p>
<p>This method is a shortcut that calls <a class="reference internal" href="api.html#Model.select" title="Model.select"><tt class="xref py py-meth docutils literal"><span class="pre">Model.select()</span></tt></a> with the given query,
but limits the result set to 1.  Additionally, if no model matches the given query,
a <tt class="docutils literal"><span class="pre">DoesNotExist</span></tt> exception will be raised.</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">User</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
<span class="go">&lt;__main__.Blog object at 0x25294d0&gt;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">User</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">username</span>
<span class="go">u&#39;Charlie&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">User</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span> <span class="o">==</span> <span class="s">&#39;Charlie&#39;</span><span class="p">)</span>
<span class="go">&lt;__main__.Blog object at 0x2529410&gt;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">User</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span> <span class="o">==</span> <span class="s">&#39;nobody&#39;</span><span class="p">)</span>
<span class="go">UserDoesNotExist: instance matching query does not exist:</span>
<span class="go">SQL: SELECT t1.&quot;id&quot;, t1.&quot;username&quot; FROM &quot;user&quot; AS t1 WHERE t1.&quot;username&quot; = ?</span>
<span class="go">PARAMS: [&#39;nobody&#39;]</span>
</pre></div>
</div>
<p>For more information see notes on <a class="reference internal" href="api.html#SelectQuery" title="SelectQuery"><tt class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></tt></a> and <a class="reference internal" href="querying.html#querying"><em>Querying</em></a> in general.</p>
</div>
<div class="section" id="selecting-multiple-records">
<h3>Selecting multiple records<a class="headerlink" href="#selecting-multiple-records" title="Permalink to this headline">¶</a></h3>
<p>To simply get all instances in a table, call the <a class="reference internal" href="api.html#Model.select" title="Model.select"><tt class="xref py py-meth docutils literal"><span class="pre">Model.select()</span></tt></a> method:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">():</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">user</span><span class="o">.</span><span class="n">username</span>
<span class="gp">...</span>
<span class="go">Charlie</span>
<span class="go">Peewee Herman</span>
</pre></div>
</div>
<p>When you iterate over a <a class="reference internal" href="api.html#SelectQuery" title="SelectQuery"><tt class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></tt></a>, it will automatically execute
it and start returning results from the database cursor.  Subsequent iterations
of the same query will not hit the database as the results are cached.</p>
<p>Another useful note is that you can retrieve instances related by <a class="reference internal" href="api.html#ForeignKeyField" title="ForeignKeyField"><tt class="xref py py-class docutils literal"><span class="pre">ForeignKeyField</span></tt></a>
by iterating.  To get all the related instances for an object, you can query the related name.
Looking at the example models, we have Users and Tweets.  Tweet has a foreign key to User,
meaning that any given user may have 0..n tweets.  A user&#8217;s related tweets are exposed
using a <a class="reference internal" href="api.html#SelectQuery" title="SelectQuery"><tt class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></tt></a>, and can be iterated the same as any other SelectQuery:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">user</span><span class="o">.</span><span class="n">tweets</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">tweet</span><span class="o">.</span><span class="n">message</span>
<span class="gp">...</span>
<span class="go">hello world</span>
<span class="go">this is fun</span>
<span class="go">look at this picture of my food</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">tweets</span></tt> attribute is just another select query and any methods available
to <a class="reference internal" href="api.html#SelectQuery" title="SelectQuery"><tt class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></tt></a> are available:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">user</span><span class="o">.</span><span class="n">tweets</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">Tweet</span><span class="o">.</span><span class="n">created_date</span><span class="o">.</span><span class="n">desc</span><span class="p">()):</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">tweet</span><span class="o">.</span><span class="n">message</span>
<span class="gp">...</span>
<span class="go">look at this picture of my food</span>
<span class="go">this is fun</span>
<span class="go">hello world</span>
</pre></div>
</div>
</div>
<div class="section" id="filtering-records">
<h3>Filtering records<a class="headerlink" href="#filtering-records" title="Permalink to this headline">¶</a></h3>
<p>You can filter for particular records using normal python operators.</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span> <span class="o">==</span> <span class="s">&#39;Charlie&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">Tweet</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Tweet</span><span class="o">.</span><span class="n">user</span> <span class="o">==</span> <span class="n">user</span><span class="p">,</span> <span class="n">Tweet</span><span class="o">.</span><span class="n">is_published</span> <span class="o">==</span> <span class="bp">True</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s"> (</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">tweet</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">Charlie: hello world</span>
<span class="go">Charlie: this is fun</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">Tweet</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Tweet</span><span class="o">.</span><span class="n">created_date</span> <span class="o">&lt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2011</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)):</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">tweet</span><span class="o">.</span><span class="n">message</span><span class="p">,</span> <span class="n">tweet</span><span class="o">.</span><span class="n">created_date</span>
<span class="gp">...</span>
<span class="go">Really old tweet 2010-01-01 00:00:00</span>
</pre></div>
</div>
<p>You can also filter across joins:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">Tweet</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span> <span class="o">==</span> <span class="s">&#39;Charlie&#39;</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">tweet</span><span class="o">.</span><span class="n">message</span>
<span class="go">hello world</span>
<span class="go">this is fun</span>
<span class="go">look at this picture of my food</span>
</pre></div>
</div>
<p>If you want to express a complex query, use parentheses and python&#8217;s bitwise &#8220;or&#8221; and &#8220;and&#8221;
operators:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Tweet</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span> <span class="o">==</span> <span class="s">&#39;Charlie&#39;</span><span class="p">)</span> <span class="o">|</span>
<span class="gp">... </span>    <span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span> <span class="o">==</span> <span class="s">&#39;Peewee Herman&#39;</span><span class="p">)</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<p>Check out <a class="reference internal" href="querying.html#column-lookups"><em>the table of query operations</em></a> to see what types of
queries are possible.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>A lot of fun things can go in the where clause of a query, such as:</p>
<ul class="simple">
<li>a field expression, e.g. <tt class="docutils literal"><span class="pre">User.username</span> <span class="pre">==</span> <span class="pre">'Charlie'</span></tt></li>
<li>a function expression, e.g. <tt class="docutils literal"><span class="pre">fn.Lower(fn.Substr(User.username,</span> <span class="pre">1,</span> <span class="pre">1))</span> <span class="pre">==</span> <span class="pre">'a'</span></tt></li>
<li>a comparison of one column to another, e.g. <tt class="docutils literal"><span class="pre">Employee.salary</span> <span class="pre">&lt;</span> <span class="pre">(Employee.tenure</span> <span class="pre">*</span> <span class="pre">1000)</span> <span class="pre">+</span> <span class="pre">40000</span></tt></li>
</ul>
<p>You can also nest queries, for example tweets by users whose username starts with &#8220;a&#8221;:</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="c"># get users whose username starts with &quot;a&quot;</span>
<span class="n">a_users</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">Lower</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">Substr</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">==</span> <span class="s">&#39;a&#39;</span><span class="p">)</span>

<span class="c"># the &quot;&lt;&lt;&quot; operator signifies an &quot;IN&quot; query</span>
<span class="n">a_user_tweets</span> <span class="o">=</span> <span class="n">Tweet</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Tweet</span><span class="o">.</span><span class="n">user</span> <span class="o">&lt;&lt;</span> <span class="n">a_users</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Check <a class="reference internal" href="querying.html#query-compare"><em>the docs</em></a> for some more example queries.</p>
</div>
<div class="section" id="sorting-records">
<h3>Sorting records<a class="headerlink" href="#sorting-records" title="Permalink to this headline">¶</a></h3>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">Tweet</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">Tweet</span><span class="o">.</span><span class="n">created_date</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">t</span><span class="o">.</span><span class="n">pub_date</span>
<span class="gp">...</span>
<span class="go">2010-01-01 00:00:00</span>
<span class="go">2011-06-07 14:08:48</span>
<span class="go">2011-06-07 14:12:57</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">Tweet</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">Tweet</span><span class="o">.</span><span class="n">created_date</span><span class="o">.</span><span class="n">desc</span><span class="p">()):</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">t</span><span class="o">.</span><span class="n">pub_date</span>
<span class="gp">...</span>
<span class="go">2011-06-07 14:12:57</span>
<span class="go">2011-06-07 14:08:48</span>
<span class="go">2010-01-01 00:00:00</span>
</pre></div>
</div>
<p>You can also order across joins.  Assuming you want
to order tweets by the username of the author, then by created_date:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">qry</span> <span class="o">=</span> <span class="n">Tweet</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">Tweet</span><span class="o">.</span><span class="n">created_date</span><span class="o">.</span><span class="n">desc</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-sql"><div class="highlight"><pre><span class="c1">-- generates --</span>
<span class="k">SELECT</span> <span class="n">t1</span><span class="p">.</span><span class="ss">&quot;id&quot;</span><span class="p">,</span> <span class="n">t1</span><span class="p">.</span><span class="ss">&quot;user_id&quot;</span><span class="p">,</span> <span class="n">t1</span><span class="p">.</span><span class="ss">&quot;message&quot;</span><span class="p">,</span> <span class="n">t1</span><span class="p">.</span><span class="ss">&quot;is_published&quot;</span><span class="p">,</span> <span class="n">t1</span><span class="p">.</span><span class="ss">&quot;created_date&quot;</span>
<span class="k">FROM</span> <span class="ss">&quot;tweet&quot;</span> <span class="k">AS</span> <span class="n">t1</span> <span class="k">INNER</span> <span class="k">JOIN</span> <span class="ss">&quot;user&quot;</span> <span class="k">AS</span> <span class="n">t2</span> <span class="k">ON</span> <span class="n">t1</span><span class="p">.</span><span class="ss">&quot;user_id&quot;</span> <span class="o">=</span> <span class="n">t2</span><span class="p">.</span><span class="ss">&quot;id&quot;</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">t2</span><span class="p">.</span><span class="ss">&quot;username&quot;</span><span class="p">,</span> <span class="n">t1</span><span class="p">.</span><span class="ss">&quot;created_date&quot;</span> <span class="k">DESC</span>
</pre></div>
</div>
</div>
<div class="section" id="getting-random-records">
<h3>Getting random records<a class="headerlink" href="#getting-random-records" title="Permalink to this headline">¶</a></h3>
<p>Occasionally you may want to pull a random record from the database.  You can accomplish
this by ordering by the <tt class="docutils literal"><span class="pre">random</span></tt> or <tt class="docutils literal"><span class="pre">rand</span></tt> function:</p>
<p>Postgresql and Sqlite:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">LotteryNumber</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">Random</span><span class="p">())</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="c"># pick 5 lucky winners</span>
</pre></div>
</div>
<p>MySQL:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">LotterNumber</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">Rand</span><span class="p">())</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="c"># pick 5 lucky winners</span>
</pre></div>
</div>
</div>
<div class="section" id="paginating-records">
<h3>Paginating records<a class="headerlink" href="#paginating-records" title="Permalink to this headline">¶</a></h3>
<p>The paginate method makes it easy to grab a &#8220;page&#8221; or records &#8211; it takes two
parameters, <cite>page_number</cite>, and <cite>items_per_page</cite>. <cite>page_number</cite> is 1-based, so page 1 is the first page:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">Tweet</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">Tweet</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">paginate</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">tweet</span><span class="o">.</span><span class="n">message</span>
<span class="gp">...</span>
<span class="go">tweet 10</span>
<span class="go">tweet 11</span>
<span class="go">tweet 12</span>
<span class="go">tweet 13</span>
<span class="go">tweet 14</span>
<span class="go">tweet 15</span>
<span class="go">tweet 16</span>
<span class="go">tweet 17</span>
<span class="go">tweet 18</span>
<span class="go">tweet 19</span>
</pre></div>
</div>
</div>
<div class="section" id="counting-records">
<h3>Counting records<a class="headerlink" href="#counting-records" title="Permalink to this headline">¶</a></h3>
<p>You can count the number of rows in any select query:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Tweet</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="go">100</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Tweet</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Tweet</span><span class="o">.</span><span class="n">id</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="go">50</span>
</pre></div>
</div>
</div>
<div class="section" id="iterating-over-lots-of-rows">
<h3>Iterating over lots of rows<a class="headerlink" href="#iterating-over-lots-of-rows" title="Permalink to this headline">¶</a></h3>
<p>To limit the amount of memory used by peewee when iterating over a lot of rows (i.e.
you may be dumping data to csv), use the <tt class="docutils literal"><span class="pre">iterator()</span></tt> method on the <tt class="xref py py-class docutils literal"><span class="pre">QueryResultWrapper</span></tt>.
This method allows you to iterate without caching each model returned, using much less
memory when iterating over large result sets:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># let&#39;s assume we&#39;ve got 1M stat objects to dump to csv</span>
<span class="n">stats_qr</span> <span class="o">=</span> <span class="n">Stat</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

<span class="c"># our imaginary serializer class</span>
<span class="n">serializer</span> <span class="o">=</span> <span class="n">CSVSerializer</span><span class="p">()</span>

<span class="c"># loop over all the stats and serialize</span>
<span class="k">for</span> <span class="n">stat</span> <span class="ow">in</span> <span class="n">stats_qr</span><span class="o">.</span><span class="n">iterator</span><span class="p">():</span>
    <span class="n">serializer</span><span class="o">.</span><span class="n">serialize_object</span><span class="p">(</span><span class="n">stat</span><span class="p">)</span>
</pre></div>
</div>
<p>For simple queries you can see further speed improvements by using the <a class="reference internal" href="api.html#SelectQuery.naive" title="SelectQuery.naive"><tt class="xref py py-meth docutils literal"><span class="pre">SelectQuery.naive()</span></tt></a>
query method.  See the documentation for details on this optimization.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">stats_query</span> <span class="o">=</span> <span class="n">Stat</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">naive</span><span class="p">()</span> <span class="c"># note we are calling &quot;naive()&quot;</span>
<span class="n">stats_qr</span> <span class="o">=</span> <span class="n">stats_query</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

<span class="k">for</span> <span class="n">stat</span> <span class="ow">in</span> <span class="n">stats_qr</span><span class="o">.</span><span class="n">iterator</span><span class="p">():</span>
    <span class="n">serializer</span><span class="o">.</span><span class="n">serialize_object</span><span class="p">(</span><span class="n">stat</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="performing-atomic-updates">
<h3>Performing atomic updates<a class="headerlink" href="#performing-atomic-updates" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Stat</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">counter</span><span class="o">=</span><span class="n">Stat</span><span class="o">.</span><span class="n">counter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Stat</span><span class="o">.</span><span class="n">url</span> <span class="o">==</span> <span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="aggregating-records">
<h3>Aggregating records<a class="headerlink" href="#aggregating-records" title="Permalink to this headline">¶</a></h3>
<p>Suppose you have some users and want to get a list of them along with the count
of tweets in each.  First I will show you the shortcut:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">query</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">Tweet</span><span class="p">)</span>
</pre></div>
</div>
<p>This is equivalent to the following:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">query</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
    <span class="n">User</span><span class="p">,</span> <span class="n">fn</span><span class="o">.</span><span class="n">Count</span><span class="p">(</span><span class="n">Tweet</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s">&#39;count&#39;</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Tweet</span><span class="p">)</span><span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
</pre></div>
</div>
<p>The resulting query will return User objects with all their normal attributes
plus an additional attribute &#8216;count&#8217; which will contain the number of tweets.
By default it uses an inner join if the foreign key is not nullable, which means
blogs without entries won&#8217;t appear in the list.  To remedy this, manually specify
the type of join to include users with 0 tweets:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">query</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Tweet</span><span class="p">,</span> <span class="n">JOIN_LEFT_OUTER</span><span class="p">)</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">Tweet</span><span class="p">)</span>
</pre></div>
</div>
<p>You can also specify a custom aggregator:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">query</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">Tweet</span><span class="p">,</span> <span class="n">fn</span><span class="o">.</span><span class="n">Max</span><span class="p">(</span><span class="n">Tweet</span><span class="o">.</span><span class="n">created_date</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s">&#39;latest&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Let&#8217;s assume you have a tagging application and want to find tags that have a
certain number of related objects.  For this example we&#8217;ll use some different
models in a Many-To-Many configuration:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Photo</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Tag</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">PhotoTag</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">photo</span> <span class="o">=</span> <span class="n">ForeignKeyField</span><span class="p">(</span><span class="n">Photo</span><span class="p">)</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">ForeignKeyField</span><span class="p">(</span><span class="n">Tag</span><span class="p">)</span>
</pre></div>
</div>
<p>Now say we want to find tags that have at least 5 photos associated with them:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Tag</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PhotoTag</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Photo</span><span class="p">)</span><span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="n">Tag</span><span class="p">)</span><span class="o">.</span><span class="n">having</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">Count</span><span class="p">(</span><span class="n">Photo</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<p>Yields the following:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="n">t1</span><span class="p">.</span><span class="ss">&quot;id&quot;</span><span class="p">,</span> <span class="n">t1</span><span class="p">.</span><span class="ss">&quot;name&quot;</span>
<span class="k">FROM</span> <span class="ss">&quot;tag&quot;</span> <span class="k">AS</span> <span class="n">t1</span>
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="ss">&quot;phototag&quot;</span> <span class="k">AS</span> <span class="n">t2</span> <span class="k">ON</span> <span class="n">t1</span><span class="p">.</span><span class="ss">&quot;id&quot;</span> <span class="o">=</span> <span class="n">t2</span><span class="p">.</span><span class="ss">&quot;tag_id&quot;</span>
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="ss">&quot;photo&quot;</span> <span class="k">AS</span> <span class="n">t3</span> <span class="k">ON</span> <span class="n">t2</span><span class="p">.</span><span class="ss">&quot;photo_id&quot;</span> <span class="o">=</span> <span class="n">t3</span><span class="p">.</span><span class="ss">&quot;id&quot;</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">t1</span><span class="p">.</span><span class="ss">&quot;id&quot;</span><span class="p">,</span> <span class="n">t1</span><span class="p">.</span><span class="ss">&quot;name&quot;</span>
<span class="k">HAVING</span> <span class="k">Count</span><span class="p">(</span><span class="n">t3</span><span class="p">.</span><span class="ss">&quot;id&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span>
</pre></div>
</div>
<p>Suppose we want to grab the associated count and store it on the tag:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Tag</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">Tag</span><span class="p">,</span> <span class="n">fn</span><span class="o">.</span><span class="n">Count</span><span class="p">(</span><span class="n">Photo</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s">&#39;count&#39;</span><span class="p">)</span>
<span class="gp">... </span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PhotoTag</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Photo</span><span class="p">)</span><span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="n">Tag</span><span class="p">)</span><span class="o">.</span><span class="n">having</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">Count</span><span class="p">(</span><span class="n">Photo</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="retrieving-scalar-values">
<h3>Retrieving Scalar Values<a class="headerlink" href="#retrieving-scalar-values" title="Permalink to this headline">¶</a></h3>
<p>You can retrieve scalar values by calling <a class="reference internal" href="api.html#Query.scalar" title="Query.scalar"><tt class="xref py py-meth docutils literal"><span class="pre">Query.scalar()</span></tt></a>.  For instance:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">PageView</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">Count</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">Distinct</span><span class="p">(</span><span class="n">PageView</span><span class="o">.</span><span class="n">url</span><span class="p">)))</span><span class="o">.</span><span class="n">scalar</span><span class="p">()</span>
<span class="go">100 # &lt;-- there are 100 distinct URLs in the PageView table</span>
</pre></div>
</div>
<p>You can retrieve multiple scalar values by passing <tt class="docutils literal"><span class="pre">as_tuple=True</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Employee</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">fn</span><span class="o">.</span><span class="n">Min</span><span class="p">(</span><span class="n">Employee</span><span class="o">.</span><span class="n">salary</span><span class="p">),</span> <span class="n">fn</span><span class="o">.</span><span class="n">Max</span><span class="p">(</span><span class="n">Employee</span><span class="o">.</span><span class="n">salary</span><span class="p">)</span>
<span class="gp">... </span><span class="p">)</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span><span class="n">as_tuple</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="go">(30000, 50000)</span>
</pre></div>
</div>
</div>
<div class="section" id="sql-functions-subqueries-and-raw-expressions">
<h3>SQL Functions, Subqueries and &#8220;Raw expressions&#8221;<a class="headerlink" href="#sql-functions-subqueries-and-raw-expressions" title="Permalink to this headline">¶</a></h3>
<p>Suppose you need to want to get a list of all users whose username begins with &#8220;a&#8221;.
There are a couple ways to do this, but one method might be to use some SQL functions
like <tt class="docutils literal"><span class="pre">LOWER</span></tt> and <tt class="docutils literal"><span class="pre">SUBSTR</span></tt>.  To use arbitrary SQL functions, use the special <a class="reference internal" href="api.html#fn" title="fn"><tt class="xref py py-func docutils literal"><span class="pre">fn()</span></tt></a>
function to construct queries:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># select the users&#39; id, username and the first letter of their username, lower-cased</span>
<span class="n">query</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">fn</span><span class="o">.</span><span class="n">Lower</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">Substr</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s">&#39;first_letter&#39;</span><span class="p">))</span>

<span class="c"># alternatively we could select only users whose username begins with &#39;a&#39;</span>
<span class="n">a_users</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">Lower</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">Substr</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">==</span> <span class="s">&#39;a&#39;</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">a_users</span><span class="p">:</span>
<span class="o">...</span>    <span class="k">print</span> <span class="n">user</span><span class="o">.</span><span class="n">username</span>
</pre></div>
</div>
<p>There are times when you may want to simply pass in some arbitrary sql.  You can do
this using the special <a class="reference internal" href="api.html#SQL" title="SQL"><tt class="xref py py-class docutils literal"><span class="pre">SQL</span></tt></a> class.  One use-case is when referencing an
alias:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># we&#39;ll query the user table and annotate it with a count of tweets for</span>
<span class="c"># the given user</span>
<span class="n">query</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">fn</span><span class="o">.</span><span class="n">Count</span><span class="p">(</span><span class="n">Tweet</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s">&#39;ct&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Tweet</span><span class="p">)</span><span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>

<span class="c"># now we will order by the count, which was aliased to &quot;ct&quot;</span>
<span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">SQL</span><span class="p">(</span><span class="s">&#39;ct&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>To execute custom SQL, please refer to <a class="reference internal" href="querying.html#using-sql"><em>Writing queries by hand with SQL</em></a>.</p>
</div>
<div class="section" id="retrieving-raw-tuples-dictionaries">
<h3>Retrieving raw tuples / dictionaries<a class="headerlink" href="#retrieving-raw-tuples-dictionaries" title="Permalink to this headline">¶</a></h3>
<p>Sometimes you do not need the overhead of creating model instances and simply want
to iterate over the row tuples.  To do this, call <a class="reference internal" href="api.html#SelectQuery.tuples" title="SelectQuery.tuples"><tt class="xref py py-meth docutils literal"><span class="pre">SelectQuery.tuples()</span></tt></a> or
<a class="reference internal" href="api.html#RawQuery.tuples" title="RawQuery.tuples"><tt class="xref py py-meth docutils literal"><span class="pre">RawQuery.tuples()</span></tt></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">stats</span> <span class="o">=</span> <span class="n">Stat</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">Stat</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">fn</span><span class="o">.</span><span class="n">Count</span><span class="p">(</span><span class="n">Stat</span><span class="o">.</span><span class="n">url</span><span class="p">))</span><span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="n">Stat</span><span class="o">.</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">tuples</span><span class="p">()</span>

<span class="c"># iterate over a list of 2-tuples containing the url and count</span>
<span class="k">for</span> <span class="n">stat_url</span><span class="p">,</span> <span class="n">stat_count</span> <span class="ow">in</span> <span class="n">stats</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">stat_url</span><span class="p">,</span> <span class="n">stat_count</span>
</pre></div>
</div>
<p>Similarly, you can return the rows from the cursor as dictionaries using <a class="reference internal" href="api.html#SelectQuery.dicts" title="SelectQuery.dicts"><tt class="xref py py-meth docutils literal"><span class="pre">SelectQuery.dicts()</span></tt></a>
or <a class="reference internal" href="api.html#RawQuery.dicts" title="RawQuery.dicts"><tt class="xref py py-meth docutils literal"><span class="pre">RawQuery.dicts()</span></tt></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">stats</span> <span class="o">=</span> <span class="n">Stat</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">Stat</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">fn</span><span class="o">.</span><span class="n">Count</span><span class="p">(</span><span class="n">Stat</span><span class="o">.</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s">&#39;ct&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="n">Stat</span><span class="o">.</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">dicts</span><span class="p">()</span>

<span class="c"># iterate over a list of 2-tuples containing the url and count</span>
<span class="k">for</span> <span class="n">stat</span> <span class="ow">in</span> <span class="n">stats</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">stat</span><span class="p">[</span><span class="s">&#39;url&#39;</span><span class="p">],</span> <span class="n">stat</span><span class="p">[</span><span class="s">&#39;ct&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="working-with-transactions">
<span id="id2"></span><h2>Working with transactions<a class="headerlink" href="#working-with-transactions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="context-manager">
<h3>Context manager<a class="headerlink" href="#context-manager" title="Permalink to this headline">¶</a></h3>
<p>You can execute queries within a transaction using the <tt class="docutils literal"><span class="pre">transaction</span></tt> context manager,
which will issue a commit if all goes well, or a rollback if an exception is raised:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">db</span> <span class="o">=</span> <span class="n">SqliteDatabase</span><span class="p">(</span><span class="s">&#39;:memory:&#39;</span><span class="p">)</span>

<span class="k">with</span> <span class="n">db</span><span class="o">.</span><span class="n">transaction</span><span class="p">():</span>
    <span class="n">user</span><span class="o">.</span><span class="n">delete_instance</span><span class="p">(</span><span class="n">recursive</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c"># delete user and associated tweets</span>
</pre></div>
</div>
</div>
<div class="section" id="decorator">
<h3>Decorator<a class="headerlink" href="#decorator" title="Permalink to this headline">¶</a></h3>
<p>Similar to the context manager, you can decorate functions with the <tt class="docutils literal"><span class="pre">commit_on_success</span></tt>
decorator:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">db</span> <span class="o">=</span> <span class="n">SqliteDatabase</span><span class="p">(</span><span class="s">&#39;:memory:&#39;</span><span class="p">)</span>

<span class="nd">@db.commit_on_success</span>
<span class="k">def</span> <span class="nf">delete_user</span><span class="p">(</span><span class="n">user</span><span class="p">):</span>
    <span class="n">user</span><span class="o">.</span><span class="n">delete_instance</span><span class="p">(</span><span class="n">recursive</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="changing-autocommit-behavior">
<h3>Changing autocommit behavior<a class="headerlink" href="#changing-autocommit-behavior" title="Permalink to this headline">¶</a></h3>
<p>By default, databases are initialized with <tt class="docutils literal"><span class="pre">autocommit=True</span></tt>, you can turn this
on and off at runtime if you like.  The behavior below is roughly the same as the
context manager and decorator:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">db</span><span class="o">.</span><span class="n">set_autocommit</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">user</span><span class="o">.</span><span class="n">delete_instance</span><span class="p">(</span><span class="n">recursive</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">db</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
    <span class="k">raise</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">db</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
        <span class="k">raise</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="n">db</span><span class="o">.</span><span class="n">set_autocommit</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>If you would like to manually control <em>every</em> transaction, simply turn autocommit
off when instantiating your database:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">db</span> <span class="o">=</span> <span class="n">SqliteDatabase</span><span class="p">(</span><span class="s">&#39;:memory:&#39;</span><span class="p">,</span> <span class="n">autocommit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">User</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;somebody&#39;</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="non-integer-primary-keys-composite-keys-and-other-tricks">
<span id="non-integer-primary-keys"></span><h2>Non-integer Primary Keys, Composite Keys and other Tricks<a class="headerlink" href="#non-integer-primary-keys-composite-keys-and-other-tricks" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id3">
<h3>Non-integer primary keys<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>If you would like use a non-integer primary key (which I generally don&#8217;t recommend),
you can specify <tt class="docutils literal"><span class="pre">primary_key=True</span></tt>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">peewee</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">class</span> <span class="nc">UUIDModel</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>


<span class="n">inst</span> <span class="o">=</span> <span class="n">UUIDModel</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()))</span>
<span class="n">inst</span><span class="o">.</span><span class="n">save</span><span class="p">()</span> <span class="c"># &lt;-- WRONG!!  this will try to do an update</span>

<span class="n">inst</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">force_insert</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c"># &lt;-- CORRECT</span>

<span class="c"># to update the instance after it has been saved once</span>
<span class="n">inst</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Any foreign keys to a model with a non-integer primary key will have the
<tt class="docutils literal"><span class="pre">ForeignKeyField</span></tt> use the same underlying storage type as the primary key
they are related to.</p>
</div>
<p>See full documentation on <a class="reference internal" href="models.html#non-int-pks"><em>non-integer primary keys</em></a>.</p>
</div>
<div class="section" id="composite-primary-keys">
<h3>Composite primary keys<a class="headerlink" href="#composite-primary-keys" title="Permalink to this headline">¶</a></h3>
<p>Peewee has very basic support for composite keys.  In order to use a composite
key, you must set the <tt class="docutils literal"><span class="pre">primary_key</span></tt> attribute of the model options to a
<a class="reference internal" href="api.html#CompositeKey" title="CompositeKey"><tt class="xref py py-class docutils literal"><span class="pre">CompositeKey</span></tt></a> instance:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">BlogToTag</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A simple &quot;through&quot; table for many-to-many relationship.&quot;&quot;&quot;</span>
    <span class="n">blog</span> <span class="o">=</span> <span class="n">ForeignKeyField</span><span class="p">(</span><span class="n">Blog</span><span class="p">)</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">ForeignKeyField</span><span class="p">(</span><span class="n">Tag</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">primary_key</span> <span class="o">=</span> <span class="n">CompositeKey</span><span class="p">(</span><span class="s">&#39;blog&#39;</span><span class="p">,</span> <span class="s">&#39;tag&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="bulk-inserts">
<h3>Bulk inserts<a class="headerlink" href="#bulk-inserts" title="Permalink to this headline">¶</a></h3>
<p>There are a couple of ways you can load lots of data quickly. Let&#8217;s look at the
various options:</p>
<p>The naive approach is to simply call <a class="reference internal" href="api.html#Model.create" title="Model.create"><tt class="xref py py-meth docutils literal"><span class="pre">Model.create()</span></tt></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">data_dict</span> <span class="ow">in</span> <span class="n">data_source</span><span class="p">:</span>
    <span class="n">Model</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">data_dict</span><span class="p">)</span>
</pre></div>
</div>
<p>The above approach is slow for a couple of reasons:</p>
<ol class="arabic simple">
<li>If you are using autocommit (the default), then each call to <tt class="docutils literal"><span class="pre">create</span></tt>
happens in its own transaction. That is going to be slow!</li>
<li>There is a decent amount of Python logic getting in your way, and each
<a class="reference internal" href="api.html#InsertQuery" title="InsertQuery"><tt class="xref py py-class docutils literal"><span class="pre">InsertQuery</span></tt></a> must be generated and parsed into SQL.</li>
<li>That&#8217;s a lot of data (in terms of raw bytes) you are sending to your database
to parse.</li>
<li>We are retrieving the &#8220;last insert ID&#8221;, which causes an additional query to
be executed in some cases.</li>
</ol>
<p>You can get a <em>very significant</em> speedup by simply wrapping this in a transaction.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># This is much faster.</span>
<span class="k">with</span> <span class="n">db</span><span class="o">.</span><span class="n">transaction</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">data_dict</span> <span class="ow">in</span> <span class="n">data_source</span><span class="p">:</span>
        <span class="n">Model</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">data_dict</span><span class="p">)</span>
</pre></div>
</div>
<p>The above code still suffers from points 2, 3 and 4. We can get another big
boost by calling <a class="reference internal" href="api.html#Model.insert_many" title="Model.insert_many"><tt class="xref py py-meth docutils literal"><span class="pre">Model.insert_many()</span></tt></a>. This method accepts a list of
dictionaries to insert.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Fastest.</span>
<span class="k">with</span> <span class="n">db</span><span class="o">.</span><span class="n">transaction</span><span class="p">():</span>
    <span class="n">Model</span><span class="o">.</span><span class="n">insert_many</span><span class="p">(</span><span class="n">data_source</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</pre></div>
</div>
<p>Depending on the number of rows in your data source, you may need to break it
up into chunks:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Insert rows 1000 at a time.</span>
<span class="k">with</span> <span class="n">db</span><span class="o">.</span><span class="n">transaction</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_source</span><span class="p">),</span> <span class="mi">1000</span><span class="p">):</span>
        <span class="n">Model</span><span class="o">.</span><span class="n">insert_many</span><span class="p">(</span><span class="n">data_source</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1000</span><span class="p">])</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="manually-specifying-primary-keys">
<h3>Manually specifying primary keys<a class="headerlink" href="#manually-specifying-primary-keys" title="Permalink to this headline">¶</a></h3>
<p>Sometimes you do not want the database to automatically generate a primary key,
for instance when bulk loading relational data.  To handle this on a &#8220;one-off&#8221;
basis, you can simply tell peewee to turn off <tt class="docutils literal"><span class="pre">auto_increment</span></tt> during the
import:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">data</span> <span class="o">=</span> <span class="n">load_user_csv</span><span class="p">()</span> <span class="c"># load up a bunch of data</span>

<span class="n">User</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">auto_increment</span> <span class="o">=</span> <span class="bp">False</span> <span class="c"># turn off auto incrementing IDs</span>
<span class="k">with</span> <span class="n">db</span><span class="o">.</span><span class="n">transaction</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">username</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">u</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">force_insert</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c"># &lt;-- force peewee to insert row</span>

<span class="n">User</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">auto_increment</span> <span class="o">=</span> <span class="bp">True</span>
</pre></div>
</div>
<p>If you <em>always</em> want to have control over the primary key, simply do not use
the <tt class="docutils literal"><span class="pre">PrimaryKeyField</span></tt> type:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">IntegerField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">u</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">999</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="s">&#39;somebody&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">u</span><span class="o">.</span><span class="n">id</span>
<span class="mi">999</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">User</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span> <span class="o">==</span> <span class="s">&#39;somebody&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">id</span>
<span class="mi">999</span>
</pre></div>
</div>
</div>
<div class="section" id="self-referential-foreign-keys">
<h3>Self-referential foreign keys<a class="headerlink" href="#self-referential-foreign-keys" title="Permalink to this headline">¶</a></h3>
<p>When creating a heirarchical structure it is necessary to create a self-referential
foreign key which links a child object to its parent.  Because the model class is not
defined at the time you instantiate the self-referential foreign key, use the special
string <tt class="docutils literal"><span class="pre">'self'</span></tt> to indicate a self-referential foreign key:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Category</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>
    <span class="n">parent</span> <span class="o">=</span> <span class="n">ForeignKeyField</span><span class="p">(</span><span class="s">&#39;self&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">&#39;children&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>As you can see, the foreign key points &#8220;upward&#8221; to the parent object and the
back-reference is named &#8220;children&#8221;.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Self-referential foreign-keys should always be <tt class="docutils literal"><span class="pre">null=True</span></tt>.</p>
</div>
</div>
<div class="section" id="circular-foreign-key-dependencies">
<h3>Circular foreign key dependencies<a class="headerlink" href="#circular-foreign-key-dependencies" title="Permalink to this headline">¶</a></h3>
<p>Sometimes it happens that you will create a circular dependency between two
tables.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">My personal opinion is that circular foreign keys are a code smell and should
be refactored (by adding an intermediary table, for instance).</p>
</div>
<p>Adding circular foreign keys with peewee is a bit tricky because at the time you
are defining either foreign key, the model it points to will not have been defined
yet, causing a <tt class="docutils literal"><span class="pre">NameError</span></tt>.</p>
<p>By using <a class="reference internal" href="api.html#Proxy" title="Proxy"><tt class="xref py py-class docutils literal"><span class="pre">Proxy</span></tt></a> we can get around the problem, though:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Create a proxy object to stand in for our as-yet-undefined Tweet model.</span>
<span class="n">TweetProxy</span> <span class="o">=</span> <span class="n">Proxy</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>
    <span class="c"># Tweet has not been defined yet so use the proxy.</span>
    <span class="n">favorite_tweet</span> <span class="o">=</span> <span class="n">ForeignKeyField</span><span class="p">(</span><span class="n">TweetProxy</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Tweet</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">message</span> <span class="o">=</span> <span class="n">TextField</span><span class="p">()</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">ForeignKeyField</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">&#39;tweets&#39;</span><span class="p">)</span>

<span class="c"># Now that Tweet is defined, we can initialize the proxy object.</span>
<span class="n">TweetProxy</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="n">Tweet</span><span class="p">)</span>
</pre></div>
</div>
<p>After initializing the proxy the foreign key fields are now correctly set up.
There is one more quirk to watch out for, though.  When you call <a class="reference internal" href="api.html#Model.create_table" title="Model.create_table"><tt class="xref py py-class docutils literal"><span class="pre">create_table</span></tt></a>
we will again encounter the same issue.  For this reason peewee will not automatically
create a foreign key constraint for any &#8220;deferred&#8221; foreign keys.</p>
<p>Here is how to create the tables:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Foreign key constraint from User -&gt; Tweet will NOT be created because the</span>
<span class="c"># Tweet table does not exist yet. `favorite_tweet` will just be a regular</span>
<span class="c"># integer field:</span>
<span class="n">User</span><span class="o">.</span><span class="n">create_table</span><span class="p">()</span>

<span class="c"># Foreign key constraint from Tweet -&gt; User will be created normally.</span>
<span class="n">Tweet</span><span class="o">.</span><span class="n">create_table</span><span class="p">()</span>

<span class="c"># Now that both tables exist, we can create the foreign key from User -&gt; Tweet:</span>
<span class="n">db</span><span class="o">.</span><span class="n">create_foreign_key</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">User</span><span class="o">.</span><span class="n">favorite_tweet</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="introspecting-databases">
<h2>Introspecting databases<a class="headerlink" href="#introspecting-databases" title="Permalink to this headline">¶</a></h2>
<p>If you&#8217;d like to generate some models for an existing database, you can try
out the database introspection tool &#8220;pwiz&#8221; that comes with peewee.</p>
<p>Usage:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">python pwiz.py my_postgresql_database</span>
</pre></div>
</div>
<p>It works with postgresql, mysql and sqlite:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">python pwiz.py test.db --engine=sqlite</span>
</pre></div>
</div>
<p>pwiz will generate code for:</p>
<ul class="simple">
<li>database connection object</li>
<li>a base model class to use this connection</li>
<li>models that were introspected from the database tables</li>
</ul>
<p>The generated code is written to stdout.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">pwiz is <strong>not</strong> a fully-automatic model generator. You may need to go
back through, add indexes, fix unknown column types, and resolve any
circular references.</p>
</div>
</div>
<div class="section" id="schema-migrations">
<h2>Schema migrations<a class="headerlink" href="#schema-migrations" title="Permalink to this headline">¶</a></h2>
<p>Currently peewee does not have support for automatic schema migrations.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Peewee Cookbook</a><ul>
<li><a class="reference internal" href="#database-and-connection-recipes">Database and Connection Recipes</a><ul>
<li><a class="reference internal" href="#creating-a-database-connection-and-tables">Creating a database connection and tables</a></li>
<li><a class="reference internal" href="#using-with-postgresql">Using with Postgresql</a></li>
<li><a class="reference internal" href="#using-with-mysql">Using with MySQL</a></li>
<li><a class="reference internal" href="#using-with-sqlite">Using with SQLite</a></li>
<li><a class="reference internal" href="#multi-threaded-applications">Multi-threaded applications</a></li>
<li><a class="reference internal" href="#deferring-initialization">Deferring initialization</a></li>
<li><a class="reference internal" href="#dynamically-defining-a-database">Dynamically defining a database</a></li>
<li><a class="reference internal" href="#logging-queries">Logging queries</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creating-reading-updating-and-deleting">Creating, Reading, Updating and Deleting</a><ul>
<li><a class="reference internal" href="#creating-a-new-record">Creating a new record</a></li>
<li><a class="reference internal" href="#updating-existing-records">Updating existing records</a></li>
<li><a class="reference internal" href="#deleting-a-record">Deleting a record</a></li>
<li><a class="reference internal" href="#selecting-a-single-record">Selecting a single record</a></li>
<li><a class="reference internal" href="#selecting-multiple-records">Selecting multiple records</a></li>
<li><a class="reference internal" href="#filtering-records">Filtering records</a></li>
<li><a class="reference internal" href="#sorting-records">Sorting records</a></li>
<li><a class="reference internal" href="#getting-random-records">Getting random records</a></li>
<li><a class="reference internal" href="#paginating-records">Paginating records</a></li>
<li><a class="reference internal" href="#counting-records">Counting records</a></li>
<li><a class="reference internal" href="#iterating-over-lots-of-rows">Iterating over lots of rows</a></li>
<li><a class="reference internal" href="#performing-atomic-updates">Performing atomic updates</a></li>
<li><a class="reference internal" href="#aggregating-records">Aggregating records</a></li>
<li><a class="reference internal" href="#retrieving-scalar-values">Retrieving Scalar Values</a></li>
<li><a class="reference internal" href="#sql-functions-subqueries-and-raw-expressions">SQL Functions, Subqueries and &#8220;Raw expressions&#8221;</a></li>
<li><a class="reference internal" href="#retrieving-raw-tuples-dictionaries">Retrieving raw tuples / dictionaries</a></li>
</ul>
</li>
<li><a class="reference internal" href="#working-with-transactions">Working with transactions</a><ul>
<li><a class="reference internal" href="#context-manager">Context manager</a></li>
<li><a class="reference internal" href="#decorator">Decorator</a></li>
<li><a class="reference internal" href="#changing-autocommit-behavior">Changing autocommit behavior</a></li>
</ul>
</li>
<li><a class="reference internal" href="#non-integer-primary-keys-composite-keys-and-other-tricks">Non-integer Primary Keys, Composite Keys and other Tricks</a><ul>
<li><a class="reference internal" href="#id3">Non-integer primary keys</a></li>
<li><a class="reference internal" href="#composite-primary-keys">Composite primary keys</a></li>
<li><a class="reference internal" href="#bulk-inserts">Bulk inserts</a></li>
<li><a class="reference internal" href="#manually-specifying-primary-keys">Manually specifying primary keys</a></li>
<li><a class="reference internal" href="#self-referential-foreign-keys">Self-referential foreign keys</a></li>
<li><a class="reference internal" href="#circular-foreign-key-dependencies">Circular foreign key dependencies</a></li>
</ul>
</li>
<li><a class="reference internal" href="#introspecting-databases">Introspecting databases</a></li>
<li><a class="reference internal" href="#schema-migrations">Schema migrations</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="example.html"
                        title="previous chapter">Example app</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="models.html"
                        title="next chapter">Model and Fields</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/peewee/cookbook.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="models.html" title="Model and Fields"
             >next</a> |</li>
        <li class="right" >
          <a href="example.html" title="Example app"
             >previous</a> |</li>
        <li><a href="../index.html">peewee 2.2.3 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright charles leifer.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>