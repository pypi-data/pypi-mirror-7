// Copyright (c) 2011-2012,2014 Turbulenz Limited
/*global Backbone*//*global Templates*//*global PluginDetection*//*global window*//*jshint nomen: false*//*global _*//*global $*//*jshint nomen: true*//*exported LocalMessageView*/function hideMessage(e,t,n){$(e).fadeOut("slow"),t&&$.cookie(t,n,{expires:100,path:"/"})}var LocalMessageView=Backbone.View.extend({initialize:function(e){return this.app=this.options.app,this.engineVersionTemplate=Templates.local_message_engine_version_template,this.sdkTemplate=Templates.local_message_sdk_template,this.hostTemplate=Templates.local_message_host_template,this.pluginTemplate=Templates.local_message_plugin_template,this.missingPluginTemplate=Templates.local_message_missing_plugin_template,this.engine=e.engine,this.sdk=e.sdk,_.bindAll(this,"render"),this},checkEngineVersion:function(){var e=PluginDetection.getPlugins();if(e.turbulenz.supported)try{var t=e.turbulenz.version,n=this.engine.newest;PluginDetection.newerVersion(n,t)&&$.cookie("skip_engine_version")!==n&&($(".messages").jqoteapp(this.engineVersionTemplate,{engine:this.engine}),$("#skip-engine-link").bind("click",function(){hideMessage(".engine_version","skip_engine_version",n)}),$(".engine_version").fadeIn("slow"))}catch(r){$(".message").html('<span class="error">'+r+"</span>")}},checkPlugin:function(){var e=PluginDetection.getPlugins();if(e.turbulenz.supported)if(this.engine){var t=this.engine.newest;$.cookie("skip_engine_version")!==t&&($(".messages").jqoteapp(this.pluginTemplate,{engine:this.engine}),$("#skip-engine-link").bind("click",function(){hideMessage(".plugin","skip_engine_version",t)}),$(".plugin").fadeIn("slow"))}else $(".messages").jqoteapp(this.missingPluginTemplate),$("#skip-engine-link").bind("click",function(){hideMessage(".plugin")}),$(".plugin").fadeIn("slow")},checkSDK:function(){var e=this.sdk.newest,t=this.sdk.current;t&&PluginDetection.newerVersion(e,t)&&$.cookie("skip_sdk_version")!==e&&($(".messages").jqoteapp(this.sdkTemplate,{sdk:this.sdk}),$("#skip-sdk-link").bind("click",function(){hideMessage(".sdk","skip_sdk_version",e)}),$(".sdk").fadeIn("slow"))},checkHost:function(){var e=PluginDetection.getPlatform();e==="Windows"&&window.location.href.indexOf("http://localhost:8070/")>=0&&$.cookie("skip-local-link")!=="true"&&($(".messages").jqoteapp(this.hostTemplate),$("#local-link").bind("click",function(){$("#local-link").attr("href","http://127.0.0.1:8070/"+document.location.hash)}),$("#skip-local-link").bind("click",function(){hideMessage(".WinOS","skip-local-link",!0)}),$(".WinOS").fadeIn("slow"))},render:function(){return this.checkEngineVersion(),this.checkSDK(),this.checkHost(),this.checkPlugin(),this}});