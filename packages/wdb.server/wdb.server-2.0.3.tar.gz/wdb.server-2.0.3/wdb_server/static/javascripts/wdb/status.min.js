/*! wdb           2014-05-13 */

(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};a=function(){function a(){this.debug=$("body").attr("data-debug")||!1}return a.prototype.log=function(){var a,b;return this.debug?(b="["+this.constructor.name+"]",a=[b].concat(Array.prototype.slice.call(arguments,0)),console.log.apply(console,a)):void 0},a.prototype.fail=function(){var a,b;return b=this.constructor.name,a=[b].concat(Array.prototype.slice.call(arguments,0)),console.error.apply(console,a)},a}(),l=null,k=25,g=function(a,b){var c;return(c=$(".sessions tr[data-uuid="+a+"]")).size()||(c=$('<tr data-uuid="'+a+'"> <td class="uuid"><a href="/debug/session/'+a+'">'+a+'</a></td> <td class="socket">No</td> <td class="websocket">No</td> <td class="close"> <a class="fa fa-times-circle remove" title="Force close"></a> </td>'),$(".sessions tbody").append(c)),c.find("."+b).text("Yes")},j=function(a,b){var c;if((c=$(".sessions tr[data-uuid="+a+"]")).size())return"socket"===b&&"No"===c.find(".websocket").text()||"websocket"===b&&"No"===c.find(".socket").text()?c.remove():c.find("."+b).text("No")},d=function(a){var b,c,d,e,f;for(c="<tr>",f=["fn","lno","cond","fun"],d=0,e=f.length;e>d;d++)b=f[d],c+='<td class="'+b+'">'+(a[b]||"∅")+"</td>";return c+='<td class="action"> <a class="fa fa-folder-open open" title="Open"></a> <a class="fa fa-minus-circle remove" title="Remove"></a> </td>',c+="</tr>",$(".breakpoints tbody").append($(c))},i=function(a){var b,c,d,e,f,g,h,i,j,k,l;for(j=$(".breakpoints tr"),l=[],f=0,h=j.length;h>f;f++){for(e=j[f],b=$(e),d=!0,k=["fn","lno","cond","fun"],g=0,i=k.length;i>g;g++)c=k[g],d=d&&b.find("."+c).text()===""+(a[c]||"∅");l.push(d?b.remove():void 0)}return l},c=function(a,b){var c,d,e,f,g,h,i;if(f=a[b],null==f)return"∅";if("time"===b)e=function(a){var b,c;return c=Math.floor((new Date-a)/1e3),b=Math.floor(c/31536e3),b>1?b+"y":(b=Math.floor(c/2592e3),b>1?b+"mo":(b=Math.floor(c/86400),b>1?b+"d":(b=Math.floor(c/3600),b>1?b+"h":(b=Math.floor(c/60),b>1?b+"m":Math.floor(c)+"s"))))},f=e(1e3*f);else if("mem"===b||"cpu"===b)f=f.toFixed(2)+"%";else if("cmd"===b){for(d=[],i=f.split(" "),g=0,h=i.length;h>g;g++)c=i[g],d.push(0===c.indexOf("/")?'<abbr title="'+c+'">'+c.split("/").slice(-1)+"</abbr>":1===c.indexOf(":")&&2===c.indexOf("\\")?'<abbr title="'+c+'"> '+c.slice(3).split("\\").slice(-1)+"</abbr>":c);f=d.join(" ")}return f},e=function(a){var b,d,e,f,g,h,i,j,k,l;if((b=$(".processes tbody tr[data-pid="+a.pid+"]")).size()){for(j=["pid","user","cmd","time","mem","cpu"],l=[],f=0,h=j.length;h>f;f++)d=j[f],l.push(b.find("."+d).html(c(a,d)));return l}for(e='<tr data-pid="'+a.pid+'" '+(a.threadof?'data-threadof="'+a.threadof+'"':"")+">",k=["pid","user","cmd","time","mem","cpu"],g=0,i=k.length;i>g;g++)d=k[g],e+='<td class="rowspan '+d+'"> '+c(a,d)+"</td>";return e+='<td class="action"><a href="" class="fa fa-minus minus" title="Toggle threads"></a></td>',e+='<td class="action">',e+='<a href="" class="fa fa-pause pause" title="Pause"></a> ',e+="</td>",e+="</tr>",$(".processes tbody").append($(e))},f=function(a){var b,d,e,f,g,h,i,j,k;if(d=$(".processes tbody tr[data-pid="+a.of+"]"),d.size()){if((e=$(".processes tbody tr[data-tid="+a.id+"]")).size()){for(j=["id","of"],k=[],h=0,i=j.length;i>h;h++)f=j[h],k.push(e.find("."+f).text(c(a,f)));return k}return g='<tr data-tid="'+a.id+'" data-of="'+a.of+'">',g+='<td class="id">'+c(a,"id")+"</td>",g+='<td class="action">',g+='<a href="" class="fa fa-pause pause" title="Pause"></a> ',g+="</td>",g+="</tr>",b=d.nextAll("[data-pid]"),b.size()?b.before(g):$(".processes tbody").append(g),d.find(".rowspan").attr("rowspan",(+d.find(".rowspan").attr("rowspan")||1)+1)}},m=function(a){var b,c,h,m,o,p,q,r,s,t,u,v,w,x,y,z,A;switch(k=25,o=a.data,p=o.indexOf("|"),p>-1?(h=o.substr(0,p),m=JSON.parse(o.substr(p+1))):(h=o,m=""),h){case"AddWebSocket":return g(m,"websocket");case"AddSocket":return g(m,"socket");case"RemoveWebSocket":return j(m,"websocket");case"RemoveSocket":return j(m,"socket");case"AddBreak":return d(m);case"RemoveBreak":return i(m);case"AddProcess":return e(m);case"AddThread":return f(m);case"KeepProcess":for(v=$(".processes tbody tr[data-pid]"),z=[],r=0,t=v.length;t>r;r++)q=v[r],c=$(q),w=parseInt(c.attr("data-pid")),n.call(m,w)<0?($(".processes [data-of="+c.attr("data-pid")+"]").remove(),z.push(c.remove())):z.push(void 0);return z;case"KeepProcess":for(x=$(".processes tbody tr[data-tid]"),A=[],s=0,u=x.length;u>s;s++)q=x[s],c=$(q),y=parseInt(c.attr("data-tid")),n.call(m,y)<0?(c.remove(),b=$(".processes [data-pid="+c.attr("data-of")+"]"),A.push(b.attr("rowspan",+b.attr("rowspan")-1))):A.push(void 0);return A;case"StartLoop":return setInterval(function(){return l.send("ListProcesses")},2e3)}},b=function(){return l=new WebSocket("ws://"+location.host+"/status"),l.onopen=function(){return console.log("WebSocket open",arguments),$("tbody tr").remove(),l.send("ListSockets"),l.send("ListWebSockets"),l.send("ListBreaks"),l.send("ListProcesses")},l.onerror=function(){return console.log("WebSocket error",arguments)},l.onmessage=m,l.onclose=function(){return console.log("WebSocket closed",arguments),k*=2,setTimeout(b,k)}},h=function(a){return"∅"===a?null:a},$(function(){return b(),$(".sessions tbody").on("click",".remove",function(){return l.send("RemoveUUID|"+$(this).closest("tr").attr("data-uuid")),!1}),$(".breakpoints tbody").on("click",".open",function(){var a;return a=$(this).closest("tr"),l.send("RunFile|"+a.find(".fn").text()),!1}),$(".breakpoints tbody").on("click",".remove",function(){var a,b;return a=$(this).closest("tr"),b={fn:a.find(".fn").text(),lno:parseInt(a.find(".lno").text()),cond:h(a.find(".cond").text()),fun:h(a.find(".fun").text())},l.send("RemoveBreak|"+JSON.stringify(b)),!1}),$(".processes tbody").on("click",".pause",function(){var a;return a=$(this).closest("tr"),l.send("Pause|"+(a.attr("data-pid")||a.attr("data-tid"))),!1}).on("click",".minus",function(){var a,b;return a=$(this),b=a.closest("tr"),$("[data-of="+b.attr("data-pid")+"]").hide(),b.find(".rowspan").attr("rowspan",1),a.attr("class",a.attr("class").replace(/minus/g,"plus")),!1}).on("click",".plus",function(){var a,b,c;return a=$(this),b=a.closest("tr"),c=$("[data-of="+b.attr("data-pid")+"]").show().size(),b.find(".rowspan").attr("rowspan",c+1),a.attr("class",a.attr("class").replace(/plus/g,"minus")),!1}),$(".runfile").on("submit",function(){return l.send("RunFile|"+$(this).find("[type=text]").val()),!1})})}).call(this);
//# sourceMappingURL=status.min.map