<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="esdrt.content">
<body>


  <metal:js fill-slot="javascript_head_slot">
      <script type="text/javascript">
      $(document).ready(function(){

        $('.addfile').prepOverlay(
        {
            subtype: 'ajax',
            filter: common_content_filter,
            formselector: '#edit',
            noform: function(el) {return $.plonepopups.noformerrorshow(el, 'redirect');},
            redirect: $.plonepopups.redirectbasehref,
            closeselector: '[name="form.button.Cancel"]',
            width:'50%'
        }
      );

        });

      </script>
    </metal:js>

<metal:main fill-slot="content-core">
  <metal:content-core define-macro="content-core"
    tal:define="observation view/observation;
                context nocall:observation">
    <div class="backButton">
      <a
        tal:attributes="href observation/absolute_url"
          class="standardButton">
          <span class="eea-icon"><!-- --></span>
            Back to observation
      </a>
    </div>
    <metal:obs use-macro="context/@@view/macros/observation-info" />


  </metal:content-core>

  <div id="qa" class="eea-tabs-panels" tal:define="toLocalizedTime nocall:here/@@plone/toLocalizedTime">
    <span
      class="questionTitle"
      tal:content="context/title">Question X</span>

      <div class="esdDiv action-comments"
          tal:define="info view/wf_info;
                      status context/get_status"
          tal:condition="python:status in ['draft']">
        <div class="esdLabel">Counterpart comments</div>
          <p>
            <span class="author" tal:content="python:view.get_user_name(info.get('actor', ''))" />
            <span class="datetime" tal:content="python:toLocalizedTime(info.get('time', ''))" />
            <span class="comment" tal:content="info/comments|nothing" />
          </p>
      </div>


    <div class="question" tal:repeat="question context/get_questions"
          tal:attributes="id question/getId;
                          class string:question ${question/portal_type/lower};
          ">
      <tal:block tal:define="portalType question/portal_type/lower"
        tal:condition="python:portalType == 'comment'">
        <div class="arrow-right-border"></div>
        <div class="arrow-right"></div>
      </tal:block>
      <tal:block tal:define="portalType question/portal_type/lower"
        tal:condition="python:portalType == 'commentanswer'">
        <div class="arrow-left-border"></div>
        <div class="arrow-left"></div>
      </tal:block>
      <div class="from">
        <span class="esdLabel">from</span>
        <span class="value" tal:content="python:view.get_user_name(question.Creator(), question)">John Smith</span>
        <span class="messageDate">
          <tal:effective condition="question/effective_date">
            Sent on: <span tal:content="python:toLocalizedTime(question.EffectiveDate(), True)">11/12/2013 12:00</span>
          </tal:effective>
          <tal:noteffective condition="not:question/effective_date">
            Created on: <span tal:content="python:toLocalizedTime(question.created(), True)">11/12/2013 12:00</span>
          </tal:noteffective>
       </span>
      </div>
      <div tal:content="structure question/text/output|string:">
        Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
      </div>
      <div class="files" tal:condition="python:question.getObject().get_files()">
        Files:
        <div class="file" tal:repeat="file python:question.getObject().get_files()">
          <p>
          <a href="" tal:attributes="href string:${file/absolute_url}/@@download/file"
            tal:content="file/file/filename">
          </a>
          <span class="discreet"
                tal:define="size file/file/getSize;
                            kb python:size/1024">
                &mdash; <span tal:replace="kb" /> KB</span>
          </p>
        </div>
      </div>
      <div class="actions" tal:condition="repeat/question/end">
        <a href=""
          tal:define="question_obj question/getObject"
          tal:condition="question_obj/can_add_files"
          tal:attributes="href string:${question/getURL}/++add++ESDRTFile"
          class="standardButton addfile">
            Add file
        </a>

        <a href=""
          tal:define="question_obj question/getObject"
          tal:condition="question_obj/can_edit"
          tal:attributes="href string:${question/getURL}/edit"
          class="standardButton">
            Edit
        </a>

        <tal:block tal:repeat="action view/actions">
          <a href=""
            tal:attributes="href string:${action/action}&amp;comment=${question/getId}"
            class="standardButton"
            tal:content="action/title">
            Action
          </a>
        </tal:block>
      </div>
    </div>


    <div class="actions" tal:condition="view/can_add_comment">
      <a href="./++add++Comment"
        tal:attributes="href string:${here/absolute_url}/++add++Comment"
        class="standardButton">
          Reply (Add comment)
      </a>
    </div>
    <div class="actions" tal:condition="view/can_add_answer">
      <a href="./++add++CommentAnswer"
        tal:attributes="href string:${here/absolute_url}/++add++CommentAnswer"
        class="standardButton">
          Reply (Add comment answer)
      </a>
    </div>
  </div>


</metal:main>

</body>
</html>

