

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Manuel &mdash; Manuel Documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Manuel Documentation" href="#" />
    <link rel="next" title="Theory of Operation" href="README.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="README.html" title="Theory of Operation"
             accesskey="N">next</a> |</li>
        <li><a href="#">Manuel Documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="manuel">
<h1><a class="toc-backref" href="#id4">Manuel</a><a class="headerlink" href="#manuel" title="Permalink to this headline">¶</a></h1>
<p>Manuel lets you mix and match traditional doctests with custom test syntax.</p>
<p>Several plug-ins are included that provide new test syntax (see
<a class="reference internal" href="#functionality"><em>Included Functionality</em></a>).  You can also create your own plug-ins.</p>
<p>For example, if you&#8217;ve ever wanted to include a large chunk of Python in a
doctest but were irritated by all the &#8220;&gt;&gt;&gt;&#8221; and &#8221;...&#8221; prompts required, you&#8217;d
like the <tt class="xref py py-mod docutils literal"><span class="pre">manuel.codeblock</span></tt> module.  It lets you execute code using
Sphinx-style &#8221;..  code-block:: python&#8221; directives.  The markup looks like
this:</p>
<div class="highlight-python"><pre>.. code-block:: python

    import foo

    def my_func(bar):
        return foo.baz(bar)</pre>
</div>
<p>Incidentally, the implementation of <tt class="xref py py-mod docutils literal"><span class="pre">manuel.codeblock</span></tt> is only 23 lines of
code.</p>
<p>The plug-ins included in Manuel make good examples while being quite useful in
their own right.  The Manuel documentation makes extensive use of them as well.
Follow the &#8220;Show Source&#8221; link to the left to see the <a class="reference external" href="http://docutils.sourceforge.net/rst.html">reST</a> source of this document.</p>
<p>For a large example of creating test syntax, take a look at the
<a class="reference internal" href="table-example.html#fit-table-example"><em>FIT Table Example</em></a> or for all the details, <a class="reference internal" href="README.html#theory-of-operation"><em>Theory of Operation</em></a>.</p>
<p>To see how to get Manuel wired up see <a class="reference internal" href="#getting-started"><em>Getting Started</em></a>.</p>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#manuel" id="id4">Manuel</a><ul>
<li><a class="reference internal" href="#included-functionality" id="id5">Included Functionality</a></li>
<li><a class="reference internal" href="#getting-started" id="id6">Getting Started</a><ul>
<li><a class="reference internal" href="#using-unittest" id="id7">Using unittest</a></li>
<li><a class="reference internal" href="#using-zope-testing" id="id8">Using zope.testing</a></li>
<li><a class="reference internal" href="#others" id="id9">Others</a></li>
<li><a class="reference internal" href="#customizing-the-testcase-class" id="id10">Customizing the TestCase class</a></li>
</ul>
</li>
<li><a class="reference internal" href="#doctests" id="id11">Doctests</a></li>
<li><a class="reference internal" href="#capturing-blocks" id="id12">Capturing Blocks</a></li>
<li><a class="reference internal" href="#code-blocks" id="id13">Code Blocks</a><ul>
<li><a class="reference internal" href="#docutils-code-blocks" id="id14">Docutils Code Blocks</a></li>
<li><a class="reference internal" href="#invisible-code-blocks" id="id15">Invisible Code Blocks</a></li>
</ul>
</li>
<li><a class="reference internal" href="#footnotes" id="id16">Footnotes</a></li>
<li><a class="reference internal" href="#ignoring-blocks" id="id17">Ignoring Blocks</a><ul>
<li><a class="reference internal" href="#ignoring-literal-blocks" id="id18">Ignoring Literal Blocks</a></li>
</ul>
</li>
<li><a class="reference internal" href="#test-isolation" id="id19">Test Isolation</a></li>
<li><a class="reference internal" href="#testcase" id="id20">Identifying Test Cases</a><ul>
<li><a class="reference internal" href="#grouping-tests-by-heading" id="id21">Grouping Tests by Heading</a></li>
<li><a class="reference internal" href="#grouping-tests-explicitly" id="id22">Grouping Tests Explicitly</a></li>
<li><a class="reference internal" href="#both-methods" id="id23">Both Methods</a></li>
</ul>
</li>
<li><a class="reference internal" href="#further-reading" id="id24">Further Reading</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="included-functionality">
<span id="functionality"></span><h2><a class="toc-backref" href="#id5">Included Functionality</a><a class="headerlink" href="#included-functionality" title="Permalink to this headline">¶</a></h2>
<p>Manuel includes several plug-ins out of the box:</p>
<dl class="docutils">
<dt><a class="reference internal" href="#capture"><em>manuel.capture</em></a></dt>
<dd>stores regions of a document in variables for later processing</dd>
<dt><a class="reference internal" href="#code-blocks"><em>manuel.codeblock</em></a></dt>
<dd>executes code in &#8221;.. code-block:: python&#8221; blocks</dd>
<dt><a class="reference internal" href="#doctest"><em>manuel.doctest</em></a></dt>
<dd>provides traditional doctest processing as a Manuel plug-in</dd>
<dt><a class="reference internal" href="#footnotes"><em>manuel.footnote</em></a></dt>
<dd>executes code in reST-style footnodes each time they&#8217;re referenced (good
for getting incidental code out of the main flow of a document)</dd>
<dt><a class="reference internal" href="#ignore"><em>manuel.ignore</em></a></dt>
<dd>ignores parts of a document while running tests</dd>
<dt><a class="reference internal" href="#isolation"><em>manuel.isolation</em></a></dt>
<dd>makes it easier to have test isolation in doctests</dd>
<dt><a class="reference internal" href="#testcase"><em>manuel.testcase</em></a></dt>
<dd>identify parts of tests as individual test cases so they can be run
independently</dd>
</dl>
</div>
<div class="section" id="getting-started">
<span id="id1"></span><h2><a class="toc-backref" href="#id6">Getting Started</a><a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h2>
<p>The plug-ins used for a test are composed together using the &#8220;+&#8221; operator.
Let&#8217;s say you wanted a test that used doctest syntax as well as footnotes.  You
would create a Manuel instance to use like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">manuel.doctest</span>
<span class="kn">import</span> <span class="nn">manuel.footnote</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">manuel</span><span class="o">.</span><span class="n">doctest</span><span class="o">.</span><span class="n">Manuel</span><span class="p">()</span>
<span class="n">m</span> <span class="o">+=</span> <span class="n">manuel</span><span class="o">.</span><span class="n">footnote</span><span class="o">.</span><span class="n">Manuel</span><span class="p">()</span>
</pre></div>
</div>
<p>You would then pass the Manuel instance to a <tt class="xref py py-class docutils literal"><span class="pre">manuel.testing.TestSuite</span></tt>,
including the names of documents you want to process:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">manuel</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">TestSuite</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&#39;test-one.txt&#39;</span><span class="p">,</span> <span class="s">&#39;test-two.txt&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="using-unittest">
<h3><a class="toc-backref" href="#id7">Using unittest</a><a class="headerlink" href="#using-unittest" title="Permalink to this headline">¶</a></h3>
<p>The simplest way to get started with Manuel is to use <tt class="xref py py-mod docutils literal"><span class="pre">unittest</span></tt> to run
your tests:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">manuel.codeblock</span>
<span class="kn">import</span> <span class="nn">manuel.doctest</span>
<span class="kn">import</span> <span class="nn">manuel.testing</span>
<span class="kn">import</span> <span class="nn">unittest</span>

<span class="k">def</span> <span class="nf">test_suite</span><span class="p">():</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">manuel</span><span class="o">.</span><span class="n">doctest</span><span class="o">.</span><span class="n">Manuel</span><span class="p">()</span>
    <span class="n">m</span> <span class="o">+=</span> <span class="n">manuel</span><span class="o">.</span><span class="n">codeblock</span><span class="o">.</span><span class="n">Manuel</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">manuel</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">TestSuite</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&#39;test-one.txt&#39;</span><span class="p">,</span> <span class="s">&#39;test-two.txt&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">TextTestRunner</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">test_suite</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="section" id="using-zope-testing">
<h3><a class="toc-backref" href="#id8">Using zope.testing</a><a class="headerlink" href="#using-zope-testing" title="Permalink to this headline">¶</a></h3>
<p>If you want to use a more featureful test runner you can use zope.testing&#8217;s
test runner (usable stand-alone &#8211; it isn&#8217;t dependent on the Zope application
server).  Create a file named <tt class="file docutils literal"><span class="pre">tests.py</span></tt> with a <tt class="xref py py-func docutils literal"><span class="pre">test_suite()</span></tt>
function that returns a test suite.</p>
<p>The suite can be either a <tt class="xref py py-class docutils literal"><span class="pre">manuel.testing.TestSuite</span></tt> object or a
<tt class="xref py py-class docutils literal"><span class="pre">unittest.TestSuite</span></tt> as demonstrated below.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">manuel.codeblock</span>
<span class="kn">import</span> <span class="nn">manuel.doctest</span>
<span class="kn">import</span> <span class="nn">manuel.testing</span>

<span class="k">def</span> <span class="nf">test_suite</span><span class="p">():</span>
    <span class="n">suite</span> <span class="o">=</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestSuite</span><span class="p">()</span>

    <span class="c"># here you add your other tests to the suite...</span>

    <span class="c"># now you can add the Manuel tests</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">manuel</span><span class="o">.</span><span class="n">doctest</span><span class="o">.</span><span class="n">Manuel</span><span class="p">()</span>
    <span class="n">m</span> <span class="o">+=</span> <span class="n">manuel</span><span class="o">.</span><span class="n">codeblock</span><span class="o">.</span><span class="n">Manuel</span><span class="p">()</span>
    <span class="n">suite</span><span class="o">.</span><span class="n">addTest</span><span class="p">(</span><span class="n">manuel</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">TestSuite</span><span class="p">(</span><span class="n">m</span><span class="p">,</span>
        <span class="s">&#39;test-one.txt&#39;</span><span class="p">,</span> <span class="s">&#39;test-two.txt&#39;</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">suite</span>
</pre></div>
</div>
</div>
<div class="section" id="others">
<h3><a class="toc-backref" href="#id9">Others</a><a class="headerlink" href="#others" title="Permalink to this headline">¶</a></h3>
<p>If you know out how to make Manuel work with other test runners (nose, py.test,
etc.), please <a class="reference external" href="mailto:benji+manuel&#37;&#52;&#48;benjiyork&#46;com">send me an email</a> and I&#8217;ll expand this section.</p>
</div>
<div class="section" id="customizing-the-testcase-class">
<h3><a class="toc-backref" href="#id10">Customizing the TestCase class</a><a class="headerlink" href="#customizing-the-testcase-class" title="Permalink to this headline">¶</a></h3>
<p>Manuel has its own <tt class="xref py py-class docutils literal"><span class="pre">manuel.testing.TestClass</span></tt> class that
<tt class="xref py py-class docutils literal"><span class="pre">manuel.testing.TestSuite</span></tt> uses. If you want to customize it, you
can pass in your own class to <cite>TestSuite</cite>.</p>
<div class="highlight-python"><div class="highlight"><pre> <span class="kn">import</span> <span class="nn">os.path</span>
 <span class="kn">import</span> <span class="nn">manuel.testing</span>

 <span class="k">class</span> <span class="nc">StripDirsTestCase</span><span class="p">(</span><span class="n">manuel</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
     <span class="k">def</span> <span class="nf">shortDescription</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
         <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
 <span class="n">suite</span> <span class="o">=</span> <span class="n">manuel</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">TestSuite</span><span class="p">(</span>
     <span class="n">m</span><span class="p">,</span> <span class="n">path_to_test</span><span class="p">,</span> <span class="n">TestCase</span><span class="o">=</span><span class="n">StripDirsTestCase</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="nb">list</span><span class="p">(</span><span class="n">suite</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shortDescription</span><span class="p">()</span>
<span class="s">&#39;bugs.txt&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="doctests">
<span id="doctest"></span><h2><a class="toc-backref" href="#id11">Doctests</a><a class="headerlink" href="#doctests" title="Permalink to this headline">¶</a></h2>
<p>Manuel is all about making testable documents and well-documented tests.  Of
course, Python&#8217;s doctest module is a long-standing fixture in that space, so it
only makes sense for Manuel to support doctest syntax.</p>
<p>Handling doctests is easy:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">manuel.doctest</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">manuel</span><span class="o">.</span><span class="n">doctest</span><span class="o">.</span><span class="n">Manuel</span><span class="p">()</span>
<span class="n">suite</span> <span class="o">=</span> <span class="n">manuel</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">TestSuite</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&#39;my-doctest.txt&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Of course you can mix in other Manuel syntax plug-ins as well (including ones
you write yourself).</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">manuel.doctest</span>
<span class="kn">import</span> <span class="nn">manuel.codeblock</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">manuel</span><span class="o">.</span><span class="n">doctest</span><span class="o">.</span><span class="n">Manuel</span><span class="p">()</span>
<span class="n">m</span> <span class="o">+=</span> <span class="n">manuel</span><span class="o">.</span><span class="n">codeblock</span><span class="o">.</span><span class="n">Manuel</span><span class="p">()</span>
<span class="n">suite</span> <span class="o">=</span> <span class="n">manuel</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">TestSuite</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&#39;my-doctest-with-code-blocks.txt&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <tt class="xref py py-class docutils literal"><span class="pre">manuel.doctest.Manuel</span></tt> constructor also takes <tt class="xref py py-data docutils literal"><span class="pre">optionflags</span></tt>
and <tt class="xref py py-data docutils literal"><span class="pre">checker</span></tt> arguments.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">m</span> <span class="o">=</span> <span class="n">manuel</span><span class="o">.</span><span class="n">doctest</span><span class="o">.</span><span class="n">Manuel</span><span class="p">(</span><span class="n">optionflags</span><span class="o">=</span><span class="n">optionflags</span><span class="p">,</span> <span class="n">checker</span><span class="o">=</span><span class="n">checker</span><span class="p">)</span>
</pre></div>
</div>
<p>See the <a class="reference external" href="http://docs.python.org/library/doctest.html">doctest documentation</a>
for more information about the <a class="reference external" href="http://docs.python.org/library/doctest.html#doctest-options">available options</a>  and <a class="reference external" href="http://docs.python.org/library/doctest.html#outputchecker-objects">output
checkers</a></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><tt class="xref py py-mod docutils literal"><span class="pre">zope.testing.renormalizing</span></tt> provides an <tt class="xref py py-class docutils literal"><span class="pre">OutputChecker</span></tt>
for smoothing out differences between actual and expected output for things
that are hard to control (like memory addresses and time).  See the
<a class="reference external" href="http://svn.zope.org/zope.testing/trunk/src/zope/testing/renormalizing.py?view=markup">module&#8217;s doctests</a>
for more information on how it works.  Here&#8217;s a short example that
smoothes over the differences between CPython&#8217;s and PyPy&#8217;s NameError
messages:</p>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">zope.testing.renormalizing</span>
<span class="n">checker</span> <span class="o">=</span> <span class="n">zope</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">renormalizing</span><span class="o">.</span><span class="n">RENormalizing</span><span class="p">([</span>
    <span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&quot;NameError: global name &#39;([a-zA-Z0-9_]+)&#39; is not defined&quot;</span><span class="p">),</span>
     <span class="s">r&quot;NameError: name &#39;\1&#39; is not defined&quot;</span><span class="p">),</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="capturing-blocks">
<span id="capture"></span><h2><a class="toc-backref" href="#id12">Capturing Blocks</a><a class="headerlink" href="#capturing-blocks" title="Permalink to this headline">¶</a></h2>
<p>When writing documentation the need often arises to describe the contents of
files or other non-Python information.  You may also want to put that
information under test.  <tt class="xref py py-mod docutils literal"><span class="pre">manuel.capture</span></tt> helps with that.</p>
<p>For example, if you were writing the problems for a programming contest, you
might want to describe the input and output files for each challenge, but you
want to be sure that your examples are correct.</p>
<p>To do that you might write your document like this:</p>
<div class="highlight-python"><pre>Challenge 1
===========

Write a program that sorts the numbers in a file.


Example
-------

Given this example input file::

    6
    1
    8
    20
    11
    65
    2

.. -&gt; input

Your program should generate this output file::

    1
    2
    6
    8
    11
    20
    65

.. -&gt; output

    &gt;&gt;&gt; input_lines = input.splitlines()
    &gt;&gt;&gt; correct = '\n'.join(map(str, sorted(map(int, input_lines)))) + '\n'
    &gt;&gt;&gt; output == correct
    True</pre>
</div>
<p>This uses the syntax implemented in <tt class="xref py py-mod docutils literal"><span class="pre">manuel.capture</span></tt> to capture a block of
text into a variable (the one named after &#8220;-&gt;&#8221;).</p>
<p>Whenever a line of the structure &#8221;.. -&gt; VAR&#8221; is detected, the text of the
<em>previous</em> block will be stored in the given variable.</p>
<p>Of course, lines that start with &#8221;.. &#8221; are reST comments, so when the document
is rendered with docutils or Sphinx, the tests will dissapear and only the
intended document contents will remain.  Like so:</p>
<div class="highlight-python"><pre>Challenge 1
===========

Write a program that sorts the numbers in a file.


Example
-------

Given this example input file::

    6
    1
    8
    20
    11
    65
    2

Your program should generate this output file::

    1
    2
    6
    8
    11
    20
    65</pre>
</div>
</div>
<div class="section" id="code-blocks">
<span id="id2"></span><h2><a class="toc-backref" href="#id13">Code Blocks</a><a class="headerlink" href="#code-blocks" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="http://sphinx.pocoo.org/">Sphinx</a> and other docutils <a class="reference external" href="http://docutils.sourceforge.net/sandbox/code-block-directive/docs/syntax-highlight.html">extensions</a>
provide a <a class="reference external" href="http://sphinx.pocoo.org/markup/code.html">&#8220;code-block&#8221; directive</a>,
which allows inlined snippets of code in reST documents.</p>
<p>The <tt class="xref py py-mod docutils literal"><span class="pre">manuel.codeblock</span></tt> module provides the ability to execute the contents
of Python code-blocks.  For example:</p>
<div class="highlight-python"><pre>.. code-block:: python

    print('hello')</pre>
</div>
<p>If the code-block generates some sort of error...</p>
<div class="highlight-python"><div class="highlight"><pre><span class="o">..</span> <span class="n">code</span><span class="o">-</span><span class="n">block</span><span class="p">::</span> <span class="n">python</span>

    <span class="k">print</span><span class="p">(</span><span class="n">does_not_exist</span><span class="p">)</span>
</pre></div>
</div>
<p>...that error will be reported:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">document</span><span class="o">.</span><span class="n">process_with</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">globs</span><span class="o">=</span><span class="p">{})</span>
<span class="gt">Traceback (most recent call last):</span>
    <span class="o">...</span>
<span class="gr">NameError</span>: <span class="n">name &#39;does_not_exist&#39; is not defined</span>
</pre></div>
</div>
<p>If you find that you want to include a code-block in a document but don&#8217;t want
Manuel to execute it, use <a class="reference internal" href="#ignore"><em>manuel.ignore</em></a> to ignore that
particular block.</p>
<div class="section" id="docutils-code-blocks">
<h3><a class="toc-backref" href="#id14">Docutils Code Blocks</a><a class="headerlink" href="#docutils-code-blocks" title="Permalink to this headline">¶</a></h3>
<p>Sphinx and docutils have different ideas of how code blocks should be spelled.
Manuel supports the docutils-style code blocks too.</p>
<div class="highlight-python"><pre>.. code:: python

    a = 1</pre>
</div>
<p>Docutils options after the opening of the code block are also allowed:</p>
<div class="highlight-python"><pre>.. code:: python
    :class: hidden

    a = 1</pre>
</div>
</div>
<div class="section" id="invisible-code-blocks">
<h3><a class="toc-backref" href="#id15">Invisible Code Blocks</a><a class="headerlink" href="#invisible-code-blocks" title="Permalink to this headline">¶</a></h3>
<p>At times you&#8217;ll want to have a block of code that is executed but not displayed
in the rendered document (like some setup for later examples).</p>
<p>When using doctest&#8217;s native format (&#8220;&gt;&gt;&gt;&#8221;) that&#8217;s easy to do, you just put the
code in a reST comment, like so:</p>
<div class="highlight-python"><pre>.. this is some setup, it is hidden in a reST comment

    &gt;&gt;&gt; a = 5
    &gt;&gt;&gt; b = a + 3</pre>
</div>
<p>However, if you want to include a relatively large chunk of Python, you&#8217;d
rather use a code-block, but that means that it will be included in the
rendered document.  Instead, <tt class="xref py py-mod docutils literal"><span class="pre">manuel.codeblock</span></tt> also understands a variant
of the code-block directive that is actually a reST comment: &#8221;..
invisible-code-block:: python&#8221;:</p>
<div class="highlight-python"><pre>.. invisible-code-block:: python

    a = 5
    b = a + 3</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The &#8220;invisible-code-block&#8221; directive will work with either one or two
colons.  The reason is that reST processers (like docutils and Sphinx) will
generate an error for unrecognized directives (like invisible-code-block).
Therefore you can use a single colon and the line will be interpreted as a
comment instead.</p>
</div>
</div>
</div>
<div class="section" id="footnotes">
<span id="id3"></span><h2><a class="toc-backref" href="#id16">Footnotes</a><a class="headerlink" href="#footnotes" title="Permalink to this headline">¶</a></h2>
<p>The <tt class="xref py py-mod docutils literal"><span class="pre">manuel.footnote</span></tt> module provides an implementation of reST footnote
handling, but instead of just plain text, the footnotes can contain any syntax
Manuel can interpret including doctests.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">manuel.footnote</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">manuel</span><span class="o">.</span><span class="n">footnote</span><span class="o">.</span><span class="n">Manuel</span><span class="p">()</span>
</pre></div>
</div>
<p>Here&#8217;s an example of combining footnotes with doctests:</p>
<div class="highlight-python"><pre>Here we reference a footnote. [1]_

    &gt;&gt;&gt; x
    42

Here we reference another. [2]_

    &gt;&gt;&gt; x
    100

.. [1] This is a test footnote definition.

    &gt;&gt;&gt; x = 42

.. [2] This is another test footnote definition.

    &gt;&gt;&gt; x = 100

.. [3] This is a footnote that will never be executed.

    &gt;&gt;&gt; raise RuntimeError('nooooo!')</pre>
</div>
<p>It is also possible to reference more than one footnote on a single line.</p>
<div class="highlight-python"><pre>This line has several footnotes on it. [1]_ [2]_ [3]_

    &gt;&gt;&gt; z
    105

A little prose to separate the examples.

.. [1] Do something

    &gt;&gt;&gt; w = 3

.. [2] Do something

    &gt;&gt;&gt; x = 5

.. [3] Do something

    &gt;&gt;&gt; y = 7

    &gt;&gt;&gt; z = w * x * y</pre>
</div>
</div>
<div class="section" id="ignoring-blocks">
<span id="ignore"></span><h2><a class="toc-backref" href="#id17">Ignoring Blocks</a><a class="headerlink" href="#ignoring-blocks" title="Permalink to this headline">¶</a></h2>
<p>Occasionally the need arises to ignore a block of markup that would otherwise
be parsed by a Manuel plug-in.</p>
<p>For example, this document has a code-block that will generate a syntax error:</p>
<div class="highlight-python"><pre>The following is invalid Python.

.. code-block:: python

    def foo:
        pass</pre>
</div>
<p>We can see that when executed, the SyntaxError escapes.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">manuel.codeblock</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">manuel</span><span class="o">.</span><span class="n">codeblock</span><span class="o">.</span><span class="n">Manuel</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">document</span><span class="o">.</span><span class="n">process_with</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">globs</span><span class="o">=</span><span class="p">{})</span>
  File <span class="nb">&quot;&lt;memory&gt;:4&quot;</span>, line <span class="m">2</span>
     <span class="k">def</span> <span class="nf">foo</span><span class="p">:</span>
            <span class="o">^</span>
<span class="gr">SyntaxError</span>: <span class="n">invalid syntax</span>
</pre></div>
</div>
<p>The <tt class="xref py py-mod docutils literal"><span class="pre">manuel.ignore</span></tt> module provides a way to ignore parts of a document
using a directive &#8221;.. ignore-next-block&#8221;.</p>
<p>Because Manuel plug-ins are executed in the order they are accumulated, we want
<tt class="xref py py-mod docutils literal"><span class="pre">manuel.ignore</span></tt> to be the base Manuel object, with any additional plug-ins
added to it.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">manuel.ignore</span>
<span class="kn">import</span> <span class="nn">manuel.doctest</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">manuel</span><span class="o">.</span><span class="n">ignore</span><span class="o">.</span><span class="n">Manuel</span><span class="p">()</span>
<span class="n">m</span> <span class="o">+=</span> <span class="n">manuel</span><span class="o">.</span><span class="n">codeblock</span><span class="o">.</span><span class="n">Manuel</span><span class="p">()</span>
<span class="n">m</span> <span class="o">+=</span> <span class="n">manuel</span><span class="o">.</span><span class="n">doctest</span><span class="o">.</span><span class="n">Manuel</span><span class="p">()</span>
</pre></div>
</div>
<p>If we add an ignore marker to the block we don&#8217;t want processed...</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">The</span> <span class="n">following</span> <span class="ow">is</span> <span class="n">invalid</span> <span class="n">Python</span><span class="o">.</span>

<span class="o">..</span> <span class="n">ignore</span><span class="o">-</span><span class="nb">next</span><span class="o">-</span><span class="n">block</span>
<span class="o">..</span> <span class="n">code</span><span class="o">-</span><span class="n">block</span><span class="p">::</span> <span class="n">python</span>

    <span class="k">def</span> <span class="nf">foo</span><span class="p">:</span>
        <span class="k">pass</span>
</pre></div>
</div>
<p>...the error goes away.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">document</span><span class="o">.</span><span class="n">process_with</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">globs</span><span class="o">=</span><span class="p">{})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">formatted</span><span class="p">())</span>
</pre></div>
</div>
<div class="section" id="ignoring-literal-blocks">
<h3><a class="toc-backref" href="#id18">Ignoring Literal Blocks</a><a class="headerlink" href="#ignoring-literal-blocks" title="Permalink to this headline">¶</a></h3>
<p>Ignoring literal blocks is a little more involved:</p>
<div class="highlight-python"><pre>Here is some invalid Python:

.. ignore-next-block

::

   &gt;&gt;&gt; lambda: x=1</pre>
</div>
</div>
</div>
<div class="section" id="test-isolation">
<span id="isolation"></span><h2><a class="toc-backref" href="#id19">Test Isolation</a><a class="headerlink" href="#test-isolation" title="Permalink to this headline">¶</a></h2>
<p>One of the advantages of unittest over doctest is that the individual tests are
isolated from one-another.</p>
<p>In large doctests (like this one) you may want to keep later tests from
depending on incidental details of earlier tests, preventing the tests from
becoming brittle and harder to change.</p>
<p>Test isolation is one approach to reducing this intra-doctest coupling.  The
<tt class="xref py py-mod docutils literal"><span class="pre">manuel.isolation</span></tt> module provides a plug-in to help.</p>
<p>The &#8221;.. reset-globs&#8221; directive resets the globals in the test:</p>
<div class="highlight-python"><pre>We define a variable.

    &gt;&gt;&gt; x = 'hello'

It is still defined.

    &gt;&gt;&gt; print(x)
    hello

Now we can reset the globals...

.. reset-globs

...and the name binding will be gone:

    &gt;&gt;&gt; print(x)
    Traceback (most recent call last):
        ...
    NameError: name 'x' is not defined</pre>
</div>
<p>We can see that after the globals have been reset, the second &#8220;print(x)&#8221; line
raises an error.</p>
<p>Of course, resetting to an empty set of global variables isn&#8217;t always what&#8217;s
wanted.  In that case there is a &#8221;.. capture-globs&#8221; directive that saves a
baseline set of globals that will be restored at each reset.</p>
<div class="highlight-python"><pre>We define a variable.

    &gt;&gt;&gt; x = 'hello'

It is still defined.

    &gt;&gt;&gt; print(x)
    hello

We can capture the currently defined globals:

.. capture-globs

Of course capturing the globals doesn't disturb them.

    &gt;&gt;&gt; print(x)
    hello

Now if we define a new global...

    &gt;&gt;&gt; y = 'goodbye'
    &gt;&gt;&gt; print(y)
    goodbye

.. reset-globs

...it will disappear after a reset.

    &gt;&gt;&gt; print(y)
    Traceback (most recent call last):
        ...
    NameError: name 'y' is not defined

But the captured globals will still be defined.

    &gt;&gt;&gt; print(x)
    hello</pre>
</div>
</div>
<div class="section" id="testcase">
<span id="identifying-test-cases"></span><h2><a class="toc-backref" href="#id20">Identifying Test Cases</a><a class="headerlink" href="#testcase" title="Permalink to this headline">¶</a></h2>
<p>If you want parts of a document to be individually accessible as test cases (to
be able to run just a particular subset of them, for example), a parser can
create a region that marks the beginning of a new test case.</p>
<p>Two ways of identifying test cases are included in <tt class="xref py py-mod docutils literal"><span class="pre">manuel.testcase</span></tt>:</p>
<ol class="arabic simple">
<li>by section headings</li>
<li>by explicit &#8221;.. test-case: NAME&#8221; markers.</li>
</ol>
<div class="section" id="grouping-tests-by-heading">
<h3><a class="toc-backref" href="#id21">Grouping Tests by Heading</a><a class="headerlink" href="#grouping-tests-by-heading" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><pre>First Section
=============

Some prose.

    &gt;&gt;&gt; print('first test case')

Some more prose.

    &gt;&gt;&gt; print('still in the first test case')

Second Section
==============

Even more prose.

    &gt;&gt;&gt; print('second test case')</pre>
</div>
<p>Given the above document, if you&#8217;re using zope.testing&#8217;s testrunner (located in bin/test), you could run just the tests in the second section with this command:</p>
<div class="highlight-python"><pre>bin/test -t "file-name.txt:Second Section"</pre>
</div>
<p>Or, exploiting the fact that -t does a regex search (as opposed to a match):</p>
<div class="highlight-python"><pre>bin/test -t file-name.txt:Second</pre>
</div>
</div>
<div class="section" id="grouping-tests-explicitly">
<h3><a class="toc-backref" href="#id22">Grouping Tests Explicitly</a><a class="headerlink" href="#grouping-tests-explicitly" title="Permalink to this headline">¶</a></h3>
<p>If you would like to identify test cases separately from sections, you can
identify them with a marker:</p>
<div class="highlight-python"><pre>First Section
=============

The following test will be in a test case that is not individually
identifiable.

    &gt;&gt;&gt; print('first test case (unidentified)')

Some more prose.

.. test-case: first-named-test-case

    &gt;&gt;&gt; print('first identified test case')


Second Section
==============

The test case markers don't have to immediately proceed a test.

.. test-case: second-named-test-case

Even more prose.

    &gt;&gt;&gt; print('second identified test case')</pre>
</div>
<p>Again, given the above document and zope.testing, you could run just the second
set of tests with this command:</p>
<div class="highlight-python"><pre>bin/test -t file-name.txt:second-named-test-case</pre>
</div>
<p>Or, exploiting the fact that -t does a regex search again:</p>
<div class="highlight-python"><pre>bin/test -t file-name.txt:second</pre>
</div>
<p>Even though the tests are individually accessable doesn&#8217;t mean that they can&#8217;t
all be run at the same time:</p>
<div class="highlight-python"><pre>bin/test -t file-name.txt</pre>
</div>
<p>Also, if you create a hierarchy of names, you can run groups of tests at a
time.  For example, lets say that you append &#8220;-important&#8221; to all your really
important tests, you could then run the important tests for a single document
like so:</p>
<div class="highlight-python"><pre>bin/test -t 'file-name.txt:.*-important$'</pre>
</div>
<p>or all the &#8220;important&#8221; tests no matter what file they are in:</p>
<div class="highlight-python"><pre>bin/test -t '-important$'</pre>
</div>
</div>
<div class="section" id="both-methods">
<h3><a class="toc-backref" href="#id23">Both Methods</a><a class="headerlink" href="#both-methods" title="Permalink to this headline">¶</a></h3>
<p>You can also combine more than one test case identification method if you want.
Here&#8217;s an example of building a Manuel stack that has doctests and both flavors
of test case identification:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">manuel.doctest</span>
<span class="kn">import</span> <span class="nn">manuel.testcase</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">manuel</span><span class="o">.</span><span class="n">doctest</span><span class="o">.</span><span class="n">Manuel</span><span class="p">()</span>
<span class="n">m</span> <span class="o">+=</span> <span class="n">manuel</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">SectionManuel</span><span class="p">()</span>
<span class="n">m</span> <span class="o">+=</span> <span class="n">manuel</span><span class="o">.</span><span class="n">testcase</span><span class="o">.</span><span class="n">MarkerManuel</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="further-reading">
<h2><a class="toc-backref" href="#id24">Further Reading</a><a class="headerlink" href="#further-reading" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="README.html">Theory of Operation</a></li>
<li class="toctree-l1"><a class="reference internal" href="table-example.html">FIT Table Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="bugs.html">Fixed Bugs</a></li>
</ul>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="#">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Manuel</a><ul>
<li><a class="reference internal" href="#included-functionality">Included Functionality</a></li>
<li><a class="reference internal" href="#getting-started">Getting Started</a><ul>
<li><a class="reference internal" href="#using-unittest">Using unittest</a></li>
<li><a class="reference internal" href="#using-zope-testing">Using zope.testing</a></li>
<li><a class="reference internal" href="#others">Others</a></li>
<li><a class="reference internal" href="#customizing-the-testcase-class">Customizing the TestCase class</a></li>
</ul>
</li>
<li><a class="reference internal" href="#doctests">Doctests</a></li>
<li><a class="reference internal" href="#capturing-blocks">Capturing Blocks</a></li>
<li><a class="reference internal" href="#code-blocks">Code Blocks</a><ul>
<li><a class="reference internal" href="#docutils-code-blocks">Docutils Code Blocks</a></li>
<li><a class="reference internal" href="#invisible-code-blocks">Invisible Code Blocks</a></li>
</ul>
</li>
<li><a class="reference internal" href="#footnotes">Footnotes</a></li>
<li><a class="reference internal" href="#ignoring-blocks">Ignoring Blocks</a><ul>
<li><a class="reference internal" href="#ignoring-literal-blocks">Ignoring Literal Blocks</a></li>
</ul>
</li>
<li><a class="reference internal" href="#test-isolation">Test Isolation</a></li>
<li><a class="reference internal" href="#testcase">Identifying Test Cases</a><ul>
<li><a class="reference internal" href="#grouping-tests-by-heading">Grouping Tests by Heading</a></li>
<li><a class="reference internal" href="#grouping-tests-explicitly">Grouping Tests Explicitly</a></li>
<li><a class="reference internal" href="#both-methods">Both Methods</a></li>
</ul>
</li>
<li><a class="reference internal" href="#further-reading">Further Reading</a><ul>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Next topic</h4>
  <p class="topless"><a href="README.html"
                        title="next chapter">Theory of Operation</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/index.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="README.html" title="Theory of Operation"
             >next</a> |</li>
        <li><a href="#">Manuel Documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright Benji York.
      Last updated on 2014-07-15.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>