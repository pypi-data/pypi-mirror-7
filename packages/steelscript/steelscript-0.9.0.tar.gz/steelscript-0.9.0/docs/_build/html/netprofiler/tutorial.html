<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>4.1. SteelScript NetProfiler Tutorial &mdash; steelscript  documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="steelscript  documentation" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">steelscript  documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="steelscript-netprofiler-tutorial">
<h1>4.1. SteelScript NetProfiler Tutorial<a class="headerlink" href="#steelscript-netprofiler-tutorial" title="Permalink to this headline">¶</a></h1>
<p>This tutorial will walk through the main components of the SteelScript
interfaces for Riverbed SteelCentral NetProfiler.  It is assumed that
you have a basic understanding of the Python programming language.</p>
<p>The tutorial has been organized so you can follow it sequentially.
Throughout the examples, you will be expected to fill in details
specific to your environment.  These will be called out using a dollar
sign <tt class="docutils literal"><span class="pre">$&lt;name&gt;</span></tt> &#8211; for example <tt class="docutils literal"><span class="pre">$host</span></tt> indicates you should fill in
the host name or IP address of a NetProfiler appliance.</p>
<p>Whenever you see <tt class="docutils literal"><span class="pre">&gt;&gt;&gt;</span></tt>, this indicates an interactive session using
the Python shell.  The command that you are expected to type follows
the <tt class="docutils literal"><span class="pre">&gt;&gt;&gt;</span></tt>.  The result of the command follows.  Any lines with a
<tt class="docutils literal"><span class="pre">#</span></tt> are just comments to describe what is happening.  In many cases
the exact output will depend on your environment, so it may not match
precisely what you see in this tutorial.</p>
<div class="section" id="background">
<h2>4.1.1. Background<a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h2>
<p>NetProfiler provides centralized reporting and analysis of the data
collected by other SteelCentral appliances (i.e., Flow Gateway, and
NetShark) and SteelHead products on a single user interface.
SteelScript for NetProfiler makes this this wealth of data easily
accessible via Python.</p>
</div>
<div class="section" id="netprofiler-objects">
<h2>4.1.2. NetProfiler Objects<a class="headerlink" href="#netprofiler-objects" title="Permalink to this headline">¶</a></h2>
<p>Interacting with a NetProfiler leverages two key classes:</p>
<ul class="simple">
<li><a class="reference internal" href="netprofiler.html#steelscript.netprofiler.core.netprofiler.NetProfiler" title="steelscript.netprofiler.core.netprofiler.NetProfiler"><tt class="xref py py-class docutils literal"><span class="pre">NetProfiler</span></tt></a> - provides
the primary interface to the appliance, handling initialization,
setup, and communication via REST API calls.</li>
<li><a class="reference internal" href="netprofiler.html#steelscript.netprofiler.core.report.Report" title="steelscript.netprofiler.core.report.Report"><tt class="xref py py-class docutils literal"><span class="pre">Report</span></tt></a> - talks
through the NetProfiler to create new reports and pull data from
existing reports.</li>
</ul>
<p>In most cases you will not use Report directly &#8211; your scripts will
use a more helpful object tailored to the desired report, such as a
<a class="reference internal" href="netprofiler.html#steelscript.netprofiler.core.report.TrafficSummaryReport" title="steelscript.netprofiler.core.report.TrafficSummaryReport"><tt class="xref py py-class docutils literal"><span class="pre">TrafficSummaryReport</span></tt></a> or a
<a class="reference internal" href="netprofiler.html#steelscript.netprofiler.core.report.TrafficOverallTimeSeriesReport" title="steelscript.netprofiler.core.report.TrafficOverallTimeSeriesReport"><tt class="xref py py-class docutils literal"><span class="pre">TrafficOverallTimeSeriesReport</span></tt></a>.  We&#8217;ll cover those shortly.</p>
<p>Outside of handling all the communication back and forth,
<a class="reference internal" href="netprofiler.html#steelscript.netprofiler.core.netprofiler.NetProfiler" title="steelscript.netprofiler.core.netprofiler.NetProfiler"><tt class="xref py py-class docutils literal"><span class="pre">NetProfiler</span></tt></a> also handles all of
the different report columns that could be desired.  It provides a
helpful interface to offer up available columns by report type, and
ensures that any chosen columns are in fact appropriate.</p>
<p>With that brief overview, let&#8217;s get started.</p>
</div>
<div class="section" id="startup">
<h2>4.1.3. Startup<a class="headerlink" href="#startup" title="Permalink to this headline">¶</a></h2>
<p>As with any Python code, the first step is to import the module(s) we
intend to use.  The SteelScript code for working with NetProfiler
appliances resides in a module called
<a class="reference internal" href="netprofiler.html#module-steelscript.netprofiler.core" title="steelscript.netprofiler.core"><tt class="xref py py-mod docutils literal"><span class="pre">steelscript.netprofiler.core</span></tt></a>.  The main class in this module
is <a class="reference internal" href="netprofiler.html#steelscript.netprofiler.core.netprofiler.NetProfiler" title="steelscript.netprofiler.core.netprofiler.NetProfiler"><tt class="xref py py-class docutils literal"><span class="pre">NetProfiler</span></tt></a>.  This object
represents a connection to a NetProfiler appliance.</p>
<p>To start, start python from the shell or command line:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>python
Python 2.7.3 <span class="o">(</span>default, Apr 19 2012, 00:55:09<span class="o">)</span>
<span class="o">[</span>GCC 4.2.1 <span class="o">(</span>Based on Apple Inc. build 5658<span class="o">)</span> <span class="o">(</span>LLVM build 2335.15.00<span class="o">)]</span> on darwin
Type <span class="s2">&quot;help&quot;</span>, <span class="s2">&quot;copyright&quot;</span>, <span class="s2">&quot;credits&quot;</span> or <span class="s2">&quot;license&quot;</span> <span class="k">for </span>more information.
&gt;&gt;&gt;
</pre></div>
</div>
<p>Once in the python shell, let&#8217;s create a NetProfiler object:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">steelscript.netprofiler.core</span> <span class="kn">import</span> <span class="n">NetProfiler</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">steelscript.common.service</span> <span class="kn">import</span> <span class="n">UserAuth</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">NetProfiler</span><span class="p">(</span><span class="s">&#39;$hostname&#39;</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="n">UserAuth</span><span class="p">(</span><span class="s">&#39;$username&#39;</span><span class="p">,</span> <span class="s">&#39;$password&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Replace the first argument <tt class="docutils literal"><span class="pre">$hostname</span></tt> with the hostname or IP
address of the NetProfiler appliance.  The second argument is an auth
parameter and identifies the authentication method to use &#8211; in this
case, simple username/password is used.  OAuth 2.0 is supported as
well, but we will focus on basic authentication for this tutorial.</p>
<p>As soon as the <tt class="docutils literal"><span class="pre">NetProfiler</span></tt> object is created, a connection is
established to the appliance, the authentication credentials are
validated, and hierarchy of available columns is loaded.  If the
username and password are not correct, you will immediately see an
exception.  Also, if this is the first time initializing a
<tt class="docutils literal"><span class="pre">NetProfiler</span></tt> object, there will be a short delay while all of the
columns are fetched from the appliance and cached locally.</p>
<p>The <tt class="docutils literal"><span class="pre">p</span></tt> object is the basis for all communication with the
NetProfiler appliance.  We can get some basic version information by
simply looking at the &#8216;version&#8217; attribute:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">p</span><span class="o">.</span><span class="n">version</span>
<span class="go">&#39;10.1 (release 20130204_1200)&#39;</span>
</pre></div>
</div>
<p>Before moving on, exit the python interactive shell:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">Ctrl</span><span class="o">-</span><span class="n">D</span><span class="p">]</span>
<span class="go">$</span>
</pre></div>
</div>
</div>
<div class="section" id="generating-reports">
<h2>4.1.4. Generating Reports<a class="headerlink" href="#generating-reports" title="Permalink to this headline">¶</a></h2>
<p>Reports are the mechanisim to extract all the myriad of data from
<tt class="xref py py-class docutils literal"><span class="pre">NetProfiler</span></tt> into any format desired.  We will create a short script
that provides a command-line interface to generate reports on the fly.</p>
<p>Create a new file in a working directory of your choice, call it <tt class="docutils literal"><span class="pre">myreport.py</span></tt>,
and insert the following lines:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">pprint</span>

<span class="kn">from</span> <span class="nn">steelscript.netprofiler.core</span> <span class="kn">import</span> <span class="n">NetProfiler</span>

<span class="kn">from</span> <span class="nn">steelscript.common.service</span> <span class="kn">import</span> <span class="n">UserAuth</span>
<span class="kn">from</span> <span class="nn">steelscript.netprofiler.core.filters</span> <span class="kn">import</span> <span class="n">TimeFilter</span>
<span class="kn">from</span> <span class="nn">steelscript.netprofiler.core.report</span> <span class="kn">import</span> <span class="n">TrafficSummaryReport</span>

<span class="c"># connection information</span>
<span class="n">username</span> <span class="o">=</span> <span class="s">&#39;$username&#39;</span>
<span class="n">password</span> <span class="o">=</span> <span class="s">&#39;$password&#39;</span>
<span class="n">auth</span> <span class="o">=</span> <span class="n">UserAuth</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
<span class="n">host</span> <span class="o">=</span> <span class="s">&#39;$host&#39;</span>

<span class="c"># create a new NetProfiler instance</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">NetProfiler</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="n">auth</span><span class="p">)</span>

<span class="c"># setup basic info for our report</span>
<span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">host_ip</span><span class="p">,</span>
           <span class="n">p</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">avg_bytes</span><span class="p">,</span>
           <span class="n">p</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">network_rtt</span><span class="p">]</span>
<span class="n">sort_column</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">avg_bytes</span>
<span class="n">timefilter</span> <span class="o">=</span> <span class="n">TimeFilter</span><span class="o">.</span><span class="n">parse_range</span><span class="p">(</span><span class="s">&quot;last 5 m&quot;</span><span class="p">)</span>

<span class="c"># initialize a new report, and run it</span>
<span class="n">report</span> <span class="o">=</span> <span class="n">TrafficSummaryReport</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="n">report</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s">&#39;hos&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">timefilter</span><span class="o">=</span><span class="n">timefilter</span><span class="p">,</span> <span class="n">sort_col</span><span class="o">=</span><span class="n">sort_column</span><span class="p">)</span>

<span class="c"># grab the data, and legend (it should be what we passed in for most cases)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">report</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
<span class="n">legend</span> <span class="o">=</span> <span class="n">report</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span>

<span class="c"># once we have what we need, delete the report from the NetProfiler</span>
<span class="n">report</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

<span class="c"># print out the top ten hosts!</span>
<span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span>
</pre></div>
</div>
<p>Be sure to fill in appropriate values for <tt class="docutils literal"><span class="pre">$host</span></tt>, <tt class="docutils literal"><span class="pre">$username</span></tt> and <tt class="docutils literal"><span class="pre">$password</span></tt>.
Run this script as follows and you should see something like the following:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>python myreport.py
<span class="o">[[</span><span class="s1">&#39;10.100.6.12&#39;</span>, 1733552.81667, <span class="s1">&#39;&#39;</span><span class="o">]</span>,
 <span class="o">[</span><span class="s1">&#39;10.99.18.154&#39;</span>, 1027017.35, 0.124<span class="o">]</span>,
 <span class="o">[</span><span class="s1">&#39;10.100.5.12&#39;</span>, 814550.3, <span class="s1">&#39;&#39;</span><span class="o">]</span>,
 <span class="o">[</span><span class="s1">&#39;10.100.5.13&#39;</span>, 707320.527778, <span class="s1">&#39;&#39;</span><span class="o">]</span>,
 <span class="o">[</span><span class="s1">&#39;10.100.6.14&#39;</span>, 691441.777778, <span class="s1">&#39;&#39;</span><span class="o">]</span>,
 <span class="o">[</span><span class="s1">&#39;10.100.6.10&#39;</span>, 525593.25, <span class="s1">&#39;&#39;</span><span class="o">]</span>,
 <span class="o">[</span><span class="s1">&#39;10.100.120.108&#39;</span>, 455330.638889, <span class="s1">&#39;&#39;</span><span class="o">]</span>,
 <span class="o">[</span><span class="s1">&#39;10.100.5.11&#39;</span>, 443483.577778, <span class="s1">&#39;&#39;</span><span class="o">]</span>,
 <span class="o">[</span><span class="s1">&#39;10.100.6.11&#39;</span>, 385050.85, <span class="s1">&#39;&#39;</span><span class="o">]</span>,
 <span class="o">[</span><span class="s1">&#39;10.100.201.33&#39;</span>, 371349.105556, 0.046<span class="o">]]</span>
</pre></div>
</div>
<p>We&#8217;ve created our first report!  Let&#8217;s take a closer look at what we just did.</p>
<div class="highlight-bash"><div class="highlight"><pre>import pprint

from steelscript.netprofiler.core import NetProfiler

from steelscript.common.service import UserAuth
from steelscript.netprofiler.core.filters import TimeFilter
from steelscript.netprofiler.core.report import TrafficSummaryReport
</pre></div>
</div>
<p>These first few lines import our SteelScript modules and prepare them
for use in the rest of the script.  The Python Style guide (<a class="reference external" href="http://legacy.python.org/dev/peps/pep-0008/">PEP8</a>) indicates that common
or built-in modules like <tt class="docutils literal"><span class="pre">pprint</span></tt> are imported first, and custom
modules (like SteelScript) follow after.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># connection information</span>
<span class="n">username</span> <span class="o">=</span> <span class="s">&#39;$username&#39;</span>
<span class="n">password</span> <span class="o">=</span> <span class="s">&#39;$password&#39;</span>
<span class="n">auth</span> <span class="o">=</span> <span class="n">UserAuth</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
<span class="n">host</span> <span class="o">=</span> <span class="s">&#39;$host&#39;</span>
</pre></div>
</div>
<p>These are our login credentials.  We have them hard-coded into the script for
an example here, but we will show how to have these supplied on the command line
shortly.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># create a new NetProfiler instance</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">NetProfiler</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="n">auth</span><span class="p">)</span>

<span class="c"># setup basic info for our report</span>
<span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">host_ip</span><span class="p">,</span>
           <span class="n">p</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">avg_bytes</span><span class="p">,</span>
           <span class="n">p</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">network_rtt</span><span class="p">]</span>
<span class="n">sort_column</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">avg_bytes</span>
<span class="n">timefilter</span> <span class="o">=</span> <span class="n">TimeFilter</span><span class="o">.</span><span class="n">parse_range</span><span class="p">(</span><span class="s">&quot;last 5 m&quot;</span><span class="p">)</span>

<span class="c"># initialize a new report, and run it</span>
<span class="n">report</span> <span class="o">=</span> <span class="n">TrafficSummaryReport</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="n">report</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s">&#39;hos&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">timefilter</span><span class="o">=</span><span class="n">timefilter</span><span class="p">,</span> <span class="n">sort_col</span><span class="o">=</span><span class="n">sort_column</span><span class="p">)</span>
</pre></div>
</div>
<p>Now things get interesting.  After initializing a new NetProfiler instance,
we define some of the settings we want to use in our report:</p>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">columns</span></tt> is a list of column types we want to use in our report</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">sort_column</span></tt> indicates which column NetProfiler should use to sort on</p>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">timefilter</span></tt> provides a time range for what time period the report</dt>
<dd><p class="first last">should be limited to</p>
</dd>
</dl>
</li>
</ul>
<p>Next, a new report instance is created, and the variables we just defined are
used to generate a report.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># grab the data, and legend (it should be what we passed in for most cases)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">report</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
<span class="n">legend</span> <span class="o">=</span> <span class="n">report</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span>

<span class="c"># once we have what we need, delete the report from the NetProfiler</span>
<span class="n">report</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

<span class="c"># print out the top ten hosts!</span>
<span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span>
</pre></div>
</div>
<p>Here, the comments pretty well walk through what is happening.  Deleting
reports helps keep things tidy, but doesn&#8217;t cause harm if they are left around.
After a period of time the appliance will cleanup any leftover reports after 24
hours.</p>
<p>Finally, since we included a column to sort on in our report request, we can
just limit the output to the first ten items to get the top ten.</p>
</div>
<div class="section" id="reporting-columns">
<h2>4.1.5. Reporting Columns<a class="headerlink" href="#reporting-columns" title="Permalink to this headline">¶</a></h2>
<p>We chose only a small subset of the available columns for our example script.
We could include any columns applicable for this report type.  To help identify
which columns are available, we could start up a python console and try some of
the commands discussed in the <a class="reference external" href="columns.html">Profile Columns</a>
section, or we could use the helper command <tt class="docutils literal"><span class="pre">steel</span> <span class="pre">netprofiler</span> <span class="pre">columns</span></tt>.</p>
<p>The <tt class="docutils literal"><span class="pre">steel</span></tt> sommand should have been installed in one of your local
<tt class="docutils literal"><span class="pre">bin</span></tt> directories (<tt class="docutils literal"><span class="pre">Scripts</span></tt> on Windows).  Try the following
command to see if its on your path:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>which steel
</pre></div>
</div>
<p>If that doesn&#8217;t return a path, then you will need to add the directory where
has been installed to your shell&#8217;s system path.</p>
<p>Now that you are setup, let&#8217;s find some columns.</p>
<p>In our example, we glossed over the specific realm, centricity, and groupby that
was selected.  For a TrafficSummaryReport, those three items could be as follows:</p>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Possible values</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">realm</span></tt></td>
<td><tt class="docutils literal"><span class="pre">traffic_summary</span></tt></td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">centricity</span></tt></td>
<td><tt class="docutils literal"><span class="pre">hos</span></tt>, <tt class="docutils literal"><span class="pre">int</span></tt></td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">groupby</span></tt></td>
<td>any type except <tt class="docutils literal"><span class="pre">time_host_user</span></tt>, our example used <tt class="docutils literal"><span class="pre">host</span></tt></td>
</tr>
</tbody>
</table>
<p>Enter the following:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>steel netprofiler columns -h
Usage: steel netprofiler columns HOST <span class="o">[</span>options<span class="o">]</span> ...

List columns available <span class="k">for </span>NetProfiler reports
Required Arguments:

  HOST        NetProfiler hostname or IP address

Options:
  -h, --help            show this <span class="nb">help </span>message and <span class="nb">exit</span>

<span class="o">[</span>...text continues...<span class="o">]</span>
</pre></div>
</div>
<p>And you will see all of the available options to the script.  One thing you
will see are options for host, username, and password.  Where we had
those hardcoded in our example, now we pass them as options to the script.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>steel netprofiler columns <span class="nv">$hostname</span> -u <span class="nv">$username</span> -p <span class="nv">$password</span>
</pre></div>
</div>
<p>This will just execute and print nothing out if it was able to successfully
connect.  Now, let&#8217;s add our triplet information:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>steel netprofiler columns <span class="nv">$hostname</span> -u <span class="nv">$username</span> -p <span class="nv">$password</span> -r traffic_summary
  -c hos -g host --list-columns

Key Columns        Label                  ID
-------------------------------------------------
group_name         Group                  23
<span class="o">[</span>...text continues...<span class="o">]</span>

Value Columns                    Label                               ID
----------------------------------------------------------------------------
avg_bytes                        Avg Bytes/s                         33
avg_bytes_app                    Avg App Bytes/s                     504
<span class="o">[</span>...text continues...<span class="o">]</span>
</pre></div>
</div>
<p>The available key and value columns will be presented.  If additional columns were
desired for your report, select from this list.</p>
<p>We have chosen <tt class="docutils literal"><span class="pre">host</span></tt> as our groupby option, but to get a full list of what is available,
use the &#8216;&#8211;list-groupbys&#8217; option:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>steel netprofiler columns <span class="nv">$hostname</span> -u <span class="nv">$username</span> -p <span class="nv">$password</span> --list-groupbys

GroupBy                      Id
------------------------------------
host_pair                    hop
ip_mac_pair                  ipp
port_group                   pgr
<span class="o">[</span>...text continues...<span class="o">]</span>
</pre></div>
</div>
<p>Note that the correct value to pass in the <tt class="docutils literal"><span class="pre">steel</span> <span class="pre">netprofiler</span>
<span class="pre">columns</span></tt> script is the groupby name, not the Id.</p>
<p>Once you have found the set of columns you are interested in, you will now have
a means of including them in your report request.  The following syntax would
be one way to reference them:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">host_ip</span><span class="p">,</span>
           <span class="n">p</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">avg_bytes</span><span class="p">,</span>
           <span class="n">p</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">network_rtt</span><span class="p">]</span>
</pre></div>
</div>
<p>Assuming <tt class="docutils literal"><span class="pre">p</span></tt> is a NetProfiler instance, this would be one format to create
a list of key and value columns.  Keys are named <tt class="docutils literal"><span class="pre">p.columns.key.&lt;colname&gt;</span></tt> and
values are named <tt class="docutils literal"><span class="pre">p.columns.value.&lt;colname&gt;</span></tt>.</p>
<p>Additional discussion on columns can be found <a class="reference external" href="columns.html">here</a>.</p>
</div>
<div class="section" id="extending-the-example">
<h2>4.1.6. Extending the Example<a class="headerlink" href="#extending-the-example" title="Permalink to this headline">¶</a></h2>
<p>As a last item to help get started with your own scripts, we will extend our example
with two helpful features: command-line options and table outputs.</p>
<p>Rather than show how to update your existing example script, we will post the new
script below, then walk through key differences that add the features we are looking for.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>

<span class="kn">import</span> <span class="nn">optparse</span>

<span class="kn">from</span> <span class="nn">steelscript.netprofiler.core.filters</span> <span class="kn">import</span> <span class="n">TimeFilter</span>
<span class="kn">from</span> <span class="nn">steelscript.netprofiler.core.report</span> <span class="kn">import</span> <span class="n">TrafficSummaryReport</span>
<span class="kn">from</span> <span class="nn">steelscript.netprofiler.core.app</span> <span class="kn">import</span> <span class="n">NetProfilerApp</span>
<span class="kn">from</span> <span class="nn">steelscript.common.utils</span> <span class="kn">import</span> <span class="n">Formatter</span>

<span class="k">class</span> <span class="nc">ExampleApp</span><span class="p">(</span><span class="n">NetProfilerApp</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">add_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">):</span>
        <span class="n">group</span> <span class="o">=</span> <span class="n">optparse</span><span class="o">.</span><span class="n">OptionGroup</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="s">&quot;Example Options&quot;</span><span class="p">)</span>
        <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-r&#39;</span><span class="p">,</span> <span class="s">&#39;--timerange&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&#39;timerange&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                         <span class="n">help</span><span class="o">=</span><span class="s">&#39;Time range to limit report to, e.g. &quot;last 5 m&quot;&#39;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_option_group</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">netprofiler</span>

        <span class="n">report</span> <span class="o">=</span> <span class="n">TrafficSummaryReport</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

        <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">host_ip</span><span class="p">,</span>
                   <span class="n">p</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">avg_bytes</span><span class="p">,</span>
                   <span class="n">p</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">network_rtt</span><span class="p">]</span>
        <span class="n">sort_column</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">avg_bytes</span>

        <span class="n">timefilter</span> <span class="o">=</span> <span class="n">TimeFilter</span><span class="o">.</span><span class="n">parse_range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">timerange</span><span class="p">)</span>

        <span class="n">report</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s">&#39;hos&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">timefilter</span><span class="o">=</span><span class="n">timefilter</span><span class="p">,</span> <span class="n">sort_col</span><span class="o">=</span><span class="n">sort_column</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">report</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
        <span class="n">legend</span> <span class="o">=</span> <span class="n">report</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span>
        <span class="n">report</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

        <span class="n">header</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">key</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">]</span>
        <span class="n">Formatter</span><span class="o">.</span><span class="n">print_table</span><span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="mi">10</span><span class="p">],</span> <span class="n">header</span><span class="p">)</span>

<span class="n">ExampleApp</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>Copy that code into a new file, and run it with a timerange option,
and you will find the same base set of options used for <tt class="docutils literal"><span class="pre">steel</span>
<span class="pre">netprofiler</span> <span class="pre">columns</span></tt> are now included in this script.  Primarily,
<tt class="docutils literal"><span class="pre">hostname</span></tt>, <tt class="docutils literal"><span class="pre">username</span></tt>, <tt class="docutils literal"><span class="pre">password</span></tt> are now all items to be
passed to the script.</p>
<p>For example:</p>
<div class="highlight-python"><div class="highlight"><pre>&gt; python myreport2.py $hosthame -u $username -p $password -r &quot;last 10 min&quot;

host_ip           avg_bytes        network_rtt
--------------------------------------------------
10.100.6.12       683349.295833
10.100.5.13       653938.525
10.100.120.108    572001.791667
10.100.5.11       438921.75
10.100.201.30     405558.216667    0.051
10.100.5.12       398773.9875
10.100.201.20     359039.758333    0.153
10.100.201.21     306396.929167    0.154
10.100.202.2      301756.991667    0.011
10.100.201.32     293926.695833    0.064
</pre></div>
</div>
<p>We also get a nicely formatted table, too!</p>
<p>First we needed to import some new items:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>

<span class="kn">from</span> <span class="nn">steelscript.netprofiler.core.filters</span> <span class="kn">import</span> <span class="n">TimeFilter</span>
<span class="kn">from</span> <span class="nn">steelscript.netprofiler.core.report</span> <span class="kn">import</span> <span class="n">TrafficSummaryReport</span>
<span class="kn">from</span> <span class="nn">steelscript.netprofiler.core.app</span> <span class="kn">import</span> <span class="n">NetProfilerApp</span>
<span class="kn">from</span> <span class="nn">steelscript.common.utils</span> <span class="kn">import</span> <span class="n">Formatter</span>

<span class="kn">import</span> <span class="nn">optparse</span>
</pre></div>
</div>
<p>That bit at the top is called a shebang, it tells the system that it should
execute this script using the program after the &#8216;#!&#8217;.  We are also importing
<tt class="docutils literal"><span class="pre">NetProfilerApp</span></tt> and <tt class="docutils literal"><span class="pre">Formatter</span></tt> classes to help with our new updates.  The
built-in library <tt class="docutils literal"><span class="pre">optparse</span></tt> is used to parse command-line options.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">ExampleApp</span><span class="p">(</span><span class="n">NetProfilerApp</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">add_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">):</span>
        <span class="n">group</span> <span class="o">=</span> <span class="n">optparse</span><span class="o">.</span><span class="n">OptionGroup</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="s">&quot;Example Options&quot;</span><span class="p">)</span>
        <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-r&#39;</span><span class="p">,</span> <span class="s">&#39;--timerange&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&#39;timerange&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                         <span class="n">help</span><span class="o">=</span><span class="s">&#39;Time range to limit report to, e.g. &quot;last 5 m&quot;&#39;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_option_group</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
</pre></div>
</div>
<p>This section begins the definition of a new class, which inherits from the
class NetProfilerApp.  This is some of the magic of object-oriented programming,
a lot of functionality is defined as part of NetProfilerApp, including the
basics of authentication, and setting up a NetProfiler instance, and we get all
of that for <em>free</em>, just by inheriting from it.  In fact, we go beyond that,
and <em>extend</em> its functionality by defining the function <tt class="docutils literal"><span class="pre">add_options</span></tt>.  Here,
we add a new option to pass in a timerange on the commandline.</p>
<div class="highlight-python"><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">netprofiler</span>

        <span class="n">report</span> <span class="o">=</span> <span class="n">TrafficSummaryReport</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

        <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">host_ip</span><span class="p">,</span>
                   <span class="n">p</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">avg_bytes</span><span class="p">,</span>
                   <span class="n">p</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">network_rtt</span><span class="p">]</span>
        <span class="n">sort_column</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">avg_bytes</span>

        <span class="n">timefilter</span> <span class="o">=</span> <span class="n">TimeFilter</span><span class="o">.</span><span class="n">parse_range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">timerange</span><span class="p">)</span>

        <span class="n">report</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s">&#39;hos&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">timefilter</span><span class="o">=</span><span class="n">timefilter</span><span class="p">,</span> <span class="n">sort_col</span><span class="o">=</span><span class="n">sort_column</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">report</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
        <span class="n">legend</span> <span class="o">=</span> <span class="n">report</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span>
        <span class="n">report</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

        <span class="n">header</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">key</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">]</span>
        <span class="n">Formatter</span><span class="o">.</span><span class="n">print_table</span><span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="mi">10</span><span class="p">],</span> <span class="n">header</span><span class="p">)</span>

<span class="n">ExampleApp</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>This is the main part of the script, and remains mostly unchanged from our previous
version.  Rather than create the NetProfiler instance directly, that is now being
done for us as part of NetProfilerApp.  We just need to reference it as shown.</p>
<p>The timefilter option is now being pulled from the command-line,
<tt class="docutils literal"><span class="pre">self.options.timerange</span></tt>, so we have one additional item that can be varied
from run to run.</p>
<p>Next, we have to run some small magic to pull out the key information
from each of the column objects.  The expression in the brackets for
the header assignment is called a <a class="reference external" href="http://docs.python.org/2/tutorial/datastructures.html#list-comprehensions">list comprehension</a>.
Think of it like a condensed for-loop.  Once we have a header, we pass
that along with our data to the <tt class="docutils literal"><span class="pre">Formatter.print_table</span></tt> function,
and that will print out our data nicely formatted into columns.</p>
<p>The last line calls the main run-loop as defined in the NetProfilerApp class,
and the rest should function as before.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/rb-ss-logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="overview.html">SteelScript NetProfiler</a></h3>
  <ul>
<li><a class="reference internal" href="#">4.1. SteelScript NetProfiler Tutorial</a><ul>
<li><a class="reference internal" href="#background">4.1.1. Background</a></li>
<li><a class="reference internal" href="#netprofiler-objects">4.1.2. NetProfiler Objects</a></li>
<li><a class="reference internal" href="#startup">4.1.3. Startup</a></li>
<li><a class="reference internal" href="#generating-reports">4.1.4. Generating Reports</a></li>
<li><a class="reference internal" href="#reporting-columns">4.1.5. Reporting Columns</a></li>
<li><a class="reference internal" href="#extending-the-example">4.1.6. Extending the Example</a></li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/netprofiler/tutorial.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><h3>
<a href="../license.html">License</a>
</h3>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">steelscript  documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014 Riverbed Technology, Inc..
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>