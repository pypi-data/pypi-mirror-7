

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Porting from SimPy 2 to 3 &mdash; SimPy 3.0.4 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  

    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:'../',
        VERSION:'3.0.4',
        COLLAPSE_INDEX:false,
        FILE_SUFFIX:'.html',
        HAS_SOURCE:  true
      };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
    <link rel="top" title="SimPy 3.0.4 documentation" href="../index.html"/>
        <link rel="up" title="Topical Guides" href="index.html"/>
        <link rel="next" title="Examples" href="../examples/index.html"/>
        <link rel="prev" title="Process Interaction" href="process_interaction.html"/> 

  <script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="../contents.html" class="icon icon-home"> SimPy</a>
        <form class="wy-form" action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search docs" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">SimPy home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../simpy_intro/index.html">SimPy in 10 Minutes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../simpy_intro/installation.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../simpy_intro/basic_concepts.html">Basic Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../simpy_intro/process_interaction.html">Process Interaction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../simpy_intro/shared_resources.html">Shared Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../simpy_intro/how_to_proceed.html">How to Proceed</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Topical Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="simpy_basics.html">SimPy basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="environments.html">Environments</a></li>
<li class="toctree-l2"><a class="reference internal" href="events.html">Events</a></li>
<li class="toctree-l2"><a class="reference internal" href="process_interaction.html">Process Interaction</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Porting from SimPy 2 to 3</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html#condition-events">Condition events</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html#interrupts">Interrupts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html#monitoring">Monitoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html#resources-container">Resources: Container</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html#resources-preemptive-resource">Resources: Preemptive Resource</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html#resources-resource">Resources: Resource</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html#resources-store">Resources: Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html#shared-events">Shared events</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html#waiting-for-other-processes">Waiting for other processes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html#all-examples">All examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api_reference/index.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/simpy.html"><tt class="docutils literal"><span class="pre">simpy</span></tt> &#8212; The end user API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/simpy.core.html"><tt class="docutils literal"><span class="pre">simpy.core</span></tt> &#8212; SimPy&#8217;s core components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/simpy.events.html"><tt class="docutils literal"><span class="pre">simpy.events</span></tt> &#8212; Core event types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/simpy.monitoring.html"><tt class="docutils literal"><span class="pre">simpy.monitoring</span></tt> &#8212; Monitor SimPy simulations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/simpy.resources.html"><tt class="docutils literal"><span class="pre">simpy.resources</span></tt> &#8212; SimPy&#8217;s built-in resource types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/simpy.resources.base.html"><tt class="docutils literal"><span class="pre">simpy.resources.base</span></tt> &#8212; Base classes for all resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/simpy.resources.container.html"><tt class="docutils literal"><span class="pre">simpy.resources.container</span></tt> &#8212; Container type resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/simpy.resources.resource.html"><tt class="docutils literal"><span class="pre">simpy.resources.resource</span></tt> &#8211; Resource type resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/simpy.resources.store.html"><tt class="docutils literal"><span class="pre">simpy.resources.store</span></tt> &#8212; Store type resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/simpy.rt.html"><tt class="docutils literal"><span class="pre">simpy.rt</span></tt> &#8212; Real-time simulations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/simpy.util.html"><tt class="docutils literal"><span class="pre">simpy.util</span></tt> &#8212; Utility functions for SimPy</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../about/index.html">About SimPy</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../about/history.html">SimPy History &amp; Change Log</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about/acknowledgements.html">Acknowledgments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about/ports.html">Ports</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about/defense_of_design.html">Defense of Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about/release_process.html">Release Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about/license.html">License</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top">
        <i data-toggle="wy-nav-top" class="icon icon-reorder"></i>
        <a href="/">SimPy</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <ul class="wy-breadcrumbs">
  <li><a href="../contents.html">Docs</a> &raquo;</li>
  <li><a href="">Porting from SimPy 2 to 3</a></li>
  
</ul>
<hr/>

          
  <div class="section" id="porting-from-simpy-2-to-3">
<span id="porting-from-simpy2"></span><h1>Porting from SimPy 2 to 3<a class="headerlink" href="#porting-from-simpy-2-to-3" title="Permalink to this headline">¶</a></h1>
<p>Porting from SimPy 2 to SimPy 3 is not overly complicated. A lot of changes
merely comprise copy/paste.</p>
<p>This guide describes the conceptual and API changes between both SimPy versions
and shows you how to change your code for SimPy 3.</p>
<div class="section" id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Permalink to this headline">¶</a></h2>
<p>In SimPy 2, you had to decide at import-time whether you wanted to use a normal
simulation (<tt class="docutils literal"><span class="pre">SimPy.Simulation</span></tt>), a real-time simulation
(<tt class="docutils literal"><span class="pre">SimPy.SimulationRT</span></tt>) or something else. You usually had to import
<tt class="docutils literal"><span class="pre">Simulation</span></tt> (or <tt class="docutils literal"><span class="pre">SimulationRT</span></tt>), <tt class="docutils literal"><span class="pre">Process</span></tt> and some of the SimPy
keywords (<tt class="docutils literal"><span class="pre">hold</span></tt> or <tt class="docutils literal"><span class="pre">passivate</span></tt>, for example) from that package.</p>
<p>In SimPy 3, you usually need to import much less classes and modules (for
example, all keywords are gone). In most use cases you will now only need to
import <a class="reference internal" href="../api_reference/simpy.html#module-simpy" title="simpy"><tt class="xref py py-mod docutils literal"><span class="pre">simpy</span></tt></a>.</p>
<p><strong>SimPy 2</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">Simpy.Simulation</span> <span class="kn">import</span> <span class="n">Simulation</span><span class="p">,</span> <span class="n">Process</span><span class="p">,</span> <span class="n">hold</span>
</pre></div>
</div>
<p><strong>SimPy 3</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">simpy</span>
</pre></div>
</div>
</div>
<div class="section" id="the-simulation-classes">
<h2>The <tt class="docutils literal"><span class="pre">Simulation*</span></tt> classes<a class="headerlink" href="#the-simulation-classes" title="Permalink to this headline">¶</a></h2>
<p>SimPy 2 encapsulated the simulation state in a <tt class="docutils literal"><span class="pre">Simulation*</span></tt> class (e.g.,
<tt class="docutils literal"><span class="pre">Simulation</span></tt>, <tt class="docutils literal"><span class="pre">SimulationRT</span></tt> or <tt class="docutils literal"><span class="pre">SimulationTrace</span></tt>). This
class also had a <tt class="docutils literal"><span class="pre">simulate()</span></tt> method that executed a normal simulation,
a real-time simulation or something else (depending on the particular class).</p>
<p>There was a global <tt class="docutils literal"><span class="pre">Simulation</span></tt> instance that was automatically created when
you imported SimPy. You could also instantiate it on your own to uses SimPy&#8217;s
object-orient API. This led to some confusion and problems, because you had to
pass the <tt class="docutils literal"><span class="pre">Simulation</span></tt> instance around when you were using the object-oriented
API but not if you were using the procedural API.</p>
<p>In SimPy 3, an <a class="reference internal" href="../api_reference/simpy.core.html#simpy.core.Environment" title="simpy.core.Environment"><tt class="xref py py-class docutils literal"><span class="pre">Environment</span></tt></a> replaces <tt class="docutils literal"><span class="pre">Simulation</span></tt> and
<a class="reference internal" href="../api_reference/simpy.rt.html#simpy.rt.RealtimeEnvironment" title="simpy.rt.RealtimeEnvironment"><tt class="xref py py-class docutils literal"><span class="pre">RealtimeEnvironment</span></tt></a> replaces <tt class="docutils literal"><span class="pre">SimulationRT</span></tt>. You always
need to instantiate an environment. There&#8217;s no more global state.</p>
<p>To execute a simulation, you call the environment&#8217;s
<a class="reference internal" href="../api_reference/simpy.core.html#simpy.core.Environment.run" title="simpy.core.Environment.run"><tt class="xref py py-meth docutils literal"><span class="pre">run()</span></tt></a> method.</p>
<p><strong>SimPy 2</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Procedural API</span>
<span class="kn">from</span> <span class="nn">SimPy.Simulation</span> <span class="kn">import</span> <span class="n">initialize</span><span class="p">,</span> <span class="n">simulate</span>

<span class="n">initialize</span><span class="p">()</span>
<span class="c"># Start processes</span>
<span class="n">simulate</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Object-oriented API</span>
<span class="kn">from</span> <span class="nn">SimPy.Simulation</span> <span class="kn">import</span> <span class="n">Simulation</span>

<span class="n">sim</span> <span class="o">=</span> <span class="n">Simulation</span><span class="p">()</span>
<span class="c"># Start processes</span>
<span class="n">sim</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>SimPy3</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">simpy</span>

<span class="n">env</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Environment</span><span class="p">()</span>
<span class="c"># Start processes</span>
<span class="n">env</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="defining-a-process">
<h2>Defining a Process<a class="headerlink" href="#defining-a-process" title="Permalink to this headline">¶</a></h2>
<p>Processes had to inherit the <tt class="docutils literal"><span class="pre">Process</span></tt> base class in SimPy 2. Subclasses had
to implement at least a so called <em>Process Execution Method (PEM)</em> (which is
basically a generator function) and in most cases <tt class="docutils literal"><span class="pre">__init__()</span></tt>. Each process
needed to know the <tt class="docutils literal"><span class="pre">Simulation</span></tt> instance it belonged to. This reference was
passed implicitly in the procedural API and had to be passed explicitly in the
object-oriented API. Apart from some internal problems, this made it quite
cumbersome to define a simple process.</p>
<p>Processes were started by passing the <tt class="docutils literal"><span class="pre">Process</span></tt> and a generator instance
created by the generator function to either the global <tt class="docutils literal"><span class="pre">activate()</span></tt> function
or the corresponding <tt class="docutils literal"><span class="pre">Simulation</span></tt> method.</p>
<p>A process in SimPy 3 is a Python generator (no matter if it’s defined on module
level or as an instance method) wrapped in a <a class="reference internal" href="../api_reference/simpy.events.html#simpy.events.Process" title="simpy.events.Process"><tt class="xref py py-class docutils literal"><span class="pre">Process</span></tt></a>
instance. The generator usually requires a reference to a
<a class="reference internal" href="../api_reference/simpy.core.html#simpy.core.Environment" title="simpy.core.Environment"><tt class="xref py py-class docutils literal"><span class="pre">Environment</span></tt></a> to interact with, but this is completely
optional.</p>
<p>Processes are can be started by creating a <a class="reference internal" href="../api_reference/simpy.events.html#simpy.events.Process" title="simpy.events.Process"><tt class="xref py py-class docutils literal"><span class="pre">Process</span></tt></a>
instance and passing the generator to it. The environment provides a shortcut
for this: <a class="reference internal" href="../api_reference/simpy.core.html#simpy.core.Environment.process" title="simpy.core.Environment.process"><tt class="xref py py-meth docutils literal"><span class="pre">process()</span></tt></a>.</p>
<p><strong>SimPy 2</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Procedural API</span>
<span class="kn">from</span> <span class="nn">Simpy.Simulation</span> <span class="kn">import</span> <span class="n">Process</span>

<span class="k">class</span> <span class="nc">MyProcess</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">another_param</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">another_param</span> <span class="o">=</span> <span class="n">another_param</span>

    <span class="k">def</span> <span class="nf">generator_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Implement the process&#39; behavior.&quot;&quot;&quot;</span>
        <span class="k">yield</span> <span class="n">something</span>

<span class="n">initialize</span><span class="p">()</span>
<span class="n">proc</span> <span class="o">=</span> <span class="n">Process</span><span class="p">(</span><span class="s">&#39;Spam&#39;</span><span class="p">)</span>
<span class="n">activate</span><span class="p">(</span><span class="n">proc</span><span class="p">,</span> <span class="n">proc</span><span class="o">.</span><span class="n">generator_function</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Object-oriented API</span>
<span class="kn">from</span> <span class="nn">SimPy.Simulation</span> <span class="kn">import</span> <span class="n">Simulation</span><span class="p">,</span> <span class="n">Process</span>

<span class="k">class</span> <span class="nc">MyProcess</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sim</span><span class="p">,</span> <span class="n">another_param</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">sim</span><span class="o">=</span><span class="n">sim</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">another_param</span> <span class="o">=</span> <span class="n">another_param</span>

    <span class="k">def</span> <span class="nf">generator_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Implement the process&#39; behaviour.&quot;&quot;&quot;</span>
        <span class="k">yield</span> <span class="n">something</span>

<span class="n">sim</span> <span class="o">=</span> <span class="n">Simulation</span><span class="p">()</span>
<span class="n">proc</span> <span class="o">=</span> <span class="n">Process</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="s">&#39;Spam&#39;</span><span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">activate</span><span class="p">(</span><span class="n">proc</span><span class="p">,</span> <span class="n">proc</span><span class="o">.</span><span class="n">generator_function</span><span class="p">())</span>
</pre></div>
</div>
<p><strong>SimPy 3</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">simpy</span>

<span class="k">def</span> <span class="nf">generator_function</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">another_param</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Implement the process&#39; behavior.&quot;&quot;&quot;</span>
    <span class="k">yield</span> <span class="n">something</span>

<span class="n">env</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Environment</span><span class="p">()</span>
<span class="n">proc</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">generator_function</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="s">&#39;Spam&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="simpy-keywords-hold-etc">
<h2>SimPy Keywords (<tt class="docutils literal"><span class="pre">hold</span></tt> etc.)<a class="headerlink" href="#simpy-keywords-hold-etc" title="Permalink to this headline">¶</a></h2>
<p>In SimPy 2, processes created new events by yielding a <em>SimPy Keyword</em> and some
additional parameters (at least <tt class="docutils literal"><span class="pre">self</span></tt>). These keywords had to be imported
from <tt class="docutils literal"><span class="pre">SimPy.Simulation*</span></tt> if they were used. Internally, the keywords were
mapped to a function that generated the according event.</p>
<p>In SimPy 3, you directly yield <a class="reference internal" href="../api_reference/simpy.events.html#module-simpy.events" title="simpy.events"><tt class="xref py py-mod docutils literal"><span class="pre">events</span></tt></a> if you want to wait for an
event to occur. You can instantiate an event directly or use the shortcuts
provided by <a class="reference internal" href="../api_reference/simpy.core.html#simpy.core.Environment" title="simpy.core.Environment"><tt class="xref py py-class docutils literal"><span class="pre">Environment</span></tt></a>.</p>
<p>Generally, whenever a process yields an event, the execution of the process is
suspended and resumed once the event has been triggered. To motivate this
understanding, some of the events were renamed. For example, the <tt class="docutils literal"><span class="pre">hold</span></tt>
keyword meant to wait until some time has passed. In terms of events this means
that a timeout has happened. Therefore <tt class="docutils literal"><span class="pre">hold</span></tt> has been replaced by a
<a class="reference internal" href="../api_reference/simpy.events.html#simpy.events.Timeout" title="simpy.events.Timeout"><tt class="xref py py-class docutils literal"><span class="pre">Timeout</span></tt></a> event.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><a class="reference internal" href="../api_reference/simpy.events.html#simpy.events.Process" title="simpy.events.Process"><tt class="xref py py-class docutils literal"><span class="pre">Process</span></tt></a> is also an <a class="reference internal" href="../api_reference/simpy.events.html#simpy.events.Event" title="simpy.events.Event"><tt class="xref py py-class docutils literal"><span class="pre">Event</span></tt></a>. If
you want to wait for a process to finish, simply yield it.</p>
</div>
<p><strong>SimPy 2</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">yield</span> <span class="n">hold</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">duration</span>
<span class="k">yield</span> <span class="n">passivate</span><span class="p">,</span> <span class="bp">self</span>
<span class="k">yield</span> <span class="n">request</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">resource</span>
<span class="k">yield</span> <span class="n">release</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">resource</span>
<span class="k">yield</span> <span class="n">waitevent</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">event</span>
<span class="k">yield</span> <span class="n">waitevent</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="n">event_a</span><span class="p">,</span> <span class="n">event_b</span><span class="p">,</span> <span class="n">event_c</span><span class="p">]</span>
<span class="k">yield</span> <span class="n">queueevent</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">event_list</span>
<span class="k">yield</span> <span class="n">get</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">amount</span>
<span class="k">yield</span> <span class="n">put</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">amount</span>
</pre></div>
</div>
<p><strong>SimPy 3</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">duration</span><span class="p">)</span>        <span class="c"># hold: renamed</span>
<span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">event</span><span class="p">()</span>                  <span class="c"># passivate: renamed</span>
<span class="k">yield</span> <span class="n">resource</span><span class="o">.</span><span class="n">request</span><span class="p">()</span>           <span class="c"># Request is now bound to class Resource</span>
<span class="n">resource</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>                 <span class="c"># Release no longer needs to be yielded</span>
<span class="k">yield</span> <span class="n">event</span>                        <span class="c"># waitevent: just yield the event</span>
<span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">all_of</span><span class="p">([</span><span class="n">event_a</span><span class="p">,</span> <span class="n">event_b</span><span class="p">,</span> <span class="n">event_c</span><span class="p">])</span>  <span class="c"># waitvent</span>
<span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">any_of</span><span class="p">([</span><span class="n">event_a</span><span class="p">,</span> <span class="n">event_b</span><span class="p">,</span> <span class="n">event_c</span><span class="p">])</span>  <span class="c"># queuevent</span>
<span class="k">yield</span> <span class="n">container</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>        <span class="c"># Level is now called Container</span>
<span class="k">yield</span> <span class="n">container</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>

<span class="k">yield</span> <span class="n">event_a</span> <span class="o">|</span> <span class="n">event_b</span>            <span class="c"># Wait for either a or b. This is new.</span>
<span class="k">yield</span> <span class="n">event_a</span> <span class="o">&amp;</span> <span class="n">event_b</span>            <span class="c"># Wait for a and b. This is new.</span>
<span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">calculation</span><span class="p">(</span><span class="n">env</span><span class="p">))</span>  <span class="c"># Wait for the process calculation to</span>
                                     <span class="c"># to finish.</span>
</pre></div>
</div>
<div class="section" id="partially-supported-features">
<h3>Partially supported features<a class="headerlink" href="#partially-supported-features" title="Permalink to this headline">¶</a></h3>
<p>The following <tt class="docutils literal"><span class="pre">waituntil</span></tt> keyword is not completely supported anymore:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">yield</span> <span class="n">waituntil</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">cond_func</span>
</pre></div>
</div>
<p>SimPy 2 was evaluating <tt class="docutils literal"><span class="pre">cond_func</span></tt> after <em>every</em> event, which was
computationally very expensive. One possible workaround is for example the
following process, which evaluates <tt class="docutils literal"><span class="pre">cond_func</span></tt> periodically:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">waituntil</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">cond_func</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">cond_func</span><span class="p">():</span>
        <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>

<span class="c"># Usage:</span>
<span class="k">yield</span> <span class="n">waituntil</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">cond_func</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="interrupts">
<h2>Interrupts<a class="headerlink" href="#interrupts" title="Permalink to this headline">¶</a></h2>
<p>In SimPy 2, <tt class="docutils literal"><span class="pre">interrupt()</span></tt> was a method of the interrupting process. The
victim of the interrupt had to be passed as an argument.</p>
<p>The victim was not directly notified of the interrupt but had to check if the
<tt class="docutils literal"><span class="pre">interrupted</span></tt> flag was set. Afterwards, it had to reset the interrupt via
<tt class="docutils literal"><span class="pre">interruptReset()</span></tt>. You could manually set the <tt class="docutils literal"><span class="pre">interruptCause</span></tt> attribute
of the victim.</p>
<p>Explicitly checking for an interrupt is obviously error prone as it is too easy
to be forgotten.</p>
<p>In SimPy 3, you call <a class="reference internal" href="../api_reference/simpy.events.html#simpy.events.Process.interrupt" title="simpy.events.Process.interrupt"><tt class="xref py py-meth docutils literal"><span class="pre">interrupt()</span></tt></a> on the victim
process. You can optionally supply a cause. An <a class="reference internal" href="../api_reference/simpy.events.html#simpy.events.Interrupt" title="simpy.events.Interrupt"><tt class="xref py py-exc docutils literal"><span class="pre">Interrupt</span></tt></a>
is then thrown into the victim process, which has to handle the interrupt via
<tt class="docutils literal"><span class="pre">try:</span> <span class="pre">...</span> <span class="pre">except</span> <span class="pre">Interrupt:</span> <span class="pre">...</span></tt>.</p>
<p><strong>SimPy 2</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Interrupter</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">victim</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">victim</span> <span class="o">=</span> <span class="n">victim</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">hold</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interrupt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">victim_proc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">victim_proc</span><span class="o">.</span><span class="n">interruptCause</span> <span class="o">=</span> <span class="s">&#39;Spam&#39;</span>

<span class="k">class</span> <span class="nc">Victim</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">hold</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="mi">10</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">interrupted</span><span class="p">:</span>
            <span class="n">cause</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interruptCause</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interruptReset</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>SimPy 3</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">interrupter</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">victim_proc</span><span class="p">):</span>
    <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">victim_proc</span><span class="o">.</span><span class="n">interrupt</span><span class="p">(</span><span class="s">&#39;Spam&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">victim</span><span class="p">(</span><span class="n">env</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">Interrupt</span> <span class="k">as</span> <span class="n">interrupt</span><span class="p">:</span>
        <span class="n">cause</span> <span class="o">=</span> <span class="n">interrupt</span><span class="o">.</span><span class="n">cause</span>
</pre></div>
</div>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p>This guide is by no means complete. If you run into problems, please have
a look at the other <a class="reference internal" href="index.html"><em>guides</em></a>, the <a class="reference internal" href="../examples/index.html"><em>examples</em></a> or the <a class="reference internal" href="../api_reference/index.html"><em>API Reference</em></a>. You are also very
welcome to submit improvements. Just create a pull request at <a class="reference external" href="https://bitbucket.org/simpy/simpy/">bitbucket</a>.</p>
</div>
</div>


          <footer>
  
    <div class="rst-footer-buttons">
      
        <a href="../examples/index.html" class="btn btn-neutral float-right" title="Examples"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="process_interaction.html" class="btn btn-neutral" title="Process Interaction"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <p>
      &copy; Copyright 2002-2014, Team SimPy.
  </p>

  <a href="https://www.github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="http://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  

</body>
</html>