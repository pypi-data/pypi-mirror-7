

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Process Interaction &mdash; SimPy 3.0.4 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  

    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:'../',
        VERSION:'3.0.4',
        COLLAPSE_INDEX:false,
        FILE_SUFFIX:'.html',
        HAS_SOURCE:  true
      };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
    <link rel="top" title="SimPy 3.0.4 documentation" href="../index.html"/>
        <link rel="up" title="Topical Guides" href="index.html"/>
        <link rel="next" title="Porting from SimPy 2 to 3" href="porting_from_simpy2.html"/>
        <link rel="prev" title="Events" href="events.html"/> 

  <script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="../contents.html" class="icon icon-home"> SimPy</a>
        <form class="wy-form" action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search docs" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">SimPy home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../simpy_intro/index.html">SimPy in 10 Minutes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../simpy_intro/installation.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../simpy_intro/basic_concepts.html">Basic Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../simpy_intro/process_interaction.html">Process Interaction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../simpy_intro/shared_resources.html">Shared Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../simpy_intro/how_to_proceed.html">How to Proceed</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Topical Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="simpy_basics.html">SimPy basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="environments.html">Environments</a></li>
<li class="toctree-l2"><a class="reference internal" href="events.html">Events</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Process Interaction</a></li>
<li class="toctree-l2"><a class="reference internal" href="porting_from_simpy2.html">Porting from SimPy 2 to 3</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html#condition-events">Condition events</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html#interrupts">Interrupts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html#monitoring">Monitoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html#resources-container">Resources: Container</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html#resources-preemptive-resource">Resources: Preemptive Resource</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html#resources-resource">Resources: Resource</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html#resources-store">Resources: Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html#shared-events">Shared events</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html#waiting-for-other-processes">Waiting for other processes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html#all-examples">All examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api_reference/index.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/simpy.html"><tt class="docutils literal"><span class="pre">simpy</span></tt> &#8212; The end user API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/simpy.core.html"><tt class="docutils literal"><span class="pre">simpy.core</span></tt> &#8212; SimPy&#8217;s core components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/simpy.events.html"><tt class="docutils literal"><span class="pre">simpy.events</span></tt> &#8212; Core event types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/simpy.monitoring.html"><tt class="docutils literal"><span class="pre">simpy.monitoring</span></tt> &#8212; Monitor SimPy simulations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/simpy.resources.html"><tt class="docutils literal"><span class="pre">simpy.resources</span></tt> &#8212; SimPy&#8217;s built-in resource types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/simpy.resources.base.html"><tt class="docutils literal"><span class="pre">simpy.resources.base</span></tt> &#8212; Base classes for all resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/simpy.resources.container.html"><tt class="docutils literal"><span class="pre">simpy.resources.container</span></tt> &#8212; Container type resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/simpy.resources.resource.html"><tt class="docutils literal"><span class="pre">simpy.resources.resource</span></tt> &#8211; Resource type resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/simpy.resources.store.html"><tt class="docutils literal"><span class="pre">simpy.resources.store</span></tt> &#8212; Store type resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/simpy.rt.html"><tt class="docutils literal"><span class="pre">simpy.rt</span></tt> &#8212; Real-time simulations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/simpy.util.html"><tt class="docutils literal"><span class="pre">simpy.util</span></tt> &#8212; Utility functions for SimPy</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../about/index.html">About SimPy</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../about/history.html">SimPy History &amp; Change Log</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about/acknowledgements.html">Acknowledgments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about/ports.html">Ports</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about/defense_of_design.html">Defense of Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about/release_process.html">Release Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about/license.html">License</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top">
        <i data-toggle="wy-nav-top" class="icon icon-reorder"></i>
        <a href="/">SimPy</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <ul class="wy-breadcrumbs">
  <li><a href="../contents.html">Docs</a> &raquo;</li>
  <li><a href="">Process Interaction</a></li>
  
</ul>
<hr/>

          
  <div class="section" id="process-interaction">
<h1>Process Interaction<a class="headerlink" href="#process-interaction" title="Permalink to this headline">Â¶</a></h1>
<p>Event discrete simulation is only made interesting by interactions between
processes.</p>
<p>So this guide is about:</p>
<ul class="simple">
<li><a class="reference internal" href="#sleep-until-woken-up"><em>Sleep until woken up</em></a> (passivate/reactivate)</li>
<li><a class="reference internal" href="#waiting-for-another-process-to-terminate"><em>Waiting for another process to terminate</em></a></li>
<li><a class="reference internal" href="#interrupting-another-process"><em>Interrupting another process</em></a></li>
</ul>
<p>The first two items were already covered in the <a class="reference internal" href="events.html"><em>Events</em></a> guide, but we&#8217;ll
also include them here for the sake of completeness.</p>
<p>Another possibility for processes to interact are resources. They are discussed
in a <tt class="xref doc docutils literal"><span class="pre">separate</span> <span class="pre">guide</span></tt>.</p>
<div class="section" id="sleep-until-woken-up">
<span id="id1"></span><h2>Sleep until woken up<a class="headerlink" href="#sleep-until-woken-up" title="Permalink to this headline">Â¶</a></h2>
<p>Imagine you want to model an electric vehicle with an intelligent
battery-charging controller. While the vehicle is driving, the controller can
be passive but needs to be reactivate once the vehicle is connected to the
power grid in order to charge the battery.</p>
<p>In SimPy 2, this pattern was known as <em>passivate / reactivate</em>. In SimPy 3,
you can accomplish that with a simple, shared <a class="reference internal" href="../api_reference/simpy.events.html#simpy.events.Event" title="simpy.events.Event"><tt class="xref py py-class docutils literal"><span class="pre">Event</span></tt></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">seed</span><span class="p">,</span> <span class="n">randint</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">seed</span><span class="p">(</span><span class="mi">23</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">simpy</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">EV</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">env</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">drive_proc</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drive</span><span class="p">(</span><span class="n">env</span><span class="p">))</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">bat_ctrl_proc</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bat_ctrl</span><span class="p">(</span><span class="n">env</span><span class="p">))</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">bat_ctrl_reactivate</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">event</span><span class="p">()</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">drive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
<span class="gp">... </span>            <span class="c"># Drive for 20-40 min</span>
<span class="gp">... </span>            <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">))</span>
<span class="gp">...</span>
<span class="gp">... </span>            <span class="c"># Park for 1â6 hours</span>
<span class="gp">... </span>            <span class="k">print</span><span class="p">(</span><span class="s">&#39;Start parking at&#39;</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>
<span class="gp">... </span>            <span class="bp">self</span><span class="o">.</span><span class="n">bat_ctrl_reactivate</span><span class="o">.</span><span class="n">succeed</span><span class="p">()</span>  <span class="c"># &quot;reactivate&quot;</span>
<span class="gp">... </span>            <span class="bp">self</span><span class="o">.</span><span class="n">bat_ctrl_reactivate</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">event</span><span class="p">()</span>
<span class="gp">... </span>            <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">360</span><span class="p">))</span>
<span class="gp">... </span>            <span class="k">print</span><span class="p">(</span><span class="s">&#39;Stop parking at&#39;</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">bat_ctrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">print</span><span class="p">(</span><span class="s">&#39;Bat. ctrl. passivating at&#39;</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>
<span class="gp">... </span>            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">bat_ctrl_reactivate</span>  <span class="c"># &quot;passivate&quot;</span>
<span class="gp">... </span>            <span class="k">print</span><span class="p">(</span><span class="s">&#39;Bat. ctrl. reactivated at&#39;</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>            <span class="c"># Intelligent charging behavior here â¦</span>
<span class="gp">... </span>            <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">90</span><span class="p">))</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">env</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Environment</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ev</span> <span class="o">=</span> <span class="n">EV</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">env</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="go">Bat. ctrl. passivating at 0</span>
<span class="go">Start parking at 29</span>
<span class="go">Bat. ctrl. reactivated at 29</span>
<span class="go">Bat. ctrl. passivating at 60</span>
<span class="go">Stop parking at 131</span>
</pre></div>
</div>
<p>Since <tt class="docutils literal"><span class="pre">bat_ctrl()</span></tt> just waits for a normal event, we no longer call this
pattern <em>passivate / reactivate</em> in SimPy 3.</p>
</div>
<div class="section" id="waiting-for-another-process-to-terminate">
<span id="id2"></span><h2>Waiting for another process to terminate<a class="headerlink" href="#waiting-for-another-process-to-terminate" title="Permalink to this headline">Â¶</a></h2>
<p>The example above has a problem: it may happen that the vehicles wants to park
for a shorter duration than it takes to charge the battery (this is the case if
both, charging and parking would take 60 to 90 minutes).</p>
<p>To fix this problem we have to slightly change our model. A new <tt class="docutils literal"><span class="pre">bat_ctrl()</span></tt>
will be started every time the EV starts parking. The EV then waits until the
parking duration is over <em>and</em> until the charging has stopped:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">EV</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">env</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">drive_proc</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drive</span><span class="p">(</span><span class="n">env</span><span class="p">))</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">drive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
<span class="gp">... </span>            <span class="c"># Drive for 20-40 min</span>
<span class="gp">... </span>            <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">))</span>
<span class="gp">...</span>
<span class="gp">... </span>            <span class="c"># Park for 1â6 hours</span>
<span class="gp">... </span>            <span class="k">print</span><span class="p">(</span><span class="s">&#39;Start parking at&#39;</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>
<span class="gp">... </span>            <span class="n">charging</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bat_ctrl</span><span class="p">(</span><span class="n">env</span><span class="p">))</span>
<span class="gp">... </span>            <span class="n">parking</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">360</span><span class="p">))</span>
<span class="gp">... </span>            <span class="k">yield</span> <span class="n">charging</span> <span class="o">&amp;</span> <span class="n">parking</span>
<span class="gp">... </span>            <span class="k">print</span><span class="p">(</span><span class="s">&#39;Stop parking at&#39;</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">bat_ctrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Bat. ctrl. started at&#39;</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>
<span class="gp">... </span>        <span class="c"># Intelligent charging behavior here â¦</span>
<span class="gp">... </span>        <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">90</span><span class="p">))</span>
<span class="gp">... </span>        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Bat. ctrl. done at&#39;</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">env</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Environment</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ev</span> <span class="o">=</span> <span class="n">EV</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">env</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="mi">310</span><span class="p">)</span>
<span class="go">Start parking at 29</span>
<span class="go">Bat. ctrl. started at 29</span>
<span class="go">Bat. ctrl. done at 83</span>
<span class="go">Stop parking at 305</span>
</pre></div>
</div>
<p>Again, nothing new (if you&#8217;ve read the <a class="reference internal" href="events.html"><em>Events</em></a> guide) and special is
happening. SimPy processes are events, too, so you can yield them and will thus
wait for them to get triggered. You can also wait for two events at the same
time by concatenating them with <tt class="docutils literal"><span class="pre">&amp;</span></tt> (see
<a class="reference internal" href="events.html#waiting-for-multiple-events-at-once"><em>Waiting for multiple events at once</em></a>).</p>
</div>
<div class="section" id="interrupting-another-process">
<span id="id3"></span><h2>Interrupting another process<a class="headerlink" href="#interrupting-another-process" title="Permalink to this headline">Â¶</a></h2>
<p>As usual, we now have another problem: Imagine, a trip is very urgent, but with
the current implementation, we always need to wait until the battery is fully
charged. If we could somehow interrupt that ...</p>
<p>Fortunate coincidence, there is indeed a way to do exactly this. You can call
<tt class="docutils literal"><span class="pre">interrupt()</span></tt> on a <a class="reference internal" href="../api_reference/simpy.events.html#simpy.events.Process" title="simpy.events.Process"><tt class="xref py py-class docutils literal"><span class="pre">Process</span></tt></a>. This will throw an
<a class="reference internal" href="../api_reference/simpy.events.html#simpy.events.Interrupt" title="simpy.events.Interrupt"><tt class="xref py py-class docutils literal"><span class="pre">Interrupt</span></tt></a> exception into that process, resuming it
immediately:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">EV</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">env</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">drive_proc</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drive</span><span class="p">(</span><span class="n">env</span><span class="p">))</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">drive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
<span class="gp">... </span>            <span class="c"># Drive for 20-40 min</span>
<span class="gp">... </span>            <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">))</span>
<span class="gp">...</span>
<span class="gp">... </span>            <span class="c"># Park for 1 hour</span>
<span class="gp">... </span>            <span class="k">print</span><span class="p">(</span><span class="s">&#39;Start parking at&#39;</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>
<span class="gp">... </span>            <span class="n">charging</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bat_ctrl</span><span class="p">(</span><span class="n">env</span><span class="p">))</span>
<span class="gp">... </span>            <span class="n">parking</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
<span class="gp">... </span>            <span class="k">yield</span> <span class="n">charging</span> <span class="o">|</span> <span class="n">parking</span>
<span class="gp">... </span>            <span class="k">if</span> <span class="ow">not</span> <span class="n">charging</span><span class="o">.</span><span class="n">triggered</span><span class="p">:</span>
<span class="gp">... </span>                <span class="c"># Interrupt charging if not already done.</span>
<span class="gp">... </span>                <span class="n">charging</span><span class="o">.</span><span class="n">interrupt</span><span class="p">(</span><span class="s">&#39;Need to go!&#39;</span><span class="p">)</span>
<span class="gp">... </span>            <span class="k">print</span><span class="p">(</span><span class="s">&#39;Stop parking at&#39;</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">bat_ctrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Bat. ctrl. started at&#39;</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">try</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">90</span><span class="p">))</span>
<span class="gp">... </span>            <span class="k">print</span><span class="p">(</span><span class="s">&#39;Bat. ctrl. done at&#39;</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">except</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Interrupt</span> <span class="k">as</span> <span class="n">i</span><span class="p">:</span>
<span class="gp">... </span>            <span class="c"># Onoes! Got interrupted before the charging was done.</span>
<span class="gp">... </span>            <span class="k">print</span><span class="p">(</span><span class="s">&#39;Bat. ctrl. interrupted at&#39;</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">,</span> <span class="s">&#39;msg:&#39;</span><span class="p">,</span>
<span class="gp">... </span>                  <span class="n">i</span><span class="o">.</span><span class="n">cause</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">env</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Environment</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ev</span> <span class="o">=</span> <span class="n">EV</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">env</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="go">Start parking at 31</span>
<span class="go">Bat. ctrl. started at 31</span>
<span class="go">Stop parking at 91</span>
<span class="go">Bat. ctrl. interrupted at 91 msg: Need to go!</span>
</pre></div>
</div>
<p>What <tt class="docutils literal"><span class="pre">process.interrupt()</span></tt> actually does is scheduling an
<a class="reference internal" href="../api_reference/simpy.events.html#simpy.events.Interruption" title="simpy.events.Interruption"><tt class="xref py py-class docutils literal"><span class="pre">Interruption</span></tt></a> event for immediate execution. If this
event is executed it will remove the victim process&#8217; <tt class="docutils literal"><span class="pre">_resume()</span></tt> method from
the callbacks of the event that it is currently waiting for (see
<a class="reference internal" href="../api_reference/simpy.events.html#simpy.events.Process.target" title="simpy.events.Process.target"><tt class="xref py py-attr docutils literal"><span class="pre">target</span></tt></a>). Following that it will throw the
<tt class="docutils literal"><span class="pre">Interrupt</span></tt> exception into the process.</p>
<p>Since we don&#8217;t to anything special to the original target event of the process,
the interrupted process can yield the same event again after catching the
<tt class="docutils literal"><span class="pre">Interrupt</span></tt> â Imagine someone waiting for a shop to open. The person may get
interrupted by a phone call.  After finishing the call, he or she checks if the
shop already opened and either enters or continues to wait.</p>
</div>
</div>


          <footer>
  
    <div class="rst-footer-buttons">
      
        <a href="porting_from_simpy2.html" class="btn btn-neutral float-right" title="Porting from SimPy 2 to 3"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="events.html" class="btn btn-neutral" title="Events"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <p>
      &copy; Copyright 2002-2014, Team SimPy.
  </p>

  <a href="https://www.github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="http://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  

</body>
</html>