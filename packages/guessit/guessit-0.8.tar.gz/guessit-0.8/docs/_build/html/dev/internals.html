<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Understanding the MatchTree &mdash; GuessIt 0.7.2.dev0 documentation</title>
    
    <link rel="stylesheet" href="../_static/flasky.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.7.2.dev0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="GuessIt 0.7.2.dev0 documentation" href="../index.html" />
    <link rel="next" title="Guess" href="../api/guess.html" />
    <link rel="prev" title="Python module usage" href="../user/python.html" />
   
  <link href='http://fonts.googleapis.com/css?family=Ubuntu' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Ubuntu+Mono' rel='stylesheet' type='text/css'>
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../api/guess.html" title="Guess"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../user/python.html" title="Python module usage"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">GuessIt 0.7.2.dev0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="understanding-the-matchtree">
<span id="internals"></span><h1>Understanding the MatchTree<a class="headerlink" href="#understanding-the-matchtree" title="Permalink to this headline">¶</a></h1>
<p>The basic structure that the filename detection component uses is the
<tt class="docutils literal"><span class="pre">MatchTree</span></tt>. A <tt class="docutils literal"><span class="pre">MatchTree</span></tt> is a tree covering the filename, where each
node represent a substring in the filename and can have a <tt class="docutils literal"><span class="pre">Guess</span></tt>
associated with it that contains the information that has been guessed
in this node. Nodes can be further split into subnodes until a proper
split has been found.</p>
<p>This makes it so that all the leaves concatenated will give you back
the original filename. But enough theory, let&#8217;s look at an example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">path</span> <span class="o">=</span> <span class="s">&#39;Movies/Dark City (1998)/Dark.City.(1998).DC.BDRip.720p.DTS.X264-CHD.mkv&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">guessit</span><span class="o">.</span><span class="n">IterativeMatcher</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">match_tree</span>
<span class="go">000000 1111111111111111 2222222222222222222222222222222222222222222 333</span>
<span class="go">000000 0000000000111111 0000000000111111222222222222222222222222222 000</span>
<span class="go">                 011112           011112000000000000000000000000111</span>
<span class="go">                                        000000000000000000011112</span>
<span class="go">                                        0000000000111122222</span>
<span class="go">                                        0000111112    01112</span>
<span class="go">Movies/__________(____)/Dark.City.(____).DC._____.____.___.____-___.___</span>
<span class="go">       tttttttttt yyyy             yyyy     fffff ssss aaa vvvv rrr ccc</span>
<span class="go">Movies/Dark City (1998)/Dark.City.(1998).DC.BDRip.720p.DTS.X264-CHD.mkv</span>
</pre></div>
</div>
<p>The last line contains the filename, which you can use a reference.
The previous line contains the type of property that has been found.
The line before that contains the filename, where all the found groups
have been blanked. Basically, what is left on this line are the leftover
groups which could not be identified.</p>
<p>The lines before that indicate the indices of the groups in the tree.</p>
<p>For instance, the part of the filename &#8216;BDRip&#8217; is the leaf with index
<tt class="docutils literal"><span class="pre">(2,</span> <span class="pre">2,</span> <span class="pre">0,</span> <span class="pre">0,</span> <span class="pre">0,</span> <span class="pre">1)</span></tt> (read from top to bottom), and its meaning is &#8216;format&#8217;
(as shown by the <tt class="docutils literal"><span class="pre">f</span></tt>&#8216;s on the last-but-one line).</p>
</div>
<div class="section" id="what-does-the-iterativematcher-do">
<h1>What does the IterativeMatcher do?<a class="headerlink" href="#what-does-the-iterativematcher-do" title="Permalink to this headline">¶</a></h1>
<p>The goal of the <em class="xref std std-ref">api/matcher</em> is to take a <tt class="docutils literal"><span class="pre">MatchTree</span></tt> which
contains no information (yet!) at the beginning, and apply a succession of
rules to try to guess parts of the filename. These rules are called
transformations and work in-place on the tree, splitting into new leaves
and updating the nodes&#8217;s guesses when it finds some information.</p>
<p>Let&#8217;s look at what happens when matching the previous filename.</p>
<div class="section" id="splitting-into-path-components">
<h2>Splitting into path components<a class="headerlink" href="#splitting-into-path-components" title="Permalink to this headline">¶</a></h2>
<p>First, we split the filename into folders + basename + extension
This gives us the following tree, which has 4 leaves (from 0 to 3):</p>
<div class="highlight-python"><div class="highlight"><pre>000000 1111111111111111 2222222222222222222222222222222222222222222 333
Movies/Dark City (1998)/Dark.City.(1998).DC.BDRip.720p.DTS.X264-CHD.mkv
</pre></div>
</div>
</div>
<div class="section" id="splitting-into-explicit-groups">
<h2>Splitting into explicit groups<a class="headerlink" href="#splitting-into-explicit-groups" title="Permalink to this headline">¶</a></h2>
<p>Then, we want to split each of those groups into &#8220;explicit&#8221; groups, i.e.:
groups which are enclosed in parentheses, square brackets, curly braces, etc.:</p>
<div class="highlight-python"><div class="highlight"><pre>000000 1111111111111111 2222222222222222222222222222222222222222222 333
000000 0000000000111111 0000000000111111222222222222222222222222222 000
Movies/Dark City (1998)/Dark.City.(1998).DC.BDRip.720p.DTS.X264-CHD.___
                                                                    ccc
Movies/Dark City (1998)/Dark.City.(1998).DC.BDRip.720p.DTS.X264-CHD.mkv
</pre></div>
</div>
<p>As you can see, the containing folder has been split into 2 sub-groups,
and the basename into 3 groups (separated by the year information).</p>
<p>Note that we also got the information from the extension, as you can see
above.</p>
</div>
<div class="section" id="finding-interesting-patterns">
<h2>Finding interesting patterns<a class="headerlink" href="#finding-interesting-patterns" title="Permalink to this headline">¶</a></h2>
<p>Now that this first split has been made, we can start finding some known
patterns which we can identify in the filename.
That is the main objective of the <tt class="docutils literal"><span class="pre">IterativeMatcher</span></tt>, which will run
a series of transformations which can identify groups in the filename and
will annotate the corresponding nodes.</p>
<p>For instance, the year:</p>
<div class="highlight-python"><div class="highlight"><pre>000000 1111111111111111 2222222222222222222222222222222222222222222 333
000000 0000000000111111 0000000000111111222222222222222222222222222 000
                 011112           011112
Movies/Dark City (____)/Dark.City.(____).DC.BDRip.720p.DTS.X264-CHD.___
                  yyyy             yyyy                             ccc
Movies/Dark City (1998)/Dark.City.(1998).DC.BDRip.720p.DTS.X264-CHD.mkv
</pre></div>
</div>
<p>Then, known properties usually found in video filenames:</p>
<div class="highlight-python"><div class="highlight"><pre>000000 1111111111111111 2222222222222222222222222222222222222222222 333
000000 0000000000111111 0000000000111111222222222222222222222222222 000
                 011112           011112000000000000000000000000111
                                        000000000000000000011112
                                        0000000000111122222
                                        0000111112    01112
Movies/Dark City (____)/Dark.City.(____).DC._____.____.___.____-___.___
                  yyyy             yyyy     fffff ssss aaa vvvv rrr ccc
Movies/Dark City (1998)/Dark.City.(1998).DC.BDRip.720p.DTS.X264-CHD.mkv
</pre></div>
</div>
<p>As you can see, this starts to branch pretty quickly, as each found group
splits a leaf into further leaves. In this case, that gives us the
year (1998), the format (BDRip), the screen size (720p), the video codec
(x264) and the release group (CHD).</p>
</div>
<div class="section" id="using-positional-rules-to-find-the-title-property">
<h2>Using positional rules to find the &#8216;title&#8217; property<a class="headerlink" href="#using-positional-rules-to-find-the-title-property" title="Permalink to this headline">¶</a></h2>
<p>Now that we found all the known patterns that we could, it is time to try
to guess what is the title of the movie. This is done by looking at which
groups in the filename are still unidentified, and trying to guess which
one corresponds to the title by looking at their position:</p>
<div class="highlight-python"><div class="highlight"><pre>000000 1111111111111111 2222222222222222222222222222222222222222222 333
000000 0000000000111111 0000000000111111222222222222222222222222222 000
                 011112           011112000000000000000000000000111
                                        000000000000000000011112
                                        0000000000111122222
                                        0000111112    01112
Movies/__________(____)/Dark.City.(____).DC._____.____.___.____-___.___
       tttttttttt yyyy             yyyy     fffff ssss aaa vvvv rrr ccc
Movies/Dark City (1998)/Dark.City.(1998).DC.BDRip.720p.DTS.X264-CHD.mkv
</pre></div>
</div>
<p>In this case, as the containing folder is composed of 2 groups, the second
of which is the year, we can (usually) safely assume that the first one
corresponds to the movie title.</p>
</div>
</div>
<div class="section" id="merging-all-the-results-in-a-matchtree-to-give-a-final-guess">
<h1>Merging all the results in a MatchTree to give a final Guess<a class="headerlink" href="#merging-all-the-results-in-a-matchtree-to-give-a-final-guess" title="Permalink to this headline">¶</a></h1>
<p>Once that we have matched as many groups as we could, the job is not done yet.
Indeed, every leaf of the tree that we could identify contains the found property
in its guess, but what we want at the end is to have a single <tt class="docutils literal"><span class="pre">Guess</span></tt> containing
all the information.</p>
<p>There are some simple strategies implemented to try to deal with conflicts
and/or duplicate properties. In our example, &#8216;year&#8217; appears twice, but
as it has the same value, so it will be merged into a single &#8216;year&#8217; property,
but with a confidence that represents the combined confidence of both guesses.
If the properties were conflicting, we would take the one with the highest
confidence and lower it accordingly.</p>
<p>Here:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">path</span> <span class="o">=</span> <span class="s">&#39;Movies/Dark City (1998)/Dark.City.(1998).DC.BDRip.720p.DTS.X264-CHD.mkv&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">guessit</span><span class="o">.</span><span class="n">guess_movie_info</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="go">{&#39;videoCodec&#39;: &#39;h264&#39;, &#39;container&#39;: &#39;mkv&#39;, &#39;format&#39;: &#39;BluRay&#39;,</span>
<span class="go">&#39;title&#39;: &#39;Dark City&#39;, &#39;releaseGroup&#39;: &#39;CHD&#39;, &#39;screenSize&#39;: &#39;720p&#39;,</span>
<span class="go">&#39;year&#39;: 1998, &#39;type&#39;: &#39;movie&#39;, &#39;audioCodec&#39;: &#39;DTS&#39;}</span>
</pre></div>
</div>
<p>And that gives you your final guess!</p>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper"><p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/guessit-logo.png" alt="Logo"/>
  </a>
</p>
<p>
<iframe src="http://ghbtns.com/github-btn.html?user=wackou&repo=guessit&type=watch&count=true&size=large"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>

<p>
  GuessIt is a python library that tries to extract as much information
  as possible from a file.
</p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Understanding the MatchTree</a></li>
<li><a class="reference internal" href="#what-does-the-iterativematcher-do">What does the IterativeMatcher do?</a><ul>
<li><a class="reference internal" href="#splitting-into-path-components">Splitting into path components</a></li>
<li><a class="reference internal" href="#splitting-into-explicit-groups">Splitting into explicit groups</a></li>
<li><a class="reference internal" href="#finding-interesting-patterns">Finding interesting patterns</a></li>
<li><a class="reference internal" href="#using-positional-rules-to-find-the-title-property">Using positional rules to find the &#8216;title&#8217; property</a></li>
</ul>
</li>
<li><a class="reference internal" href="#merging-all-the-results-in-a-matchtree-to-give-a-final-guess">Merging all the results in a MatchTree to give a final Guess</a></li>
</ul>
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="../user/python.html" title="previous chapter">Python module usage</a></li>
      <li>Next: <a href="../api/guess.html" title="next chapter">Guess</a></li>
  </ul></li>
</ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy; Copyright 2014 Nicolas Wack.
    </div>
  </body>
</html>