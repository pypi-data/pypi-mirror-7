<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    <title>Optimizing Kallithea Performance &mdash; Kallithea 0 documentation</title>

    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Kallithea 0 documentation" href="../index.html" />
    <link rel="next" title="Kallithea repository locking system" href="locking.html" />
    <link rel="prev" title="GIT support" href="git_support.html" />
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="locking.html" title="Kallithea repository locking system"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="git_support.html" title="GIT support"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Kallithea 0 documentation</a> &raquo;</li>
      </ul>
    </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">

  <div class="section" id="optimizing-kallithea-performance">
<span id="performance"></span><h1>Optimizing Kallithea Performance<a class="headerlink" href="#optimizing-kallithea-performance" title="Permalink to this headline">Â¶</a></h1>
<p>When serving large amount of big repositories Kallithea can start
performing slower than expected. Because of demanding nature of handling large
amount of data from version control systems here are some tips how to get
the best performance.</p>
<ul class="simple">
<li>Kallithea will perform better on machines with faster disks (SSD/SAN). It&#8217;s
more important to have faster disk than faster CPU.</li>
<li>Slowness on initial page can be easily fixed by grouping repositories, and/or
increasing cache size (see below), that includes using lightweight dashboard
option and vcs_full_cache setting in .ini file</li>
</ul>
<p>Follow these few steps to improve performance of Kallithea system.</p>
<ol class="arabic">
<li><p class="first">Increase cache</p>
<blockquote>
<div><p>in the .ini file:</p>
<div class="highlight-python"><div class="highlight"><pre>beaker.cache.sql_cache_long.expire=3600 &lt;-- set this to higher number
</pre></div>
</div>
<p>This option affects the cache expiration time for main page. Having
few hundreds of repositories on main page can sometimes make the system
to behave slow when cache expires for all of them. Increasing <cite>expire</cite>
option to day (86400) or a week (604800) will improve general response
times for the main page. Kallithea has an intelligent cache expiration
system and it will expire cache for repositories that had been changed.</p>
</div></blockquote>
</li>
<li><p class="first">Switch from sqlite to postgres or mysql</p>
<blockquote>
<div><p>sqlite is a good option when having small load on the system. But due to
locking issues with sqlite, it&#8217;s not recommended to use it for larger
setup. Switching to mysql or postgres will result in a immediate
performance increase.</p>
</div></blockquote>
</li>
<li><p class="first">Scale Kallithea horizontally</p>
<blockquote>
<div><p>Scaling horizontally can give huge performance increase when dealing with
large traffic (large amount of users, CI servers etc). Kallithea can be
scaled horizontally on one (recommended) or multiple machines. In order
to scale horizontally you need to do the following:</p>
<ul class="simple">
<li>each instance needs it&#8217;s own .ini file and unique <cite>instance_id</cite> set in them</li>
<li>each instance <cite>data</cite> storage needs to be configured to be stored on a
shared disk storage, preferably together with repositories. This <cite>data</cite>
dir contains template caches, sessions, whoosh index and it&#8217;s used for
tasks locking (so it&#8217;s safe across multiple instances). Set the
<cite>cache_dir</cite>, <cite>index_dir</cite>, <cite>beaker.cache.data_dir</cite>, <cite>beaker.cache.lock_dir</cite>
variables in each .ini file to shared location across Kallithea instances</li>
<li>if celery is used each instance should run separate celery instance, but
the message broken should be common to all of them (ex one rabbitmq
shared server)</li>
<li>load balance using round robin or ip hash, recommended is writing LB rules
that will separate regular user traffic from automated processes like CI
servers or build bots.</li>
</ul>
</div></blockquote>
</li>
</ol>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<h3>Support Kallithea development</h3>
<div style="text-align:center">
<form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
<input type="hidden" name="cmd" value="_s-xclick">
<input type="hidden" name="hosted_button_id" value="EYXFS3SQPHYUL">
<input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
<img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
</form>
    <div style="padding:5px">
     <a href="https://flattr.com/thing/922714/Donate-to-Software-Freedom-Conservancy" target="_blank">
     <img src="http://api.flattr.com/button/flattr-badge-large.png" alt="Flattr this" title="Flattr this" border="0" /></a>
    </div>
</div>

  <h4>Previous topic</h4>
  <p class="topless"><a href="git_support.html"
                        title="previous chapter">GIT support</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="locking.html"
                        title="next chapter">Kallithea repository locking system</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/usage/performance.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="locking.html" title="Kallithea repository locking system"
             >next</a> |</li>
        <li class="right" >
          <a href="git_support.html" title="GIT support"
             >previous</a> |</li>
        <li><a href="../index.html">Kallithea 0 documentation</a> &raquo;</li>
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2010-2014 by various authors, licensed as GPLv3..
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>