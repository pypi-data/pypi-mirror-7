<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Comment configurer le mode ‘live’ avec pywws &mdash; documentation pywws 13.09_r1069</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '13.09_r1069',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <link rel="shortcut icon" href="../_static/pywws_logo.ico"/>
    <link rel="top" title="documentation pywws 13.09_r1069" href="../index.html" />
    <link rel="up" title="Guides utilisateur" href="index.html" />
    <link rel="next" title="Comment intégrer divers services météorologiques à pywws" href="integration.html" />
    <link rel="prev" title="Comment configurer la journalisation horaire avec pywws" href="hourlylogging.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Index général"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Index des modules Python"
             >modules</a> |</li>
        <li class="right" >
          <a href="integration.html" title="Comment intégrer divers services météorologiques à pywws"
             accesskey="N">suivant</a> |</li>
        <li class="right" >
          <a href="hourlylogging.html" title="Comment configurer la journalisation horaire avec pywws"
             accesskey="P">précédent</a> |</li>
        <li><a href="../index.html">documentation pywws 13.09_r1069</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Guides utilisateur</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="how-to-set-up-live-logging-with-pywws">
<h1>Comment configurer le mode &#8216;live&#8217; avec pywws<a class="headerlink" href="#how-to-set-up-live-logging-with-pywws" title="Lien permanent vers ce titre">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Lien permanent vers ce titre">¶</a></h2>
<p>Pywws offre deux modes de fonctionnement très différents. Habituellement le programme <a class="reference internal" href="../api/pywws.Hourly.html#module-pywws.Hourly" title="pywws.Hourly"><tt class="xref py py-mod docutils literal"><span class="pre">Hourly</span></tt></a> devrait être exécuté à intervale régulier (habituellement chaque heure) à partir d&#8217;une tâche programmée (Cron). Ceci convient aux sites Web plutôt statiques, mais des mises à jour plus fréquentes peuvent être utiles pour des sites comme Weather Underground (<a class="reference external" href="http://www.wunderground.com/">http://www.wunderground.com/</a>). Le plus récent programme <a class="reference internal" href="../api/pywws.LiveLog.html#module-pywws.LiveLog" title="pywws.LiveLog"><tt class="xref py py-mod docutils literal"><span class="pre">LiveLog</span></tt></a> s&#8217;exécute continuellement et peut envoyer des données à chaque 48 secondes.</p>
</div>
<div class="section" id="getting-started">
<h2>Mise en route<a class="headerlink" href="#getting-started" title="Lien permanent vers ce titre">¶</a></h2>
<p>Avant tout, vous devez installer pywws et vous assurer qu&#8217;il reçoit bien les informations de votre station météo. Voir <a class="reference internal" href="getstarted.html"><em>Comment démarrer avec pywws</em></a> pour plus de détails.</p>
<p>Essayez d&#8217;exécuter <a class="reference internal" href="../api/pywws.LiveLog.html#module-pywws.LiveLog" title="pywws.LiveLog"><tt class="xref py py-mod docutils literal"><span class="pre">LiveLog</span></tt></a> à partir de la ligne de commande, avec un haut niveau de commentaires pour que vous puissiez voir ce qui se passe:</p>
<div class="highlight-python"><div class="highlight"><pre>python -m pywws.LiveLog -vvv ~/weather/data
</pre></div>
</div>
<p>En moins de cinq minutes (assumant que vous avez un intervalle de relevé de 5 minutes) vous devriez voir le message &#8216;live_data new ptr&#8217;, suivi par la recherche et le traitement de nouvelles données de la station météorologique. Laissez <a class="reference internal" href="../api/pywws.LiveLog.html#module-pywws.LiveLog" title="pywws.LiveLog"><tt class="xref py py-mod docutils literal"><span class="pre">LiveLog</span></tt></a> fonctionner une ou deux minutes de plus, puis arrêtez le processus en tapant &#8216;&lt;Ctrl&gt;C&#8217;.</p>
</div>
<div class="section" id="configuring-file-locations">
<h2>Configurer l&#8217;emplacement des fichiers<a class="headerlink" href="#configuring-file-locations" title="Lien permanent vers ce titre">¶</a></h2>
<p>Ouvrez votre fichier weather.ini avec un éditeur de texte. Vous devriez avoir une section <tt class="docutils literal"><span class="pre">[paths]</span></tt> similaire à ce qui suit (où <tt class="docutils literal"><span class="pre">xxx</span></tt> est votre nom d&#8217;usager):</p>
<div class="highlight-python"><div class="highlight"><pre>[paths]
work = /tmp/weather
templates = /home/xxx/weather/templates/
graph_templates = /home/xxx/weather/graph_templates/
</pre></div>
</div>
<p>Éditez pour correspondre à votre installation et à vos préférences. <tt class="docutils literal"><span class="pre">work</span></tt> est un dossier temporaire utilisé pour emmagasiner les fichiers intermédiaires, <tt class="docutils literal"><span class="pre">templates</span></tt> est le dossier où vous gardez vos fichiers de gabarit texte et <tt class="docutils literal"><span class="pre">graph_templates</span></tt> est le dossier où vous gardez vos fichiers de gabarit graphes. Ne pas utiliser les dossiers exemple de pywws pour celà, puisqu&#8217;ils seront écrasés lors de mise à jour de pywws.</p>
<p>Copiez vos fichiers de gabarits texte et graphes dans les dossiers appropriés. Vous pouvez trouver les quelques exemples fournis avec pywws fort utiles pour débuter.  Si vous avez installé pywws avec la commande <tt class="docutils literal"><span class="pre">pip</span></tt>, les exemples devrait se trouver dans le dossier <tt class="docutils literal"><span class="pre">/usr/share/pywws</span></tt> ou <tt class="docutils literal"><span class="pre">/usr/local/share/pywws</span></tt> ou similaire.</p>
</div>
<div class="section" id="configuring-periodic-tasks">
<h2>Configurer les tâches périodiques<a class="headerlink" href="#configuring-periodic-tasks" title="Lien permanent vers ce titre">¶</a></h2>
<p>Dans weather.ini vous devriez avoir une section <tt class="docutils literal"><span class="pre">[live]</span></tt> similaire à celle-ci:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="n">live</span><span class="p">]</span>
<span class="n">services</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">twitter</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">plot</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">text</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</div>
<p>Cette section spécifie ce que devrait faire pywws à chaque fois qu&#8217;il reçoit une lecture de la station météo, ex. toutes les 48 secondes. Les entrées <tt class="docutils literal"><span class="pre">services</span></tt> sont des listes de services météo en ligne sur lesquels envoyer vos données météo, ex. <tt class="docutils literal"><span class="pre">['underground']</span></tt>. Les entrées <tt class="docutils literal"><span class="pre">plot</span></tt> et <tt class="docutils literal"><span class="pre">text</span></tt> sont des listes de fichiers gabarits de graphe et de texte à téléverser sur votre site web, et l&#8217;entrée <tt class="docutils literal"><span class="pre">twitter</span></tt> est une liste de gabarits pour les messages à poster sur Twitter. Vous devriez probablement laisser toutes ces entrées vides, sauf pour <tt class="docutils literal"><span class="pre">services</span></tt>.</p>
<p>Si vous utilisez YoWindow (<a class="reference external" href="http://yowindow.com/">http://yowindow.com/</a>) vous pouvez ajouter l&#8217;entrée à la section <tt class="docutils literal"><span class="pre">[live]</span></tt> pour spécifier votre fichier YoWindow, ex.:</p>
<div class="highlight-python"><div class="highlight"><pre>[live]
yowindow = /home/jim/data/yowindow.xml
services = [&#39;underground&#39;]
...
</pre></div>
</div>
<p>Si vous ne les avez pas déjà, créez quatre sections supplémentaires dans votre fichier weather.ini : <tt class="docutils literal"><span class="pre">[logged]</span></tt>, <tt class="docutils literal"><span class="pre">[hourly]</span></tt>, <tt class="docutils literal"><span class="pre">[12</span> <span class="pre">hourly]</span></tt> et <tt class="docutils literal"><span class="pre">[daily]</span></tt>. Ces sections doivent avoir des entrées similaires à la section <tt class="docutils literal"><span class="pre">[live]</span></tt>, et spécifiez ce qui doit être fait chaque fois qu&#8217;une donnée est enregistrée (5 à 30 minutes, dépendant de votre intervalle), chaque heure, deux fois par jour et chaque jour. Ajoutez les noms de vos fichiers de gabarit à l&#8217;entrée appropriée, par exemple:</p>
<div class="highlight-python"><div class="highlight"><pre>[logged]
services = [&#39;underground&#39;, &#39;metoffice&#39;]
twitter = []
plot = []
text = []

[hourly]
services = []
twitter = [&#39;tweet.txt&#39;]
plot = [&#39;7days.png.xml&#39;, &#39;24hrs.png.xml&#39;, &#39;rose_24hrs.png.xml&#39;]
text = [&#39;24hrs.txt&#39;, &#39;6hrs.txt&#39;, &#39;7days.txt&#39;]

[12 hourly]
services = []
twitter = []
plot = []
text = []

[daily]
services = []
twitter = [&#39;forecast.txt&#39;]
plot = [&#39;28days.png.xml&#39;]
text = [&#39;allmonths.txt&#39;]
</pre></div>
</div>
</div>
<div class="section" id="using-a-utility-script">
<h2>Utilisation d&#8217;un script<a class="headerlink" href="#using-a-utility-script" title="Lien permanent vers ce titre">¶</a></h2>
<p>L&#8217;installation de pywws inclu un petit script <tt class="docutils literal"><span class="pre">pywws-livelog.py</span></tt> qui se trouve dans le dossier <tt class="docutils literal"><span class="pre">/usr/bin</span></tt> ou <tt class="docutils literal"><span class="pre">/usr/local/bin</span></tt> ou similaire. Vous devriez être en mesure d&#8217;utiliser ce script pour exécuter <a class="reference internal" href="../api/pywws.LiveLog.html#module-pywws.LiveLog" title="pywws.LiveLog"><tt class="xref py py-mod docutils literal"><span class="pre">LiveLog</span></tt></a>:</p>
<div class="highlight-python"><div class="highlight"><pre>pywws-livelog.py -v ~/weather/data
</pre></div>
</div>
</div>
<div class="section" id="run-in-the-background">
<h2>Exécuter en arrière-plan<a class="headerlink" href="#run-in-the-background" title="Lien permanent vers ce titre">¶</a></h2>
<p>Afin que <a class="reference internal" href="../api/pywws.LiveLog.html#module-pywws.LiveLog" title="pywws.LiveLog"><tt class="xref py py-mod docutils literal"><span class="pre">LiveLog</span></tt></a> continue de fonctionner après avoir fini d&#8217;utiliser votre ordinateur, vous devez exécuter ce programme en tant que &#8216;tâche en arrière-plan&#8217;. Sur la plupart des systèmes Linux / UNIX vous pouvez faire celà en ajoutant simplement le symbole (&#8216;&amp;&#8217;) à la fin de la ligne de commande. Par exemple:</p>
<div class="highlight-python"><div class="highlight"><pre>pywws-livelog.py ~/weather/data &amp;
</pre></div>
</div>
<p>Cependant, il peut être utile de savoir ce qui ne va pas si le programme se bloque pour une raison quelconque. <a class="reference internal" href="../api/pywws.LiveLog.html#module-pywws.LiveLog" title="pywws.LiveLog"><tt class="xref py py-mod docutils literal"><span class="pre">LiveLog</span></tt></a> peut enregistrer ces messages dans un fichier d&#8217;historique, pour ce faire spécifiez l&#8217;option <tt class="docutils literal"><span class="pre">-l</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre>pywws-livelog.py -v -l ~/weather/data/pywws.log ~/weather/data &amp;
</pre></div>
</div>
</div>
<div class="section" id="automatic-restarting">
<h2>Redémarrage automatique<a class="headerlink" href="#automatic-restarting" title="Lien permanent vers ce titre">¶</a></h2>
<p>Il y a une plusieurs manières de configurer un système Linux pour lancer un programme au démarrage de l&#8217;ordinateur. Habituellement pour ce faire, vous devez mettre un fichier dans <tt class="docutils literal"><span class="pre">/etc/init.d/</span></tt>, ce qui requière les privilèges &#8216;root&#8217;. Un problème un peu plus difficile est d&#8217;assurer qu&#8217;un programme redémarre s&#8217;il se bloque. Ma solution à ces deux problèmes consiste à exécuter le script cron suivant, toutes les heures.</p>
<div class="highlight-python"><div class="highlight"><pre>#!/bin/sh

pidfile=/var/run/pywws.pid
datadir=/data/weather
logfile=$datadir/live_logger.log

# exit if process is running
[ -f $pidfile ] &amp;&amp; kill -0 `cat $pidfile` &amp;&amp; exit

# email last few lines of the logfile to see why it died
if [ -f $logfile ]; then
  log=/var/log/log-weather
  tail -40 $logfile &gt;$log
  /home/jim/scripts/email-log.sh $log &quot;weather log&quot;
  rm $log
  fi

# restart process
pywws-livelog.py -v -l $logfile $datadir &amp;
echo $! &gt;$pidfile
</pre></div>
</div>
<p>Ce script enregistre l&#8217;identificateur de processus exécutant <a class="reference internal" href="../api/pywws.LiveLog.html#module-pywws.LiveLog" title="pywws.LiveLog"><tt class="xref py py-mod docutils literal"><span class="pre">LiveLog</span></tt></a> dans le pidfile. Si le processus fonctionne, le script ne fait rien. Si le processus a bloqué, il m’envoie un courriel contenant les 40 dernières lignes du fichier d&#8217;historique (en utilisant un script qui crée un message et l&#8217;envoi par sendmail) puis redémarre <a class="reference internal" href="../api/pywws.LiveLog.html#module-pywws.LiveLog" title="pywws.LiveLog"><tt class="xref py py-mod docutils literal"><span class="pre">LiveLog</span></tt></a>. Vous devrez éditer beaucoup pour adapter à vos emplacements de dossier et ainsi de suite, mais il donne une certaine idée de ce qui doit être fait.</p>
<p>Commentaires ou questions? SVP, souscrivez à la liste d&#8217;envoi de pywws <a class="reference external" href="http://groups.google.com/group/pywws">http://groups.google.com/group/pywws</a> et laissez-le nous savoir.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/pywws_logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table des Matières</a></h3>
  <ul>
<li><a class="reference internal" href="#">Comment configurer le mode &#8216;live&#8217; avec pywws</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#getting-started">Mise en route</a></li>
<li><a class="reference internal" href="#configuring-file-locations">Configurer l&#8217;emplacement des fichiers</a></li>
<li><a class="reference internal" href="#configuring-periodic-tasks">Configurer les tâches périodiques</a></li>
<li><a class="reference internal" href="#using-a-utility-script">Utilisation d&#8217;un script</a></li>
<li><a class="reference internal" href="#run-in-the-background">Exécuter en arrière-plan</a></li>
<li><a class="reference internal" href="#automatic-restarting">Redémarrage automatique</a></li>
</ul>
</li>
</ul>

  <h4>Sujet précédent</h4>
  <p class="topless"><a href="hourlylogging.html"
                        title="Chapitre précédent">Comment configurer la journalisation horaire avec pywws</a></p>
  <h4>Sujet suivant</h4>
  <p class="topless"><a href="integration.html"
                        title="Chapitre suivant">Comment intégrer divers services météorologiques à pywws</a></p>
<div id="searchbox" style="display: none">
  <h3>Recherche rapide</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Saisissez un mot clef ou un nom de module, classe ou fonction.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Index général"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Index des modules Python"
             >modules</a> |</li>
        <li class="right" >
          <a href="integration.html" title="Comment intégrer divers services météorologiques à pywws"
             >suivant</a> |</li>
        <li class="right" >
          <a href="hourlylogging.html" title="Comment configurer la journalisation horaire avec pywws"
             >précédent</a> |</li>
        <li><a href="../index.html">documentation pywws 13.09_r1069</a> &raquo;</li>
          <li><a href="index.html" >Guides utilisateur</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2008-13, Jim Easterbrook.
      Créé avec <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>