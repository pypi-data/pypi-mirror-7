

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Programming API &mdash; Tallywallet manual v0.008</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="Tallywallet manual v0.008" href="index.html"/>
        <link rel="next" title="A tutorial on Currency Exchange" href="selinger.html"/>
        <link rel="prev" title="Tallywallet - a Money framework in Python" href="index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="index.html" class="fa fa-home"> Tallywallet</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="">Programming API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#module-tallywallet.common.currency">Currency</a></li>
<li class="toctree-l2"><a class="reference internal" href="#trade">Trade</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-tallywallet.common.exchange">Exchange</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-tallywallet.common.ledger">Ledger</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-tallywallet.common.output">Output</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="selinger.html">A tutorial on Currency Exchange</a><ul>
<li class="toctree-l2"><a class="reference internal" href="selinger.html#jan-1">Jan 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="selinger.html#jan-2">Jan 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="selinger.html#jan-3">Jan 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="selinger.html#jan-5">Jan 5</a></li>
<li class="toctree-l2"><a class="reference internal" href="selinger.html#jan-7">Jan 7</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="wilson.html">A simple Keen Monetary Circuit simulation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="wilson.html#why-you-shouldn-t-use-tallywallet-in-an-economic-simulation">Why you shouldn&#8217;t use Tallywallet in an economic simulation...</a></li>
<li class="toctree-l2"><a class="reference internal" href="wilson.html#and-why-you-might-do">...and why you might do</a></li>
<li class="toctree-l2"><a class="reference internal" href="wilson.html#ledger-simulation-example">Ledger simulation example</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Tallywallet</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Programming API</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="_sources/api.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="programming-api">
<h1>Programming API<a class="headerlink" href="#programming-api" title="Permalink to this headline">¶</a></h1>
<div class="section" id="module-tallywallet.common.currency">
<span id="currency"></span><h2>Currency<a class="headerlink" href="#module-tallywallet.common.currency" title="Permalink to this headline">¶</a></h2>
<p>The currency module defines currencies of various types. As of this
release, there are only a handful yet defined.</p>
<dl class="class">
<dt id="tallywallet.common.currency.Currency">
<em class="property">class </em><tt class="descclassname">tallywallet.common.currency.</tt><tt class="descname">Currency</tt><a class="reference internal" href="_modules/tallywallet/common/currency.html#Currency"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tallywallet.common.currency.Currency" title="Permalink to this definition">¶</a></dt>
<dd><p>This is an enumeration class which captures the codes defined in
<a class="reference external" href="http://en.wikipedia.org/wiki/ISO_4217">ISO 4217</a> for international currencies.</p>
</dd></dl>

</div>
<div class="section" id="trade">
<h2>Trade<a class="headerlink" href="#trade" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="tallywallet.common.trade.TradePath">
<em class="property">class </em><tt class="descclassname">tallywallet.common.trade.</tt><tt class="descname">TradePath</tt><a class="headerlink" href="#tallywallet.common.trade.TradePath" title="Permalink to this definition">¶</a></dt>
<dd><p><cite>TradePath(rcv, work, out)</cite></p>
<p>A 3-tuple of <a class="reference internal" href="#currency">Currency</a> objects, describing the path of a foreign
exchange trade. The first element is the source currency, the second the
reference currency of the account, and the third the destination currency.</p>
</dd></dl>

<dl class="class">
<dt id="tallywallet.common.trade.TradeGain">
<em class="property">class </em><tt class="descclassname">tallywallet.common.trade.</tt><tt class="descname">TradeGain</tt><a class="headerlink" href="#tallywallet.common.trade.TradeGain" title="Permalink to this definition">¶</a></dt>
<dd><p><cite>TradeGain(rcv, gain, out)</cite></p>
<p>A 3-tuple of numerical values, describing the result of a change in foreign
exchange rates. The first element is the value due to the prior rate, the
second is the gain due to the rate change, and the third element is the final
sum.</p>
</dd></dl>

</div>
<div class="section" id="module-tallywallet.common.exchange">
<span id="exchange"></span><h2>Exchange<a class="headerlink" href="#module-tallywallet.common.exchange" title="Permalink to this headline">¶</a></h2>
<p>The exchange module contains functionality to enable conversion between
currencies.</p>
<dl class="class">
<dt id="tallywallet.common.exchange.Exchange">
<em class="property">class </em><tt class="descclassname">tallywallet.common.exchange.</tt><tt class="descname">Exchange</tt><a class="headerlink" href="#tallywallet.common.exchange.Exchange" title="Permalink to this definition">¶</a></dt>
<dd><p>An exchange is a lookup container for currency exchange rates.</p>
<p>It behaves just like a Python dictionary, but has some extra methods.</p>
<p>The approach Tallywallet uses is to associate each rate against a key
which is a 2-tuple of <a class="reference internal" href="#currency">Currency</a>.
By convention, the first element of this key is the source currency,
and the second is the destination. The values of the exchange mapping can
therefore be considered as <cite>gain</cite> from one currency to the next.</p>
<dl class="method">
<dt id="tallywallet.common.exchange.Exchange.get">
<tt class="descname">get</tt><big>(</big><em>key</em><big>)</big><a class="headerlink" href="#tallywallet.common.exchange.Exchange.get" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the value stored against <cite>key</cite>.</p>
<p>This method overrides the standard behaviour of <cite>dict.get</cite>. It infers the
values of missing keys as follows:</p>
<blockquote>
<div><ul class="simple">
<li>The rate of a currency against itself is unity.</li>
<li>The rate of one currency against another is the reciprocal of the
reverse rate (if defined).</li>
</ul>
</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="tallywallet.common.exchange.Exchange.convert">
<tt class="descname">convert</tt><big>(</big><em>val</em>, <em>path</em>, <em>fees=TradeFees(rcv=0</em>, <em>out=0)</em><big>)</big><a class="headerlink" href="#tallywallet.common.exchange.Exchange.convert" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the calculated outcome of converting the amount <cite>val</cite>
via the TradePath <cite>path</cite>.</p>
</dd></dl>

<dl class="method">
<dt id="tallywallet.common.exchange.Exchange.gain">
<tt class="descname">gain</tt><big>(</big><em>val</em>, <em>path</em>, <em>prior=None</em>, <em>fees=TradeFees(rcv=0</em>, <em>out=0)</em><big>)</big><a class="headerlink" href="#tallywallet.common.exchange.Exchange.gain" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the gain related to a change in exchange rates.
The <cite>self</cite> object contains the latest rates, and the historic
ones are passed as an argument to this method.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>prior</strong> &#8211; An <a class="reference internal" href="#exchange">Exchange</a> object which contains the rates
existing prior to those in the <cite>self</cite> object.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">TradeGain</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-tallywallet.common.ledger">
<span id="ledger"></span><h2>Ledger<a class="headerlink" href="#module-tallywallet.common.ledger" title="Permalink to this headline">¶</a></h2>
<p>The ledger module defines Ledger and some associated classes.</p>
<dl class="class">
<dt id="tallywallet.common.ledger.Role">
<em class="property">class </em><tt class="descclassname">tallywallet.common.ledger.</tt><tt class="descname">Role</tt><a class="reference internal" href="_modules/tallywallet/common/ledger.html#Role"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tallywallet.common.ledger.Role" title="Permalink to this definition">¶</a></dt>
<dd><p>This enumeration contains definitions for the roles played by
a column in a Ledger.</p>
</dd></dl>

<dl class="class">
<dt id="tallywallet.common.ledger.Column">
<em class="property">class </em><tt class="descclassname">tallywallet.common.ledger.</tt><tt class="descname">Column</tt><a class="headerlink" href="#tallywallet.common.ledger.Column" title="Permalink to this definition">¶</a></dt>
<dd><p><cite>Column(ref, currency, role, label)</cite></p>
<p>A 4-tuple, describing a column in a Ledger.</p>
</dd></dl>

<dl class="class">
<dt id="tallywallet.common.ledger.Ledger">
<em class="property">class </em><tt class="descclassname">tallywallet.common.ledger.</tt><tt class="descname">Ledger</tt><big>(</big><em>*args</em>, <em>ref=&lt;Currency.XTW: 'tallywallet'&gt;</em><big>)</big><a class="reference internal" href="_modules/tallywallet/common/ledger.html#Ledger"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tallywallet.common.ledger.Ledger" title="Permalink to this definition">¶</a></dt>
<dd><p>This class implements the fundamental operations you need to perform
Adjusted Cost Base accounting.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>ref</strong> &#8211; (optional) the base <a class="reference internal" href="#currency">Currency</a> type for the Ledger</li>
<li><strong>args</strong> &#8211; One or more Column objects</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="attribute">
<dt id="tallywallet.common.ledger.Ledger.equation">
<tt class="descname">equation</tt><a class="reference internal" href="_modules/tallywallet/common/ledger.html#Ledger.equation"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tallywallet.common.ledger.Ledger.equation" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference external" href="http://en.wikipedia.org/wiki/Accounting_equation">Fundamental Accounting Equation</a> is this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Assets</span> <span class="o">-</span> <span class="n">Liabilities</span> <span class="o">=</span> <span class="n">Capital</span> <span class="o">+</span> <span class="n">Income</span> <span class="o">-</span> <span class="n">Expenses</span> <span class="o">-</span> <span class="n">Dividends</span>
</pre></div>
</div>
<p>Currency trading gains are counted as income.
For practical purposes, the <cite>FAE</cite> is often rearranged to be:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Assets</span> <span class="o">+</span> <span class="n">Expenses</span> <span class="o">+</span> <span class="n">Dividends</span> <span class="o">=</span> <span class="n">Capital</span> <span class="o">+</span> <span class="n">Income</span> <span class="o">+</span> <span class="n">Liabilities</span>
</pre></div>
</div>
<p>This property evaluates both sides of this second equation,
and determines if they are equal or not.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">A tuple of <cite>lhs</cite>, <cite>rhs</cite>, <cite>status</cite></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tallywallet.common.ledger.Ledger.adjustments">
<tt class="descname">adjustments</tt><big>(</big><em>exchange</em>, <em>cols=None</em><big>)</big><a class="reference internal" href="_modules/tallywallet/common/ledger.html#Ledger.adjustments"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tallywallet.common.ledger.Ledger.adjustments" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates the effects of a change in exchange rates.</p>
<p>Supply an Exchange object and an optional sequence of columns.
If no columns are specified then all are assumed.</p>
<p>The columns are recalculated (but not committed) against the new
exchange rates.</p>
<p>This method will generate a sequence of 3-tuples;
<cite>(TradeGain, Column, Exchange)</cite>.</p>
<p>This output is compatible with the arguments accepted by the <cite>commit</cite>
method.</p>
</dd></dl>

<dl class="method">
<dt id="tallywallet.common.ledger.Ledger.commit">
<tt class="descname">commit</tt><big>(</big><em>trade</em>, <em>col</em>, <em>exchange=None</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/tallywallet/common/ledger.html#Ledger.commit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tallywallet.common.ledger.Ledger.commit" title="Permalink to this definition">¶</a></dt>
<dd><p>Applies a trade to the ledger.</p>
<p>If you supply an exchange argument, <cite>trade</cite> may be a TradeGain
object. In this usage, a trading account in the currency of the
ledger column will accept any exchange gain or loss.</p>
<p>Otherwise, <cite>trade</cite> should be a number. It will be added to the
specified column in the ledger.</p>
</dd></dl>

<dl class="method">
<dt id="tallywallet.common.ledger.Ledger.balance">
<tt class="descname">balance</tt><big>(</big><em>ref</em><big>)</big><a class="reference internal" href="_modules/tallywallet/common/ledger.html#Ledger.balance"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tallywallet.common.ledger.Ledger.balance" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns columns and their values in the ledger.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>ref</strong> &#8211; The ref of the column</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tallywallet.common.ledger.Ledger.value">
<tt class="descname">value</tt><big>(</big><em>arg</em><big>)</big><a class="reference internal" href="_modules/tallywallet/common/ledger.html#Ledger.value"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tallywallet.common.ledger.Ledger.value" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the current value of a column in the ledger.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>arg</strong> &#8211; The column object, or its name as a string</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-tallywallet.common.output">
<span id="output"></span><h2>Output<a class="headerlink" href="#module-tallywallet.common.output" title="Permalink to this headline">¶</a></h2>
<p>Tallywallet has chosen <a class="reference external" href="http://code.google.com/p/rson/">RSON</a> as the serialisation format for a Ledger.
It&#8217;s a readable serial object notation which can be processed by text
utilities or converted into Python objects.</p>
<dl class="function">
<dt id="tallywallet.common.output.metadata">
<tt class="descclassname">tallywallet.common.output.</tt><tt class="descname">metadata</tt><big>(</big><em>ledger</em><big>)</big><a class="reference internal" href="_modules/tallywallet/common/output.html#metadata"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tallywallet.common.output.metadata" title="Permalink to this definition">¶</a></dt>
<dd><p>Create an RSON string containing all the metadata required to recreate
a working Ledger object.</p>
</dd></dl>

<dl class="function">
<dt id="tallywallet.common.output.journal">
<tt class="descclassname">tallywallet.common.output.</tt><tt class="descname">journal</tt><big>(</big><em>ledger</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/tallywallet/common/output.html#journal"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tallywallet.common.output.journal" title="Permalink to this definition">¶</a></dt>
<dd><p>Create an RSON string representing the current state of
a Ledger object.</p>
<p>Journal strings can be appended to metadata, and/or concatenated
to form a time-series record of the Ledger accounts.</p>
</dd></dl>

</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="selinger.html" class="btn btn-neutral float-right" title="A tutorial on Currency Exchange"/>Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="Tallywallet - a Money framework in Python"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2013, Thuswise Ltd.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.008',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>