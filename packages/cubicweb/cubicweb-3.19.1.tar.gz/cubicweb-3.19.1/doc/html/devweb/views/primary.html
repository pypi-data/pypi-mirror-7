
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>The Primary View &mdash; CubicWeb 3.18.3</title>
    
    <link rel="stylesheet" href="../../_static/lglb-sphinx-doc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '3.18.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="CubicWeb 3.18.3" href="../../index.html" />
    <link rel="up" title="The View system" href="index.html" />
    <link rel="next" title="The “Click and Edit” (also reledit) View" href="reledit.html" />
    <link rel="prev" title="Templates" href="basetemplates.html" /> 
  </head>
  <body>
<div class="header">
 <a href="http://www.cubicweb.org">
  <img alt="cubicweb logo" src="../../_static/cubicweb.png"/>
 </a>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="reledit.html" title="The “Click and Edit” (also reledit) View"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="basetemplates.html" title="Templates"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">CubicWeb 3.18.3</a> &raquo;</li>
          <li><a href="../index.html" >Web side development</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">The View system</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">The Primary View</a><ul>
<li><a class="reference internal" href="#layout">Layout</a></li>
<li><a class="reference internal" href="#primary-view-configuration">Primary view configuration</a><ul>
<li><a class="reference internal" href="#attributes-relations-display-location">Attributes/relations display location</a></li>
<li><a class="reference internal" href="#display-content">Display content</a><ul>
<li><a class="reference internal" href="#public-api-of-the-primaryview-class">Public API of the PrimaryView class</a></li>
<li><a class="reference internal" href="#views-that-may-be-used-to-display-an-entity-s-attribute-or-relation">Views that may be used to display an entity&#8217;s attribute or relation</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#example-of-customization-and-creation">Example of customization and creation</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="basetemplates.html"
                        title="previous chapter">Templates</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="reledit.html"
                        title="next chapter">The &#8220;Click and Edit&#8221; (also <cite>reledit</cite>) View</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/devweb/views/primary.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="the-primary-view">
<span id="primary-view"></span><h1>The Primary View<a class="headerlink" href="#the-primary-view" title="Permalink to this headline">¶</a></h1>
<p>By default, <em>CubicWeb</em> provides a view that fits every available
entity type. This is the first view you might be interested in
modifying. It is also one of the richest and most complex.</p>
<p>It is automatically selected on a one line result set containing an
entity.</p>
<p>It lives in the <a class="reference internal" href="#module-cubicweb.web.views.primary" title="cubicweb.web.views.primary"><tt class="xref py py-mod docutils literal"><span class="pre">cubicweb.web.views.primary</span></tt></a> module.</p>
<p>The <em>primary</em> view is supposed to render a maximum of informations about the
entity.</p>
<div class="section" id="layout">
<span id="primary-view-layout"></span><h2>Layout<a class="headerlink" href="#layout" title="Permalink to this headline">¶</a></h2>
<p>The primary view has the following layout.</p>
<img alt="../../_images/primaryview_template.png" src="../../_images/primaryview_template.png" />
</div>
<div class="section" id="primary-view-configuration">
<span id="id1"></span><h2>Primary view configuration<a class="headerlink" href="#primary-view-configuration" title="Permalink to this headline">¶</a></h2>
<p>If you want to customize the primary view of an entity, overriding the primary
view class may not be necessary. For simple adjustments (attributes or relations
display locations and styles), a much simpler way is to use uicfg.</p>
<div class="section" id="attributes-relations-display-location">
<h3>Attributes/relations display location<a class="headerlink" href="#attributes-relations-display-location" title="Permalink to this headline">¶</a></h3>
<p>In the primary view, there are three sections where attributes and
relations can be displayed (represented in pink in the image above):</p>
<ul class="simple">
<li>&#8216;attributes&#8217;</li>
<li>&#8216;relations&#8217;</li>
<li>&#8216;sideboxes&#8217;</li>
</ul>
<dl class="docutils">
<dt><strong>Attributes</strong> can only be displayed in the attributes section (default</dt>
<dd>behavior). They can also be hidden. By default, attributes of type <cite>Password</cite>
and <cite>Bytes</cite> are hidden.</dd>
</dl>
<p>For instance, to hide the <tt class="docutils literal"><span class="pre">title</span></tt> attribute of the <tt class="docutils literal"><span class="pre">Blog</span></tt> entity:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">cubicweb.web.views</span> <span class="kn">import</span> <span class="n">uicfg</span>
<span class="n">uicfg</span><span class="o">.</span><span class="n">primaryview_section</span><span class="o">.</span><span class="n">tag_attribute</span><span class="p">((</span><span class="s">&#39;Blog&#39;</span><span class="p">,</span> <span class="s">&#39;title&#39;</span><span class="p">),</span> <span class="s">&#39;hidden&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Relations</strong> can be either displayed in one of the three sections or hidden.</p>
<p>For relations, there are two methods:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">tag_object_of</span></tt> for modifying the primary view of the object</li>
<li><tt class="docutils literal"><span class="pre">tag_subject_of</span></tt> for modifying the primary view of the subject</li>
</ul>
<p>These two methods take two arguments:</p>
<ul class="simple">
<li>a triplet <tt class="docutils literal"><span class="pre">(subject,</span> <span class="pre">relation_name,</span> <span class="pre">object)</span></tt>, where subject or object can be replaced with <tt class="docutils literal"><span class="pre">'*'</span></tt></li>
<li>the section name or <tt class="docutils literal"><span class="pre">hidden</span></tt></li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span class="n">pv_section</span> <span class="o">=</span> <span class="n">uicfg</span><span class="o">.</span><span class="n">primaryview_section</span>
<span class="c"># hide every relation `entry_of` in the `Blog` primary view</span>
<span class="n">pv_section</span><span class="o">.</span><span class="n">tag_object_of</span><span class="p">((</span><span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="s">&#39;entry_of&#39;</span><span class="p">,</span> <span class="s">&#39;Blog&#39;</span><span class="p">),</span> <span class="s">&#39;hidden&#39;</span><span class="p">)</span>

<span class="c"># display `entry_of` relations in the `relations`</span>
<span class="c"># section in the `BlogEntry` primary view</span>
<span class="n">pv_section</span><span class="o">.</span><span class="n">tag_subject_of</span><span class="p">((</span><span class="s">&#39;BlogEntry&#39;</span><span class="p">,</span> <span class="s">&#39;entry_of&#39;</span><span class="p">,</span> <span class="s">&#39;*&#39;</span><span class="p">),</span> <span class="s">&#39;relations&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="display-content">
<h3>Display content<a class="headerlink" href="#display-content" title="Permalink to this headline">¶</a></h3>
<p>You can use <tt class="docutils literal"><span class="pre">primaryview_display_ctrl</span></tt> to customize the display of attributes
or relations. Values of <tt class="docutils literal"><span class="pre">primaryview_display_ctrl</span></tt> are dictionaries.</p>
<p>Common keys for attributes and relations are:</p>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">vid</span></tt>: specifies the regid of the view for displaying the attribute or the relation.</p>
<dl class="docutils">
<dt>If <tt class="docutils literal"><span class="pre">vid</span></tt> is not specified, the default value depends on the section:</dt>
<dd><ul class="first last simple">
<li><tt class="docutils literal"><span class="pre">attributes</span></tt> section: &#8216;reledit&#8217; view</li>
<li><tt class="docutils literal"><span class="pre">relations</span></tt> section: &#8216;autolimited&#8217; view</li>
<li><tt class="docutils literal"><span class="pre">sideboxes</span></tt> section: &#8216;sidebox&#8217; view</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">order</span></tt>: int used to control order within a section. When not specified,
automatically set according to order in which tags are added.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">label</span></tt>: label for the relations section or side box</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">showlabel</span></tt>: boolean telling whether the label is displayed</p>
</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># let us remind the schema of a blog entry</span>
<span class="k">class</span> <span class="nc">BlogEntry</span><span class="p">(</span><span class="n">EntityType</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">fulltextindexed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">maxsize</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>
    <span class="n">publish_date</span> <span class="o">=</span> <span class="n">Date</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s">&#39;TODAY&#39;</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">fulltextindexed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">entry_of</span> <span class="o">=</span> <span class="n">SubjectRelation</span><span class="p">(</span><span class="s">&#39;Blog&#39;</span><span class="p">,</span> <span class="n">cardinality</span><span class="o">=</span><span class="s">&#39;?*&#39;</span><span class="p">)</span>

<span class="c"># now, we want to show attributes</span>
<span class="c"># with an order different from that in the schema definition</span>
<span class="n">view_ctrl</span> <span class="o">=</span> <span class="n">uicfg</span><span class="o">.</span><span class="n">primaryview_display_ctrl</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">attr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="s">&#39;content&#39;</span><span class="p">,</span> <span class="s">&#39;publish_date&#39;</span><span class="p">):</span>
    <span class="n">view_ctrl</span><span class="o">.</span><span class="n">tag_attribute</span><span class="p">((</span><span class="s">&#39;BlogEntry&#39;</span><span class="p">,</span> <span class="n">attr</span><span class="p">),</span> <span class="p">{</span><span class="s">&#39;order&#39;</span><span class="p">:</span> <span class="n">index</span><span class="p">})</span>
</pre></div>
</div>
<p>By default, relations displayed in the &#8216;relations&#8217; section are being displayed by
the &#8216;autolimited&#8217; view. This view will use comma separated values, or list view
and/or limit your rset if there is too much items in it (and generate the &#8220;view
all&#8221; link in this case).</p>
<p>You can control this view by setting the following values in the
<cite>primaryview_display_ctrl</cite> relation tag:</p>
<ul class="simple">
<li><cite>limit</cite>, maximum number of entities to display. The value of the
&#8216;navigation.related-limit&#8217;  cwproperty is used by default (which is 8 by default).
If None, no limit.</li>
<li><cite>use_list_limit</cite>, number of entities until which they should be display as a list
(eg using the &#8216;list&#8217; view). Below that limit, the &#8216;csv&#8217; view is used. If None,
display using &#8216;csv&#8217; anyway.</li>
<li><cite>subvid</cite>, the subview identifier (eg view that should be used of each item in the
list)</li>
</ul>
<p>Notice you can also use the <cite>filter</cite> key to set up a callback taking the related
result set as argument and returning it filtered, to do some arbitrary filtering
that can&#8217;t be done using rql for instance.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">pv_section</span> <span class="o">=</span> <span class="n">uicfg</span><span class="o">.</span><span class="n">primaryview_section</span>
<span class="c"># in `CWUser` primary view, display `created_by`</span>
<span class="c"># relations in relations section</span>
<span class="n">pv_section</span><span class="o">.</span><span class="n">tag_object_of</span><span class="p">((</span><span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="s">&#39;created_by&#39;</span><span class="p">,</span> <span class="s">&#39;CWUser&#39;</span><span class="p">),</span> <span class="s">&#39;relations&#39;</span><span class="p">)</span>

<span class="c"># display this relation as a list, sets the label,</span>
<span class="c"># limit the number of results and filters on comments</span>
<span class="k">def</span> <span class="nf">filter_comment</span><span class="p">(</span><span class="n">rset</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">rset</span><span class="o">.</span><span class="n">filtered_rset</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">e_schema</span> <span class="o">==</span> <span class="s">&#39;Comment&#39;</span><span class="p">)</span>
<span class="n">pv_ctrl</span> <span class="o">=</span> <span class="n">uicfg</span><span class="o">.</span><span class="n">primaryview_display_ctrl</span>
<span class="n">pv_ctrl</span><span class="o">.</span><span class="n">tag_object_of</span><span class="p">((</span><span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="s">&#39;created_by&#39;</span><span class="p">,</span> <span class="s">&#39;CWUser&#39;</span><span class="p">),</span>
                      <span class="p">{</span><span class="s">&#39;vid&#39;</span><span class="p">:</span> <span class="s">&#39;list&#39;</span><span class="p">,</span> <span class="s">&#39;label&#39;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;latest comment(s):&#39;</span><span class="p">),</span>
                       <span class="s">&#39;limit&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                       <span class="s">&#39;filter&#39;</span><span class="p">:</span> <span class="n">filter_comment</span><span class="p">})</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">with the <tt class="docutils literal"><span class="pre">primaryview_display_ctrl</span></tt> rtag, the subject or the
object of the relation is ignored for respectively <tt class="docutils literal"><span class="pre">tag_object_of</span></tt> or
<tt class="docutils literal"><span class="pre">tag_subject_of</span></tt>. To avoid warnings during execution, they should be set to
<tt class="docutils literal"><span class="pre">'*'</span></tt>.</p>
</div>
<span class="target" id="module-cubicweb.web.views.primary"></span><div class="section" id="public-api-of-the-primaryview-class">
<h4>Public API of the PrimaryView class<a class="headerlink" href="#public-api-of-the-primaryview-class" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="cubicweb.web.views.primary.PrimaryView">
<em class="property">class </em><tt class="descclassname">cubicweb.web.views.primary.</tt><tt class="descname">PrimaryView</tt><big>(</big><em>req=None</em>, <em>rset=None</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.web.views.primary.PrimaryView" title="Permalink to this definition">¶</a></dt>
<dd><p>The basic layout of a primary view is as in the <a class="reference internal" href="#primary-view-layout"><em>Layout</em></a>
section. This layout is actually drawn by the <cite>render_entity</cite> method.</p>
<p>The methods you may want to modify while customizing a <tt class="docutils literal"><span class="pre">PrimaryView</span></tt>
are:</p>
<dl class="method">
<dt id="cubicweb.web.views.primary.PrimaryView.render_entity_title">
<tt class="descname">render_entity_title</tt><big>(</big><em>entity</em><big>)</big><a class="headerlink" href="#cubicweb.web.views.primary.PrimaryView.render_entity_title" title="Permalink to this definition">¶</a></dt>
<dd><p>Renders the entity title, by default using entity&#8217;s
<tt class="xref py py-meth docutils literal"><span class="pre">dc_title()</span></tt> method.</p>
</dd></dl>

<dl class="method">
<dt id="cubicweb.web.views.primary.PrimaryView.render_entity_attributes">
<tt class="descname">render_entity_attributes</tt><big>(</big><em>entity</em><big>)</big><a class="headerlink" href="#cubicweb.web.views.primary.PrimaryView.render_entity_attributes" title="Permalink to this definition">¶</a></dt>
<dd><p>Renders all attributes and relations in the &#8216;attributes&#8217; section.</p>
</dd></dl>

<dl class="method">
<dt id="cubicweb.web.views.primary.PrimaryView.render_entity_relations">
<tt class="descname">render_entity_relations</tt><big>(</big><em>entity</em><big>)</big><a class="headerlink" href="#cubicweb.web.views.primary.PrimaryView.render_entity_relations" title="Permalink to this definition">¶</a></dt>
<dd><p>Renders all relations in the &#8216;relations&#8217; section.</p>
</dd></dl>

<dl class="method">
<dt id="cubicweb.web.views.primary.PrimaryView.render_side_boxes">
<tt class="descname">render_side_boxes</tt><big>(</big><em>boxes</em><big>)</big><a class="headerlink" href="#cubicweb.web.views.primary.PrimaryView.render_side_boxes" title="Permalink to this definition">¶</a></dt>
<dd><p>Renders side boxes on the right side of the content. This will
generate a box for each relation in the &#8216;sidebox&#8217; section, as well as
explicit box appobjects selectable in this context.</p>
</dd></dl>

<p>The placement of relations in the relations section or in side boxes
can be controlled through the <a class="reference internal" href="#primary-view-configuration"><em>Primary view configuration</em></a> mechanism.</p>
<dl class="method">
<dt id="cubicweb.web.views.primary.PrimaryView.content_navigation_components">
<tt class="descname">content_navigation_components</tt><big>(</big><em>context</em><big>)</big><a class="headerlink" href="#cubicweb.web.views.primary.PrimaryView.content_navigation_components" title="Permalink to this definition">¶</a></dt>
<dd><p>This method is applicable only for entity type implementing the
interface <cite>IPrevNext</cite>. This interface is for entities which can be
linked to a previous and/or next entity. This method will render the
navigation links between entities of this type, either at the top or at
the bottom of the page given the context (navcontent{top|bottom}).</p>
</dd></dl>

<p>Also, please note that by setting the following attributes in your
subclass, you can already customize some of the rendering:</p>
<dl class="docutils">
<dt><tt class="xref py py-attr docutils literal"><span class="pre">show_attr_label</span></tt></dt>
<dd>Renders the attribute label next to the attribute value if set to <cite>True</cite>.
Otherwise, does only display the attribute value.</dd>
<dt><tt class="xref py py-attr docutils literal"><span class="pre">show_rel_label</span></tt></dt>
<dd>Renders the relation label next to the relation value if set to <cite>True</cite>.
Otherwise, does only display the relation value.</dd>
<dt><tt class="xref py py-attr docutils literal"><span class="pre">main_related_section</span></tt></dt>
<dd>Renders the relations of the entity if set to <cite>True</cite>.</dd>
</dl>
<p>A good practice is for you to identify the content of your entity type for
which the default rendering does not answer your need so that you can focus
on the specific method (from the list above) that needs to be modified. We
do not advise you to overwrite <tt class="docutils literal"><span class="pre">render_entity</span></tt> unless you want a
completely different layout.</p>
</dd></dl>

</div>
<div class="section" id="views-that-may-be-used-to-display-an-entity-s-attribute-or-relation">
<h4>Views that may be used to display an entity&#8217;s attribute or relation<a class="headerlink" href="#views-that-may-be-used-to-display-an-entity-s-attribute-or-relation" title="Permalink to this headline">¶</a></h4>
<p>Yoy may easily the display of an attribute or relation by simply configuring the
view using one of <cite>primaryview_display_ctrl</cite> or <cite>reledit_ctrl</cite> to use one of the
views describled below. For instance:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">primaryview_display_ctrl</span><span class="o">.</span><span class="n">tag_attribute</span><span class="p">((</span><span class="s">&#39;Foo&#39;</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">),</span> <span class="p">{</span><span class="s">&#39;vid&#39;</span><span class="p">:</span> <span class="s">&#39;attribute&#39;</span><span class="p">})</span>
</pre></div>
</div>
<dl class="class">
<dt id="cubicweb.web.views.primary.AttributeView">
<em class="property">class </em><tt class="descclassname">cubicweb.web.views.primary.</tt><tt class="descname">AttributeView</tt><big>(</big><em>req=None</em>, <em>rset=None</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.web.views.primary.AttributeView" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">__regid__ :</th><td class="field-body"><em>attribute</em></td>
</tr>
</tbody>
</table>
<p>This view is generally used to disable the <em>reledit</em> feature. It works on
both relations and attributes.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.web.views.primary.URLAttributeView">
<em class="property">class </em><tt class="descclassname">cubicweb.web.views.primary.</tt><tt class="descname">URLAttributeView</tt><big>(</big><em>req=None</em>, <em>rset=None</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.web.views.primary.URLAttributeView" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">__regid__ :</th><td class="field-body"><em>urlattr</em></td>
</tr>
</tbody>
</table>
<p>This view will wrap an attribute value (hence expect a string) into an &#8216;&lt;a&gt;&#8217;
HTML tag to display a clickable link.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.web.views.primary.VerbatimAttributeView">
<em class="property">class </em><tt class="descclassname">cubicweb.web.views.primary.</tt><tt class="descname">VerbatimAttributeView</tt><big>(</big><em>req=None</em>, <em>rset=None</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.web.views.primary.VerbatimAttributeView" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">__regid__ :</th><td class="field-body"><em>verbatimattr</em></td>
</tr>
</tbody>
</table>
<p>This view will wrap an attribute value into an &#8216;&lt;pre&gt;&#8217; HTML tag to display
arbitrary text where EOL will be respected. It usually make sense for
attributes whose value is a multi-lines string where new lines matters.</p>
</dd></dl>

</div>
</div>
</div>
<div class="section" id="example-of-customization-and-creation">
<h2>Example of customization and creation<a class="headerlink" href="#example-of-customization-and-creation" title="Permalink to this headline">¶</a></h2>
<p>We&#8217;ll show you now an example of a <tt class="docutils literal"><span class="pre">primary</span></tt> view and how to customize it.</p>
<p>If you want to change the way a <tt class="docutils literal"><span class="pre">BlogEntry</span></tt> is displayed, just
override the method <tt class="docutils literal"><span class="pre">cell_call()</span></tt> of the view <tt class="docutils literal"><span class="pre">primary</span></tt> in
<tt class="docutils literal"><span class="pre">BlogDemo/views.py</span></tt>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">cubicweb.predicates</span> <span class="kn">import</span> <span class="n">is_instance</span>
<span class="kn">from</span> <span class="nn">cubicweb.web.views.primary</span> <span class="kn">import</span> <span class="n">Primaryview</span>

<span class="k">class</span> <span class="nc">BlogEntryPrimaryView</span><span class="p">(</span><span class="n">PrimaryView</span><span class="p">):</span>
    <span class="n">__select__</span> <span class="o">=</span> <span class="n">PrimaryView</span><span class="o">.</span><span class="n">__select__</span> <span class="o">&amp;</span> <span class="n">is_instance</span><span class="p">(</span><span class="s">&#39;BlogEntry&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">render_entity_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">(</span><span class="s">u&#39;&lt;p&gt;published on </span><span class="si">%s</span><span class="s">&lt;/p&gt;&#39;</span> <span class="o">%</span>
               <span class="n">entity</span><span class="o">.</span><span class="n">publish_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%Y-%m-</span><span class="si">%d</span><span class="s">&#39;</span><span class="p">))</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">BlogEntryPrimaryView</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">render_entity_attributes</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span>
</pre></div>
</div>
<p>The above source code defines a new primary view for
<tt class="docutils literal"><span class="pre">BlogEntry</span></tt>. The <cite>__reid__</cite> class attribute is not repeated there since it
is inherited through the <cite>primary.PrimaryView</cite> class.</p>
<p>The selector for this view chains the selector of the inherited class
with its own specific criterion.</p>
<p>The view method <tt class="docutils literal"><span class="pre">self.w()</span></tt> is used to output data. Here <cite>lines
08-09</cite> output HTML for the publication date of the entry.</p>
<img alt="blog entries now look much nicer" src="../../_images/lax-book_09-new-view-blogentry_en.png" />
<p>Let us now improve the primary view of a blog</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">logilab.mtconverter</span> <span class="kn">import</span> <span class="n">xml_escape</span>
<span class="kn">from</span> <span class="nn">cubicweb.predicates</span> <span class="kn">import</span> <span class="n">is_instance</span><span class="p">,</span> <span class="n">one_line_rset</span>
<span class="kn">from</span> <span class="nn">cubicweb.web.views.primary</span> <span class="kn">import</span> <span class="n">Primaryview</span>

<span class="k">class</span> <span class="nc">BlogPrimaryView</span><span class="p">(</span><span class="n">PrimaryView</span><span class="p">):</span>
    <span class="n">__regid__</span> <span class="o">=</span> <span class="s">&#39;primary&#39;</span>
    <span class="n">__select__</span> <span class="o">=</span> <span class="n">PrimaryView</span><span class="o">.</span><span class="n">__select__</span> <span class="o">&amp;</span> <span class="n">is_instance</span><span class="p">(</span><span class="s">&#39;Blog&#39;</span><span class="p">)</span>
    <span class="n">rql</span> <span class="o">=</span> <span class="s">&#39;Any BE ORDERBY D DESC WHERE BE entry_of B, BE publish_date D, B eid </span><span class="si">%(b)s</span><span class="s">&#39;</span>

    <span class="k">def</span> <span class="nf">render_entity_relations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity</span><span class="p">):</span>
        <span class="n">rset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cw</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rql</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;b&#39;</span> <span class="p">:</span> <span class="n">entity</span><span class="o">.</span><span class="n">eid</span><span class="p">})</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">rset</span><span class="o">.</span><span class="n">entities</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">(</span><span class="s">u&#39;&lt;p&gt;</span><span class="si">%s</span><span class="s">&lt;/p&gt;&#39;</span> <span class="o">%</span> <span class="n">entry</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="s">&#39;inblogcontext&#39;</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">BlogEntryInBlogView</span><span class="p">(</span><span class="n">EntityView</span><span class="p">):</span>
    <span class="n">__regid__</span> <span class="o">=</span> <span class="s">&#39;inblogcontext&#39;</span>
    <span class="n">__select__</span> <span class="o">=</span> <span class="n">is_instance</span><span class="p">(</span><span class="s">&#39;BlogEntry&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">cell_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
        <span class="n">entity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cw_rset</span><span class="o">.</span><span class="n">get_entity</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">(</span><span class="s">u&#39;&lt;a href=&quot;</span><span class="si">%s</span><span class="s">&quot; title=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;</span><span class="si">%s</span><span class="s">&lt;/a&gt;&#39;</span> <span class="o">%</span>
               <span class="n">entity</span><span class="o">.</span><span class="n">absolute_url</span><span class="p">(),</span>
               <span class="n">xml_escape</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">content</span><span class="p">[:</span><span class="mi">50</span><span class="p">]),</span>
               <span class="n">xml_escape</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">description</span><span class="p">))</span>
</pre></div>
</div>
<p>This happens in two places. First we override the
render_entity_relations method of a Blog&#8217;s primary view. Here we want
to display our blog entries in a custom way.</p>
<p>At <cite>line 10</cite>, a simple request is made to build a result set with all
the entities linked to the current <tt class="docutils literal"><span class="pre">Blog</span></tt> entity by the relationship
<tt class="docutils literal"><span class="pre">entry_of</span></tt>. The part of the framework handling the request knows
about the schema and infers that such entities have to be of the
<tt class="docutils literal"><span class="pre">BlogEntry</span></tt> kind and retrieves them (in the prescribed publish_date
order).</p>
<p>The request returns a selection of data called a result set. Result
set objects have an .entities() method returning a generator on
requested entities (going transparently through the <cite>ORM</cite> layer).</p>
<p>At <cite>line 13</cite> the view &#8216;inblogcontext&#8217; is applied to each blog entry to
output HTML. (Note that the &#8216;inblogcontext&#8217; view is not defined
whatsoever in <em>CubicWeb</em>. You are absolutely free to define whole view
families.) We juste arrange to wrap each blogentry output in a &#8216;p&#8217;
html element.</p>
<p>Next, we define the &#8216;inblogcontext&#8217; view. This is NOT a primary view,
with its well-defined sections (title, metadata, attribtues,
relations/boxes). All a basic view has to define is cell_call.</p>
<p>Since views are applied to result sets which can be tables of data, we
have to recover the entity from its (row,col)-coordinates (<cite>line
20</cite>). Then we can spit some HTML.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Be careful: all strings manipulated in <em>CubicWeb</em> are actually
unicode strings. While web browsers are usually tolerant to
incoherent encodings they are being served, we should not abuse
it. Hence we have to properly escape our data. The xml_escape()
function has to be used to safely fill (X)HTML elements from Python
unicode strings.</p>
</div>
<p>Assuming we added entries to the blog titled <cite>MyLife</cite>, displaying it
now allows to read its description and all its entries.</p>
<img alt="a blog and all its entries" src="../../_images/lax-book_10-blog-with-two-entries_en.png" />
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="reledit.html" title="The “Click and Edit” (also reledit) View"
             >next</a> |</li>
        <li class="right" >
          <a href="basetemplates.html" title="Templates"
             >previous</a> |</li>
        <li><a href="../../index.html">CubicWeb 3.18.3</a> &raquo;</li>
          <li><a href="../index.html" >Web side development</a> &raquo;</li>
          <li><a href="index.html" >The View system</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2001-2014, Logilab.
      Last updated on Mar 11, 2014.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>