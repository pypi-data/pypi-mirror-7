
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>The edit controller &mdash; CubicWeb 3.18.3</title>
    
    <link rel="stylesheet" href="../../_static/lglb-sphinx-doc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '3.18.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="CubicWeb 3.18.3" href="../../index.html" />
    <link rel="up" title="Edition control" href="index.html" />
    <link rel="next" title="Examples" href="examples.html" />
    <link rel="prev" title="Dissection of an entity form" href="dissection.html" /> 
  </head>
  <body>
<div class="header">
 <a href="http://www.cubicweb.org">
  <img alt="cubicweb logo" src="../../_static/cubicweb.png"/>
 </a>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="examples.html" title="Examples"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="dissection.html" title="Dissection of an entity form"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">CubicWeb 3.18.3</a> &raquo;</li>
          <li><a href="../index.html" >Web side development</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Edition control</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">The <cite>edit controller</cite></a><ul>
<li><a class="reference internal" href="#edition-handling">Edition handling</a></li>
<li><a class="reference internal" href="#redirection-control">Redirection control</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="dissection.html"
                        title="previous chapter">Dissection of an entity form</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="examples.html"
                        title="next chapter">Examples</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/devweb/edition/editcontroller.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="the-edit-controller">
<span id="edit-controller"></span><h1>The <cite>edit controller</cite><a class="headerlink" href="#the-edit-controller" title="Permalink to this headline">¶</a></h1>
<p>It can be found in (<tt class="xref py py-mod docutils literal"><span class="pre">cubicweb.web.views.editcontroller</span></tt>). This
controller processes data received from an html form to create or
update entities.</p>
<div class="section" id="edition-handling">
<h2>Edition handling<a class="headerlink" href="#edition-handling" title="Permalink to this headline">¶</a></h2>
<p>The parameters related to entities to edit are specified as follows
(first seen in <a class="reference internal" href="dissection.html#attributes-section"><em>The attributes section</em></a>):</p>
<div class="highlight-python"><pre>&lt;rtype-role&gt;:&lt;entity eid&gt;</pre>
</div>
<p>where entity eid could be a letter in case of an entity to create. We
name those parameters as <em>qualified</em>.</p>
<ul>
<li><p class="first">Retrieval of entities to edit is done by using the forms parameters
<cite>eid</cite> and <cite>__type</cite></p>
</li>
<li><p class="first">For all the attributes and the relations of an entity to edit
(attributes and relations are handled a bit differently but these
details are not much relevant here) :</p>
<blockquote>
<div><ul class="simple">
<li>using the <tt class="docutils literal"><span class="pre">rtype</span></tt>, <tt class="docutils literal"><span class="pre">role</span></tt> and <tt class="docutils literal"><span class="pre">__type</span></tt> information, fetch
an appropriate field instance</li>
<li>check if the field has been modified (if not, proceed to the next
relation)</li>
<li>build an rql expression to update the entity</li>
</ul>
</div></blockquote>
</li>
</ul>
<p>At the end, all rql expressions are executed.</p>
<ul>
<li><p class="first">For each entity to edit:</p>
<blockquote>
<div><ul>
<li><p class="first">if a qualified parameter <cite>__linkto</cite> is specified, its value has
to be a string (or a list of strings) such as:</p>
<div class="highlight-python"><pre>&lt;relation type&gt;:&lt;eids&gt;:&lt;target&gt;</pre>
</div>
<p>where &lt;target&gt; is either <cite>subject</cite> or <cite>object</cite> and each eid could
be separated from the others by a <cite>_</cite>. Target specifies if the
<em>edited entity</em> is subject or object of the relation and each
relation specified will be inserted.</p>
</li>
</ul>
<blockquote>
<div><ul>
<li><p class="first">if a qualified parameter <cite>__clone_eid</cite> is specified for an entity, the
relations of the specified entity passed as value of this parameter are
copied on the edited entity.</p>
</li>
<li><p class="first">if a qualified parameter <cite>__delete</cite> is specified, its value must be
a string or a list of string such as follows:</p>
<div class="highlight-python"><pre>&lt;subjects eids&gt;:&lt;relation type&gt;:&lt;objects eids&gt;</pre>
</div>
<p>where each eid subject or object can be seperated from the other
by <cite>_</cite>. Each specified relation will be deleted.</p>
</li>
</ul>
</div></blockquote>
</div></blockquote>
</li>
<li><p class="first">If no entity is edited but the form contains the parameters <cite>__linkto</cite>
and <cite>eid</cite>, this one is interpreted by using the value specified for <cite>eid</cite>
to designate the entity on which to add the relations.</p>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>if the parameter <cite>__action_delete</cite> is found, all the entities specified
as to be edited will be deleted.</li>
<li>if the parameter <cite>__action_cancel</cite> is found, no action is completed.</li>
<li>if the parameter <cite>__action_apply</cite> is found, the editing is
applied normally but the redirection is done on the form (see
<a class="reference internal" href="#redirectioncontrol"><em>Redirection control</em></a>).</li>
<li>if no entity is found to be edited and if there is no parameter
<cite>__action_delete</cite>, <cite>__action_cancel</cite>, <cite>__linkto</cite>, <cite>__delete</cite> or
<cite>__insert</cite>, an error is raised.</li>
<li>using the parameter <cite>__message</cite> in the form will allow to use its value
as a message to provide the user once the editing is completed.</li>
</ul>
</div>
</div>
<div class="section" id="redirection-control">
<span id="redirectioncontrol"></span><h2>Redirection control<a class="headerlink" href="#redirection-control" title="Permalink to this headline">¶</a></h2>
<p>Once editing is completed, there is still an issue left: where should we go
now? If nothing is specified, the controller will do his job but it does not
mean we will be happy with the result. We can control that by using the
following parameters:</p>
<ul class="simple">
<li><cite>__redirectpath</cite>: path of the URL (relative to the root URL of the site,
no form parameters</li>
<li><cite>__redirectparams</cite>: forms parameters to add to the path</li>
<li><cite>__redirectrql</cite>: redirection RQL request</li>
<li><cite>__redirectvid</cite>: redirection view identifier</li>
<li><cite>__errorurl</cite>: initial form URL, used for redirecting in case a validation
error is raised during editing. If this one is not specified, an error page
is displayed instead of going back to the form (which is, if necessary,
responsible for displaying the errors)</li>
<li><cite>__form_id</cite>: initial view form identifier, used if <cite>__action_apply</cite> is
found</li>
</ul>
<p>In general we use either <cite>__redirectpath</cite> and <cite>__redirectparams</cite> or
<cite>__redirectrql</cite> and <cite>__redirectvid</cite>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="examples.html" title="Examples"
             >next</a> |</li>
        <li class="right" >
          <a href="dissection.html" title="Dissection of an entity form"
             >previous</a> |</li>
        <li><a href="../../index.html">CubicWeb 3.18.3</a> &raquo;</li>
          <li><a href="../index.html" >Web side development</a> &raquo;</li>
          <li><a href="index.html" >Edition control</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2001-2014, Logilab.
      Last updated on Mar 11, 2014.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>