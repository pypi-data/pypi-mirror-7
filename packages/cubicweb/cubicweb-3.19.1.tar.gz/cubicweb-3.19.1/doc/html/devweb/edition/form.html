
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>HTML form construction &mdash; CubicWeb 3.18.3</title>
    
    <link rel="stylesheet" href="../../_static/lglb-sphinx-doc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '3.18.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="CubicWeb 3.18.3" href="../../index.html" />
    <link rel="up" title="Edition control" href="index.html" />
    <link rel="next" title="Dissection of an entity form" href="dissection.html" />
    <link rel="prev" title="Edition control" href="index.html" /> 
  </head>
  <body>
<div class="header">
 <a href="http://www.cubicweb.org">
  <img alt="cubicweb logo" src="../../_static/cubicweb.png"/>
 </a>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="dissection.html" title="Dissection of an entity form"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Edition control"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">CubicWeb 3.18.3</a> &raquo;</li>
          <li><a href="../index.html" >Web side development</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Edition control</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">HTML form construction</a><ul>
<li><a class="reference internal" href="#exploring-the-available-forms">Exploring the available forms</a></li>
<li><a class="reference internal" href="#module-cubicweb.web.views.autoform">The Automatic Entity Form</a><ul>
<li><a class="reference internal" href="#configuration-through-uicfg">Configuration through uicfg</a><ul>
<li><a class="reference internal" href="#attributes-relations-display-location">Attributes/relations display location</a></li>
<li><a class="reference internal" href="#change-default-fields">Change default fields</a></li>
<li><a class="reference internal" href="#customize-field-options">Customize field options</a></li>
<li><a class="reference internal" href="#overriding-permissions">Overriding permissions</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#anatomy-of-a-choices-function">Anatomy of a choices function</a></li>
<li><a class="reference internal" href="#building-self-posted-form-with-custom-fields-widgets">Building self-posted form with custom fields/widgets</a></li>
<li><a class="reference internal" href="#module-cubicweb.web.formfields">APIs</a><ul>
<li><a class="reference internal" href="#the-field-class-and-basic-fields">The Field class and basic fields</a><ul>
<li><a class="reference internal" href="#basic-fields">Basic fields</a></li>
<li><a class="reference internal" href="#compound-fields">Compound fields</a></li>
<li><a class="reference internal" href="#entity-specific-fields-and-function">Entity specific fields and function</a></li>
</ul>
</li>
<li><a class="reference internal" href="#widgets">Widgets</a><ul>
<li><a class="reference internal" href="#html-input-based-widgets">HTML &lt;input&gt; based widgets</a></li>
<li><a class="reference internal" href="#other-standard-html-widgets">Other standard HTML widgets</a></li>
<li><a class="reference internal" href="#date-and-time-widgets">Date and time widgets</a></li>
<li><a class="reference internal" href="#ajax-javascript-widgets">Ajax / javascript widgets</a></li>
<li><a class="reference internal" href="#other-widgets">Other widgets</a></li>
<li><a class="reference internal" href="#form-controls">Form controls</a></li>
</ul>
</li>
<li><a class="reference internal" href="#base-form-classes">Base form classes</a></li>
<li><a class="reference internal" href="#renderers">Renderers</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Edition control</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="dissection.html"
                        title="next chapter">Dissection of an entity form</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/devweb/edition/form.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="html-form-construction">
<span id="webform"></span><h1>HTML form construction<a class="headerlink" href="#html-form-construction" title="Permalink to this headline">¶</a></h1>
<p>CubicWeb provides the somewhat usual form / field / widget / renderer abstraction
to provide generic building blocks which will greatly help you in building forms
properly integrated with CubicWeb (coherent display, error handling, etc...),
while keeping things as flexible as possible.</p>
<p>A <tt class="docutils literal"><span class="pre">form</span></tt> basically only holds a set of <tt class="docutils literal"><span class="pre">fields</span></tt>, and has te be bound to a
<tt class="docutils literal"><span class="pre">renderer</span></tt> which is responsible to layout them. Each field is bound to a
<tt class="docutils literal"><span class="pre">widget</span></tt> that will be used to fill in value(s) for that field (at form
generation time) and &#8216;decode&#8217; (fetch and give a proper Python type to) values
sent back by the browser.</p>
<p>The <tt class="docutils literal"><span class="pre">field</span></tt> should be used according to the type of what you want to edit.
E.g. if you want to edit some date, you&#8217;ll have to use the
<a class="reference internal" href="#cubicweb.web.formfields.DateField" title="cubicweb.web.formfields.DateField"><tt class="xref py py-class docutils literal"><span class="pre">cubicweb.web.formfields.DateField</span></tt></a>. Then you can choose among multiple
widgets to edit it, for instance <a class="reference internal" href="#cubicweb.web.formwidgets.TextInput" title="cubicweb.web.formwidgets.TextInput"><tt class="xref py py-class docutils literal"><span class="pre">cubicweb.web.formwidgets.TextInput</span></tt></a> (a
bare text field), <a class="reference internal" href="#cubicweb.web.formwidgets.DateTimePicker" title="cubicweb.web.formwidgets.DateTimePicker"><tt class="xref py py-class docutils literal"><span class="pre">DateTimePicker</span></tt></a> (a simple
calendar) or even <a class="reference internal" href="#cubicweb.web.formwidgets.JQueryDatePicker" title="cubicweb.web.formwidgets.JQueryDatePicker"><tt class="xref py py-class docutils literal"><span class="pre">JQueryDatePicker</span></tt></a> (the JQuery
calendar).  You can of course also write your own widget.</p>
<div class="section" id="exploring-the-available-forms">
<h2>Exploring the available forms<a class="headerlink" href="#exploring-the-available-forms" title="Permalink to this headline">¶</a></h2>
<p>A small excursion into a <em>CubicWeb</em> shell is the quickest way to
discover available forms (or application objects in general).</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pprint</span><span class="p">(</span> <span class="n">session</span><span class="o">.</span><span class="n">vreg</span><span class="p">[</span><span class="s">&#39;forms&#39;</span><span class="p">]</span> <span class="p">)</span>
<span class="go">{&#39;base&#39;: [&lt;class &#39;cubicweb.web.views.forms.FieldsForm&#39;&gt;,</span>
<span class="go">          &lt;class &#39;cubicweb.web.views.forms.EntityFieldsForm&#39;&gt;],</span>
<span class="go"> &#39;changestate&#39;: [&lt;class &#39;cubicweb.web.views.workflow.ChangeStateForm&#39;&gt;,</span>
<span class="go">                 &lt;class &#39;cubes.tracker.views.forms.VersionChangeStateForm&#39;&gt;],</span>
<span class="go"> &#39;composite&#39;: [&lt;class &#39;cubicweb.web.views.forms.CompositeForm&#39;&gt;,</span>
<span class="go">               &lt;class &#39;cubicweb.web.views.forms.CompositeEntityForm&#39;&gt;],</span>
<span class="go"> &#39;deleteconf&#39;: [&lt;class &#39;cubicweb.web.views.editforms.DeleteConfForm&#39;&gt;],</span>
<span class="go"> &#39;edition&#39;: [&lt;class &#39;cubicweb.web.views.autoform.AutomaticEntityForm&#39;&gt;,</span>
<span class="go">             &lt;class &#39;cubicweb.web.views.workflow.TransitionEditionForm&#39;&gt;,</span>
<span class="go">             &lt;class &#39;cubicweb.web.views.workflow.StateEditionForm&#39;&gt;],</span>
<span class="go"> &#39;logform&#39;: [&lt;class &#39;cubicweb.web.views.basetemplates.LogForm&#39;&gt;],</span>
<span class="go"> &#39;massmailing&#39;: [&lt;class &#39;cubicweb.web.views.massmailing.MassMailingForm&#39;&gt;],</span>
<span class="go"> &#39;muledit&#39;: [&lt;class &#39;cubicweb.web.views.editforms.TableEditForm&#39;&gt;],</span>
<span class="go"> &#39;sparql&#39;: [&lt;class &#39;cubicweb.web.views.sparql.SparqlForm&#39;&gt;]}</span>
</pre></div>
</div>
<p>The two most important form families here (for all practical purposes) are <cite>base</cite>
and <cite>edition</cite>. Most of the time one wants alterations of the
<tt class="xref py py-class docutils literal"><span class="pre">AutomaticEntityForm</span></tt> to generate custom forms to handle edition of an
entity.</p>
</div>
<div class="section" id="module-cubicweb.web.views.autoform">
<span id="the-automatic-entity-form"></span><h2>The Automatic Entity Form<a class="headerlink" href="#module-cubicweb.web.views.autoform" title="Permalink to this headline">¶</a></h2>
<p>AutomaticEntityForm is an automagic form to edit any entity. It
is designed to be fully generated from schema but highly
configurable through uicfg.</p>
<p>Of course, as for other forms, you can also customise it by specifying
various standard form parameters on selection, overriding, or
adding/removing fields in selected instances.</p>
<div class="section" id="configuration-through-uicfg">
<h3>Configuration through uicfg<a class="headerlink" href="#configuration-through-uicfg" title="Permalink to this headline">¶</a></h3>
<p>It is possible to manage which and how an entity&#8217;s attributes and relations
will be edited in the various contexts where the automatic entity form is used
by using proper uicfg tags.</p>
<p>The details of the uicfg syntax can be found in the <a class="reference internal" href="../rtags.html#uicfg"><em>The uicfg module</em></a> chapter.</p>
<p>Possible relation tags that apply to entity forms are detailled below.
They are all in the <a class="reference internal" href="../rtags.html#module-cubicweb.web.uicfg" title="cubicweb.web.uicfg"><tt class="xref py py-mod docutils literal"><span class="pre">cubicweb.web.uicfg</span></tt></a> module.</p>
<div class="section" id="attributes-relations-display-location">
<h4>Attributes/relations display location<a class="headerlink" href="#attributes-relations-display-location" title="Permalink to this headline">¶</a></h4>
<p><tt class="docutils literal"><span class="pre">autoform_section</span></tt> specifies where to display a relation in form for a given
form type.  <tt class="xref py py-meth docutils literal"><span class="pre">tag_attribute()</span></tt>, <tt class="xref py py-meth docutils literal"><span class="pre">tag_subject_of()</span></tt> and
<tt class="xref py py-meth docutils literal"><span class="pre">tag_object_of()</span></tt> methods for this relation tag expect two arguments
additionally to the relation key: a <cite>formtype</cite> and a <cite>section</cite>.</p>
<p><cite>formtype</cite> may be one of:</p>
<ul class="simple">
<li>&#8216;main&#8217;, the main entity form (e.g. the one you get when creating or editing an
entity)</li>
<li>&#8216;inlined&#8217;, the form for an entity inlined into another form</li>
<li>&#8216;muledit&#8217;, the table form when editing multiple entities of the same type</li>
</ul>
<p>section may be one of:</p>
<ul class="simple">
<li>&#8216;hidden&#8217;, don&#8217;t display (not even in a hidden input)</li>
<li>&#8216;attributes&#8217;, display in the attributes section</li>
<li>&#8216;relations&#8217;, display in the relations section, using the generic relation
selector combobox (available in main form only, and not usable for attributes)</li>
<li>&#8216;inlined&#8217;, display target entity of the relation into an inlined form
(available in main form only, and not for attributes)</li>
</ul>
<p>By default, mandatory relations are displayed in the &#8216;attributes&#8217; section,
others in &#8216;relations&#8217; section.</p>
</div>
<div class="section" id="change-default-fields">
<h4>Change default fields<a class="headerlink" href="#change-default-fields" title="Permalink to this headline">¶</a></h4>
<p>Use <tt class="docutils literal"><span class="pre">autoform_field</span></tt> to replace the default field class to use for a relation
or attribute. You can put either a field class or instance as value (put a class
whenether it&#8217;s possible).</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last"><cite>autoform_field_kwargs</cite> should usually be used instead of
<cite>autoform_field</cite>. If you put a field instance into <cite>autoform_field</cite>,
<cite>autoform_field_kwargs</cite> values for this relation will be ignored.</p>
</div>
</div>
<div class="section" id="customize-field-options">
<h4>Customize field options<a class="headerlink" href="#customize-field-options" title="Permalink to this headline">¶</a></h4>
<p>In order to customize field options (see <a class="reference internal" href="#cubicweb.web.formfields.Field" title="cubicweb.web.formfields.Field"><tt class="xref py py-class docutils literal"><span class="pre">Field</span></tt></a>
for a detailed list of options), use <cite>autoform_field_kwargs</cite>. This rtag takes
a dictionary as arguments, that will be given to the field&#8217;s contructor.</p>
<p>You can then put in that dictionary any arguments supported by the field
class. For instance:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Change the content of the combobox. Here `ticket_done_in_choices` is a</span>
<span class="c"># function which returns a list of elements to populate the combobox</span>
<span class="n">autoform_field_kwargs</span><span class="o">.</span><span class="n">tag_subject_of</span><span class="p">((</span><span class="s">&#39;Ticket&#39;</span><span class="p">,</span> <span class="s">&#39;done_in&#39;</span><span class="p">,</span> <span class="s">&#39;*&#39;</span><span class="p">),</span>
                                     <span class="p">{</span><span class="s">&#39;sort&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                                      <span class="s">&#39;choices&#39;</span><span class="p">:</span> <span class="n">ticket_done_in_choices</span><span class="p">})</span>

<span class="c"># Force usage of a TextInput widget for the expression attribute of</span>
<span class="c"># RQLExpression entities</span>
<span class="n">autoform_field_kwargs</span><span class="o">.</span><span class="n">tag_attribute</span><span class="p">((</span><span class="s">&#39;RQLExpression&#39;</span><span class="p">,</span> <span class="s">&#39;expression&#39;</span><span class="p">),</span>
                                    <span class="p">{</span><span class="s">&#39;widget&#39;</span><span class="p">:</span> <span class="n">fw</span><span class="o">.</span><span class="n">TextInput</span><span class="p">})</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">the widget argument can be either a class or an instance (the later
case being convenient to pass the Widget specific initialisation
options)</p>
</div>
</div>
<div class="section" id="overriding-permissions">
<h4>Overriding permissions<a class="headerlink" href="#overriding-permissions" title="Permalink to this headline">¶</a></h4>
<p>The <cite>autoform_permissions_overrides</cite> rtag provides a way to by-pass security
checking for dark-corner case where it can&#8217;t be verified properly.</p>
</div>
</div>
</div>
<div class="section" id="anatomy-of-a-choices-function">
<h2>Anatomy of a choices function<a class="headerlink" href="#anatomy-of-a-choices-function" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s have a look at the <cite>ticket_done_in_choices</cite> function given to
the <cite>choices</cite> parameter of the relation tag that is applied to the
(&#8216;Ticket&#8217;, &#8216;done_in&#8217;, &#8216;*&#8217;) relation definition, as it is both typical
and sophisticated enough. This is a code snippet from the <a class="reference external" href="http://www.cubicweb.org/project/cubicweb-tracker">tracker</a>
cube.</p>
<p>The <tt class="docutils literal"><span class="pre">Ticket</span></tt> entity type can be related to a <tt class="docutils literal"><span class="pre">Project</span></tt> and a
<tt class="docutils literal"><span class="pre">Version</span></tt>, respectively through the <tt class="docutils literal"><span class="pre">concerns</span></tt> and <tt class="docutils literal"><span class="pre">done_in</span></tt>
relations. When a user is about to edit a ticket, we want to fill the
combo box for the <tt class="docutils literal"><span class="pre">done_in</span></tt> relation with values pertinent with
respect to the context. The important context here is:</p>
<ul class="simple">
<li>creation or modification (we cannot fetch values the same way in
either case)</li>
<li><tt class="docutils literal"><span class="pre">__linkto</span></tt> url parameter given in a creation context</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">cubicweb.web</span> <span class="kn">import</span> <span class="n">formfields</span>

<span class="k">def</span> <span class="nf">ticket_done_in_choices</span><span class="p">(</span><span class="n">form</span><span class="p">,</span> <span class="n">field</span><span class="p">):</span>
    <span class="n">entity</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">edited_entity</span>
    <span class="c"># first see if its specified by __linkto form parameters</span>
    <span class="n">linkedto</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">linked_to</span><span class="p">[(</span><span class="s">&#39;done_in&#39;</span><span class="p">,</span> <span class="s">&#39;subject&#39;</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">linkedto</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">linkedto</span>
    <span class="c"># it isn&#39;t, get initial values</span>
    <span class="n">vocab</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">relvoc_init</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>
    <span class="n">veid</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c"># try to fetch the (already or pending) related version and project</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">entity</span><span class="o">.</span><span class="n">has_eid</span><span class="p">():</span>
        <span class="n">peids</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">linked_to</span><span class="p">[(</span><span class="s">&#39;concerns&#39;</span><span class="p">,</span> <span class="s">&#39;subject&#39;</span><span class="p">)]</span>
        <span class="n">peid</span> <span class="o">=</span> <span class="n">peids</span> <span class="ow">and</span> <span class="n">peids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">peid</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">eid</span>
        <span class="n">veid</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">done_in</span> <span class="ow">and</span> <span class="n">entity</span><span class="o">.</span><span class="n">done_in</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">eid</span>
    <span class="k">if</span> <span class="n">peid</span><span class="p">:</span>
        <span class="c"># we can complete the vocabulary with relevant values</span>
        <span class="n">rschema</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">_cw</span><span class="o">.</span><span class="n">vreg</span><span class="o">.</span><span class="n">schema</span><span class="p">[</span><span class="s">&#39;done_in&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rdef</span><span class="p">(</span><span class="s">&#39;Ticket&#39;</span><span class="p">,</span> <span class="s">&#39;Version&#39;</span><span class="p">)</span>
        <span class="n">rset</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">_cw</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s">&#39;Any V, VN ORDERBY version_sort_value(VN) &#39;</span>
            <span class="s">&#39;WHERE V version_of P, P eid </span><span class="si">%(p)s</span><span class="s">, V num VN, &#39;</span>
            <span class="s">&#39;V in_state ST, NOT ST name &quot;published&quot;&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;p&#39;</span><span class="p">:</span> <span class="n">peid</span><span class="p">},</span> <span class="s">&#39;p&#39;</span><span class="p">)</span>
        <span class="n">vocab</span> <span class="o">+=</span> <span class="p">[(</span><span class="n">v</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="s">&#39;combobox&#39;</span><span class="p">),</span> <span class="n">v</span><span class="o">.</span><span class="n">eid</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">rset</span><span class="o">.</span><span class="n">entities</span><span class="p">()</span>
                  <span class="k">if</span> <span class="n">rschema</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">_cw</span><span class="p">,</span> <span class="s">&#39;add&#39;</span><span class="p">,</span> <span class="n">toeid</span><span class="o">=</span><span class="n">v</span><span class="o">.</span><span class="n">eid</span><span class="p">)</span>
                  <span class="ow">and</span> <span class="n">v</span><span class="o">.</span><span class="n">eid</span> <span class="o">!=</span> <span class="n">veid</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">vocab</span>
</pre></div>
</div>
<p>The first thing we have to do is fetch potential values from the <tt class="docutils literal"><span class="pre">__linkto</span></tt> url
parameter that is often found in entity creation contexts (the creation action
provides such a parameter with a predetermined value; for instance in this case,
ticket creation could occur in the context of a <cite>Version</cite> entity). The
<a class="reference internal" href="#cubicweb.web.formfields.RelationField" title="cubicweb.web.formfields.RelationField"><tt class="xref py py-class docutils literal"><span class="pre">RelationField</span></tt></a> field class provides a
<tt class="xref py py-meth docutils literal"><span class="pre">relvoc_linkedto()</span></tt> method that gets a
list suitably filled with vocabulary values.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">linkedto</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">relvoc_linkedto</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>
<span class="k">if</span> <span class="n">linkedto</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">linkedto</span>
</pre></div>
</div>
<p>Then, if no <tt class="docutils literal"><span class="pre">__linkto</span></tt> argument was given, we must prepare the vocabulary with
an initial empty value (because <cite>done_in</cite> is not mandatory, we must allow the
user to not select a verson) and already linked values. This is done with the
<tt class="xref py py-meth docutils literal"><span class="pre">relvoc_init()</span></tt> method.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">vocab</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">relvoc_init</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>
</pre></div>
</div>
<p>But then, we have to give more: if the ticket is related to a project,
we should provide all the non published versions of this project
(<cite>Version</cite> and <cite>Project</cite> can be related through the <cite>version_of</cite>
relation). Conversely, if we do not know yet the project, it would not
make sense to propose all existing versions as it could potentially
lead to incoherences. Even if these will be caught by some
RQLConstraint, it is wise not to tempt the user with error-inducing
candidate values.</p>
<p>The &#8220;ticket is related to a project&#8221; part must be decomposed as:</p>
<ul class="simple">
<li>this is a new ticket which is created is the context of a project</li>
<li>this is an already existing ticket, linked to a project (through the
<cite>concerns</cite> relation)</li>
<li>there is no related project (quite unlikely given the cardinality of
the <cite>concerns</cite> relation, so it can only mean that we are creating a
new ticket, and a project is about to be selected but there is no
<tt class="docutils literal"><span class="pre">__linkto</span></tt> argument)</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">the last situation could happen in several ways, but of course in a
polished application, the paths to ticket creation should be
controlled so as to avoid a suboptimal end-user experience</p>
</div>
<p>Hence, we try to fetch the related project.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">veid</span> <span class="o">=</span> <span class="bp">None</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">entity</span><span class="o">.</span><span class="n">has_eid</span><span class="p">():</span>
    <span class="n">peids</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">linked_to</span><span class="p">[(</span><span class="s">&#39;concerns&#39;</span><span class="p">,</span> <span class="s">&#39;subject&#39;</span><span class="p">)]</span>
    <span class="n">peid</span> <span class="o">=</span> <span class="n">peids</span> <span class="ow">and</span> <span class="n">peids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">peid</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">eid</span>
    <span class="n">veid</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">done_in</span> <span class="ow">and</span> <span class="n">entity</span><span class="o">.</span><span class="n">done_in</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">eid</span>
</pre></div>
</div>
<p>We distinguish between entity creation and entity modification using
the <tt class="docutils literal"><span class="pre">Entity.has_eid()</span></tt> method, which returns <cite>False</cite> on creation. At
creation time the only way to get a project is through the
<tt class="docutils literal"><span class="pre">__linkto</span></tt> parameter. Notice that we fetch the version in which the
ticket is <cite>done_in</cite> if any, for later.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">the implementation above assumes that if there is a <tt class="docutils literal"><span class="pre">__linkto</span></tt>
parameter, it is only about a project. While it makes sense most of
the time, it is not an absolute. Depending on how an entity creation
action action url is built, several outcomes could be possible
there</p>
</div>
<p>If the ticket is already linked to a project, fetching it is
trivial. Then we add the relevant version to the initial vocabulary.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">peid</span><span class="p">:</span>
    <span class="n">rschema</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">_cw</span><span class="o">.</span><span class="n">vreg</span><span class="o">.</span><span class="n">schema</span><span class="p">[</span><span class="s">&#39;done_in&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rdef</span><span class="p">(</span><span class="s">&#39;Ticket&#39;</span><span class="p">,</span> <span class="s">&#39;Version&#39;</span><span class="p">)</span>
    <span class="n">rset</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">_cw</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
        <span class="s">&#39;Any V, VN ORDERBY version_sort_value(VN) &#39;</span>
        <span class="s">&#39;WHERE V version_of P, P eid </span><span class="si">%(p)s</span><span class="s">, V num VN, &#39;</span>
        <span class="s">&#39;V in_state ST, NOT ST name &quot;published&quot;&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;p&#39;</span><span class="p">:</span> <span class="n">peid</span><span class="p">})</span>
    <span class="n">vocab</span> <span class="o">+=</span> <span class="p">[(</span><span class="n">v</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="s">&#39;combobox&#39;</span><span class="p">),</span> <span class="n">v</span><span class="o">.</span><span class="n">eid</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">rset</span><span class="o">.</span><span class="n">entities</span><span class="p">()</span>
              <span class="k">if</span> <span class="n">rschema</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">_cw</span><span class="p">,</span> <span class="s">&#39;add&#39;</span><span class="p">,</span> <span class="n">toeid</span><span class="o">=</span><span class="n">v</span><span class="o">.</span><span class="n">eid</span><span class="p">)</span>
              <span class="ow">and</span> <span class="n">v</span><span class="o">.</span><span class="n">eid</span> <span class="o">!=</span> <span class="n">veid</span><span class="p">]</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">we have to defend ourselves against lack of a project eid. Given
the cardinality of the <cite>concerns</cite> relation, there <em>must</em> be a
project, but this rule can only be enforced at validation time,
which will happen of course only after form subsmission</p>
</div>
<p>Here, given a project eid, we complete the vocabulary with all
unpublished versions defined in the project (sorted by number) for
which the current user is allowed to establish the relation.</p>
</div>
<div class="section" id="building-self-posted-form-with-custom-fields-widgets">
<h2>Building self-posted form with custom fields/widgets<a class="headerlink" href="#building-self-posted-form-with-custom-fields-widgets" title="Permalink to this headline">¶</a></h2>
<p>Sometimes you want a form that is not related to entity edition. For those,
you&#8217;ll have to handle form posting by yourself. Here is a complete example on how
to achieve this (and more).</p>
<p>Imagine you want a form that selects a month period. There are no proper
field/widget to handle this in CubicWeb, so let&#8217;s start by defining them:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># let&#39;s have the whole import list at the beginning, even those necessary for</span>
<span class="c"># subsequent snippets</span>
<span class="kn">from</span> <span class="nn">logilab.common</span> <span class="kn">import</span> <span class="n">date</span>
<span class="kn">from</span> <span class="nn">logilab.mtconverter</span> <span class="kn">import</span> <span class="n">xml_escape</span>
<span class="kn">from</span> <span class="nn">cubicweb.view</span> <span class="kn">import</span> <span class="n">View</span>
<span class="kn">from</span> <span class="nn">cubicweb.predicates</span> <span class="kn">import</span> <span class="n">match_kwargs</span>
<span class="kn">from</span> <span class="nn">cubicweb.web</span> <span class="kn">import</span> <span class="n">RequestError</span><span class="p">,</span> <span class="n">ProcessFormError</span>
<span class="kn">from</span> <span class="nn">cubicweb.web</span> <span class="kn">import</span> <span class="n">formfields</span> <span class="k">as</span> <span class="n">fields</span><span class="p">,</span> <span class="n">formwidgets</span> <span class="k">as</span> <span class="n">wdgs</span>
<span class="kn">from</span> <span class="nn">cubicweb.web.views</span> <span class="kn">import</span> <span class="n">forms</span><span class="p">,</span> <span class="n">calendar</span>

<span class="k">class</span> <span class="nc">MonthSelect</span><span class="p">(</span><span class="n">wdgs</span><span class="o">.</span><span class="n">Select</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Custom widget to display month and year. Expect value to be given as a</span>
<span class="sd">    date instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">format_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">u&#39;</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">month</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">process_field_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">,</span> <span class="n">field</span><span class="p">):</span>
        <span class="n">val</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">MonthSelect</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">process_field_data</span><span class="p">(</span><span class="n">form</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">year</span><span class="p">,</span> <span class="n">month</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
            <span class="n">year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
            <span class="n">month</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">month</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">date</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ProcessFormError</span><span class="p">(</span>
                <span class="n">form</span><span class="o">.</span><span class="n">_cw</span><span class="o">.</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;badly formated date string </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="n">val</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">MonthPeriodField</span><span class="p">(</span><span class="n">fields</span><span class="o">.</span><span class="n">CompoundField</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;custom field composed of two subfields, &#39;begin_month&#39; and &#39;end_month&#39;.</span>

<span class="sd">    It expects to be used on form that has &#39;mindate&#39; and &#39;maxdate&#39; in its</span>
<span class="sd">    extra arguments, telling the range of month to display.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&#39;widget&#39;</span><span class="p">,</span> <span class="n">wdgs</span><span class="o">.</span><span class="n">IntervalWidget</span><span class="p">())</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MonthPeriodField</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span>
            <span class="p">[</span><span class="n">fields</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;begin_month&#39;</span><span class="p">,</span>
                                <span class="n">choices</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_range</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_mindate</span><span class="p">,</span>
                                <span class="n">widget</span><span class="o">=</span><span class="n">MonthSelect</span><span class="p">()),</span>
             <span class="n">fields</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;end_month&#39;</span><span class="p">,</span>
                                <span class="n">choices</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_range</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_maxdate</span><span class="p">,</span>
                                <span class="n">widget</span><span class="o">=</span><span class="n">MonthSelect</span><span class="p">())],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_range</span><span class="p">(</span><span class="n">form</span><span class="p">,</span> <span class="n">field</span><span class="p">):</span>
        <span class="n">mindate</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">todate</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">cw_extra_kwargs</span><span class="p">[</span><span class="s">&#39;mindate&#39;</span><span class="p">])</span>
        <span class="n">maxdate</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">todate</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">cw_extra_kwargs</span><span class="p">[</span><span class="s">&#39;maxdate&#39;</span><span class="p">])</span>
        <span class="k">assert</span> <span class="n">mindate</span> <span class="o">&lt;=</span> <span class="n">maxdate</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">_cw</span><span class="o">.</span><span class="n">_</span>
        <span class="n">months</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="n">mindate</span> <span class="o">&lt;=</span> <span class="n">maxdate</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="n">calendar</span><span class="o">.</span><span class="n">MONTHNAMES</span><span class="p">[</span><span class="n">mindate</span><span class="o">.</span><span class="n">month</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]),</span>
                               <span class="n">mindate</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">widget</span><span class="o">.</span><span class="n">format_value</span><span class="p">(</span><span class="n">form</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">mindate</span><span class="p">)</span>
            <span class="n">months</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">mindate</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">next_month</span><span class="p">(</span><span class="n">mindate</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">months</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_mindate</span><span class="p">(</span><span class="n">form</span><span class="p">,</span> <span class="n">field</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">form</span><span class="o">.</span><span class="n">cw_extra_kwargs</span><span class="p">[</span><span class="s">&#39;mindate&#39;</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_maxdate</span><span class="p">(</span><span class="n">form</span><span class="p">,</span> <span class="n">field</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">form</span><span class="o">.</span><span class="n">cw_extra_kwargs</span><span class="p">[</span><span class="s">&#39;maxdate&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">process_posted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">field</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">super</span><span class="p">(</span><span class="n">MonthPeriodField</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">process_posted</span><span class="p">(</span><span class="n">form</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&#39;end_month&#39;</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">last_day</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">field</span><span class="p">,</span> <span class="n">value</span>
</pre></div>
</div>
<p>Here we first define a widget that will be used to select the beginning and the
end of the period, displaying months like &#8216;&lt;month&gt; YYYY&#8217; but using &#8216;YYYY/mm&#8217; as
actual value.</p>
<p>We then define a field that will actually hold two fields, one for the beginning
and another for the end of the period. Each subfield uses the widget we defined
earlier, and the outer field itself uses the standard
<tt class="xref py py-class docutils literal"><span class="pre">IntervalWidget</span></tt>. The field adds some logic:</p>
<ul class="simple">
<li>a vocabulary generation function <cite>get_range</cite>, used to populate each sub-field</li>
<li>two &#8216;value&#8217; functions <cite>get_mindate</cite> and <cite>get_maxdate</cite>, used to tell to
subfields which value they should consider on form initialization</li>
<li>overriding of <cite>process_posted</cite>, called when the form is being posted, so that
the end of the period is properly set to the last day of the month.</li>
</ul>
<p>Now, we can define a very simple form:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MonthPeriodSelectorForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">FieldsForm</span><span class="p">):</span>
    <span class="n">__regid__</span> <span class="o">=</span> <span class="s">&#39;myform&#39;</span>
    <span class="n">__select__</span> <span class="o">=</span> <span class="n">match_kwargs</span><span class="p">(</span><span class="s">&#39;mindate&#39;</span><span class="p">,</span> <span class="s">&#39;maxdate&#39;</span><span class="p">)</span>

    <span class="n">form_buttons</span> <span class="o">=</span> <span class="p">[</span><span class="n">wdgs</span><span class="o">.</span><span class="n">SubmitButton</span><span class="p">()]</span>
    <span class="n">form_renderer_id</span> <span class="o">=</span> <span class="s">&#39;onerowtable&#39;</span>
    <span class="n">period</span> <span class="o">=</span> <span class="n">MonthPeriodField</span><span class="p">()</span>
</pre></div>
</div>
<p>where we simply add our field, set a submit button and use a very simple renderer
(try others!). Also we specify a selector that ensures form will have arguments
necessary to our field.</p>
<p>Now, we need a view that will wrap the form and handle post when it occurs,
simply displaying posted values in the page:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">SelfPostingForm</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
    <span class="n">__regid__</span> <span class="o">=</span> <span class="s">&#39;myformview&#39;</span>

    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">mindate</span><span class="p">,</span> <span class="n">maxdate</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">date</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">form</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cw</span><span class="o">.</span><span class="n">vreg</span><span class="p">[</span><span class="s">&#39;forms&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
            <span class="s">&#39;myform&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cw</span><span class="p">,</span> <span class="n">mindate</span><span class="o">=</span><span class="n">mindate</span><span class="p">,</span> <span class="n">maxdate</span><span class="o">=</span><span class="n">maxdate</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">posted</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">process_posted</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">(</span><span class="s">u&#39;&lt;p&gt;posted values </span><span class="si">%s</span><span class="s">&lt;/p&gt;&#39;</span> <span class="o">%</span> <span class="n">xml_escape</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">posted</span><span class="p">)))</span>
        <span class="k">except</span> <span class="n">RequestError</span><span class="p">:</span> <span class="c"># no specified period asked</span>
            <span class="k">pass</span>
        <span class="n">form</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">w</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">,</span> <span class="n">formvalues</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_cw</span><span class="o">.</span><span class="n">form</span><span class="p">)</span>
</pre></div>
</div>
<p>Notice usage of the <tt class="xref py py-meth docutils literal"><span class="pre">process_posted()</span></tt> method, that will return a dictionary
of typed values (because they have been processed by the field). In our case, when
the form is posted you should see a dictionary with &#8216;begin_month&#8217; and &#8216;end_month&#8217;
as keys with the selected dates as value (as a python <cite>date</cite> object).</p>
</div>
<div class="section" id="module-cubicweb.web.formfields">
<span id="apis"></span><h2>APIs<a class="headerlink" href="#module-cubicweb.web.formfields" title="Permalink to this headline">¶</a></h2>
<div class="section" id="the-field-class-and-basic-fields">
<h3>The Field class and basic fields<a class="headerlink" href="#the-field-class-and-basic-fields" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Fields are used to control what&#8217;s edited in forms. They makes the link between
something to edit and its display in the form. Actual display is handled by a
widget associated to the field.</p>
</div>
<p>Let first see the base class for fields:</p>
<dl class="class">
<dt id="cubicweb.web.formfields.Field">
<em class="property">class </em><tt class="descclassname">cubicweb.web.formfields.</tt><tt class="descname">Field</tt><big>(</big><em>name=None</em>, <em>label=&lt;nullobject&gt;</em>, <em>widget=None</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.web.formfields.Field" title="Permalink to this definition">¶</a></dt>
<dd><p>This class is the abstract base class for all fields. It hold a bunch
of attributes which may be used for fine control of the behaviour of a
concrete field.</p>
<p><strong>Attributes</strong></p>
<p>All the attributes described below have sensible default value which may be
overriden by named arguments given to field&#8217;s constructor.</p>
<dl class="docutils">
<dt><tt class="xref py py-attr docutils literal"><span class="pre">name</span></tt></dt>
<dd>base name of the field (basestring). The actual input name is returned by
the <a class="reference internal" href="#cubicweb.web.formfields.Field.input_name" title="cubicweb.web.formfields.Field.input_name"><tt class="xref py py-meth docutils literal"><span class="pre">input_name()</span></tt></a> method and may differ from that name (for instance
if <cite>eidparam</cite> is true).</dd>
<dt><tt class="xref py py-attr docutils literal"><span class="pre">id</span></tt></dt>
<dd>DOM identifier (default to the same value as <cite>name</cite>), should be unique in
a form.</dd>
<dt><tt class="xref py py-attr docutils literal"><span class="pre">label</span></tt></dt>
<dd>label of the field (default to the same value as <cite>name</cite>).</dd>
<dt><tt class="xref py py-attr docutils literal"><span class="pre">help</span></tt></dt>
<dd>help message about this field.</dd>
<dt><tt class="xref py py-attr docutils literal"><span class="pre">widget</span></tt></dt>
<dd>widget associated to the field. Each field class has a default widget
class which may be overriden per instance.</dd>
<dt><tt class="xref py py-attr docutils literal"><span class="pre">value</span></tt></dt>
<dd>field value. May be an actual value or a callable which should take the
form as argument and return a value.</dd>
<dt><tt class="xref py py-attr docutils literal"><span class="pre">choices</span></tt></dt>
<dd>static vocabulary for this field. May be a list of values, a list of
(label, value) tuples or a callable which should take the form and field
as arguments and return a list of values or a list of (label, value).</dd>
<dt><tt class="xref py py-attr docutils literal"><span class="pre">required</span></tt></dt>
<dd>bool flag telling if the field is required or not.</dd>
<dt><tt class="xref py py-attr docutils literal"><span class="pre">sort</span></tt></dt>
<dd>bool flag telling if the vocabulary (either static vocabulary specified
in <cite>choices</cite> or dynamic vocabulary fetched from the form) should be
sorted on label.</dd>
<dt><tt class="xref py py-attr docutils literal"><span class="pre">internationalizable</span></tt></dt>
<dd>bool flag telling if the vocabulary labels should be translated using the
current request language.</dd>
<dt><tt class="xref py py-attr docutils literal"><span class="pre">eidparam</span></tt></dt>
<dd>bool flag telling if this field is linked to a specific entity</dd>
<dt><tt class="xref py py-attr docutils literal"><span class="pre">role</span></tt></dt>
<dd>when the field is linked to an entity attribute or relation, tells the
role of the entity in the relation (eg &#8216;subject&#8217; or &#8216;object&#8217;). If this is
not an attribute or relation of the edited entity, <cite>role</cite> should be
<cite>None</cite>.</dd>
<dt><tt class="xref py py-attr docutils literal"><span class="pre">fieldset</span></tt></dt>
<dd>optional fieldset to which this field belongs to</dd>
<dt><tt class="xref py py-attr docutils literal"><span class="pre">order</span></tt></dt>
<dd>key used by automatic forms to sort fields</dd>
<dt><tt class="xref py py-attr docutils literal"><span class="pre">ignore_req_params</span></tt></dt>
<dd>when true, this field won&#8217;t consider value potentialy specified using
request&#8217;s form parameters (eg you won&#8217;t be able to specify a value using for
instance url like <a class="reference external" href="http://mywebsite.com/form?field=value">http://mywebsite.com/form?field=value</a>)</dd>
</dl>
<p><strong>Generic methods</strong></p>
<dl class="method">
<dt id="cubicweb.web.formfields.Field.input_name">
<tt class="descname">input_name</tt><big>(</big><em>form</em>, <em>suffix=None</em><big>)</big><a class="headerlink" href="#cubicweb.web.formfields.Field.input_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the &#8216;qualified name&#8217; for this field, e.g. something suitable
to use as HTML input name. You can specify a suffix that will be
included in the name when widget needs several inputs.</p>
</dd></dl>

<dl class="method">
<dt id="cubicweb.web.formfields.Field.dom_id">
<tt class="descname">dom_id</tt><big>(</big><em>form</em>, <em>suffix=None</em><big>)</big><a class="headerlink" href="#cubicweb.web.formfields.Field.dom_id" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the HTML DOM identifier for this field, e.g. something
suitable to use as HTML input id. You can specify a suffix that will be
included in the name when widget needs several inputs.</p>
</dd></dl>

<dl class="method">
<dt id="cubicweb.web.formfields.Field.actual_fields">
<tt class="descname">actual_fields</tt><big>(</big><em>form</em><big>)</big><a class="headerlink" href="#cubicweb.web.formfields.Field.actual_fields" title="Permalink to this definition">¶</a></dt>
<dd><p>Fields may be composed of other fields. For instance the
<a class="reference internal" href="#cubicweb.web.formfields.RichTextField" title="cubicweb.web.formfields.RichTextField"><tt class="xref py py-class docutils literal"><span class="pre">RichTextField</span></tt></a> is containing a format
field to define the text format. This method returns actual fields that
should be considered for display / edition. It usually simply return
self.</p>
</dd></dl>

<p><strong>Form generation methods</strong></p>
<dl class="method">
<dt id="cubicweb.web.formfields.Field.form_init">
<tt class="descname">form_init</tt><big>(</big><em>form</em><big>)</big><a class="headerlink" href="#cubicweb.web.formfields.Field.form_init" title="Permalink to this definition">¶</a></dt>
<dd><p>Method called at form initialization to trigger potential field
initialization requiring the form instance. Do nothing by default.</p>
</dd></dl>

<dl class="method">
<dt id="cubicweb.web.formfields.Field.typed_value">
<tt class="descname">typed_value</tt><big>(</big><em>form</em>, <em>load_bytes=False</em><big>)</big><a class="headerlink" href="#cubicweb.web.formfields.Field.typed_value" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the correctly typed value for this field in the form context.</p>
</dd></dl>

<p><strong>Post handling methods</strong></p>
<dl class="method">
<dt id="cubicweb.web.formfields.Field.process_posted">
<tt class="descname">process_posted</tt><big>(</big><em>form</em><big>)</big><a class="headerlink" href="#cubicweb.web.formfields.Field.process_posted" title="Permalink to this definition">¶</a></dt>
<dd><p>Return an iterator on (field, value) that has been posted for
field returned by <a class="reference internal" href="#cubicweb.web.formfields.Field.actual_fields" title="cubicweb.web.formfields.Field.actual_fields"><tt class="xref py py-meth docutils literal"><span class="pre">actual_fields()</span></tt></a>.</p>
</dd></dl>

<dl class="method">
<dt id="cubicweb.web.formfields.Field.process_form_value">
<tt class="descname">process_form_value</tt><big>(</big><em>form</em><big>)</big><a class="headerlink" href="#cubicweb.web.formfields.Field.process_form_value" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the correctly typed value posted for this field.</p>
</dd></dl>

</dd></dl>

<p>Now, you usually don&#8217;t use that class but one of the concrete field classes
described below, according to what you want to edit.</p>
<div class="section" id="basic-fields">
<h4>Basic fields<a class="headerlink" href="#basic-fields" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="cubicweb.web.formfields.StringField">
<em class="property">class </em><tt class="descclassname">cubicweb.web.formfields.</tt><tt class="descname">StringField</tt><a class="headerlink" href="#cubicweb.web.formfields.StringField" title="Permalink to this definition">¶</a></dt>
<dd><p>Use this field to edit unicode string (<cite>String</cite> yams type). This field
additionaly support a <cite>max_length</cite> attribute that specify a maximum size for
the string (<cite>None</cite> meaning no limit).</p>
<p>Unless explicitly specified, the widget for this field will be:</p>
<ul class="simple">
<li><a class="reference internal" href="#cubicweb.web.formwidgets.Select" title="cubicweb.web.formwidgets.Select"><tt class="xref py py-class docutils literal"><span class="pre">Select</span></tt></a> if some vocabulary is specified
using <cite>choices</cite> attribute</li>
<li><a class="reference internal" href="#cubicweb.web.formwidgets.TextInput" title="cubicweb.web.formwidgets.TextInput"><tt class="xref py py-class docutils literal"><span class="pre">TextInput</span></tt></a> if maximum size is specified
using <cite>max_length</cite> attribute and this length is inferior to 257.</li>
<li><a class="reference internal" href="#cubicweb.web.formwidgets.TextArea" title="cubicweb.web.formwidgets.TextArea"><tt class="xref py py-class docutils literal"><span class="pre">TextArea</span></tt></a> in all other cases</li>
</ul>
</dd></dl>

<dl class="class">
<dt id="cubicweb.web.formfields.PasswordField">
<em class="property">class </em><tt class="descclassname">cubicweb.web.formfields.</tt><tt class="descname">PasswordField</tt><a class="headerlink" href="#cubicweb.web.formfields.PasswordField" title="Permalink to this definition">¶</a></dt>
<dd><p>Use this field to edit password (<cite>Password</cite> yams type, encoded python
string).</p>
<p>Unless explicitly specified, the widget for this field will be
a <a class="reference internal" href="#cubicweb.web.formwidgets.PasswordInput" title="cubicweb.web.formwidgets.PasswordInput"><tt class="xref py py-class docutils literal"><span class="pre">PasswordInput</span></tt></a>.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.web.formfields.IntField">
<em class="property">class </em><tt class="descclassname">cubicweb.web.formfields.</tt><tt class="descname">IntField</tt><a class="headerlink" href="#cubicweb.web.formfields.IntField" title="Permalink to this definition">¶</a></dt>
<dd><p>Use this field to edit integers (<cite>Int</cite> yams type). Similar to
<a class="reference internal" href="#cubicweb.web.formfields.BigIntField" title="cubicweb.web.formfields.BigIntField"><tt class="xref py py-class docutils literal"><span class="pre">BigIntField</span></tt></a> but set max length when text
input widget is used (the default).</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.web.formfields.BigIntField">
<em class="property">class </em><tt class="descclassname">cubicweb.web.formfields.</tt><tt class="descname">BigIntField</tt><a class="headerlink" href="#cubicweb.web.formfields.BigIntField" title="Permalink to this definition">¶</a></dt>
<dd><p>Use this field to edit big integers (<cite>BigInt</cite> yams type). This field
additionaly support <cite>min</cite> and <cite>max</cite> attributes that specify a minimum and/or
maximum value for the integer (<cite>None</cite> meaning no boundary).</p>
<p>Unless explicitly specified, the widget for this field will be a
<a class="reference internal" href="#cubicweb.web.formwidgets.TextInput" title="cubicweb.web.formwidgets.TextInput"><tt class="xref py py-class docutils literal"><span class="pre">TextInput</span></tt></a>.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.web.formfields.FloatField">
<em class="property">class </em><tt class="descclassname">cubicweb.web.formfields.</tt><tt class="descname">FloatField</tt><a class="headerlink" href="#cubicweb.web.formfields.FloatField" title="Permalink to this definition">¶</a></dt>
<dd><p>Use this field to edit floats (<cite>Float</cite> yams type). This field additionaly
support <cite>min</cite> and <cite>max</cite> attributes as the
<a class="reference internal" href="#cubicweb.web.formfields.IntField" title="cubicweb.web.formfields.IntField"><tt class="xref py py-class docutils literal"><span class="pre">IntField</span></tt></a>.</p>
<p>Unless explicitly specified, the widget for this field will be a
<a class="reference internal" href="#cubicweb.web.formwidgets.TextInput" title="cubicweb.web.formwidgets.TextInput"><tt class="xref py py-class docutils literal"><span class="pre">TextInput</span></tt></a>.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.web.formfields.BooleanField">
<em class="property">class </em><tt class="descclassname">cubicweb.web.formfields.</tt><tt class="descname">BooleanField</tt><a class="headerlink" href="#cubicweb.web.formfields.BooleanField" title="Permalink to this definition">¶</a></dt>
<dd><p>Use this field to edit booleans (<cite>Boolean</cite> yams type).</p>
<p>Unless explicitly specified, the widget for this field will be a
<a class="reference internal" href="#cubicweb.web.formwidgets.Radio" title="cubicweb.web.formwidgets.Radio"><tt class="xref py py-class docutils literal"><span class="pre">Radio</span></tt></a> with yes/no values. You
can change that values by specifing <cite>choices</cite>.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.web.formfields.DateField">
<em class="property">class </em><tt class="descclassname">cubicweb.web.formfields.</tt><tt class="descname">DateField</tt><a class="headerlink" href="#cubicweb.web.formfields.DateField" title="Permalink to this definition">¶</a></dt>
<dd><p>Use this field to edit date (<cite>Date</cite> yams type).</p>
<p>Unless explicitly specified, the widget for this field will be a
<a class="reference internal" href="#cubicweb.web.formwidgets.JQueryDatePicker" title="cubicweb.web.formwidgets.JQueryDatePicker"><tt class="xref py py-class docutils literal"><span class="pre">JQueryDatePicker</span></tt></a>.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.web.formfields.DateTimeField">
<em class="property">class </em><tt class="descclassname">cubicweb.web.formfields.</tt><tt class="descname">DateTimeField</tt><a class="headerlink" href="#cubicweb.web.formfields.DateTimeField" title="Permalink to this definition">¶</a></dt>
<dd><p>Use this field to edit datetime (<cite>Datetime</cite> yams type).</p>
<p>Unless explicitly specified, the widget for this field will be a
<a class="reference internal" href="#cubicweb.web.formwidgets.JQueryDateTimePicker" title="cubicweb.web.formwidgets.JQueryDateTimePicker"><tt class="xref py py-class docutils literal"><span class="pre">JQueryDateTimePicker</span></tt></a>.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.web.formfields.TimeField">
<em class="property">class </em><tt class="descclassname">cubicweb.web.formfields.</tt><tt class="descname">TimeField</tt><a class="headerlink" href="#cubicweb.web.formfields.TimeField" title="Permalink to this definition">¶</a></dt>
<dd><p>Use this field to edit time (<cite>Time</cite> yams type).</p>
<p>Unless explicitly specified, the widget for this field will be a
<a class="reference internal" href="#cubicweb.web.formwidgets.JQueryTimePicker" title="cubicweb.web.formwidgets.JQueryTimePicker"><tt class="xref py py-class docutils literal"><span class="pre">JQueryTimePicker</span></tt></a>.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.web.formfields.TimeIntervalField">
<em class="property">class </em><tt class="descclassname">cubicweb.web.formfields.</tt><tt class="descname">TimeIntervalField</tt><a class="headerlink" href="#cubicweb.web.formfields.TimeIntervalField" title="Permalink to this definition">¶</a></dt>
<dd><p>Use this field to edit time interval (<cite>Interval</cite> yams type).</p>
<p>Unless explicitly specified, the widget for this field will be a
<a class="reference internal" href="#cubicweb.web.formwidgets.TextInput" title="cubicweb.web.formwidgets.TextInput"><tt class="xref py py-class docutils literal"><span class="pre">TextInput</span></tt></a>.</p>
</dd></dl>

</div>
<div class="section" id="compound-fields">
<h4>Compound fields<a class="headerlink" href="#compound-fields" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="cubicweb.web.formfields.RichTextField">
<em class="property">class </em><tt class="descclassname">cubicweb.web.formfields.</tt><tt class="descname">RichTextField</tt><a class="headerlink" href="#cubicweb.web.formfields.RichTextField" title="Permalink to this definition">¶</a></dt>
<dd><p>This compound field allow edition of text (unicode string) in
a particular format. It has an inner field holding the text format,
that can be specified using <cite>format_field</cite> argument. If not specified
one will be automaticall generated.</p>
<p>Unless explicitly specified, the widget for this field will be a
<a class="reference internal" href="#cubicweb.web.formwidgets.FCKEditor" title="cubicweb.web.formwidgets.FCKEditor"><tt class="xref py py-class docutils literal"><span class="pre">FCKEditor</span></tt></a> or a
<a class="reference internal" href="#cubicweb.web.formwidgets.TextArea" title="cubicweb.web.formwidgets.TextArea"><tt class="xref py py-class docutils literal"><span class="pre">TextArea</span></tt></a>. according to the field&#8217;s
format and to user&#8217;s preferences.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.web.formfields.FileField">
<em class="property">class </em><tt class="descclassname">cubicweb.web.formfields.</tt><tt class="descname">FileField</tt><a class="headerlink" href="#cubicweb.web.formfields.FileField" title="Permalink to this definition">¶</a></dt>
<dd><p>This compound field allow edition of binary stream (<cite>Bytes</cite> yams
type). Three inner fields may be specified:</p>
<ul class="simple">
<li><cite>format_field</cite>, holding the file&#8217;s format.</li>
<li><cite>encoding_field</cite>, holding the file&#8217;s content encoding.</li>
<li><cite>name_field</cite>, holding the file&#8217;s name.</li>
</ul>
<p>Unless explicitly specified, the widget for this field will be a
<a class="reference internal" href="#cubicweb.web.formwidgets.FileInput" title="cubicweb.web.formwidgets.FileInput"><tt class="xref py py-class docutils literal"><span class="pre">FileInput</span></tt></a>. Inner fields, if any,
will be added to a drop down menu at the right of the file input.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.web.formfields.CompoundField">
<em class="property">class </em><tt class="descclassname">cubicweb.web.formfields.</tt><tt class="descname">CompoundField</tt><a class="headerlink" href="#cubicweb.web.formfields.CompoundField" title="Permalink to this definition">¶</a></dt>
<dd><p>This field shouldn&#8217;t be used directly, it&#8217;s designed to hold inner
fields that should be conceptually groupped together.</p>
</dd></dl>

</div>
<div class="section" id="entity-specific-fields-and-function">
<h4>Entity specific fields and function<a class="headerlink" href="#entity-specific-fields-and-function" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="cubicweb.web.formfields.RelationField">
<em class="property">class </em><tt class="descclassname">cubicweb.web.formfields.</tt><tt class="descname">RelationField</tt><a class="headerlink" href="#cubicweb.web.formfields.RelationField" title="Permalink to this definition">¶</a></dt>
<dd><p>Use this field to edit a relation of an entity.</p>
<p>Unless explicitly specified, the widget for this field will be a
<a class="reference internal" href="#cubicweb.web.formwidgets.Select" title="cubicweb.web.formwidgets.Select"><tt class="xref py py-class docutils literal"><span class="pre">Select</span></tt></a>.</p>
</dd></dl>

<dl class="function">
<dt id="cubicweb.web.formfields.guess_field">
<tt class="descclassname">cubicweb.web.formfields.</tt><tt class="descname">guess_field</tt><big>(</big><em>eschema</em>, <em>rschema</em>, <em>role='subject'</em>, <em>req=None</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.web.formfields.guess_field" title="Permalink to this definition">¶</a></dt>
<dd><p>This function return the most adapted field to edit the given relation
(<cite>rschema</cite>) where the given entity type (<cite>eschema</cite>) is the subject or object
(<cite>role</cite>).</p>
<p>The field is initialized according to information found in the schema,
though any value can be explicitly specified using <cite>kwargs</cite>.</p>
</dd></dl>

</div>
</div>
<span class="target" id="module-cubicweb.web.formwidgets"></span><div class="section" id="widgets">
<h3>Widgets<a class="headerlink" href="#widgets" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>A widget is responsible for the display of a field. It may use more than one
HTML input tags. When the form is posted, a widget is also reponsible to give
back to the field something it can understand.</p>
<p class="last">Of course you can not use any widget with any field...</p>
</div>
<dl class="class">
<dt id="cubicweb.web.formwidgets.FieldWidget">
<em class="property">class </em><tt class="descclassname">cubicweb.web.formwidgets.</tt><tt class="descname">FieldWidget</tt><big>(</big><em>attrs=None</em>, <em>setdomid=None</em>, <em>settabindex=None</em>, <em>suffix=None</em><big>)</big><a class="headerlink" href="#cubicweb.web.formwidgets.FieldWidget" title="Permalink to this definition">¶</a></dt>
<dd><p>The abstract base class for widgets.</p>
<p><strong>Attributes</strong></p>
<p>Here are standard attributes of a widget, that may be set on concrete class
to override default behaviours:</p>
<dl class="docutils">
<dt><tt class="xref py py-attr docutils literal"><span class="pre">needs_js</span></tt></dt>
<dd>list of javascript files needed by the widget.</dd>
<dt><tt class="xref py py-attr docutils literal"><span class="pre">needs_css</span></tt></dt>
<dd>list of css files needed by the widget.</dd>
<dt><tt class="xref py py-attr docutils literal"><span class="pre">setdomid</span></tt></dt>
<dd>flag telling if HTML DOM identifier should be set on input.</dd>
<dt><tt class="xref py py-attr docutils literal"><span class="pre">settabindex</span></tt></dt>
<dd>flag telling if HTML tabindex attribute of inputs should be set.</dd>
<dt><tt class="xref py py-attr docutils literal"><span class="pre">suffix</span></tt></dt>
<dd>string to use a suffix when generating input, to ease usage as a
sub-widgets (eg widget used by another widget)</dd>
<dt><tt class="xref py py-attr docutils literal"><span class="pre">vocabulary_widget</span></tt></dt>
<dd>flag telling if this widget expect a vocabulary</dd>
</dl>
<p>Also, widget instances takes as first argument a <cite>attrs</cite> dictionary which
will be stored in the attribute of the same name. It contains HTML
attributes that should be set in the widget&#8217;s input tag (though concrete
classes may ignore it).</p>
<p><strong>Form generation methods</strong></p>
<dl class="method">
<dt id="cubicweb.web.formwidgets.FieldWidget.render">
<tt class="descname">render</tt><big>(</big><em>form</em>, <em>field</em>, <em>renderer=None</em><big>)</big><a class="headerlink" href="#cubicweb.web.formwidgets.FieldWidget.render" title="Permalink to this definition">¶</a></dt>
<dd><p>Called to render the widget for the given <cite>field</cite> in the given
<cite>form</cite>.  Return a unicode string containing the HTML snippet.</p>
<p>You will usually prefer to override the <a class="reference internal" href="#cubicweb.web.formwidgets.FieldWidget._render" title="cubicweb.web.formwidgets.FieldWidget._render"><tt class="xref py py-meth docutils literal"><span class="pre">_render()</span></tt></a> method so you
don&#8217;t have to handle addition of needed javascript / css files.</p>
</dd></dl>

<dl class="method">
<dt id="cubicweb.web.formwidgets.FieldWidget._render">
<tt class="descname">_render</tt><big>(</big><em>form</em>, <em>field</em>, <em>renderer</em><big>)</big><a class="headerlink" href="#cubicweb.web.formwidgets.FieldWidget._render" title="Permalink to this definition">¶</a></dt>
<dd><p>This is the method you have to implement in concrete widget classes.</p>
</dd></dl>

<dl class="method">
<dt id="cubicweb.web.formwidgets.FieldWidget.values">
<tt class="descname">values</tt><big>(</big><em>form</em>, <em>field</em><big>)</big><a class="headerlink" href="#cubicweb.web.formwidgets.FieldWidget.values" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the current <em>string</em> values (i.e. for display in an HTML
string) for the given field. This method returns a list of values since
it&#8217;s suitable for all kind of widgets, some of them taking multiple
values, but you&#8217;ll get a single value in the list in most cases.</p>
<p>Those values are searched in:</p>
<ol class="arabic simple">
<li>previously submitted form values if any (on validation error)</li>
<li>req.form (specified using request parameters)</li>
<li>extra form values given to form.render call (specified the code
generating the form)</li>
<li>field&#8217;s typed value (returned by its
<a class="reference internal" href="#cubicweb.web.formfields.Field.typed_value" title="cubicweb.web.formfields.Field.typed_value"><tt class="xref py py-meth docutils literal"><span class="pre">typed_value()</span></tt></a> method)</li>
</ol>
<p>Values found in 1. and 2. are expected te be already some &#8216;display
value&#8217; (eg a string) while those found in 3. and 4. are expected to be
correctly typed value.</p>
<p>3 and 4 are handle by the <tt class="xref py py-meth docutils literal"><span class="pre">typed_value()</span></tt> method to ease reuse in
concrete classes.</p>
</dd></dl>

<dl class="method">
<dt id="cubicweb.web.formwidgets.FieldWidget.attributes">
<tt class="descname">attributes</tt><big>(</big><em>form</em>, <em>field</em><big>)</big><a class="headerlink" href="#cubicweb.web.formwidgets.FieldWidget.attributes" title="Permalink to this definition">¶</a></dt>
<dd><p>Return HTML attributes for the widget, automatically setting DOM
identifier and tabindex when desired (see <tt class="xref py py-attr docutils literal"><span class="pre">setdomid</span></tt> and
<tt class="xref py py-attr docutils literal"><span class="pre">settabindex</span></tt> attributes)</p>
</dd></dl>

<p><strong>Post handling methods</strong></p>
<dl class="method">
<dt id="cubicweb.web.formwidgets.FieldWidget.process_field_data">
<tt class="descname">process_field_data</tt><big>(</big><em>form</em>, <em>field</em><big>)</big><a class="headerlink" href="#cubicweb.web.formwidgets.FieldWidget.process_field_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Return process posted value(s) for widget and return something
understandable by the associated <cite>field</cite>. That value may be correctly
typed or a string that the field may parse.</p>
</dd></dl>

</dd></dl>

<div class="section" id="html-input-based-widgets">
<h4>HTML &lt;input&gt; based widgets<a class="headerlink" href="#html-input-based-widgets" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="cubicweb.web.formwidgets.HiddenInput">
<em class="property">class </em><tt class="descclassname">cubicweb.web.formwidgets.</tt><tt class="descname">HiddenInput</tt><big>(</big><em>attrs=None</em>, <em>setdomid=None</em>, <em>settabindex=None</em>, <em>suffix=None</em><big>)</big><a class="headerlink" href="#cubicweb.web.formwidgets.HiddenInput" title="Permalink to this definition">¶</a></dt>
<dd><p>Simple &lt;input type=&#8217;hidden&#8217;&gt; for hidden value, will return an unicode
string.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.web.formwidgets.TextInput">
<em class="property">class </em><tt class="descclassname">cubicweb.web.formwidgets.</tt><tt class="descname">TextInput</tt><big>(</big><em>attrs=None</em>, <em>setdomid=None</em>, <em>settabindex=None</em>, <em>suffix=None</em><big>)</big><a class="headerlink" href="#cubicweb.web.formwidgets.TextInput" title="Permalink to this definition">¶</a></dt>
<dd><p>Simple &lt;input type=&#8217;text&#8217;&gt;, will return an unicode string.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.web.formwidgets.PasswordSingleInput">
<em class="property">class </em><tt class="descclassname">cubicweb.web.formwidgets.</tt><tt class="descname">PasswordSingleInput</tt><big>(</big><em>attrs=None</em>, <em>setdomid=None</em>, <em>settabindex=None</em>, <em>suffix=None</em><big>)</big><a class="headerlink" href="#cubicweb.web.formwidgets.PasswordSingleInput" title="Permalink to this definition">¶</a></dt>
<dd><p>Simple &lt;input type=&#8217;password&#8217;&gt;, will return an utf-8 encoded string.</p>
<p>You may prefer using the <a class="reference internal" href="#cubicweb.web.formwidgets.PasswordInput" title="cubicweb.web.formwidgets.PasswordInput"><tt class="xref py py-class docutils literal"><span class="pre">PasswordInput</span></tt></a>
widget which handles password confirmation.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.web.formwidgets.FileInput">
<em class="property">class </em><tt class="descclassname">cubicweb.web.formwidgets.</tt><tt class="descname">FileInput</tt><big>(</big><em>attrs=None</em>, <em>setdomid=None</em>, <em>settabindex=None</em>, <em>suffix=None</em><big>)</big><a class="headerlink" href="#cubicweb.web.formwidgets.FileInput" title="Permalink to this definition">¶</a></dt>
<dd><p>Simple &lt;input type=&#8217;file&#8217;&gt;, will return a tuple (name, stream) where
name is the posted file name and stream a file like object containing the
posted file data.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.web.formwidgets.ButtonInput">
<em class="property">class </em><tt class="descclassname">cubicweb.web.formwidgets.</tt><tt class="descname">ButtonInput</tt><big>(</big><em>attrs=None</em>, <em>setdomid=None</em>, <em>settabindex=None</em>, <em>suffix=None</em><big>)</big><a class="headerlink" href="#cubicweb.web.formwidgets.ButtonInput" title="Permalink to this definition">¶</a></dt>
<dd><p>Simple &lt;input type=&#8217;button&#8217;&gt;, will return an unicode string.</p>
<p>If you want a global form button, look at the <a class="reference internal" href="#cubicweb.web.formwidgets.Button" title="cubicweb.web.formwidgets.Button"><tt class="xref py py-class docutils literal"><span class="pre">Button</span></tt></a>,
<a class="reference internal" href="#cubicweb.web.formwidgets.SubmitButton" title="cubicweb.web.formwidgets.SubmitButton"><tt class="xref py py-class docutils literal"><span class="pre">SubmitButton</span></tt></a>, <a class="reference internal" href="#cubicweb.web.formwidgets.ResetButton" title="cubicweb.web.formwidgets.ResetButton"><tt class="xref py py-class docutils literal"><span class="pre">ResetButton</span></tt></a> and <a class="reference internal" href="#cubicweb.web.formwidgets.ImgButton" title="cubicweb.web.formwidgets.ImgButton"><tt class="xref py py-class docutils literal"><span class="pre">ImgButton</span></tt></a> below.</p>
</dd></dl>

</div>
<div class="section" id="other-standard-html-widgets">
<h4>Other standard HTML widgets<a class="headerlink" href="#other-standard-html-widgets" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="cubicweb.web.formwidgets.TextArea">
<em class="property">class </em><tt class="descclassname">cubicweb.web.formwidgets.</tt><tt class="descname">TextArea</tt><big>(</big><em>attrs=None</em>, <em>setdomid=None</em>, <em>settabindex=None</em>, <em>suffix=None</em><big>)</big><a class="headerlink" href="#cubicweb.web.formwidgets.TextArea" title="Permalink to this definition">¶</a></dt>
<dd><p>Simple &lt;textarea&gt;, will return an unicode string.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.web.formwidgets.Select">
<em class="property">class </em><tt class="descclassname">cubicweb.web.formwidgets.</tt><tt class="descname">Select</tt><big>(</big><em>attrs=None</em>, <em>multiple=False</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.web.formwidgets.Select" title="Permalink to this definition">¶</a></dt>
<dd><p>Simple &lt;select&gt;, for field having a specific vocabulary. Will return
an unicode string, or a list of unicode strings.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.web.formwidgets.CheckBox">
<em class="property">class </em><tt class="descclassname">cubicweb.web.formwidgets.</tt><tt class="descname">CheckBox</tt><big>(</big><em>attrs=None</em>, <em>separator=None</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.web.formwidgets.CheckBox" title="Permalink to this definition">¶</a></dt>
<dd><p>Simple &lt;input type=&#8217;checkbox&#8217;&gt;, for field having a specific
vocabulary. One input will be generated for each possible value.</p>
<p>You can specify separator using the <cite>separator</cite> constructor argument, by
default &lt;br/&gt; is used.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.web.formwidgets.Radio">
<em class="property">class </em><tt class="descclassname">cubicweb.web.formwidgets.</tt><tt class="descname">Radio</tt><big>(</big><em>attrs=None</em>, <em>separator=None</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.web.formwidgets.Radio" title="Permalink to this definition">¶</a></dt>
<dd><p>Simle &lt;input type=&#8217;radio&#8217;&gt;, for field having a specific vocabulary. One
input will be generated for each possible value.</p>
<p>You can specify separator using the <cite>separator</cite> constructor argument, by
default &lt;br/&gt; is used.</p>
</dd></dl>

</div>
<div class="section" id="date-and-time-widgets">
<h4>Date and time widgets<a class="headerlink" href="#date-and-time-widgets" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="cubicweb.web.formwidgets.DateTimePicker">
<em class="property">class </em><tt class="descclassname">cubicweb.web.formwidgets.</tt><tt class="descname">DateTimePicker</tt><big>(</big><em>attrs=None</em>, <em>setdomid=None</em>, <em>settabindex=None</em>, <em>suffix=None</em><big>)</big><a class="headerlink" href="#cubicweb.web.formwidgets.DateTimePicker" title="Permalink to this definition">¶</a></dt>
<dd><p>&lt;input type=&#8217;text&#8217;&gt; + javascript date/time picker for date or datetime
fields. Will return the date or datetime as an unicode string.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.web.formwidgets.JQueryDateTimePicker">
<em class="property">class </em><tt class="descclassname">cubicweb.web.formwidgets.</tt><tt class="descname">JQueryDateTimePicker</tt><big>(</big><em>initialtime=None</em>, <em>timesteps=15</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.web.formwidgets.JQueryDateTimePicker" title="Permalink to this definition">¶</a></dt>
<dd><p>Compound widget using <a class="reference internal" href="#cubicweb.web.formwidgets.JQueryDatePicker" title="cubicweb.web.formwidgets.JQueryDatePicker"><tt class="xref py py-class docutils literal"><span class="pre">JQueryDatePicker</span></tt></a> and
<a class="reference internal" href="#cubicweb.web.formwidgets.JQueryTimePicker" title="cubicweb.web.formwidgets.JQueryTimePicker"><tt class="xref py py-class docutils literal"><span class="pre">JQueryTimePicker</span></tt></a> widgets to define a date and time picker. Will
return the date and time as python datetime instance.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.web.formwidgets.JQueryDatePicker">
<em class="property">class </em><tt class="descclassname">cubicweb.web.formwidgets.</tt><tt class="descname">JQueryDatePicker</tt><big>(</big><em>datestr=None</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.web.formwidgets.JQueryDatePicker" title="Permalink to this definition">¶</a></dt>
<dd><p>Use jquery.ui.datepicker to define a date picker. Will return the date as
an unicode string.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.web.formwidgets.JQueryTimePicker">
<em class="property">class </em><tt class="descclassname">cubicweb.web.formwidgets.</tt><tt class="descname">JQueryTimePicker</tt><big>(</big><em>timestr=None</em>, <em>timesteps=30</em>, <em>separator=u':'</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.web.formwidgets.JQueryTimePicker" title="Permalink to this definition">¶</a></dt>
<dd><p>Use jquery.timePicker to define a time picker. Will return the time as an
unicode string.</p>
</dd></dl>

</div>
<div class="section" id="ajax-javascript-widgets">
<h4>Ajax / javascript widgets<a class="headerlink" href="#ajax-javascript-widgets" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="cubicweb.web.formwidgets.FCKEditor">
<em class="property">class </em><tt class="descclassname">cubicweb.web.formwidgets.</tt><tt class="descname">FCKEditor</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.web.formwidgets.FCKEditor" title="Permalink to this definition">¶</a></dt>
<dd><p>FCKEditor enabled &lt;textarea&gt;, will return an unicode string containing
HTML formated text.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.web.formwidgets.AjaxWidget">
<em class="property">class </em><tt class="descclassname">cubicweb.web.formwidgets.</tt><tt class="descname">AjaxWidget</tt><big>(</big><em>wdgtype</em>, <em>inputid=None</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.web.formwidgets.AjaxWidget" title="Permalink to this definition">¶</a></dt>
<dd><p>Simple &lt;div&gt; based ajax widget, requiring a <cite>wdgtype</cite> argument telling
which javascript widget should be used.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.web.formwidgets.AutoCompletionWidget">
<em class="property">class </em><tt class="descclassname">cubicweb.web.formwidgets.</tt><tt class="descname">AutoCompletionWidget</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.web.formwidgets.AutoCompletionWidget" title="Permalink to this definition">¶</a></dt>
<dd><p>&lt;input type=&#8217;text&#8217;&gt; based ajax widget, taking a <cite>autocomplete_initfunc</cite>
argument which should specify the name of a method of the json
controller. This method is expected to return allowed values for the input,
that the widget will use to propose matching values as you type.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.web.formwidgets.InOutWidget">
<em class="property">class </em><tt class="descclassname">cubicweb.web.formwidgets.</tt><tt class="descname">InOutWidget</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.web.formwidgets.InOutWidget" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="other-widgets">
<h4>Other widgets<a class="headerlink" href="#other-widgets" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="cubicweb.web.formwidgets.PasswordInput">
<em class="property">class </em><tt class="descclassname">cubicweb.web.formwidgets.</tt><tt class="descname">PasswordInput</tt><big>(</big><em>attrs=None</em>, <em>setdomid=None</em>, <em>settabindex=None</em>, <em>suffix=None</em><big>)</big><a class="headerlink" href="#cubicweb.web.formwidgets.PasswordInput" title="Permalink to this definition">¶</a></dt>
<dd><p>&lt;input type=&#8217;password&#8217;&gt; and a confirmation input. Form processing will
fail if password and confirmation differs, else it will return the password
as an utf-8 encoded string.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.web.formwidgets.IntervalWidget">
<em class="property">class </em><tt class="descclassname">cubicweb.web.formwidgets.</tt><tt class="descname">IntervalWidget</tt><big>(</big><em>attrs=None</em>, <em>setdomid=None</em>, <em>settabindex=None</em>, <em>suffix=None</em><big>)</big><a class="headerlink" href="#cubicweb.web.formwidgets.IntervalWidget" title="Permalink to this definition">¶</a></dt>
<dd><p>Custom widget to display an interval composed by 2 fields. This widget is
expected to be used with a <tt class="xref py py-class docutils literal"><span class="pre">CompoundField</span></tt> containing the two actual
fields.</p>
<p>Exemple usage:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyForm</span><span class="p">(</span><span class="n">FieldsForm</span><span class="p">):</span>
   <span class="n">price</span> <span class="o">=</span> <span class="n">CompoundField</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">(</span><span class="n">IntField</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;minprice&#39;</span><span class="p">),</span>
                                 <span class="n">IntField</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;maxprice&#39;</span><span class="p">)),</span>
                         <span class="n">label</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;price&#39;</span><span class="p">),</span>
                         <span class="n">widget</span><span class="o">=</span><span class="n">IntervalWidget</span><span class="p">())</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="cubicweb.web.formwidgets.BitSelect">
<em class="property">class </em><tt class="descclassname">cubicweb.web.formwidgets.</tt><tt class="descname">BitSelect</tt><big>(</big><em>attrs=None</em>, <em>multiple=True</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.web.formwidgets.BitSelect" title="Permalink to this definition">¶</a></dt>
<dd><p>Select widget for IntField using a vocabulary with bit masks as values.</p>
<p>See also <a class="reference internal" href="../facets.html#cubicweb.web.facet.BitFieldFacet" title="cubicweb.web.facet.BitFieldFacet"><tt class="xref py py-class docutils literal"><span class="pre">BitFieldFacet</span></tt></a>.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.web.formwidgets.HorizontalLayoutWidget">
<em class="property">class </em><tt class="descclassname">cubicweb.web.formwidgets.</tt><tt class="descname">HorizontalLayoutWidget</tt><big>(</big><em>attrs=None</em>, <em>setdomid=None</em>, <em>settabindex=None</em>, <em>suffix=None</em><big>)</big><a class="headerlink" href="#cubicweb.web.formwidgets.HorizontalLayoutWidget" title="Permalink to this definition">¶</a></dt>
<dd><p>Custom widget to display a set of fields grouped together horizontally in
a form. See <cite>IntervalWidget</cite> for example usage.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.web.formwidgets.EditableURLWidget">
<em class="property">class </em><tt class="descclassname">cubicweb.web.formwidgets.</tt><tt class="descname">EditableURLWidget</tt><big>(</big><em>attrs=None</em>, <em>setdomid=None</em>, <em>settabindex=None</em>, <em>suffix=None</em><big>)</big><a class="headerlink" href="#cubicweb.web.formwidgets.EditableURLWidget" title="Permalink to this definition">¶</a></dt>
<dd><p>Custom widget to edit separatly an url path / query string (used by
default for the <cite>path</cite> attribute of <cite>Bookmark</cite> entities).</p>
<p>It deals with url quoting nicely so that the user edit the unquoted value.</p>
</dd></dl>

</div>
<div class="section" id="form-controls">
<h4>Form controls<a class="headerlink" href="#form-controls" title="Permalink to this headline">¶</a></h4>
<p>Those classes are not proper widget (they are not associated to field) but are
used as form controls. Their API is similar to widgets except that <cite>field</cite>
argument given to <tt class="xref py py-meth docutils literal"><span class="pre">render()</span></tt> will be <cite>None</cite>.</p>
<dl class="class">
<dt id="cubicweb.web.formwidgets.Button">
<em class="property">class </em><tt class="descclassname">cubicweb.web.formwidgets.</tt><tt class="descname">Button</tt><big>(</big><em>label=(u'button_ok'</em>, <em>'OK_ICON')</em>, <em>attrs=None</em>, <em>setdomid=None</em>, <em>settabindex=None</em>, <em>name=''</em>, <em>value=''</em>, <em>onclick=None</em>, <em>cwaction=None</em><big>)</big><a class="headerlink" href="#cubicweb.web.formwidgets.Button" title="Permalink to this definition">¶</a></dt>
<dd><p>Simple &lt;input type=&#8217;button&#8217;&gt;, base class for global form buttons.</p>
<p>Note that <cite>label</cite> is a msgid which will be translated at form generation
time, you should not give an already translated string.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.web.formwidgets.SubmitButton">
<em class="property">class </em><tt class="descclassname">cubicweb.web.formwidgets.</tt><tt class="descname">SubmitButton</tt><big>(</big><em>label=(u'button_ok'</em>, <em>'OK_ICON')</em>, <em>attrs=None</em>, <em>setdomid=None</em>, <em>settabindex=None</em>, <em>name=''</em>, <em>value=''</em>, <em>onclick=None</em>, <em>cwaction=None</em><big>)</big><a class="headerlink" href="#cubicweb.web.formwidgets.SubmitButton" title="Permalink to this definition">¶</a></dt>
<dd><p>Simple &lt;input type=&#8217;submit&#8217;&gt;, main button to submit a form</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.web.formwidgets.ResetButton">
<em class="property">class </em><tt class="descclassname">cubicweb.web.formwidgets.</tt><tt class="descname">ResetButton</tt><big>(</big><em>label=(u'button_ok'</em>, <em>'OK_ICON')</em>, <em>attrs=None</em>, <em>setdomid=None</em>, <em>settabindex=None</em>, <em>name=''</em>, <em>value=''</em>, <em>onclick=None</em>, <em>cwaction=None</em><big>)</big><a class="headerlink" href="#cubicweb.web.formwidgets.ResetButton" title="Permalink to this definition">¶</a></dt>
<dd><p>Simple &lt;input type=&#8217;reset&#8217;&gt;, main button to reset a form. You usually
don&#8217;t want to use this.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.web.formwidgets.ImgButton">
<em class="property">class </em><tt class="descclassname">cubicweb.web.formwidgets.</tt><tt class="descname">ImgButton</tt><big>(</big><em>domid</em>, <em>href</em>, <em>label</em>, <em>imgressource</em><big>)</big><a class="headerlink" href="#cubicweb.web.formwidgets.ImgButton" title="Permalink to this definition">¶</a></dt>
<dd><p>Simple &lt;img&gt; wrapped into a &lt;a&gt; tag with href triggering something (usually a
javascript call).</p>
</dd></dl>

</div>
</div>
<span class="target" id="module-cubicweb.web.views.forms"></span><div class="section" id="base-form-classes">
<h3>Base form classes<a class="headerlink" href="#base-form-classes" title="Permalink to this headline">¶</a></h3>
<p>Besides the automagic form we&#8217;ll see later, there are roughly two main
form classes in <em>CubicWeb</em>:</p>
<dl class="class">
<dt id="cubicweb.web.views.forms.FieldsForm">
<em class="property">class </em><tt class="descclassname">cubicweb.web.views.forms.</tt><tt class="descname">FieldsForm</tt><big>(</big><em>req</em>, <em>rset=None</em>, <em>row=None</em>, <em>col=None</em>, <em>submitmsg=None</em>, <em>mainform=True</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.web.views.forms.FieldsForm" title="Permalink to this definition">¶</a></dt>
<dd><p>This is the base class for fields based forms.</p>
<p><strong>Attributes</strong></p>
<p>The following attributes may be either set on subclasses or given on
form selection to customize the generated form:</p>
<dl class="docutils">
<dt><tt class="xref py py-attr docutils literal"><span class="pre">needs_js</span></tt></dt>
<dd>sequence of javascript files that should be added to handle this form
(through <tt class="xref py py-meth docutils literal"><span class="pre">add_js()</span></tt>)</dd>
<dt><tt class="xref py py-attr docutils literal"><span class="pre">needs_css</span></tt></dt>
<dd>sequence of css files that should be added to handle this form (through
<tt class="xref py py-meth docutils literal"><span class="pre">add_css()</span></tt>)</dd>
<dt><tt class="xref py py-attr docutils literal"><span class="pre">domid</span></tt></dt>
<dd>value for the &#8220;id&#8221; attribute of the &lt;form&gt; tag</dd>
<dt><tt class="xref py py-attr docutils literal"><span class="pre">action</span></tt></dt>
<dd>value for the &#8220;action&#8221; attribute of the &lt;form&gt; tag</dd>
<dt><tt class="xref py py-attr docutils literal"><span class="pre">onsubmit</span></tt></dt>
<dd>value for the &#8220;onsubmit&#8221; attribute of the &lt;form&gt; tag</dd>
<dt><tt class="xref py py-attr docutils literal"><span class="pre">cssclass</span></tt></dt>
<dd>value for the &#8220;class&#8221; attribute of the &lt;form&gt; tag</dd>
<dt><tt class="xref py py-attr docutils literal"><span class="pre">cssstyle</span></tt></dt>
<dd>value for the &#8220;style&#8221; attribute of the &lt;form&gt; tag</dd>
<dt><tt class="xref py py-attr docutils literal"><span class="pre">cwtarget</span></tt></dt>
<dd>value for the &#8220;cubicweb:target&#8221; attribute of the &lt;form&gt; tag</dd>
<dt><tt class="xref py py-attr docutils literal"><span class="pre">redirect_path</span></tt></dt>
<dd>relative to redirect to after submitting the form</dd>
<dt><tt class="xref py py-attr docutils literal"><span class="pre">copy_nav_params</span></tt></dt>
<dd>flag telling if navigation parameters should be copied back in hidden
inputs</dd>
<dt><tt class="xref py py-attr docutils literal"><span class="pre">form_buttons</span></tt></dt>
<dd>sequence of form control (<a class="reference internal" href="#cubicweb.web.formwidgets.Button" title="cubicweb.web.formwidgets.Button"><tt class="xref py py-class docutils literal"><span class="pre">Button</span></tt></a>
widgets instances)</dd>
<dt><tt class="xref py py-attr docutils literal"><span class="pre">form_renderer_id</span></tt></dt>
<dd>identifier of the form renderer to use to render the form</dd>
<dt><tt class="xref py py-attr docutils literal"><span class="pre">fieldsets_in_order</span></tt></dt>
<dd>sequence of fieldset names , to control order</dd>
</dl>
<p><strong>Generic methods</strong></p>
<dl class="classmethod">
<dt id="cubicweb.web.form.FieldsForm.Form.field_by_name">
<em class="property">classmethod </em><tt class="descclassname">Form.</tt><tt class="descname">field_by_name</tt><big>(</big><em>name</em>, <em>role=None</em><big>)</big><a class="headerlink" href="#cubicweb.web.form.FieldsForm.Form.field_by_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Return field with the given name and role.</p>
<p>Raise <tt class="xref py py-exc docutils literal"><span class="pre">FieldNotFound</span></tt> if the field can&#8217;t be found.</p>
</dd></dl>

<dl class="classmethod">
<dt id="cubicweb.web.form.FieldsForm.Form.fields_by_name">
<em class="property">classmethod </em><tt class="descclassname">Form.</tt><tt class="descname">fields_by_name</tt><big>(</big><em>name</em>, <em>role=None</em><big>)</big><a class="headerlink" href="#cubicweb.web.form.FieldsForm.Form.fields_by_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a list of fields with the given name and role.</p>
</dd></dl>

<p><strong>Form construction methods</strong></p>
<dl class="classmethod">
<dt id="cubicweb.web.form.FieldsForm.Form.remove_field">
<em class="property">classmethod </em><tt class="descclassname">Form.</tt><tt class="descname">remove_field</tt><big>(</big><em>field</em><big>)</big><a class="headerlink" href="#cubicweb.web.form.FieldsForm.Form.remove_field" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove the given field.</p>
</dd></dl>

<dl class="classmethod">
<dt id="cubicweb.web.form.FieldsForm.Form.append_field">
<em class="property">classmethod </em><tt class="descclassname">Form.</tt><tt class="descname">append_field</tt><big>(</big><em>field</em><big>)</big><a class="headerlink" href="#cubicweb.web.form.FieldsForm.Form.append_field" title="Permalink to this definition">¶</a></dt>
<dd><p>Append the given field.</p>
</dd></dl>

<dl class="classmethod">
<dt id="cubicweb.web.form.FieldsForm.Form.insert_field_before">
<em class="property">classmethod </em><tt class="descclassname">Form.</tt><tt class="descname">insert_field_before</tt><big>(</big><em>field</em>, <em>name</em>, <em>role=None</em><big>)</big><a class="headerlink" href="#cubicweb.web.form.FieldsForm.Form.insert_field_before" title="Permalink to this definition">¶</a></dt>
<dd><p>Insert the given field before the field of given name and role.</p>
</dd></dl>

<dl class="classmethod">
<dt id="cubicweb.web.form.FieldsForm.Form.insert_field_after">
<em class="property">classmethod </em><tt class="descclassname">Form.</tt><tt class="descname">insert_field_after</tt><big>(</big><em>field</em>, <em>name</em>, <em>role=None</em><big>)</big><a class="headerlink" href="#cubicweb.web.form.FieldsForm.Form.insert_field_after" title="Permalink to this definition">¶</a></dt>
<dd><p>Insert the given field after the field of given name and role.</p>
</dd></dl>

<dl class="classmethod">
<dt id="cubicweb.web.form.FieldsForm.Form.add_hidden">
<em class="property">classmethod </em><tt class="descclassname">Form.</tt><tt class="descname">add_hidden</tt><big>(</big><em>name</em>, <em>value=None</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.web.form.FieldsForm.Form.add_hidden" title="Permalink to this definition">¶</a></dt>
<dd><p>Append an hidden field to the form. <cite>name</cite>, <cite>value</cite> and extra keyword
arguments will be given to the field constructor. The inserted field is
returned.</p>
</dd></dl>

<p><strong>Form rendering methods</strong></p>
<dl class="method">
<dt id="cubicweb.web.views.forms.FieldsForm.render">
<tt class="descname">render</tt><big>(</big><em>formvalues=None</em>, <em>renderer=None</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.web.views.forms.FieldsForm.render" title="Permalink to this definition">¶</a></dt>
<dd><p>Render this form, using the <cite>renderer</cite> given as argument or the
default according to <tt class="xref py py-attr docutils literal"><span class="pre">form_renderer_id</span></tt>. The rendered form is
returned as an unicode string.</p>
<p><cite>formvalues</cite> is an optional dictionary containing values that will be
considered as field&#8217;s value.</p>
<p>Extra keyword arguments will be given to renderer&#8217;s <a class="reference internal" href="#cubicweb.web.views.forms.FieldsForm.render" title="cubicweb.web.views.forms.FieldsForm.render"><tt class="xref py py-meth docutils literal"><span class="pre">render()</span></tt></a> method.</p>
</dd></dl>

<p><strong>Form posting methods</strong></p>
<p>Once a form is posted, you can retrieve the form on the controller side and
use the following methods to ease processing. For &#8220;simple&#8221; forms, this
should looks like :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">form</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cw</span><span class="o">.</span><span class="n">vreg</span><span class="p">[</span><span class="s">&#39;forms&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s">&#39;myformid&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cw</span><span class="p">)</span>
<span class="n">posted</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">process_posted</span><span class="p">()</span>
<span class="c"># do something with the returned dictionary</span>
</pre></div>
</div>
<p>Notice that form related to entity edition should usually use the
<cite>edit</cite> controller which will handle all the logic for you.</p>
<dl class="method">
<dt id="cubicweb.web.views.forms.FieldsForm.process_posted">
<tt class="descname">process_posted</tt><big>(</big><big>)</big><a class="headerlink" href="#cubicweb.web.views.forms.FieldsForm.process_posted" title="Permalink to this definition">¶</a></dt>
<dd><p>use this method to process the content posted by a simple form.  it
will return a dictionary with field names as key and typed value as
associated value.</p>
</dd></dl>

<dl class="method">
<dt id="cubicweb.web.views.forms.FieldsForm.iter_modified_fields">
<tt class="descname">iter_modified_fields</tt><big>(</big><em>editedfields=None</em>, <em>entity=None</em><big>)</big><a class="headerlink" href="#cubicweb.web.views.forms.FieldsForm.iter_modified_fields" title="Permalink to this definition">¶</a></dt>
<dd><p>return a generator on field that has been modified by the posted
form.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="cubicweb.web.views.forms.EntityFieldsForm">
<em class="property">class </em><tt class="descclassname">cubicweb.web.views.forms.</tt><tt class="descname">EntityFieldsForm</tt><big>(</big><em>_cw</em>, <em>rset=None</em>, <em>row=None</em>, <em>col=None</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.web.views.forms.EntityFieldsForm" title="Permalink to this definition">¶</a></dt>
<dd><p>This class is designed for forms used to edit some entities. It should
handle for you all the underlying stuff necessary to properly work with the
generic <tt class="xref py py-class docutils literal"><span class="pre">EditController</span></tt>.</p>
</dd></dl>

<p>As you have probably guessed, choosing between them is easy. Simply ask you the
question &#8216;I am editing an entity or not?&#8217;. If the answer is yes, use
<a class="reference internal" href="#cubicweb.web.views.forms.EntityFieldsForm" title="cubicweb.web.views.forms.EntityFieldsForm"><tt class="xref py py-class docutils literal"><span class="pre">EntityFieldsForm</span></tt></a>, else use <a class="reference internal" href="#cubicweb.web.views.forms.FieldsForm" title="cubicweb.web.views.forms.FieldsForm"><tt class="xref py py-class docutils literal"><span class="pre">FieldsForm</span></tt></a>.</p>
<p>Actually there exists a third form class:</p>
<dl class="class">
<dt id="cubicweb.web.views.forms.CompositeForm">
<em class="property">class </em><tt class="descclassname">cubicweb.web.views.forms.</tt><tt class="descname">CompositeForm</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.web.views.forms.CompositeForm" title="Permalink to this definition">¶</a></dt>
<dd><p>Form composed of sub-forms. Typical usage is edition of multiple entities
at once.</p>
</dd></dl>

<p>but you&#8217;ll use this one rarely.</p>
</div>
<span class="target" id="module-cubicweb.web.views.formrenderers"></span><div class="section" id="renderers">
<h3>Renderers<a class="headerlink" href="#renderers" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Form renderers are responsible to layout a form to HTML.</p>
</div>
<p>Here are the base renderers available:</p>
<dl class="class">
<dt id="cubicweb.web.views.formrenderers.FormRenderer">
<em class="property">class </em><tt class="descclassname">cubicweb.web.views.formrenderers.</tt><tt class="descname">FormRenderer</tt><big>(</big><em>req=None</em>, <em>rset=None</em>, <em>row=None</em>, <em>col=None</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.web.views.formrenderers.FormRenderer" title="Permalink to this definition">¶</a></dt>
<dd><p>This is the &#8216;default&#8217; renderer, displaying fields in a two columns table:</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>field1 label</td>
<td>field1 input</td>
</tr>
<tr class="row-even"><td>field2 label</td>
<td>field2 input</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>buttons</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="cubicweb.web.views.formrenderers.HTableFormRenderer">
<em class="property">class </em><tt class="descclassname">cubicweb.web.views.formrenderers.</tt><tt class="descname">HTableFormRenderer</tt><big>(</big><em>req=None</em>, <em>rset=None</em>, <em>row=None</em>, <em>col=None</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.web.views.formrenderers.HTableFormRenderer" title="Permalink to this definition">¶</a></dt>
<dd><p>The &#8216;htable&#8217; form renderer display fields horizontally in a table:</p>
<table border="1" class="docutils">
<colgroup>
<col width="38%" />
<col width="38%" />
<col width="24%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>field1 label</td>
<td>field2 label</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>field1 input</td>
<td>field2 input</td>
<td>buttons</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="cubicweb.web.views.formrenderers.EntityCompositeFormRenderer">
<em class="property">class </em><tt class="descclassname">cubicweb.web.views.formrenderers.</tt><tt class="descname">EntityCompositeFormRenderer</tt><big>(</big><em>req=None</em>, <em>rset=None</em>, <em>row=None</em>, <em>col=None</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.web.views.formrenderers.EntityCompositeFormRenderer" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a specific renderer for the multiple entities edition form
(&#8216;muledit&#8217;).</p>
<p>Each entity form will be displayed in row off a table, with a check box for
each entities to indicate which ones are edited. Those checkboxes should be
automatically updated when something is edited.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.web.views.formrenderers.EntityFormRenderer">
<em class="property">class </em><tt class="descclassname">cubicweb.web.views.formrenderers.</tt><tt class="descname">EntityFormRenderer</tt><big>(</big><em>req=None</em>, <em>rset=None</em>, <em>row=None</em>, <em>col=None</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.web.views.formrenderers.EntityFormRenderer" title="Permalink to this definition">¶</a></dt>
<dd><p>This is the &#8216;default&#8217; renderer for entity&#8217;s form.</p>
<p>You can still use form_renderer_id = &#8216;base&#8217; if you want base FormRenderer
layout even when selected for an entity.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.web.views.formrenderers.EntityInlinedFormRenderer">
<em class="property">class </em><tt class="descclassname">cubicweb.web.views.formrenderers.</tt><tt class="descname">EntityInlinedFormRenderer</tt><big>(</big><em>req=None</em>, <em>rset=None</em>, <em>row=None</em>, <em>col=None</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.web.views.formrenderers.EntityInlinedFormRenderer" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a specific renderer for entity&#8217;s form inlined into another
entity&#8217;s form.</p>
</dd></dl>

</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="dissection.html" title="Dissection of an entity form"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Edition control"
             >previous</a> |</li>
        <li><a href="../../index.html">CubicWeb 3.18.3</a> &raquo;</li>
          <li><a href="../index.html" >Web side development</a> &raquo;</li>
          <li><a href="index.html" >Edition control</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2001-2014, Logilab.
      Last updated on Mar 11, 2014.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>