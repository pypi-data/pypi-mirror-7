
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Internationalization &mdash; CubicWeb 3.18.3</title>
    
    <link rel="stylesheet" href="../_static/lglb-sphinx-doc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.18.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="CubicWeb 3.18.3" href="../index.html" />
    <link rel="up" title="Web side development" href="index.html" />
    <link rel="next" title="The property mecanism" href="property.html" />
    <link rel="prev" title="The facets system" href="facets.html" /> 
  </head>
  <body>
<div class="header">
 <a href="http://www.cubicweb.org">
  <img alt="cubicweb logo" src="../_static/cubicweb.png"/>
 </a>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="property.html" title="The property mecanism"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="facets.html" title="The facets system"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">CubicWeb 3.18.3</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Web side development</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Internationalization</a><ul>
<li><a class="reference internal" href="#string-internationalization">String internationalization</a><ul>
<li><a class="reference internal" href="#user-defined-string">User defined string</a></li>
<li><a class="reference internal" href="#generated-string">Generated string</a></li>
</ul>
</li>
<li><a class="reference internal" href="#handling-the-translation-catalog">Handling the translation catalog</a><ul>
<li><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#editing-po-files">Editing po files</a><ul>
<li><a class="reference internal" href="#using-a-po-aware-editor">Using a PO aware editor</a></li>
<li><a class="reference internal" href="#structure-of-a-po-file">Structure of a PO file</a></li>
<li><a class="reference internal" href="#contexts-and-cubicweb">Contexts and CubicWeb</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="facets.html"
                        title="previous chapter">The facets system</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="property.html"
                        title="next chapter">The property mecanism</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/devweb/internationalization.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="internationalization">
<span id="id1"></span><h1>Internationalization<a class="headerlink" href="#internationalization" title="Permalink to this headline">¶</a></h1>
<p>Cubicweb fully supports the internalization of its content and interface.</p>
<p>Cubicweb&#8217;s interface internationalization is based on the translation project <a class="reference external" href="http://www.gnu.org/software/gettext/">GNU gettext</a>.</p>
<p>Cubicweb&#8217; internalization involves two steps:</p>
<ul class="simple">
<li>in your Python code and cubicweb-tal templates : mark translatable strings</li>
<li>in your instance : handle the translation catalog, edit translations</li>
</ul>
<div class="section" id="string-internationalization">
<h2>String internationalization<a class="headerlink" href="#string-internationalization" title="Permalink to this headline">¶</a></h2>
<div class="section" id="user-defined-string">
<h3>User defined string<a class="headerlink" href="#user-defined-string" title="Permalink to this headline">¶</a></h3>
<p>In the Python code and cubicweb-tal templates translatable strings can be
marked in one of the following ways :</p>
<blockquote>
<div><ul>
<li><p class="first">by using the <em>built-in</em> function <cite>_</cite>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">PrimaryView</span><span class="p">(</span><span class="n">EntityView</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;the full view of an non final entity&quot;&quot;&quot;</span>
    <span class="n">__regid__</span> <span class="o">=</span> <span class="s">&#39;primary&#39;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;primary&#39;</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
<blockquote>
<div>OR</div></blockquote>
<ul>
<li><p class="first">by using the equivalent request&#8217;s method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">NoResultView</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;default view when no result has been found&quot;&quot;&quot;</span>
    <span class="n">__regid__</span> <span class="o">=</span> <span class="s">&#39;noresult&#39;</span>

    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">(</span><span class="s">u&#39;&lt;div class=&quot;searchMessage&quot;&gt;&lt;strong&gt;</span><span class="si">%s</span><span class="s">&lt;/strong&gt;&lt;/div&gt;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cw</span><span class="o">.</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;No result matching query&#39;</span><span class="p">))</span>
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
<p>The goal of the <em>built-in</em> function <cite>_</cite> is only <strong>to mark the
translatable strings</strong>, it will only return the string to translate
itself, but not its translation (it&#8217;s actually another name for the
<cite>unicode</cite> builtin).</p>
<p>In the other hand the request&#8217;s method <cite>self._cw._</cite> is also meant to
retrieve the proper translation of translation strings in the
requested language.</p>
<p>Finally you can also use the <cite>__</cite> attribute of request object to get a
translation for a string <em>which should not itself added to the catalog</em>,
usually in case where the actual msgid is created by string interpolation</p>
<div class="highlight-python"><div class="highlight"><pre><span class="bp">self</span><span class="o">.</span><span class="n">_cw</span><span class="o">.</span><span class="n">__</span><span class="p">(</span><span class="s">&#39;This </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">etype</span><span class="p">)</span>
</pre></div>
</div>
<p>In this example ._cw.__` is used instead of ._cw._` so we don&#8217;t have &#8216;This %s&#8217; in
messages catalogs.</p>
<p>Translations in cubicweb-tal template can also be done with TAL tags
<cite>i18n:content</cite> and <cite>i18n:replace</cite>.</p>
<p>If you need to add messages on top of those that can be found in the source,
you can create a file named <cite>i18n/static-messages.pot</cite>.</p>
<p>You could put there messages not found in the python sources or
overrides for some messages of used cubes.</p>
</div>
<div class="section" id="generated-string">
<h3>Generated string<a class="headerlink" href="#generated-string" title="Permalink to this headline">¶</a></h3>
<p>We do not need to mark the translation strings of entities/relations used by a
particular instance&#8217;s schema as they are generated automatically. String for
various actions are also generated.</p>
<p>For exemple the following schema:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">EntityA</span><span class="p">(</span><span class="n">EntityType</span><span class="p">):</span>
    <span class="n">relation_a2b</span> <span class="o">=</span> <span class="n">SubjectRelation</span><span class="p">(</span><span class="s">&#39;EntityB&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">EntityB</span><span class="p">(</span><span class="n">EntityType</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>May generate the following message</p>
<div class="highlight-python"><pre>add EntityA relation_a2b EntityB subject</pre>
</div>
<p>This message will be used in views of <tt class="docutils literal"><span class="pre">EntityA</span></tt> for creation of a new
<tt class="docutils literal"><span class="pre">EntityB</span></tt> with a preset relation <tt class="docutils literal"><span class="pre">relation_a2b</span></tt> between the current
<tt class="docutils literal"><span class="pre">EntityA</span></tt> and the new <tt class="docutils literal"><span class="pre">EntityB</span></tt>. The opposite message</p>
<div class="highlight-python"><pre>add EntityA relation_a2b EntityB object</pre>
</div>
<p>Is used for similar creation of an <tt class="docutils literal"><span class="pre">EntityA</span></tt> from a view of <tt class="docutils literal"><span class="pre">EntityB</span></tt>. The
title of they respective creation form will be</p>
<div class="highlight-python"><pre>creating EntityB (EntityA %(linkto)s relation_a2b EntityB)

creating EntityA (EntityA relation_a2b %(linkto)s EntityA)</pre>
</div>
<p>In the translated string you can use <tt class="docutils literal"><span class="pre">%(linkto)s</span></tt> for reference to the source
<tt class="docutils literal"><span class="pre">entity</span></tt>.</p>
</div>
</div>
<div class="section" id="handling-the-translation-catalog">
<h2>Handling the translation catalog<a class="headerlink" href="#handling-the-translation-catalog" title="Permalink to this headline">¶</a></h2>
<p>Once the internationalization is done in your code, you need to populate and
update the translation catalog. Cubicweb provides the following commands for this
purpose:</p>
<ul class="simple">
<li><cite>i18ncubicweb</cite> updates Cubicweb framework&#8217;s translation
catalogs. Unless you actually work on the framework itself, you
don&#8217;t need to use this command.</li>
<li><cite>i18ncube</cite> updates the translation catalogs of <em>one particular cube</em>
(or of all cubes). After this command is executed you must update
the translation files <em>.po</em> in the &#8220;i18n&#8221; directory of your
cube. This command will of course not remove existing translations
still in use. It will mark unused translation but not remove them.</li>
<li><cite>i18ninstance</cite> recompiles the translation catalogs of <em>one particular
instance</em> (or of all instances) after the translation catalogs of
its cubes have been updated. This command is automatically
called every time you create or update your instance. The compiled
catalogs (<em>.mo</em>) are stored in the i18n/&lt;lang&gt;/LC_MESSAGES of
instance where <cite>lang</cite> is the language identifier (&#8216;en&#8217; or &#8216;fr&#8217;
for exemple).</li>
</ul>
<div class="section" id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<p>You have added and/or modified some translation strings in your cube
(after creating a new view or modifying the cube&#8217;s schema for exemple).
To update the translation catalogs you need to do:</p>
<ol class="arabic simple">
<li><cite>cubicweb-ctl i18ncube &lt;cube&gt;</cite></li>
<li>Edit the &lt;cube&gt;/i18n/xxx.po  files and add missing translations (empty <cite>msgstr</cite>)</li>
<li><cite>hg ci -m &#8220;updated i18n catalogs&#8221;</cite></li>
<li><cite>cubicweb-ctl i18ninstance &lt;myinstance&gt;</cite></li>
</ol>
</div>
</div>
<div class="section" id="editing-po-files">
<h2>Editing po files<a class="headerlink" href="#editing-po-files" title="Permalink to this headline">¶</a></h2>
<div class="section" id="using-a-po-aware-editor">
<h3>Using a PO aware editor<a class="headerlink" href="#using-a-po-aware-editor" title="Permalink to this headline">¶</a></h3>
<p>Many tools exist to help maintain .po (PO) files. Common editors or
development environment provides modes for these. One can also find
dedicated PO files editor, such as <a class="reference external" href="http://www.poedit.net/">poedit</a>.</p>
<p>While usage of such a tool is commendable, PO files are perfectly
editable with a (unicode aware) plain text editor. It is also useful
to know their structure for troubleshooting purposes.</p>
</div>
<div class="section" id="structure-of-a-po-file">
<h3>Structure of a PO file<a class="headerlink" href="#structure-of-a-po-file" title="Permalink to this headline">¶</a></h3>
<p>In this section, we selectively quote passages of the <a class="reference external" href="http://www.gnu.org/software/gettext/">GNU gettext</a>
manual chapter on PO files, available there:</p>
<div class="highlight-python"><pre>http://www.gnu.org/software/hello/manual/gettext/PO-Files.html</pre>
</div>
<p>One PO file entry has the following schematic structure:</p>
<div class="highlight-python"><pre>white-space
#  translator-comments
#. extracted-comments
#: reference...
#, flag...
#| msgid previous-untranslated-string
msgid untranslated-string
msgstr translated-string</pre>
</div>
<p>A simple entry can look like this:</p>
<div class="highlight-python"><pre>#: lib/error.c:116
msgid "Unknown system error"
msgstr "Error desconegut del sistema"</pre>
</div>
<p>It is also possible to have entries with a context specifier. They
look like this:</p>
<div class="highlight-python"><pre>white-space
#  translator-comments
#. extracted-comments
#: reference...
#, flag...
#| msgctxt previous-context
#| msgid previous-untranslated-string
msgctxt context
msgid untranslated-string
msgstr translated-string</pre>
</div>
<p>The context serves to disambiguate messages with the same
untranslated-string. It is possible to have several entries with the
same untranslated-string in a PO file, provided that they each have a
different context. Note that an empty context string and an absent
msgctxt line do not mean the same thing.</p>
</div>
<div class="section" id="contexts-and-cubicweb">
<h3>Contexts and CubicWeb<a class="headerlink" href="#contexts-and-cubicweb" title="Permalink to this headline">¶</a></h3>
<p>CubicWeb PO files have both non-contextual and contextual msgids.</p>
<p>Contextual entries are automatically used in some cases. For instance,
entity.dc_type(), eschema.display_name(req) or display_name(etype,
req, form, context) methods/function calls will use them.</p>
<p>It is also possible to explicitly use the with _cw.pgettext(context,
msgid).</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="property.html" title="The property mecanism"
             >next</a> |</li>
        <li class="right" >
          <a href="facets.html" title="The facets system"
             >previous</a> |</li>
        <li><a href="../index.html">CubicWeb 3.18.3</a> &raquo;</li>
          <li><a href="index.html" >Web side development</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2001-2014, Logilab.
      Last updated on Mar 11, 2014.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>