
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>2. The Registry, selectors and application objects &mdash; CubicWeb 3.18.3</title>
    
    <link rel="stylesheet" href="../_static/lglb-sphinx-doc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.18.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="CubicWeb 3.18.3" href="../index.html" />
    <link rel="up" title="Repository development" href="index.html" />
    <link rel="next" title="3. Data model" href="datamodel/index.html" />
    <link rel="prev" title="1.3. Available cubes" href="cubes/available-cubes.html" /> 
  </head>
  <body>
<div class="header">
 <a href="http://www.cubicweb.org">
  <img alt="cubicweb logo" src="../_static/cubicweb.png"/>
 </a>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="datamodel/index.html" title="3. Data model"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="cubes/available-cubes.html" title="1.3. Available cubes"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">CubicWeb 3.18.3</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Repository development</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">2. The Registry, selectors and application objects</a><ul>
<li><a class="reference internal" href="#the-registrystore">2.1. The <cite>RegistryStore</cite></a><ul>
<li><a class="reference internal" href="#details-of-the-recording-process">2.1.1. Details of the recording process</a></li>
<li><a class="reference internal" href="#api-for-objects-registration">2.1.2. API for objects registration</a></li>
<li><a class="reference internal" href="#runtime-objects-selection">2.1.3. Runtime objects selection</a></li>
<li><a class="reference internal" href="#api-for-objects-selections">2.1.4. API for objects selections</a></li>
</ul>
</li>
<li><a class="reference internal" href="#predicates-and-selectors">2.2. Predicates and selectors</a><ul>
<li><a class="reference internal" href="#using-and-combining-existant-predicates">2.2.1. Using and combining existant predicates</a></li>
<li><a class="reference internal" href="#example">2.2.2. Example</a></li>
<li><a class="reference internal" href="#when-to-use-selectors">2.2.3. When to use selectors?</a></li>
<li><a class="reference internal" href="#defining-your-own-predicates">2.2.4. Defining your own predicates</a></li>
<li><a class="reference internal" href="#debugging-selection">2.2.5. Debugging selection</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-appobject-class">2.3. The <cite>AppObject</cite> class</a></li>
<li><a class="reference internal" href="#base-predicates">2.4. Base predicates</a><ul>
<li><a class="reference internal" href="#bare-predicates">2.4.1. Bare predicates</a></li>
<li><a class="reference internal" href="#result-set-predicates">2.4.2. Result set predicates</a></li>
<li><a class="reference internal" href="#entity-predicates">2.4.3. Entity predicates</a></li>
<li><a class="reference internal" href="#logged-user-predicates">2.4.4. Logged user predicates</a></li>
<li><a class="reference internal" href="#web-request-predicates">2.4.5. Web request predicates</a></li>
<li><a class="reference internal" href="#other-predicates">2.4.6. Other predicates</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="cubes/available-cubes.html"
                        title="previous chapter">1.3. Available cubes</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="datamodel/index.html"
                        title="next chapter">3. Data model</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/devrepo/vreg.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="the-registry-selectors-and-application-objects">
<h1>2. The Registry, selectors and application objects<a class="headerlink" href="#the-registry-selectors-and-application-objects" title="Permalink to this headline">¶</a></h1>
<p>This chapter deals with some of the  core concepts of the <em>CubicWeb</em> framework
which make it different from other frameworks (and maybe not easy to
grasp at a first glance). To be able to do advanced development with
<em>CubicWeb</em> you need a good understanding of what is explained below.</p>
<p>This chapter goes deep into details. You don&#8217;t have to remember them
all but keep it in mind so you can go back there later.</p>
<p>An overview of AppObjects, the VRegistry and Selectors is given in the
<a class="reference internal" href="../intro/concepts.html#vregistryintro"><em>Registries and application objects</em></a> chapter.</p>
<div class="section" id="the-registrystore">
<h2>2.1. The <cite>RegistryStore</cite><a class="headerlink" href="#the-registrystore" title="Permalink to this headline">¶</a></h2>
<p>The <cite>RegistryStore</cite> can be seen as a two-level dictionary. It contains
all dynamically loaded objects (subclasses of <a class="reference internal" href="#appobject"><em>The AppObject class</em></a>) to
build a <em>CubicWeb</em> application. Basically:</p>
<ul class="simple">
<li>the first level key returns a <em>registry</em>. This key corresponds to the
<cite>__registry__</cite> attribute of application object classes</li>
<li>the second level key returns a list of application objects which
share the same identifier. This key corresponds to the <cite>__regid__</cite>
attribute of application object classes.</li>
</ul>
<p>A <em>registry</em> holds a specific kind of application objects. There is
for instance a registry for entity classes, another for views, etc...</p>
<p>The <cite>RegistryStore</cite> has two main responsibilities:</p>
<ul class="simple">
<li>being the access point to all registries</li>
<li>handling the registration process at startup time, and during automatic
reloading in debug mode.</li>
</ul>
<div class="section" id="details-of-the-recording-process">
<span id="appobjectrecording"></span><h3>2.1.1. Details of the recording process<a class="headerlink" href="#details-of-the-recording-process" title="Permalink to this headline">¶</a></h3>
<p id="index-0">On startup, <em>CubicWeb</em> loads application objects defined in its library
and in cubes used by the instance. Application objects from the
library are loaded first, then those provided by cubes are loaded in
dependency order (e.g. if your cube depends on an other, objects from
the dependency will be loaded first). The layout of the modules or packages
in a cube  is explained in <a class="reference internal" href="cubes/layout.html#cubelayout"><em>Standard structure for a cube</em></a>.</p>
<p>For each module:</p>
<ul class="simple">
<li>by default all objects are registered automatically</li>
<li>if some objects have to replace other objects, or have to be
included only if some condition is met, you&#8217;ll have to define a
<cite>registration_callback(vreg)</cite> function in your module and explicitly
register <strong>all objects</strong> in this module, using the api defined
below.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Once the function <cite>registration_callback(vreg)</cite> is implemented in a module,
all the objects from this module have to be explicitly registered as it
disables the automatic objects registration.</p>
</div>
</div>
<div class="section" id="api-for-objects-registration">
<h3>2.1.2. API for objects registration<a class="headerlink" href="#api-for-objects-registration" title="Permalink to this headline">¶</a></h3>
<p>Here are the registration methods that you can use in the <cite>registration_callback</cite>
to register your objects to the <cite>RegistryStore</cite> instance given as argument (usually
named <cite>vreg</cite>):</p>
<dl class="method">
<dt id="cubicweb.cwvreg.CWRegistryStore.register_all">
<tt class="descclassname">CWRegistryStore.</tt><tt class="descname">register_all</tt><big>(</big><em>objects</em>, <em>modname</em>, <em>butclasses=()</em><big>)</big><a class="headerlink" href="#cubicweb.cwvreg.CWRegistryStore.register_all" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="cubicweb.cwvreg.CWRegistryStore.register_and_replace">
<tt class="descclassname">CWRegistryStore.</tt><tt class="descname">register_and_replace</tt><big>(</big><em>obj</em>, <em>replaced</em><big>)</big><a class="headerlink" href="#cubicweb.cwvreg.CWRegistryStore.register_and_replace" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="cubicweb.cwvreg.CWRegistryStore.register">
<tt class="descclassname">CWRegistryStore.</tt><tt class="descname">register</tt><big>(</big><em>obj</em>, <em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.cwvreg.CWRegistryStore.register" title="Permalink to this definition">¶</a></dt>
<dd><p>register <cite>obj</cite> application object into <cite>registryname</cite> or
<cite>obj.__registry__</cite> if not specified, with identifier <cite>oid</cite> or
<cite>obj.__regid__</cite> if not specified.</p>
<p>If <cite>clear</cite> is true, all objects with the same identifier will be
previously unregistered.</p>
</dd></dl>

<dl class="method">
<dt id="cubicweb.cwvreg.CWRegistryStore.unregister">
<tt class="descclassname">CWRegistryStore.</tt><tt class="descname">unregister</tt><big>(</big><em>obj</em>, <em>registryname=None</em><big>)</big><a class="headerlink" href="#cubicweb.cwvreg.CWRegistryStore.unregister" title="Permalink to this definition">¶</a></dt>
<dd><p>unregister <cite>obj</cite> object from the registry <cite>registryname</cite> or
<cite>obj.__registries__</cite> if not specified.</p>
</dd></dl>

<p>Examples:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># web/views/basecomponents.py</span>
<span class="k">def</span> <span class="nf">registration_callback</span><span class="p">(</span><span class="n">vreg</span><span class="p">):</span>
   <span class="c"># register everything in the module except SeeAlsoComponent</span>
   <span class="n">vreg</span><span class="o">.</span><span class="n">register_all</span><span class="p">(</span><span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">itervalues</span><span class="p">(),</span> <span class="n">__name__</span><span class="p">,</span> <span class="p">(</span><span class="n">SeeAlsoVComponent</span><span class="p">,))</span>
   <span class="c"># conditionally register SeeAlsoVComponent</span>
   <span class="k">if</span> <span class="s">&#39;see_also&#39;</span> <span class="ow">in</span> <span class="n">vreg</span><span class="o">.</span><span class="n">schema</span><span class="p">:</span>
       <span class="n">vreg</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">SeeAlsoVComponent</span><span class="p">)</span>
</pre></div>
</div>
<p>In this example, we register all application object classes defined in the module
except <cite>SeeAlsoVComponent</cite>. This class is then registered only if the &#8216;see_also&#8217;
relation type is defined in the instance&#8217;schema.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># goa/appobjects/sessions.py</span>
<span class="k">def</span> <span class="nf">registration_callback</span><span class="p">(</span><span class="n">vreg</span><span class="p">):</span>
   <span class="n">vreg</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">SessionsCleaner</span><span class="p">)</span>
   <span class="c"># replace AuthenticationManager by GAEAuthenticationManager</span>
   <span class="n">vreg</span><span class="o">.</span><span class="n">register_and_replace</span><span class="p">(</span><span class="n">GAEAuthenticationManager</span><span class="p">,</span> <span class="n">AuthenticationManager</span><span class="p">)</span>
   <span class="c"># replace PersistentSessionManager by GAEPersistentSessionManager</span>
   <span class="n">vreg</span><span class="o">.</span><span class="n">register_and_replace</span><span class="p">(</span><span class="n">GAEPersistentSessionManager</span><span class="p">,</span> <span class="n">PersistentSessionManager</span><span class="p">)</span>
</pre></div>
</div>
<p>In this example, we explicitly register classes one by one:</p>
<ul class="simple">
<li>the <cite>SessionCleaner</cite> class</li>
<li>the <cite>GAEAuthenticationManager</cite> to replace the <cite>AuthenticationManager</cite></li>
<li>the <cite>GAEPersistentSessionManager</cite> to replace the <cite>PersistentSessionManager</cite></li>
</ul>
<p>If at some point we register a new appobject class in this module, it won&#8217;t be
registered at all without modification to the <cite>registration_callback</cite>
implementation. The previous example will register it though, thanks to the call
to the <cite>register_all</cite> method.</p>
</div>
<div class="section" id="runtime-objects-selection">
<span id="selection"></span><h3>2.1.3. Runtime objects selection<a class="headerlink" href="#runtime-objects-selection" title="Permalink to this headline">¶</a></h3>
<p>Now that we have all application objects loaded, the question is : when
I want some specific object, for instance the primary view for a given
entity, how do I get the proper object ? This is what we call the
<strong>selection mechanism</strong>.</p>
<p>As explained in the <a class="reference internal" href="../intro/concepts.html#concepts"><em>The Core Concepts of CubicWeb</em></a> section:</p>
<ul class="simple">
<li>each application object has a <strong>selector</strong>, defined by its
<cite>__select__</cite> class attribute</li>
<li>this selector is responsible to return a <strong>score</strong> for a given context<ul>
<li>0 score means the object doesn&#8217;t apply to this context</li>
<li>else, the higher the score, the better the object suits the context</li>
</ul>
</li>
<li>the object with the highest score is selected.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>When no single object has the highest score, an exception is raised in development
mode to let you know that the engine was not able to identify the view to
apply. This error is silenced in production mode and one of the objects with
the highest score is picked.</p>
<p class="last">In such cases you would need to review your design and make sure
your selectors or appobjects are properly defined. Such an error is
typically caused by either forgetting to change the __regid__ in a
derived class, or by having copy-pasted some code.</p>
</div>
<p>For instance, if you are selecting the primary (<cite>__regid__ =
&#8216;primary&#8217;</cite>) view (<cite>__registry__ = &#8216;views&#8217;</cite>) for a result set
containing a <cite>Card</cite> entity, two objects will probably be selectable:</p>
<ul class="simple">
<li>the default primary view (<cite>__select__ = is_instance(&#8216;Any&#8217;)</cite>), meaning
that the object is selectable for any kind of entity type</li>
<li>the specific <cite>Card</cite> primary view (<cite>__select__ = is_instance(&#8216;Card&#8217;)</cite>,
meaning that the object is selectable for Card entities</li>
</ul>
<p>Other primary views specific to other entity types won&#8217;t be selectable in this
case. Among selectable objects, the <cite>is_instance(&#8216;Card&#8217;)</cite> selector will return a higher
score since it&#8217;s more specific, so the correct view will be selected as expected.</p>
</div>
<div class="section" id="api-for-objects-selections">
<span id="selectionapi"></span><h3>2.1.4. API for objects selections<a class="headerlink" href="#api-for-objects-selections" title="Permalink to this headline">¶</a></h3>
<p>Here is the selection API you&#8217;ll get on every registry. Some of them, as the
&#8216;etypes&#8217; registry, containing entity classes, extend it. In those methods,
<cite>*args, **kwargs</cite> is what we call the <strong>context</strong>. Those arguments are given to
selectors that will inspect their content and return a score accordingly.</p>
<dl class="method">
<dt id="cubicweb.vregistry.Registry.select">
<tt class="descclassname">Registry.</tt><tt class="descname">select</tt><big>(</big><em>_Registry__oid</em>, <em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.vregistry.Registry.select" title="Permalink to this definition">¶</a></dt>
<dd><p>return the most specific object among those with the given oid
according to the given context.</p>
<p>raise <tt class="xref py py-exc docutils literal"><span class="pre">ObjectNotFound</span></tt> if there are no object with id <cite>oid</cite> in this
registry</p>
<p>raise <tt class="xref py py-exc docutils literal"><span class="pre">NoSelectableObject</span></tt> if no object can be selected</p>
</dd></dl>

<dl class="method">
<dt id="cubicweb.vregistry.Registry.select_or_none">
<tt class="descclassname">Registry.</tt><tt class="descname">select_or_none</tt><big>(</big><em>_Registry__oid</em>, <em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.vregistry.Registry.select_or_none" title="Permalink to this definition">¶</a></dt>
<dd><p>return the most specific object among those with the given oid
according to the given context, or None if no object applies.</p>
</dd></dl>

<dl class="method">
<dt id="cubicweb.vregistry.Registry.possible_objects">
<tt class="descclassname">Registry.</tt><tt class="descname">possible_objects</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.vregistry.Registry.possible_objects" title="Permalink to this definition">¶</a></dt>
<dd><p>return an iterator on possible objects in this registry for the given
context</p>
</dd></dl>

<dl class="method">
<dt id="cubicweb.vregistry.Registry.object_by_id">
<tt class="descclassname">Registry.</tt><tt class="descname">object_by_id</tt><big>(</big><em>oid</em>, <em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.vregistry.Registry.object_by_id" title="Permalink to this definition">¶</a></dt>
<dd><p>return object with the <cite>oid</cite> identifier. Only one object is expected
to be found.</p>
<p>raise <tt class="xref py py-exc docutils literal"><span class="pre">ObjectNotFound</span></tt> if there are no object with id <cite>oid</cite> in this
registry</p>
<p>raise <tt class="xref py py-exc docutils literal"><span class="pre">AssertionError</span></tt> if there is more than one object there</p>
</dd></dl>

</div>
</div>
<div class="section" id="predicates-and-selectors">
<span id="selectors"></span><h2>2.2. Predicates and selectors<a class="headerlink" href="#predicates-and-selectors" title="Permalink to this headline">¶</a></h2>
<p>A predicate is a class testing a particular aspect of a context. A selector is
built by combining existant predicates or even selectors.</p>
<div class="section" id="using-and-combining-existant-predicates">
<h3>2.2.1. Using and combining existant predicates<a class="headerlink" href="#using-and-combining-existant-predicates" title="Permalink to this headline">¶</a></h3>
<p>You can combine predicates using the <cite>&amp;</cite>, <cite>|</cite> and <cite>~</cite> operators.</p>
<p>When two predicates are combined using the <cite>&amp;</cite> operator, it means that
both should return a positive score. On success, the sum of scores is
returned.</p>
<p>When two predicates are combined using the <cite>|</cite> operator, it means that
one of them should return a positive score. On success, the first
positive score is returned.</p>
<p>You can also &#8220;negate&#8221; a predicate by precedeing it by the <cite>~</cite> unary operator.</p>
<p>Of course you can use parenthesis to balance expressions.</p>
</div>
<div class="section" id="example">
<h3>2.2.2. Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<p>The goal: when on a blog, one wants the RSS link to refer to blog entries, not to
the blog entity itself.</p>
<p>To do that, one defines a method on entity classes that returns the
RSS stream url for a given entity. The default implementation on
<tt class="xref py py-class docutils literal"><span class="pre">AnyEntity</span></tt> (the generic entity class used
as base for all others) and a specific implementation on <cite>Blog</cite> will
do what we want.</p>
<p>But when we have a result set containing several <cite>Blog</cite> entities (or
different entities), we don&#8217;t know on which entity to call the
aforementioned method. In this case, we keep the generic behaviour.</p>
<p>Hence we have two cases here, one for a single-entity rsets, the other for
multi-entities rsets.</p>
<p>In web/views/boxes.py lies the RSSIconBox class. Look at its selector:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">RSSIconBox</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">Box</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39; just display the RSS icon on uniform result set &#39;&#39;&#39;</span>
  <span class="n">__select__</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">Box</span><span class="o">.</span><span class="n">__select__</span> <span class="o">&amp;</span> <span class="n">non_final_entity</span><span class="p">()</span>
</pre></div>
</div>
<p>It takes into account:</p>
<ul class="simple">
<li>the inherited selection criteria (one has to look them up in the class
hierarchy to know the details)</li>
<li><a class="reference internal" href="#cubicweb.predicates.non_final_entity" title="cubicweb.predicates.non_final_entity"><tt class="xref py py-class docutils literal"><span class="pre">non_final_entity</span></tt></a>, which filters on result sets
containing non final entities (a &#8216;final entity&#8217; being synonym for entity
attributes type, eg <cite>String</cite>, <cite>Int</cite>, etc)</li>
</ul>
<p>This matches our second case. Hence we have to provide a specific component for
the first case:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">EntityRSSIconBox</span><span class="p">(</span><span class="n">RSSIconBox</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;just display the RSS icon on uniform result set for a single entity&#39;&#39;&#39;</span>
  <span class="n">__select__</span> <span class="o">=</span> <span class="n">RSSIconBox</span><span class="o">.</span><span class="n">__select__</span> <span class="o">&amp;</span> <span class="n">one_line_rset</span><span class="p">()</span>
</pre></div>
</div>
<p>Here, one adds the <a class="reference internal" href="#cubicweb.predicates.one_line_rset" title="cubicweb.predicates.one_line_rset"><tt class="xref py py-class docutils literal"><span class="pre">one_line_rset</span></tt></a> predicate, which
filters result sets of size 1. Thus, on a result set containing multiple
entities, <tt class="xref py py-class docutils literal"><span class="pre">one_line_rset</span></tt> makes the EntityRSSIconBox class non
selectable. However for a result set with one entity, the <cite>EntityRSSIconBox</cite>
class will have a higher score than <cite>RSSIconBox</cite>, which is what we wanted.</p>
<p>Of course, once this is done, you have to:</p>
<ul class="simple">
<li>fill in the call method of <cite>EntityRSSIconBox</cite></li>
<li>provide the default implementation of the method returning the RSS stream url
on <tt class="xref py py-class docutils literal"><span class="pre">AnyEntity</span></tt></li>
<li>redefine this method on <cite>Blog</cite>.</li>
</ul>
</div>
<div class="section" id="when-to-use-selectors">
<h3>2.2.3. When to use selectors?<a class="headerlink" href="#when-to-use-selectors" title="Permalink to this headline">¶</a></h3>
<p>Selectors are to be used whenever arises the need of dispatching on the shape or
content of a result set or whatever else context (value in request form params,
authenticated user groups, etc...). That is, almost all the time.</p>
<p>Here is a quick example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">UserLink</span><span class="p">(</span><span class="n">component</span><span class="o">.</span><span class="n">Component</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;if the user is the anonymous user, build a link to login else a link</span>
<span class="sd">    to the connected user object with a logout link</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">__regid__</span> <span class="o">=</span> <span class="s">&#39;loggeduserlink&#39;</span>

    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cw</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">anonymous_session</span><span class="p">:</span>
            <span class="c"># display login link</span>
            <span class="o">...</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># display a link to the connected user object with a loggout link</span>
            <span class="o">...</span>
</pre></div>
</div>
<p>The proper way to implement this with <em>CubicWeb</em> is two have two different
classes sharing the same identifier but with different selectors so you&#8217;ll get
the correct one according to the context.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">UserLink</span><span class="p">(</span><span class="n">component</span><span class="o">.</span><span class="n">Component</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;display a link to the connected user object with a loggout link&#39;&#39;&#39;</span>
    <span class="n">__regid__</span> <span class="o">=</span> <span class="s">&#39;loggeduserlink&#39;</span>
    <span class="n">__select__</span> <span class="o">=</span> <span class="n">component</span><span class="o">.</span><span class="n">Component</span><span class="o">.</span><span class="n">__select__</span> <span class="o">&amp;</span> <span class="n">authenticated_user</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># display useractions and siteactions</span>
        <span class="o">...</span>

<span class="k">class</span> <span class="nc">AnonUserLink</span><span class="p">(</span><span class="n">component</span><span class="o">.</span><span class="n">Component</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;build a link to login&#39;&#39;&#39;</span>
    <span class="n">__regid__</span> <span class="o">=</span> <span class="s">&#39;loggeduserlink&#39;</span>
    <span class="n">__select__</span> <span class="o">=</span> <span class="n">component</span><span class="o">.</span><span class="n">Component</span><span class="o">.</span><span class="n">__select__</span> <span class="o">&amp;</span> <span class="n">anonymous_user</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># display login link</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>The big advantage, aside readability once you&#8217;re familiar with the
system, is that your cube becomes much more easily customizable by
improving componentization.</p>
</div>
<div class="section" id="defining-your-own-predicates">
<span id="custompredicates"></span><h3>2.2.4. Defining your own predicates<a class="headerlink" href="#defining-your-own-predicates" title="Permalink to this headline">¶</a></h3>
<p>Most of the time, a simple score function is enough to build a selector.
The <tt class="xref py py-func docutils literal"><span class="pre">objectify_predicate()</span></tt> decorator turn it into a proper selector
class:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@objectify_predicate</span>
<span class="k">def</span> <span class="nf">one</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="n">rset</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">1</span>

<span class="k">class</span> <span class="nc">MyView</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
    <span class="n">__select__</span> <span class="o">=</span> <span class="n">View</span><span class="o">.</span><span class="n">__select__</span> <span class="o">&amp;</span> <span class="n">one</span><span class="p">()</span>
</pre></div>
</div>
<p>In other cases, you can take a look at the following abstract base classes:</p>
<dl class="class">
<dt id="cubicweb.predicates.ExpectedValuePredicate">
<em class="property">class </em><tt class="descclassname">cubicweb.predicates.</tt><tt class="descname">ExpectedValuePredicate</tt><big>(</big><em>*expected</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.predicates.ExpectedValuePredicate" title="Permalink to this definition">¶</a></dt>
<dd><p>Take a list of expected values as initializer argument and store them
into the <tt class="xref py py-attr docutils literal"><span class="pre">expected</span></tt> set attribute. You may also give a set as single
argument, which will then be referenced as set of expected values,
allowing modifications to the given set to be considered.</p>
<p>You should implement one of <tt class="xref py py-meth docutils literal"><span class="pre">_values_set(cls,</span> <span class="pre">req,</span> <span class="pre">**kwargs)()</span></tt> or
<tt class="xref py py-meth docutils literal"><span class="pre">_get_value(cls,</span> <span class="pre">req,</span> <span class="pre">**kwargs)()</span></tt> method which should respectively
return the set of values or the unique possible value for the given context.</p>
<p>You may also specify a <cite>mode</cite> behaviour as argument, as explained below.</p>
<p>Returned score is:</p>
<ul class="simple">
<li>0 if <cite>mode</cite> == &#8216;all&#8217; (the default) and at least one expected
values isn&#8217;t found</li>
<li>0 if <cite>mode</cite> == &#8216;any&#8217; and no expected values isn&#8217;t found at all</li>
<li>else the number of matching values</li>
</ul>
<p>Notice <cite>mode</cite> = &#8216;any&#8217; with a single expected value has no effect at all.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.predicates.EClassPredicate">
<em class="property">class </em><tt class="descclassname">cubicweb.predicates.</tt><tt class="descname">EClassPredicate</tt><big>(</big><em>once_is_enough=None</em>, <em>accept_none=True</em>, <em>mode='all'</em><big>)</big><a class="headerlink" href="#cubicweb.predicates.EClassPredicate" title="Permalink to this definition">¶</a></dt>
<dd><p>abstract class for predicates working on <em>entity class(es)</em> specified
explicitly or found of the result set.</p>
<p>Here are entity lookup / scoring rules:</p>
<ul class="simple">
<li>if <cite>entity</cite> is specified, return score for this entity&#8217;s class</li>
<li>elif <cite>rset</cite>, <cite>select</cite> and <cite>filtered_variable</cite> are specified, return score
for the possible classes for variable in the given rql <tt class="xref py py-class docutils literal"><span class="pre">Select</span></tt>
node</li>
<li>elif <cite>rset</cite> and <cite>row</cite> are specified, return score for the class of the
entity found in the specified cell, using column specified by <cite>col</cite> or 0</li>
<li>elif <cite>rset</cite> is specified return score for each entity class found in the
column specified specified by the <cite>col</cite> argument or in column 0 if not
specified</li>
</ul>
<p>When there are several classes to be evaluated, return the sum of scores for
each entity class unless:</p>
<blockquote>
<div><ul class="simple">
<li><cite>mode</cite> == &#8216;all&#8217; (the default) and some entity class is scored
to 0, in which case 0 is returned</li>
<li><cite>mode</cite> == &#8216;any&#8217;, in which case the first non-zero score is
returned</li>
<li><cite>accept_none</cite> is False and some cell in the column has a None value
(this may occurs with outer join)</li>
</ul>
</div></blockquote>
</dd></dl>

<dl class="class">
<dt id="cubicweb.predicates.EntityPredicate">
<em class="property">class </em><tt class="descclassname">cubicweb.predicates.</tt><tt class="descname">EntityPredicate</tt><big>(</big><em>once_is_enough=None</em>, <em>accept_none=True</em>, <em>mode='all'</em><big>)</big><a class="headerlink" href="#cubicweb.predicates.EntityPredicate" title="Permalink to this definition">¶</a></dt>
<dd><p>abstract class for predicates working on <em>entity instance(s)</em> specified
explicitly or found of the result set.</p>
<p>Here are entity lookup / scoring rules:</p>
<ul class="simple">
<li>if <cite>entity</cite> is specified, return score for this entity</li>
<li>elif <cite>row</cite> is specified, return score for the entity found in the
specified cell, using column specified by <cite>col</cite> or 0</li>
<li>else return the sum of scores for each entity found in the column
specified specified by the <cite>col</cite> argument or in column 0 if not specified,
unless:<ul>
<li><cite>mode</cite> == &#8216;all&#8217; (the default) and some entity class is scored
to 0, in which case 0 is returned</li>
<li><cite>mode</cite> == &#8216;any&#8217;, in which case the first non-zero score is
returned</li>
<li><cite>accept_none</cite> is False and some cell in the column has a None value
(this may occurs with outer join)</li>
</ul>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">using <tt class="xref py py-class docutils literal"><span class="pre">EntityPredicate</span></tt> or <tt class="xref py py-class docutils literal"><span class="pre">EClassPredicate</span></tt> as base predicate
class impacts performance, since when no entity or row is specified the
later works on every different <em>entity class</em> found in the result set,
while the former works on each <em>entity</em> (eg each row of the result set),
which may be much more costly.</p>
</div>
</dd></dl>

</div>
<div class="section" id="debugging-selection">
<span id="debuggingselectors"></span><h3>2.2.5. Debugging selection<a class="headerlink" href="#debugging-selection" title="Permalink to this headline">¶</a></h3>
<p>Once in a while, one needs to understand why a view (or any application object)
is, or is not selected appropriately. Looking at which predicates fired (or did
not) is the way. The <a class="reference internal" href="#logilab.common.registry.traced_selection" title="logilab.common.registry.traced_selection"><tt class="xref py py-class docutils literal"><span class="pre">logilab.common.registry.traced_selection</span></tt></a> context
manager to help with that, <em>if you&#8217;re running your instance in debug mode</em>.</p>
<dl class="class">
<dt id="logilab.common.registry.traced_selection">
<em class="property">class </em><tt class="descclassname">logilab.common.registry.</tt><tt class="descname">traced_selection</tt><big>(</big><em>traced='all'</em><big>)</big><a class="headerlink" href="#logilab.common.registry.traced_selection" title="Permalink to this definition">¶</a></dt>
<dd><p>Typical usage is :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">logilab.common.registry</span> <span class="kn">import</span> <span class="n">traced_selection</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">traced_selection</span><span class="p">():</span>
<span class="gp">... </span>    <span class="c"># some code in which you want to debug selectors</span>
<span class="gp">... </span>    <span class="c"># for all objects</span>
</pre></div>
</div>
<p>Don&#8217;t forget the &#8216;from __future__ import with_statement&#8217; at the module top-level
if you&#8217;re using python prior to 2.6.</p>
<p>This will yield lines like this in the logs:</p>
<div class="highlight-python"><pre>selector one_line_rset returned 0 for &lt;class 'elephant.Babar'&gt;</pre>
</div>
<p>You can also give to <tt class="xref py py-class docutils literal"><span class="pre">traced_selection</span></tt> the identifiers of objects on
which you want to debug selection (&#8216;oid1&#8217; and &#8216;oid2&#8217; in the example above).</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">traced_selection</span><span class="p">(</span> <span class="p">(</span><span class="s">&#39;regid1&#39;</span><span class="p">,</span> <span class="s">&#39;regid2&#39;</span><span class="p">)</span> <span class="p">):</span>
<span class="gp">... </span>    <span class="c"># some code in which you want to debug selectors</span>
<span class="gp">... </span>    <span class="c"># for objects with __regid__ &#39;regid1&#39; and &#39;regid2&#39;</span>
</pre></div>
</div>
<p>A potentially useful point to set up such a tracing function is
the <cite>logilab.common.registry.Registry.select</cite> method body.</p>
</dd></dl>

</div>
</div>
<span class="target" id="module-cubicweb.appobject"></span><div class="section" id="the-appobject-class">
<span id="appobject"></span><h2>2.3. The <cite>AppObject</cite> class<a class="headerlink" href="#the-appobject-class" title="Permalink to this headline">¶</a></h2>
<p>The AppObject class is the base class for all dynamically loaded objects
(application objects) accessible through the vregistry.</p>
<p>We can find a certain number of attributes and methods defined in this class and
common to all the application objects.</p>
<dl class="class">
<dt id="cubicweb.appobject.AppObject">
<em class="property">class </em><tt class="descclassname">cubicweb.appobject.</tt><tt class="descname">AppObject</tt><big>(</big><em>req</em>, <em>**extra</em><big>)</big><a class="headerlink" href="#cubicweb.appobject.AppObject" title="Permalink to this definition">¶</a></dt>
<dd><p>This is the base class for CubicWeb application objects which are
selected in a request context.</p>
<p>The following attributes should be set on concrete appobject classes:</p>
<p>At selection time, the following attributes are set on the instance:</p>
<dl class="docutils">
<dt><tt class="xref py py-attr docutils literal"><span class="pre">_cw</span></tt></dt>
<dd>current request</dd>
<dt><tt class="xref py py-attr docutils literal"><span class="pre">cw_extra_kwargs</span></tt></dt>
<dd>other received arguments</dd>
</dl>
<p>And also the following, only if <cite>rset</cite> is found in arguments (in which case
rset/row/col will be removed from <cite>cwextra_kwargs</cite>):</p>
<dl class="docutils">
<dt><tt class="xref py py-attr docutils literal"><span class="pre">cw_rset</span></tt></dt>
<dd>context result set or None</dd>
<dt><tt class="xref py py-attr docutils literal"><span class="pre">cw_row</span></tt></dt>
<dd>if a result set is set and the context is about a particular cell in the
result set, and not the result set as a whole, specify the row number we
are interested in, else None</dd>
<dt><tt class="xref py py-attr docutils literal"><span class="pre">cw_col</span></tt></dt>
<dd>if a result set is set and the context is about a particular cell in the
result set, and not the result set as a whole, specify the col number we
are interested in, else None</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>do not inherit directly from this class but from a more specific class
such as <cite>AnyEntity</cite>, <cite>EntityView</cite>, <cite>AnyRsetView</cite>, <cite>Action</cite>...</li>
</ul>
</div>
</dd></dl>

</div>
<div class="section" id="base-predicates">
<h2>2.4. Base predicates<a class="headerlink" href="#base-predicates" title="Permalink to this headline">¶</a></h2>
<p>Predicates are scoring functions that are called by the registry to tell whenever
an appobject can be selected in a given context. Predicates may be chained
together using operators to build a selector. A selector is the glue that tie
views to the data model or whatever input context. Using them appropriately is an
essential part of the construction of well behaved cubes.</p>
<p>Of course you may have to write your own set of predicates as your needs grows
and you get familiar with the framework (see <a class="reference internal" href="#custompredicates"><em>Defining your own predicates</em></a>).</p>
<p>Here is a description of generic predicates provided by CubicWeb that should suit
most of your needs.</p>
<div class="section" id="bare-predicates">
<h3>2.4.1. Bare predicates<a class="headerlink" href="#bare-predicates" title="Permalink to this headline">¶</a></h3>
<p>Those predicates are somewhat dumb, which doesn&#8217;t mean they&#8217;re not (very) useful.</p>
<dl class="attribute">
<dt id="cubicweb.appobject.yes">
<tt class="descclassname">cubicweb.appobject.</tt><tt class="descname">yes</tt><a class="headerlink" href="#cubicweb.appobject.yes" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <tt class="xref py py-class docutils literal"><span class="pre">wrapped</span></tt></p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.predicates.match_kwargs">
<em class="property">class </em><tt class="descclassname">cubicweb.predicates.</tt><tt class="descname">match_kwargs</tt><big>(</big><em>*expected</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.predicates.match_kwargs" title="Permalink to this definition">¶</a></dt>
<dd><p>Return non-zero score if parameter names specified as initializer
arguments are specified in the input context.</p>
<p>Return a score corresponding to the number of expected parameters.</p>
<p>When multiple parameters are expected, all of them should be found in
the input context unless <cite>mode</cite> keyword argument is given to &#8216;any&#8217;,
in which case a single matching parameter is enough.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.predicates.appobject_selectable">
<em class="property">class </em><tt class="descclassname">cubicweb.predicates.</tt><tt class="descname">appobject_selectable</tt><big>(</big><em>registry</em>, <em>*regids</em><big>)</big><a class="headerlink" href="#cubicweb.predicates.appobject_selectable" title="Permalink to this definition">¶</a></dt>
<dd><p>Return 1 if another appobject is selectable using the same input context.</p>
<p>Initializer arguments:</p>
<ul class="simple">
<li><cite>registry</cite>, a registry name</li>
<li><cite>regids</cite>, object identifiers in this registry, one of them should be
selectable.</li>
</ul>
</dd></dl>

<dl class="class">
<dt id="cubicweb.predicates.adaptable">
<em class="property">class </em><tt class="descclassname">cubicweb.predicates.</tt><tt class="descname">adaptable</tt><big>(</big><em>*regids</em><big>)</big><a class="headerlink" href="#cubicweb.predicates.adaptable" title="Permalink to this definition">¶</a></dt>
<dd><p>Return 1 if another appobject is selectable using the same input context.</p>
<p>Initializer arguments:</p>
<ul class="simple">
<li><cite>regids</cite>, adapter identifiers (e.g. interface names) to which the context
(usually entities) should be adaptable. One of them should be selectable
when multiple identifiers are given.</li>
</ul>
</dd></dl>

<dl class="class">
<dt id="cubicweb.predicates.configuration_values">
<em class="property">class </em><tt class="descclassname">cubicweb.predicates.</tt><tt class="descname">configuration_values</tt><big>(</big><em>key</em>, <em>values</em><big>)</big><a class="headerlink" href="#cubicweb.predicates.configuration_values" title="Permalink to this definition">¶</a></dt>
<dd><p>Return 1 if the instance has an option set to a given value(s) in its
configuration file.</p>
</dd></dl>

</div>
<div class="section" id="result-set-predicates">
<h3>2.4.2. Result set predicates<a class="headerlink" href="#result-set-predicates" title="Permalink to this headline">¶</a></h3>
<p>Those predicates are looking for a result set in the context (&#8216;rset&#8217; argument or
the input context) and match or not according to its shape. Some of these
predicates have different behaviour if a particular cell of the result set is
specified using &#8216;row&#8217; and &#8216;col&#8217; arguments of the input context or not.</p>
<dl class="class">
<dt id="cubicweb.predicates.none_rset">
<em class="property">class </em><tt class="descclassname">cubicweb.predicates.</tt><tt class="descname">none_rset</tt><a class="headerlink" href="#cubicweb.predicates.none_rset" title="Permalink to this definition">¶</a></dt>
<dd><p>Return 1 if the result set is None (eg usually not specified).</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.predicates.any_rset">
<em class="property">class </em><tt class="descclassname">cubicweb.predicates.</tt><tt class="descname">any_rset</tt><a class="headerlink" href="#cubicweb.predicates.any_rset" title="Permalink to this definition">¶</a></dt>
<dd><p>Return 1 for any result set, whatever the number of rows in it, even 0.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.predicates.nonempty_rset">
<em class="property">class </em><tt class="descclassname">cubicweb.predicates.</tt><tt class="descname">nonempty_rset</tt><a class="headerlink" href="#cubicweb.predicates.nonempty_rset" title="Permalink to this definition">¶</a></dt>
<dd><p>Return 1 for result set containing one ore more rows.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.predicates.empty_rset">
<em class="property">class </em><tt class="descclassname">cubicweb.predicates.</tt><tt class="descname">empty_rset</tt><a class="headerlink" href="#cubicweb.predicates.empty_rset" title="Permalink to this definition">¶</a></dt>
<dd><p>Return 1 for result set which doesn&#8217;t contain any row.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.predicates.one_line_rset">
<em class="property">class </em><tt class="descclassname">cubicweb.predicates.</tt><tt class="descname">one_line_rset</tt><a class="headerlink" href="#cubicweb.predicates.one_line_rset" title="Permalink to this definition">¶</a></dt>
<dd><p>Return 1 if the result set is of size 1, or greater but a specific row in
the result set is specified (&#8216;row&#8217; argument).</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.predicates.multi_lines_rset">
<em class="property">class </em><tt class="descclassname">cubicweb.predicates.</tt><tt class="descname">multi_lines_rset</tt><big>(</big><em>expected=None</em>, <em>operator=&lt;built-in function eq&gt;</em><big>)</big><a class="headerlink" href="#cubicweb.predicates.multi_lines_rset" title="Permalink to this definition">¶</a></dt>
<dd><p>Return 1 if the operator expression matches between <cite>num</cite> elements
in the result set and the <cite>expected</cite> value if defined.</p>
<dl class="docutils">
<dt>By default, multi_lines_rset(expected) matches equality expression:</dt>
<dd><cite>nb</cite> row(s) in result set equals to expected value</dd>
<dt>But, you can perform richer comparisons by overriding default operator:</dt>
<dd>multi_lines_rset(expected, operator.gt)</dd>
</dl>
<p>If <cite>expected</cite> is None, return 1 if the result set contains <em>at least</em>
two rows.
If rset is None, return 0.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.predicates.multi_columns_rset">
<em class="property">class </em><tt class="descclassname">cubicweb.predicates.</tt><tt class="descname">multi_columns_rset</tt><big>(</big><em>expected=None</em>, <em>operator=&lt;built-in function eq&gt;</em><big>)</big><a class="headerlink" href="#cubicweb.predicates.multi_columns_rset" title="Permalink to this definition">¶</a></dt>
<dd><p>If <cite>nb</cite> is specified, return 1 if the result set has exactly <cite>nb</cite> column
per row. Else (<cite>nb</cite> is None), return 1 if the result set contains <em>at least</em>
two columns per row. Return 0 for empty result set.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.predicates.paginated_rset">
<em class="property">class </em><tt class="descclassname">cubicweb.predicates.</tt><tt class="descname">paginated_rset</tt><big>(</big><em>nbpages=1</em><big>)</big><a class="headerlink" href="#cubicweb.predicates.paginated_rset" title="Permalink to this definition">¶</a></dt>
<dd><p>Return 1 or more for result set with more rows than one or more page
size.  You can specify expected number of pages to the initializer (default
to one), and you&#8217;ll get that number of pages as score if the result set is
big enough.</p>
<p>Page size is searched in (respecting order):
* a <cite>page_size</cite> argument
* a <cite>page_size</cite> form parameters
* the <cite>navigation.page-size</cite> property (see <a class="reference internal" href="../admin/instance-config.html#persistentproperties"><em>Configuring persistent properties</em></a>)</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.predicates.sorted_rset">
<em class="property">class </em><tt class="descclassname">cubicweb.predicates.</tt><tt class="descname">sorted_rset</tt><a class="headerlink" href="#cubicweb.predicates.sorted_rset" title="Permalink to this definition">¶</a></dt>
<dd><p>Return 1 for sorted result set (e.g. from an RQL query containing an
ORDERBY clause), with exception that it will return 0 if the rset is
&#8216;ORDERBY FTIRANK(VAR)&#8217; (eg sorted by rank value of the has_text index).</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.predicates.one_etype_rset">
<em class="property">class </em><tt class="descclassname">cubicweb.predicates.</tt><tt class="descname">one_etype_rset</tt><a class="headerlink" href="#cubicweb.predicates.one_etype_rset" title="Permalink to this definition">¶</a></dt>
<dd><p>Return 1 if the result set contains entities which are all of the same
type in the column specified by the <cite>col</cite> argument of the input context, or
in column 0.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.predicates.multi_etypes_rset">
<em class="property">class </em><tt class="descclassname">cubicweb.predicates.</tt><tt class="descname">multi_etypes_rset</tt><big>(</big><em>expected=None</em>, <em>operator=&lt;built-in function eq&gt;</em><big>)</big><a class="headerlink" href="#cubicweb.predicates.multi_etypes_rset" title="Permalink to this definition">¶</a></dt>
<dd><p>If <cite>nb</cite> is specified, return 1 if the result set contains <cite>nb</cite> different
types of entities in the column specified by the <cite>col</cite> argument of the input
context, or in column 0. If <cite>nb</cite> is None, return 1 if the result set contains
<em>at least</em> two different types of entities.</p>
</dd></dl>

</div>
<div class="section" id="entity-predicates">
<h3>2.4.3. Entity predicates<a class="headerlink" href="#entity-predicates" title="Permalink to this headline">¶</a></h3>
<p>Those predicates are looking for either an <cite>entity</cite> argument in the input context,
or entity found in the result set (&#8216;rset&#8217; argument or the input context) and
match or not according to entity&#8217;s (instance or class) properties.</p>
<dl class="class">
<dt id="cubicweb.predicates.non_final_entity">
<em class="property">class </em><tt class="descclassname">cubicweb.predicates.</tt><tt class="descname">non_final_entity</tt><big>(</big><em>once_is_enough=None</em>, <em>accept_none=True</em>, <em>mode='all'</em><big>)</big><a class="headerlink" href="#cubicweb.predicates.non_final_entity" title="Permalink to this definition">¶</a></dt>
<dd><p>Return 1 for entity of a non final entity type(s). Remember, &#8220;final&#8221;
entity types are String, Int, etc... This is equivalent to
<cite>is_instance(&#8216;Any&#8217;)</cite> but more optimized.</p>
<p>See <a class="reference internal" href="#cubicweb.predicates.EClassPredicate" title="cubicweb.predicates.EClassPredicate"><tt class="xref py py-class docutils literal"><span class="pre">EClassPredicate</span></tt></a> documentation for entity
class lookup / score rules according to the input context.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.predicates.is_instance">
<em class="property">class </em><tt class="descclassname">cubicweb.predicates.</tt><tt class="descname">is_instance</tt><big>(</big><em>*expected_etypes</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.predicates.is_instance" title="Permalink to this definition">¶</a></dt>
<dd><p>Return non-zero score for entity that is an instance of the one of given
type(s). If multiple arguments are given, matching one of them is enough.</p>
<p>Entity types should be given as string, the corresponding class will be
fetched from the registry at selection time.</p>
<p>See <a class="reference internal" href="#cubicweb.predicates.EClassPredicate" title="cubicweb.predicates.EClassPredicate"><tt class="xref py py-class docutils literal"><span class="pre">EClassPredicate</span></tt></a> documentation for entity
class lookup / score rules according to the input context.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">the score will reflect class proximity so the most specific object
will be selected.</p>
</div>
</dd></dl>

<dl class="class">
<dt id="cubicweb.predicates.score_entity">
<em class="property">class </em><tt class="descclassname">cubicweb.predicates.</tt><tt class="descname">score_entity</tt><big>(</big><em>scorefunc</em>, <em>once_is_enough=None</em>, <em>mode='all'</em><big>)</big><a class="headerlink" href="#cubicweb.predicates.score_entity" title="Permalink to this definition">¶</a></dt>
<dd><p>Return score according to an arbitrary function given as argument which
will be called with input content entity as argument.</p>
<p>This is a very useful predicate that will usually interest you since it
allows a lot of things without having to write a specific predicate.</p>
<p>The function can return arbitrary value which will be casted to an integer
value at the end.</p>
<p>See <a class="reference internal" href="#cubicweb.predicates.EntityPredicate" title="cubicweb.predicates.EntityPredicate"><tt class="xref py py-class docutils literal"><span class="pre">EntityPredicate</span></tt></a> documentation for entity
lookup / score rules according to the input context.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.predicates.rql_condition">
<em class="property">class </em><tt class="descclassname">cubicweb.predicates.</tt><tt class="descname">rql_condition</tt><big>(</big><em>expression</em>, <em>once_is_enough=None</em>, <em>mode='all'</em>, <em>user_condition=False</em><big>)</big><a class="headerlink" href="#cubicweb.predicates.rql_condition" title="Permalink to this definition">¶</a></dt>
<dd><p>Return non-zero score if arbitrary rql specified in <cite>expression</cite>
initializer argument return some results for entity found in the input
context. Returned score is the number of items returned by the rql
condition.</p>
<p><cite>expression</cite> is expected to be a string containing an rql expression, which
must use &#8216;X&#8217; variable to represent the context entity and may use &#8216;U&#8217; to
represent the request&#8217;s user.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If simply testing value of some attribute/relation of context entity (X),
you should rather use the <tt class="xref py py-class docutils literal"><span class="pre">score_entity</span></tt> predicate which will
benefit from the ORM&#8217;s request entities cache.</p>
</div>
<p>See <a class="reference internal" href="#cubicweb.predicates.EntityPredicate" title="cubicweb.predicates.EntityPredicate"><tt class="xref py py-class docutils literal"><span class="pre">EntityPredicate</span></tt></a> documentation for entity
lookup / score rules according to the input context.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.predicates.relation_possible">
<em class="property">class </em><tt class="descclassname">cubicweb.predicates.</tt><tt class="descname">relation_possible</tt><big>(</big><em>rtype</em>, <em>role='subject'</em>, <em>target_etype=None</em>, <em>action='read'</em>, <em>strict=False</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.predicates.relation_possible" title="Permalink to this definition">¶</a></dt>
<dd><p>Return 1 for entity that supports the relation, provided that the
request&#8217;s user may do some <cite>action</cite> on it (see below).</p>
<p>The relation is specified by the following initializer arguments:</p>
<ul class="simple">
<li><cite>rtype</cite>, the name of the relation</li>
<li><cite>role</cite>, the role of the entity in the relation, either &#8216;subject&#8217; or
&#8216;object&#8217;, default to &#8216;subject&#8217;</li>
<li><cite>target_etype</cite>, optional name of an entity type that should be supported
at the other end of the relation</li>
<li><cite>action</cite>, a relation schema action (e.g. one of &#8216;read&#8217;, &#8216;add&#8217;, &#8216;delete&#8217;,
default to &#8216;read&#8217;) which must be granted to the user, else a 0 score will
be returned. Give None if you don&#8217;t want any permission checking.</li>
<li><cite>strict</cite>, boolean (default to False) telling what to do when the user has
not globally the permission for the action (eg the action is not granted
to one of the user&#8217;s groups)<ul>
<li>when strict is False, if there are some local role defined for this
action (e.g. using rql expressions), then the permission will be
considered as granted</li>
<li>when strict is True, then the permission will be actually checked for
each entity</li>
</ul>
</li>
</ul>
<p>Setting <cite>strict</cite> to True impacts performance for large result set since
you&#8217;ll then get the <a class="reference internal" href="#cubicweb.predicates.EntityPredicate" title="cubicweb.predicates.EntityPredicate"><tt class="xref py py-class docutils literal"><span class="pre">EntityPredicate</span></tt></a> behaviour
while otherwise you get the <a class="reference internal" href="#cubicweb.predicates.EClassPredicate" title="cubicweb.predicates.EClassPredicate"><tt class="xref py py-class docutils literal"><span class="pre">EClassPredicate</span></tt></a>&#8216;s
one. See those classes documentation for entity lookup / score rules
according to the input context.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.predicates.partial_relation_possible">
<em class="property">class </em><tt class="descclassname">cubicweb.predicates.</tt><tt class="descname">partial_relation_possible</tt><big>(</big><em>action='read'</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.predicates.partial_relation_possible" title="Permalink to this definition">¶</a></dt>
<dd><p>Same as :class:~`cubicweb.predicates.relation_possible`, but will look for
attributes of the selected class to get information which is otherwise
expected by the initializer, except for <cite>action</cite> and <cite>strict</cite> which are kept
as initializer arguments.</p>
<p>This is useful to predefine predicate of an abstract class designed to be
customized.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.predicates.has_related_entities">
<em class="property">class </em><tt class="descclassname">cubicweb.predicates.</tt><tt class="descname">has_related_entities</tt><big>(</big><em>rtype</em>, <em>role='subject'</em>, <em>target_etype=None</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.predicates.has_related_entities" title="Permalink to this definition">¶</a></dt>
<dd><p>Return 1 if entity support the specified relation and has some linked
entities by this relation , optionaly filtered according to the specified
target type.</p>
<p>The relation is specified by the following initializer arguments:</p>
<ul class="simple">
<li><cite>rtype</cite>, the name of the relation</li>
<li><cite>role</cite>, the role of the entity in the relation, either &#8216;subject&#8217; or
&#8216;object&#8217;, default to &#8216;subject&#8217;.</li>
<li><cite>target_etype</cite>, optional name of an entity type that should be found
at the other end of the relation</li>
</ul>
<p>See <a class="reference internal" href="#cubicweb.predicates.EntityPredicate" title="cubicweb.predicates.EntityPredicate"><tt class="xref py py-class docutils literal"><span class="pre">EntityPredicate</span></tt></a> documentation for entity
lookup / score rules according to the input context.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.predicates.partial_has_related_entities">
<em class="property">class </em><tt class="descclassname">cubicweb.predicates.</tt><tt class="descname">partial_has_related_entities</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.predicates.partial_has_related_entities" title="Permalink to this definition">¶</a></dt>
<dd><p>Same as :class:~`cubicweb.predicates.has_related_entity`, but will look
for attributes of the selected class to get information which is otherwise
expected by the initializer.</p>
<p>This is useful to predefine predicate of an abstract class designed to be
customized.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.predicates.has_permission">
<em class="property">class </em><tt class="descclassname">cubicweb.predicates.</tt><tt class="descname">has_permission</tt><big>(</big><em>action</em><big>)</big><a class="headerlink" href="#cubicweb.predicates.has_permission" title="Permalink to this definition">¶</a></dt>
<dd><p>Return non-zero score if request&#8217;s user has the permission to do the
requested action on the entity. <cite>action</cite> is an entity schema action (eg one
of &#8216;read&#8217;, &#8216;add&#8217;, &#8216;delete&#8217;, &#8216;update&#8217;).</p>
<p>Here are entity lookup / scoring rules:</p>
<ul class="simple">
<li>if <cite>entity</cite> is specified, check permission is granted for this entity</li>
<li>elif <cite>row</cite> is specified, check permission is granted for the entity found
in the specified cell</li>
<li>else check permission is granted for each entity found in the column
specified specified by the <cite>col</cite> argument or in column 0</li>
</ul>
</dd></dl>

<dl class="class">
<dt id="cubicweb.predicates.has_add_permission">
<em class="property">class </em><tt class="descclassname">cubicweb.predicates.</tt><tt class="descname">has_add_permission</tt><big>(</big><em>etype=None</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.predicates.has_add_permission" title="Permalink to this definition">¶</a></dt>
<dd><p>Return 1 if request&#8217;s user has the add permission on entity type
specified in the <cite>etype</cite> initializer argument, or according to entity found
in the input content if not specified.</p>
<p>It also check that then entity type is not a strict subobject (e.g. may only
be used as a composed of another entity).</p>
<p>See <a class="reference internal" href="#cubicweb.predicates.EClassPredicate" title="cubicweb.predicates.EClassPredicate"><tt class="xref py py-class docutils literal"><span class="pre">EClassPredicate</span></tt></a> documentation for entity
class lookup / score rules according to the input context when <cite>etype</cite> is
not specified.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.predicates.has_mimetype">
<em class="property">class </em><tt class="descclassname">cubicweb.predicates.</tt><tt class="descname">has_mimetype</tt><big>(</big><em>mimetype</em>, <em>once_is_enough=None</em>, <em>mode='all'</em><big>)</big><a class="headerlink" href="#cubicweb.predicates.has_mimetype" title="Permalink to this definition">¶</a></dt>
<dd><p>Return 1 if the entity adapt to IDownloadable and has the given MIME type.</p>
<p>You can give &#8216;image/&#8217; to match any image for instance, or &#8216;image/png&#8217; to match
only PNG images.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.predicates.is_in_state">
<em class="property">class </em><tt class="descclassname">cubicweb.predicates.</tt><tt class="descname">is_in_state</tt><big>(</big><em>*expected</em><big>)</big><a class="headerlink" href="#cubicweb.predicates.is_in_state" title="Permalink to this definition">¶</a></dt>
<dd><p>Return 1 if entity is in one of the states given as argument list</p>
<p>You should use this instead of your own <tt class="xref py py-class docutils literal"><span class="pre">score_entity</span></tt> predicate to
avoid some gotchas:</p>
<ul class="simple">
<li>possible views gives a fake entity with no state</li>
<li>you must use the latest tr info thru the workflow adapter for repository
side checking of the current state</li>
</ul>
<p>In debug mode, this predicate can raise <tt class="xref py py-exc docutils literal"><span class="pre">ValueError</span></tt> for unknown states names
(only checked on entities without a custom workflow)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">int</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="cubicweb.predicates.on_fire_transition">
<tt class="descclassname">cubicweb.predicates.</tt><tt class="descname">on_fire_transition</tt><big>(</big><em>etype</em>, <em>tr_names</em>, <em>from_state_name=None</em><big>)</big><a class="headerlink" href="#cubicweb.predicates.on_fire_transition" title="Permalink to this definition">¶</a></dt>
<dd><p>Return 1 when entity of the type <cite>etype</cite> is going through transition of
a name included in <cite>tr_names</cite>.</p>
<p>You should use this predicate on &#8216;after_add_entity&#8217; hook, since it&#8217;s actually
looking for addition of <cite>TrInfo</cite> entities. Hence in the hook, <cite>self.entity</cite>
will reference the matching <cite>TrInfo</cite> entity, allowing to get all the
transition details (including the entity to which is applied the transition
but also its original state, transition, destination state, user...).</p>
<p>See <tt class="xref py py-class docutils literal"><span class="pre">cubicweb.entities.wfobjs.TrInfo</span></tt> for more information.</p>
</dd></dl>

</div>
<div class="section" id="logged-user-predicates">
<h3>2.4.4. Logged user predicates<a class="headerlink" href="#logged-user-predicates" title="Permalink to this headline">¶</a></h3>
<p>Those predicates are looking for properties of the user issuing the request.</p>
<dl class="class">
<dt id="cubicweb.predicates.match_user_groups">
<em class="property">class </em><tt class="descclassname">cubicweb.predicates.</tt><tt class="descname">match_user_groups</tt><big>(</big><em>*expected</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.predicates.match_user_groups" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a non-zero score if request&#8217;s user is in at least one of the
groups given as initializer argument. Returned score is the number of groups
in which the user is.</p>
<p>If the special &#8216;owners&#8217; group is given and <cite>rset</cite> is specified in the input
context:</p>
<ul class="simple">
<li>if <cite>row</cite> is specified check the entity at the given <cite>row</cite>/<cite>col</cite> (default
to 0) is owned by the user</li>
<li>else check all entities in <cite>col</cite> (default to 0) are owned by the user</li>
</ul>
</dd></dl>

</div>
<div class="section" id="web-request-predicates">
<h3>2.4.5. Web request predicates<a class="headerlink" href="#web-request-predicates" title="Permalink to this headline">¶</a></h3>
<p>Those predicates are looking for properties of <em>web</em> request, they can not be
used on the data repository side.</p>
<dl class="class">
<dt id="cubicweb.predicates.no_cnx">
<em class="property">class </em><tt class="descclassname">cubicweb.predicates.</tt><tt class="descname">no_cnx</tt><a class="headerlink" href="#cubicweb.predicates.no_cnx" title="Permalink to this definition">¶</a></dt>
<dd><p>Return 1 if the web session has no connection set. This occurs when
anonymous access is not allowed and user isn&#8217;t authenticated.</p>
<p>May only be used on the web side, not on the data repository side.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.predicates.anonymous_user">
<em class="property">class </em><tt class="descclassname">cubicweb.predicates.</tt><tt class="descname">anonymous_user</tt><a class="headerlink" href="#cubicweb.predicates.anonymous_user" title="Permalink to this definition">¶</a></dt>
<dd><p>Return 1 if the user is not authenticated (i.e. is the anonymous user).</p>
<p>May only be used on the web side, not on the data repository side.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.predicates.authenticated_user">
<em class="property">class </em><tt class="descclassname">cubicweb.predicates.</tt><tt class="descname">authenticated_user</tt><a class="headerlink" href="#cubicweb.predicates.authenticated_user" title="Permalink to this definition">¶</a></dt>
<dd><p>Return 1 if the user is authenticated (i.e. not the anonymous user).</p>
<p>May only be used on the web side, not on the data repository side.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.predicates.match_form_params">
<em class="property">class </em><tt class="descclassname">cubicweb.predicates.</tt><tt class="descname">match_form_params</tt><big>(</big><em>*expected</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.predicates.match_form_params" title="Permalink to this definition">¶</a></dt>
<dd><p>Return non-zero score if parameter names specified as initializer
arguments are specified in request&#8217;s form parameters.</p>
<p>Return a score corresponding to the number of expected parameters.</p>
<p>When multiple parameters are expected, all of them should be found in
the input context unless <cite>mode</cite> keyword argument is given to &#8216;any&#8217;,
in which case a single matching parameter is enough.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.predicates.match_search_state">
<em class="property">class </em><tt class="descclassname">cubicweb.predicates.</tt><tt class="descname">match_search_state</tt><big>(</big><em>*expected</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.predicates.match_search_state" title="Permalink to this definition">¶</a></dt>
<dd><p>Return 1 if the current request search state is in one of the expected
states given to the initializer.</p>
<p>Known search states are either &#8216;normal&#8217; or &#8216;linksearch&#8217; (eg searching for an
object to create a relation with another).</p>
<p>This predicate is usually used by action that want to appears or not according
to the ui search state.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.predicates.match_context_prop">
<em class="property">class </em><tt class="descclassname">cubicweb.predicates.</tt><tt class="descname">match_context_prop</tt><a class="headerlink" href="#cubicweb.predicates.match_context_prop" title="Permalink to this definition">¶</a></dt>
<dd><p>Return 1 if:</p>
<ul class="simple">
<li>no <cite>context</cite> is specified in input context (take care to confusion, here
<cite>context</cite> refers to a string given as an argument to the input context...)</li>
<li>specified <cite>context</cite> is matching the context property value for the
appobject using this predicate</li>
<li>the appobject&#8217;s context property value is None</li>
</ul>
<p>This predicate is usually used by contextual components that want to appears
in a configurable place.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.predicates.match_context">
<em class="property">class </em><tt class="descclassname">cubicweb.predicates.</tt><tt class="descname">match_context</tt><big>(</big><em>*expected</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.predicates.match_context" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="class">
<dt id="cubicweb.predicates.match_view">
<em class="property">class </em><tt class="descclassname">cubicweb.predicates.</tt><tt class="descname">match_view</tt><big>(</big><em>*expected</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.predicates.match_view" title="Permalink to this definition">¶</a></dt>
<dd><p>Return 1 if a view is specified an as its registry id is in one of the
expected view id given to the initializer.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.predicates.primary_view">
<em class="property">class </em><tt class="descclassname">cubicweb.predicates.</tt><tt class="descname">primary_view</tt><a class="headerlink" href="#cubicweb.predicates.primary_view" title="Permalink to this definition">¶</a></dt>
<dd><p>Return 1 if:</p>
<ul class="simple">
<li><em>no view is specified</em> in the input context</li>
<li>a view is specified and its <cite>.is_primary()</cite> method return True</li>
</ul>
<p>This predicate is usually used by contextual components that only want to
appears for the primary view of an entity.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.predicates.contextual">
<em class="property">class </em><tt class="descclassname">cubicweb.predicates.</tt><tt class="descname">contextual</tt><a class="headerlink" href="#cubicweb.predicates.contextual" title="Permalink to this definition">¶</a></dt>
<dd><p>Return 1 if view&#8217;s contextual property is true</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.predicates.specified_etype_implements">
<em class="property">class </em><tt class="descclassname">cubicweb.predicates.</tt><tt class="descname">specified_etype_implements</tt><big>(</big><em>*expected_etypes</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.predicates.specified_etype_implements" title="Permalink to this definition">¶</a></dt>
<dd><p>Return non-zero score if the entity type specified by an &#8216;etype&#8217; key
searched in (by priority) input context kwargs and request form parameters
match a known entity type (case insensitivly), and it&#8217;s associated entity
class is of one of the type(s) given to the initializer. If multiple
arguments are given, matching one of them is enough.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">as with <a class="reference internal" href="#cubicweb.predicates.is_instance" title="cubicweb.predicates.is_instance"><tt class="xref py py-class docutils literal"><span class="pre">is_instance</span></tt></a>, entity types
should be given as string and the score will reflect class
proximity so the most specific object will be selected.</p>
</div>
<p>This predicate is usually used by views holding entity creation forms (since
we&#8217;ve no result set to work on).</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.predicates.attribute_edited">
<em class="property">class </em><tt class="descclassname">cubicweb.predicates.</tt><tt class="descname">attribute_edited</tt><big>(</big><em>attribute</em>, <em>once_is_enough=None</em>, <em>mode='all'</em><big>)</big><a class="headerlink" href="#cubicweb.predicates.attribute_edited" title="Permalink to this definition">¶</a></dt>
<dd><p>Scores if the specified attribute has been edited This is useful for
selection of forms by the edit controller.</p>
<p>The initial use case is on a form, in conjunction with match_transition,
which will not score at edit time:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">is_instance</span><span class="p">(</span><span class="s">&#39;Version&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">match_transition</span><span class="p">(</span><span class="s">&#39;ready&#39;</span><span class="p">)</span> <span class="o">|</span>
                          <span class="n">attribute_edited</span><span class="p">(</span><span class="s">&#39;publication_date&#39;</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="cubicweb.predicates.match_transition">
<em class="property">class </em><tt class="descclassname">cubicweb.predicates.</tt><tt class="descname">match_transition</tt><big>(</big><em>*expected</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.predicates.match_transition" title="Permalink to this definition">¶</a></dt>
<dd><p>Return 1 if <cite>transition</cite> argument is found in the input context which has
a <cite>.name</cite> attribute matching one of the expected names given to the
initializer.</p>
<p>This predicate is expected to be used to customise the status change form in
the web ui.</p>
</dd></dl>

</div>
<div class="section" id="other-predicates">
<h3>2.4.6. Other predicates<a class="headerlink" href="#other-predicates" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="cubicweb.predicates.match_exception">
<em class="property">class </em><tt class="descclassname">cubicweb.predicates.</tt><tt class="descname">match_exception</tt><big>(</big><em>*expected</em><big>)</big><a class="headerlink" href="#cubicweb.predicates.match_exception" title="Permalink to this definition">¶</a></dt>
<dd><p>Return 1 if exception given as <cite>exc</cite> in the input context is an instance
of one of the class given on instanciation of this predicate.</p>
</dd></dl>

<dl class="class">
<dt id="cubicweb.predicates.debug_mode">
<em class="property">class </em><tt class="descclassname">cubicweb.predicates.</tt><tt class="descname">debug_mode</tt><a class="headerlink" href="#cubicweb.predicates.debug_mode" title="Permalink to this definition">¶</a></dt>
<dd><p>Return 1 if running in debug mode.</p>
</dd></dl>

<p>You&#8217;ll also find some other (very) specific predicates hidden in other modules
than <tt class="xref py py-mod docutils literal"><span class="pre">cubicweb.predicates</span></tt>.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="datamodel/index.html" title="3. Data model"
             >next</a> |</li>
        <li class="right" >
          <a href="cubes/available-cubes.html" title="1.3. Available cubes"
             >previous</a> |</li>
        <li><a href="../index.html">CubicWeb 3.18.3</a> &raquo;</li>
          <li><a href="index.html" >Repository development</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2001-2014, Logilab.
      Last updated on Mar 11, 2014.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>