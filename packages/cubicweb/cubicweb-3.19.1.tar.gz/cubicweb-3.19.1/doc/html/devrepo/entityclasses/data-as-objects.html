
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>4.1. Access to persistent data &mdash; CubicWeb 3.18.3</title>
    
    <link rel="stylesheet" href="../../_static/lglb-sphinx-doc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '3.18.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="CubicWeb 3.18.3" href="../../index.html" />
    <link rel="up" title="4. Data as objects" href="index.html" />
    <link rel="next" title="4.5. Loaded attributes and default sorting management" href="load-sort.html" />
    <link rel="prev" title="4. Data as objects" href="index.html" /> 
  </head>
  <body>
<div class="header">
 <a href="http://www.cubicweb.org">
  <img alt="cubicweb logo" src="../../_static/cubicweb.png"/>
 </a>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="load-sort.html" title="4.5. Loaded attributes and default sorting management"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="4. Data as objects"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">CubicWeb 3.18.3</a> &raquo;</li>
          <li><a href="../index.html" >Repository development</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">4. Data as objects</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">4.1. Access to persistent data</a></li>
<li><a class="reference internal" href="#the-anyentity-class">4.2. The <tt class="docutils literal"><span class="pre">AnyEntity</span></tt> class</a></li>
<li><a class="reference internal" href="#inheritance">4.3. Inheritance</a></li>
<li><a class="reference internal" href="#application-logic">4.4. Application logic</a></li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">4. Data as objects</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="load-sort.html"
                        title="next chapter">4.5. Loaded attributes and default sorting management</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/devrepo/entityclasses/data-as-objects.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="access-to-persistent-data">
<h1>4.1. Access to persistent data<a class="headerlink" href="#access-to-persistent-data" title="Permalink to this headline">¶</a></h1>
<p>Python-level access to persistent data is provided by the
<tt class="xref py py-class docutils literal"><span class="pre">Entity</span></tt> class.</p>
<p>An entity class is bound to a schema entity type. Descriptors are added when
classes are registered in order to initialize the class according to its schema:</p>
<ul class="simple">
<li>the attributes defined in the schema appear as attributes of these classes</li>
<li>the relations defined in the schema appear as attributes of these classes,
but are lists of instances</li>
</ul>
<p><cite>Formatting and output generation</cite>:</p>
<ul class="simple">
<li><tt class="xref py py-meth docutils literal"><span class="pre">view(__vid,</span> <span class="pre">__registry='views',</span> <span class="pre">**kwargs)()</span></tt>, applies the given view to the entity
(and returns an unicode string)</li>
<li><tt class="xref py py-meth docutils literal"><span class="pre">absolute_url(*args,</span> <span class="pre">**kwargs)()</span></tt>, returns an absolute URL including the base-url</li>
<li><tt class="xref py py-meth docutils literal"><span class="pre">rest_path()</span></tt>, returns a relative REST URL to get the entity</li>
<li><tt class="xref py py-meth docutils literal"><span class="pre">printable_value(attr,</span> <span class="pre">value=_marker,</span> <span class="pre">attrtype=None,</span> <span class="pre">format='text/html',</span> <span class="pre">displaytime=True)()</span></tt>,
returns a string enabling the display of an attribute value in a given format
(the value is automatically recovered if necessary)</li>
</ul>
<p><cite>Data handling</cite>:</p>
<ul class="simple">
<li><tt class="xref py py-meth docutils literal"><span class="pre">as_rset()</span></tt>, converts the entity into an equivalent result set simulating the
request <cite>Any X WHERE X eid _eid_</cite></li>
<li><tt class="xref py py-meth docutils literal"><span class="pre">complete(skip_bytes=True)()</span></tt>, executes a request that recovers at
once all the missing attributes of an entity</li>
<li><tt class="xref py py-meth docutils literal"><span class="pre">get_value(name)()</span></tt>, returns the value associated to the attribute name given
in parameter</li>
<li><tt class="xref py py-meth docutils literal"><span class="pre">related(rtype,</span> <span class="pre">role='subject',</span> <span class="pre">limit=None,</span> <span class="pre">entities=False)()</span></tt>,
returns a list of entities related to the current entity by the
relation given in parameter</li>
<li><tt class="xref py py-meth docutils literal"><span class="pre">unrelated(rtype,</span> <span class="pre">targettype,</span> <span class="pre">role='subject',</span> <span class="pre">limit=None)()</span></tt>,
returns a result set corresponding to the entities not (yet)
related to the current entity by the relation given in parameter
and satisfying its constraints</li>
<li><tt class="xref py py-meth docutils literal"><span class="pre">cw_set(**kwargs)()</span></tt>, updates entity&#8217;s attributes and/or relation with the
corresponding values given named parameters. To set a relation where this
entity is the object of the relation, use <cite>reverse_&lt;relation&gt;</cite> as argument
name.  Values may be an entity, a list of entities, or None (meaning that all
relations of the given type from or to this object should be deleted).</li>
<li><tt class="xref py py-meth docutils literal"><span class="pre">copy_relations(ceid)()</span></tt>, copies the relations of the entities having the eid
given in the parameters on the current entity</li>
<li><tt class="xref py py-meth docutils literal"><span class="pre">cw_delete()</span></tt> allows to delete the entity</li>
</ul>
</div>
<div class="section" id="the-anyentity-class">
<h1>4.2. The <tt class="xref py py-class docutils literal"><span class="pre">AnyEntity</span></tt> class<a class="headerlink" href="#the-anyentity-class" title="Permalink to this headline">¶</a></h1>
<p>To provide a specific behavior for each entity, we can define a class
inheriting from <cite>cubicweb.entities.AnyEntity</cite>. In general, we define this class
in <cite>mycube.entities</cite> module (or in a submodule if we want to split code among
multiple files) so that it will be available on both server and client side.</p>
<p>The class <cite>AnyEntity</cite> is a sub-class of Entity that add methods to it,
and helps specializing (by further subclassing) the handling of a
given entity type.</p>
<p>Most methods defined for <cite>AnyEntity</cite>, in addition to <cite>Entity</cite>, add
support for the <a class="reference external" href="http://dublincore.org/">Dublin Core</a> metadata.</p>
<p><cite>Standard meta-data (Dublin Core)</cite>:</p>
<ul class="simple">
<li><tt class="xref py py-meth docutils literal"><span class="pre">dc_title()</span></tt>, returns a unicode string corresponding to the
meta-data <cite>Title</cite> (used by default is the first non-meta attribute
of the entity schema)</li>
<li><tt class="xref py py-meth docutils literal"><span class="pre">dc_long_title()</span></tt>, same as dc_title but can return a more
detailed title</li>
<li><tt class="xref py py-meth docutils literal"><span class="pre">dc_description(format='text/plain')()</span></tt>, returns a unicode string
corresponding to the meta-data <cite>Description</cite> (looks for a
description attribute by default)</li>
<li><tt class="xref py py-meth docutils literal"><span class="pre">dc_authors()</span></tt>, returns a unicode string corresponding to the meta-data
<cite>Authors</cite> (owners by default)</li>
<li><tt class="xref py py-meth docutils literal"><span class="pre">dc_creator()</span></tt>, returns a unicode string corresponding to the
creator of the entity</li>
<li><tt class="xref py py-meth docutils literal"><span class="pre">dc_date(date_format=None)()</span></tt>, returns a unicode string corresponding to
the meta-data <cite>Date</cite> (update date by default)</li>
<li><tt class="xref py py-meth docutils literal"><span class="pre">dc_type(form='')()</span></tt>, returns a string to display the entity type by
specifying the preferred form (<cite>plural</cite> for a plural form)</li>
<li><tt class="xref py py-meth docutils literal"><span class="pre">dc_language()</span></tt>, returns the language used by the entity</li>
</ul>
</div>
<div class="section" id="inheritance">
<h1>4.3. Inheritance<a class="headerlink" href="#inheritance" title="Permalink to this headline">¶</a></h1>
<p>When describing a data model, entities can inherit from other entities as is
common in object-oriented programming.</p>
<p>You have the possibility to redefine whatever pleases you, as follow:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">cubes.OTHER_CUBE</span> <span class="kn">import</span> <span class="n">entities</span>

<span class="k">class</span> <span class="nc">EntityExample</span><span class="p">(</span><span class="n">entities</span><span class="o">.</span><span class="n">EntityExample</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">dc_long_title</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> (</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
</pre></div>
</div>
<p>The most specific entity definition will always the one used by the
ORM. For instance, the new EntityExample above in mycube replaces the
one in OTHER_CUBE. These types are stored in the <cite>etype</cite> section of
the <cite>vregistry</cite>.</p>
<p>Notice this is different than yams schema inheritance, which is an
experimental undocumented feature.</p>
</div>
<div class="section" id="application-logic">
<h1>4.4. Application logic<a class="headerlink" href="#application-logic" title="Permalink to this headline">¶</a></h1>
<p>While a lot of custom behaviour and application logic can be
implemented using entity classes, the programmer must be aware that
adding new attributes and method on an entity class adds may shadow
schema-level attribute or relation definitions.</p>
<p>To keep entities clean (mostly data structures plus a few universal
methods such as listed above), one should use <cite>adapters</cite> (see
<a class="reference internal" href="adapters.html#adapters"><em>Interfaces and Adapters</em></a>).</p>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="load-sort.html" title="4.5. Loaded attributes and default sorting management"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="4. Data as objects"
             >previous</a> |</li>
        <li><a href="../../index.html">CubicWeb 3.18.3</a> &raquo;</li>
          <li><a href="../index.html" >Repository development</a> &raquo;</li>
          <li><a href="index.html" >4. Data as objects</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2001-2014, Logilab.
      Last updated on Mar 11, 2014.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>