
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>10. Working with a distributed client (using Pyro) &mdash; CubicWeb 3.18.3</title>
    
    <link rel="stylesheet" href="../_static/lglb-sphinx-doc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.18.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="CubicWeb 3.18.3" href="../index.html" />
    <link rel="up" title="Administration" href="index.html" />
    <link rel="next" title="11. Migrating cubicweb instances - benefits from a distributed architecture" href="migration.html" />
    <link rel="prev" title="9. LDAP integration" href="ldap.html" /> 
  </head>
  <body>
<div class="header">
 <a href="http://www.cubicweb.org">
  <img alt="cubicweb logo" src="../_static/cubicweb.png"/>
 </a>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="migration.html" title="11. Migrating cubicweb instances - benefits from a distributed architecture"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ldap.html" title="9. LDAP integration"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">CubicWeb 3.18.3</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Administration</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">10. Working with a distributed client (using Pyro)</a><ul>
<li><a class="reference internal" href="#prerequisites">10.1. Prerequisites</a></li>
<li><a class="reference internal" href="#connect-to-the-cubicweb-repository-from-a-python-script">10.2. Connect to the CubicWeb repository from a python script</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="ldap.html"
                        title="previous chapter">9. LDAP integration</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="migration.html"
                        title="next chapter">11. Migrating cubicweb instances - benefits from a distributed architecture</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/admin/pyro.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="working-with-a-distributed-client-using-pyro">
<span id="usingpyro"></span><h1>10. Working with a distributed client (using Pyro)<a class="headerlink" href="#working-with-a-distributed-client-using-pyro" title="Permalink to this headline">¶</a></h1>
<p>In some circumstances, it is practical to split the repository and
web-client parts of the application for load-balancing reasons. Or
one wants to access the repository from independant scripts to consult
or update the database.</p>
<div class="section" id="prerequisites">
<h2>10.1. Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>For this to work, several steps have to be taken in order.</p>
<p>You must first ensure that the appropriate software is installed and
running (see <a class="reference internal" href="config.html#configenv"><em>Set-up of a CubicWeb environment</em></a>):</p>
<div class="highlight-python"><pre>pyro-nsd -x -p 6969</pre>
</div>
<p>Then you have to set appropriate options in your configuration. For
instance:</p>
<div class="highlight-python"><pre>pyro-server=yes
pyro-ns-host=localhost:6969

pyro-instance-id=myinstancename</pre>
</div>
</div>
<div class="section" id="connect-to-the-cubicweb-repository-from-a-python-script">
<h2>10.2. Connect to the CubicWeb repository from a python script<a class="headerlink" href="#connect-to-the-cubicweb-repository-from-a-python-script" title="Permalink to this headline">¶</a></h2>
<p>Assuming pyro-nsd is running and your instance is configured with <tt class="docutils literal"><span class="pre">pyro-server=yes</span></tt>,
you will be able to use <tt class="xref py py-mod docutils literal"><span class="pre">cubicweb.dbapi</span></tt> api to initiate the connection.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Regardless of whether your instance is pyro activated or not, you can still
achieve this by using cubicweb-ctl shell scripts in a simpler way, as by default
it creates a repository &#8216;in-memory&#8217; instead of connecting through pyro. That
also means you&#8217;ve to be on the host where the instance is running.</p>
</div>
<p>Finally, the client (for instance a python script) must connect specifically
as in the following example code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">cubicweb</span> <span class="kn">import</span> <span class="n">dbapi</span>

<span class="n">cnx</span> <span class="o">=</span> <span class="n">dbapi</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">database</span><span class="o">=</span><span class="s">&#39;instance-id&#39;</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s">&#39;admin&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&#39;admin&#39;</span><span class="p">)</span>
<span class="n">cnx</span><span class="o">.</span><span class="n">load_appobjects</span><span class="p">()</span>
<span class="n">cur</span> <span class="o">=</span> <span class="n">cnx</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">(</span><span class="s">u&#39;Personal&#39;</span><span class="p">,</span> <span class="s">u&#39;Professional&#39;</span><span class="p">,</span> <span class="s">u&#39;Computers&#39;</span><span class="p">):</span>
    <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;INSERT Tag T: T name </span><span class="si">%(n)s</span><span class="s">&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;n&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">})</span>
<span class="n">cnx</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</div>
<p>Calling <tt class="xref py py-meth docutils literal"><span class="pre">cubicweb.dbapi.load_appobjects()</span></tt>, will populate the
cubicweb registries (see <a class="reference internal" href="../intro/concepts.html#vregistryintro"><em>Registries and application objects</em></a>) with the application
objects installed on the host where the script runs. You&#8217;ll then be
allowed to use the ORM goodies and custom entity methods and views. Of
course this is optional, without it you can still get the repository
data through the connection but in a roughly way: only RQL cursors
will be available, e.g. you can&#8217;t even build entity objects from the
result set.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="migration.html" title="11. Migrating cubicweb instances - benefits from a distributed architecture"
             >next</a> |</li>
        <li class="right" >
          <a href="ldap.html" title="9. LDAP integration"
             >previous</a> |</li>
        <li><a href="../index.html">CubicWeb 3.18.3</a> &raquo;</li>
          <li><a href="index.html" >Administration</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2001-2014, Logilab.
      Last updated on Mar 11, 2014.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>