
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>3. Use Windmill with CubicWeb &mdash; CubicWeb 3.18.3</title>
    
    <link rel="stylesheet" href="../../_static/lglb-sphinx-doc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '3.18.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="CubicWeb 3.18.3" href="../../index.html" />
    <link rel="up" title="Tutorials" href="../index.html" />
    <link rel="next" title="4. Writing text reports with RestructuredText" href="../textreports/index.html" />
    <link rel="prev" title="2.1.5. Building my photos web site with CubicWeb part V: let’s make it even more user friendly" href="../advanced/part05_ui-advanced.html" /> 
  </head>
  <body>
<div class="header">
 <a href="http://www.cubicweb.org">
  <img alt="cubicweb logo" src="../../_static/cubicweb.png"/>
 </a>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../textreports/index.html" title="4. Writing text reports with RestructuredText"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../advanced/part05_ui-advanced.html" title="2.1.5. Building my photos web site with CubicWeb part V: let’s make it even more user friendly"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">CubicWeb 3.18.3</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Tutorials</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">3. Use Windmill with CubicWeb</a><ul>
<li><a class="reference internal" href="#installation">3.1. Installation</a><ul>
<li><a class="reference internal" href="#id1">3.1.1. Windmill</a></li>
<li><a class="reference internal" href="#x-dummy">3.1.2. X dummy</a></li>
</ul>
</li>
<li><a class="reference internal" href="#windmill-usage">3.2. Windmill usage</a><ul>
<li><a class="reference internal" href="#record-your-use-case">3.2.1. Record your use case</a></li>
</ul>
</li>
<li><a class="reference internal" href="#integrate-windmill-tests-into-cubicweb">3.3. Integrate Windmill tests into CubicWeb</a><ul>
<li><a class="reference internal" href="#set-environment">3.3.1. Set environment</a></li>
<li><a class="reference internal" href="#run-your-tests">3.3.2. Run your tests</a></li>
<li><a class="reference internal" href="#edit-your-tests">3.3.3. Edit your tests</a></li>
<li><a class="reference internal" href="#best-practises">3.3.4. Best practises</a></li>
</ul>
</li>
<li><a class="reference internal" href="#caveats">3.4. Caveats</a><ul>
<li><a class="reference internal" href="#file-upload">3.4.1. File Upload</a></li>
</ul>
</li>
<li><a class="reference internal" href="#preferences">3.5. Preferences</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../advanced/part05_ui-advanced.html"
                        title="previous chapter">2.1.5. Building my photos web site with <em>CubicWeb</em> part V: let&#8217;s make it even more user friendly</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../textreports/index.html"
                        title="next chapter">4. Writing text reports with RestructuredText</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/tutorials/tools/windmill.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="use-windmill-with-cubicweb">
<h1>3. Use Windmill with CubicWeb<a class="headerlink" href="#use-windmill-with-cubicweb" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="http://www.getwindmill.com/">Windmill</a> implements cross browser testing, in-browser recording and playback,
and functionality for fast accurate debugging and test environment integration.</p>
<p><a class="reference external" href="http://www.getwindmill.com/features">Online features list</a> is available.</p>
<div class="section" id="installation">
<h2>3.1. Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id1">
<h3>3.1.1. Windmill<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>You have to install Windmill manually for now. If you&#8217;re using Debian, there is
no binary package (<a class="reference external" href="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=579109">yet</a>).</p>
<p>The simplest solution is to use a <em>setuptools/pip</em> command (for a clean
environment, take a look to the <a class="reference external" href="http://pypi.python.org/pypi/virtualenv">virtualenv</a> project as well):</p>
<div class="highlight-python"><pre>$ pip install windmill
$ curl -O http://github.com/windmill/windmill/tarball/master</pre>
</div>
<p>However, the Windmill project doesn&#8217;t release frequently. Our recommandation is
to used the last snapshot of the Git repository:</p>
<div class="highlight-python"><pre>$ git clone git://github.com/windmill/windmill.git HEAD
$ cd windmill
$ python setup.py develop</pre>
</div>
<p>Install instructions are <a class="reference external" href="http://wiki.github.com/windmill/windmill/installing">available</a>.</p>
<p>Be sure to have the windmill module in your PYTHONPATH afterwards:</p>
<div class="highlight-python"><pre>$ python -c "import windmill"</pre>
</div>
</div>
<div class="section" id="x-dummy">
<h3>3.1.2. X dummy<a class="headerlink" href="#x-dummy" title="Permalink to this headline">¶</a></h3>
<p>In order to reduce unecessary system load from your test machines, It&#8217;s
recommended to use X dummy server for testing the Unix web clients, you need a
dummy video X driver (as xserver-xorg-video-dummy package in Debian) coupled
with a light X server as <a class="reference external" href="http://en.wikipedia.org/wiki/Xvfb">Xvfb</a>.</p>
<blockquote>
<div><p>The dummy driver is a special driver available with the XFree86 DDX. To use
the dummy driver, simply substitue it for your normal card driver in the
Device section of your xorg.conf configuration file. For example, if you
normally uses an ati driver, then you will have a Device section with
Driver &#8220;ati&#8221; to let the X server know that you want it to load and use the
ati driver; however, for these conformance tests, you would change that
line to Driver &#8220;dummy&#8221; and remove any other ati specific options from the
Device section.</p>
<p><em>From: http://www.x.org/wiki/XorgTesting</em></p>
</div></blockquote>
<p>Then, you can run the X server with the following command</p>
<div class="highlight-python"><pre>$ /usr/bin/X11/Xvfb :1 -ac -screen 0 1280x1024x8 -fbdir /tmp</pre>
</div>
</div>
</div>
<div class="section" id="windmill-usage">
<h2>3.2. Windmill usage<a class="headerlink" href="#windmill-usage" title="Permalink to this headline">¶</a></h2>
<div class="section" id="record-your-use-case">
<h3>3.2.1. Record your use case<a class="headerlink" href="#record-your-use-case" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>start your instance manually</li>
<li>start <a class="reference external" href="http://www.getwindmill.com/">Windmill</a> with url site as last argument (read <a class="reference external" href="http://wiki.github.com/windmill/windmill/running-tests">Usage</a> or use <em>&#8216;-h&#8217;</em>
option to find required command line arguments)</li>
<li>use the record button</li>
<li>click on save to obtain python code of your use case</li>
<li>copy the content to a new file in a <em>windmill</em> directory</li>
</ul>
<p>If you are using firefox as client, consider the &#8220;firebug&#8221; option.</p>
<p>If you have a running instance, you can refine the test by the <em>loadtest</em> windmill option:</p>
<div class="highlight-python"><pre>$ windmill -m firebug loadtest=&lt;test_file.py&gt; &lt;instance url&gt;</pre>
</div>
<p>Or use the internal windmill shell to explore available commands:</p>
<div class="highlight-python"><pre>$ windmill -m firebug shell &lt;instance url&gt;</pre>
</div>
<p>And enter python commands:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">load_test</span><span class="p">(</span><span class="o">&lt;</span><span class="n">your</span> <span class="n">test</span> <span class="nb">file</span><span class="o">&gt;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">run_test</span><span class="p">(</span><span class="o">&lt;</span><span class="n">your</span> <span class="n">test</span> <span class="nb">file</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="integrate-windmill-tests-into-cubicweb">
<h2>3.3. Integrate Windmill tests into CubicWeb<a class="headerlink" href="#integrate-windmill-tests-into-cubicweb" title="Permalink to this headline">¶</a></h2>
<div class="section" id="set-environment">
<h3>3.3.1. Set environment<a class="headerlink" href="#set-environment" title="Permalink to this headline">¶</a></h3>
<p>You have to create a new unit test file and a <cite>windmill</cite> directory and copy all
your windmill use case into it.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># test_windmill.py</span>

<span class="c"># Run all scenarii found in windmill directory</span>
<span class="kn">from</span> <span class="nn">cubicweb.devtools.cwwindmill</span> <span class="kn">import</span> <span class="p">(</span><span class="n">CubicWebWindmillUseCase</span><span class="p">,</span>
                                          <span class="n">unittest_main</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">unittest_main</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="run-your-tests">
<h3>3.3.2. Run your tests<a class="headerlink" href="#run-your-tests" title="Permalink to this headline">¶</a></h3>
<p>You can easily run your windmill test suite through <cite>pytest</cite> or <tt class="xref py py-mod docutils literal"><span class="pre">unittest</span></tt>.
You have to copy a <em>test_windmill.py</em> file from <tt class="xref py py-mod docutils literal"><span class="pre">web.test</span></tt>.</p>
<p>To run your test series:</p>
<div class="highlight-python"><pre>$ pytest test/test_windmill.py</pre>
</div>
<p>By default, CubicWeb will use <strong>firefox</strong> as the default browser and will try
to run test instance server on localhost. In the general case, You&#8217;ve no need
to change anything.</p>
<p>Check <tt class="xref py py-class docutils literal"><span class="pre">cubicweb.devtools.cwwindmill.CubicWebWindmillUseCase</span></tt> for
Windmill configuration. You can edit windmill settings with following class attributes:</p>
<ul class="simple">
<li>browser
identification string (firefox|ie|safari|chrome) (firefox by default)</li>
<li>test_dir
testing file path or directory (windmill directory under your unit case
file by default)</li>
<li>edit_test
load and edit test for debugging (False by default)</li>
</ul>
<p>Examples:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">browser</span> <span class="o">=</span> <span class="s">&#39;firefox&#39;</span>
<span class="n">test_dir</span> <span class="o">=</span> <span class="n">osp</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">__file__</span><span class="p">,</span> <span class="s">&#39;windmill&#39;</span><span class="p">)</span>
<span class="n">edit_test</span> <span class="o">=</span> <span class="bp">False</span>
</pre></div>
</div>
<p>If you want to change cubicweb test server parameters, you can check class
variables from <tt class="xref py py-class docutils literal"><span class="pre">CubicWebServerConfig</span></tt> or inherit it with overriding the
<tt class="xref py py-attr docutils literal"><span class="pre">configcls</span></tt> attribute in <tt class="xref py py-class docutils literal"><span class="pre">CubicWebServerTC</span></tt></p>
<div class="highlight-python"><pre>.. sourcecode:: python</pre>
</div>
<blockquote>
<div><dl class="docutils">
<dt>class OtherCubicWebServerConfig(CubicWebServerConfig):</dt>
<dd>port = 9999</dd>
<dt>class NewCubicWebServerTC(CubicWebServerTC):</dt>
<dd>configcls = OtherCubicWebServerConfig</dd>
</dl>
</div></blockquote>
<p>For instance, CubicWeb framework windmill tests can be manually run by:</p>
<div class="highlight-python"><pre>$ pytest web/test/test_windmill.py</pre>
</div>
</div>
<div class="section" id="edit-your-tests">
<h3>3.3.3. Edit your tests<a class="headerlink" href="#edit-your-tests" title="Permalink to this headline">¶</a></h3>
<p>You can toggle the <cite>edit_test</cite> variable to enable test edition.</p>
<p>But if you are using <cite>pytest</cite> as test runner, use the <cite>-i</cite> option directly.
The test series will be loaded and you can run assertions step-by-step:</p>
<div class="highlight-python"><pre>$ pytest -i test/test_windmill.py</pre>
</div>
<p>In this case, the <cite>firebug</cite> extension will be loaded automatically for you.</p>
<p>Afterwards, don&#8217;t forget to save your edited test into the right file (no autosave feature).</p>
</div>
<div class="section" id="best-practises">
<h3>3.3.4. Best practises<a class="headerlink" href="#best-practises" title="Permalink to this headline">¶</a></h3>
<p>Don&#8217;t run another instance on the same port. You risk to silence some
regressions (test runner will automatically fail in further versions).</p>
<p>Start your use case by using an assert on the expected primary url page.
Otherwise all your tests could fail without clear explanation of the used
navigation.</p>
<p>In the same location of the <em>test_windmill.py</em>, create a <em>windmill/</em> with your
windmill recorded use cases.</p>
</div>
</div>
<div class="section" id="caveats">
<h2>3.4. Caveats<a class="headerlink" href="#caveats" title="Permalink to this headline">¶</a></h2>
<div class="section" id="file-upload">
<h3>3.4.1. File Upload<a class="headerlink" href="#file-upload" title="Permalink to this headline">¶</a></h3>
<p>Windmill can&#8217;t do file uploads. This is a limitation of browser Javascript
support / sandboxing, not of Windmill per se.  It would be nice if there were
some command that would prime the Windmill HTTP proxy to add a particular file
to the next HTTP request that comes through, so that uploads could at least be
faked.</p>
</div>
</div>
<div class="section" id="preferences">
<h2>3.5. Preferences<a class="headerlink" href="#preferences" title="Permalink to this headline">¶</a></h2>
<p>A <em>.windmill/prefs.py</em> could be used to redefine default configuration values.</p>
<p>For managing browser extensions, read <a class="reference external" href="http://wiki.github.com/windmill/windmill/advanced-topics">advanced topic chapter</a>.</p>
<p>More configuration examples could be seen in <em>windmill/conf/global_settings.py</em>
as template.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../textreports/index.html" title="4. Writing text reports with RestructuredText"
             >next</a> |</li>
        <li class="right" >
          <a href="../advanced/part05_ui-advanced.html" title="2.1.5. Building my photos web site with CubicWeb part V: let’s make it even more user friendly"
             >previous</a> |</li>
        <li><a href="../../index.html">CubicWeb 3.18.3</a> &raquo;</li>
          <li><a href="../index.html" >Tutorials</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2001-2014, Logilab.
      Last updated on Mar 11, 2014.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>