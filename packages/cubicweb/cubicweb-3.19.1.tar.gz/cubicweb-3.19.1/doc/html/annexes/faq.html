
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>1. Frequently Asked Questions (FAQ) &mdash; CubicWeb 3.18.3</title>
    
    <link rel="stylesheet" href="../_static/lglb-sphinx-doc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.18.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="CubicWeb 3.18.3" href="../index.html" />
    <link rel="up" title="Appendixes" href="index.html" />
    <link rel="next" title="2. Relation Query Language (RQL)" href="rql/index.html" />
    <link rel="prev" title="Appendixes" href="index.html" /> 
  </head>
  <body>
<div class="header">
 <a href="http://www.cubicweb.org">
  <img alt="cubicweb logo" src="../_static/cubicweb.png"/>
 </a>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="rql/index.html" title="2. Relation Query Language (RQL)"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Appendixes"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">CubicWeb 3.18.3</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Appendixes</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">1. Frequently Asked Questions (FAQ)</a><ul>
<li><a class="reference internal" href="#generalities">1.1. Generalities</a><ul>
<li><a class="reference internal" href="#why-do-you-use-the-lgpl-license-to-prevent-me-from-doing-x">1.1.1. Why do you use the LGPL license to prevent me from doing X ?</a></li>
<li><a class="reference internal" href="#why-does-not-cubicweb-have-a-template-language">1.1.2. Why does not CubicWeb have a template language ?</a></li>
<li><a class="reference internal" href="#why-do-you-think-using-pure-python-is-better-than-using-a-template-language">1.1.3. Why do you think using pure python is better than using a template language ?</a></li>
<li><a class="reference internal" href="#cubicweb-looks-pretty-recent-is-it-stable">1.1.4. CubicWeb looks pretty recent. Is it stable ?</a></li>
<li><a class="reference internal" href="#why-is-the-rql-query-language-looking-similar-to-x">1.1.5. Why is the RQL query language looking similar to X ?</a></li>
<li><a class="reference internal" href="#which-ajax-library-is-cubicweb-using">1.1.6. Which ajax library is CubicWeb using ?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#development">1.2. Development</a><ul>
<li><a class="reference internal" href="#how-to-change-the-instance-logo">1.2.1. How to change the instance logo ?</a></li>
<li><a class="reference internal" href="#how-to-create-an-anonymous-user">1.2.2. How to create an anonymous user ?</a></li>
<li><a class="reference internal" href="#how-to-load-data-from-a-python-script">1.2.3. How to load data from a python script ?</a></li>
<li><a class="reference internal" href="#how-to-format-an-entity-date-attribute">1.2.4. How to format an entity date attribute ?</a></li>
<li><a class="reference internal" href="#how-to-update-a-database-after-a-schema-modification">1.2.5. How to update a database after a schema modification ?</a></li>
<li><a class="reference internal" href="#i-get-noselectableobject-exceptions-how-do-i-debug-selectors">1.2.6. I get <cite>NoSelectableObject</cite> exceptions, how do I debug selectors ?</a></li>
<li><a class="reference internal" href="#i-get-database-is-locked-when-executing-tests">1.2.7. I get &#8220;database is locked&#8221; when executing tests</a></li>
<li><a class="reference internal" href="#what-are-hooks-used-for">1.2.8. What are hooks used for ?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configuration">1.3. Configuration</a><ul>
<li><a class="reference internal" href="#how-to-configure-a-ldap-source">1.3.1. How to configure a LDAP source ?</a></li>
<li><a class="reference internal" href="#how-to-import-ldap-users-in-cubicweb">1.3.2. How to import LDAP users in <em>CubicWeb</em> ?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#security">1.4. Security</a><ul>
<li><a class="reference internal" href="#how-to-reset-the-password-for-user-joe">1.4.1. How to reset the password for user joe ?</a></li>
<li><a class="reference internal" href="#i-ve-just-created-a-user-in-a-group-and-it-doesn-t-work">1.4.2. I&#8217;ve just created a user in a group and it doesn&#8217;t work !</a></li>
<li><a class="reference internal" href="#how-is-security-implemented">1.4.3. How is security implemented ?</a></li>
<li><a class="reference internal" href="#is-it-possible-to-bypass-security-from-the-ui-web-front-part">1.4.4. Is it possible to bypass security from the UI (web front) part ?</a></li>
<li><a class="reference internal" href="#can-postgresql-and-cubicweb-authentication-work-with-kerberos">1.4.5. Can PostgreSQL and CubicWeb authentication work with kerberos ?</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Appendixes</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="rql/index.html"
                        title="next chapter">2. Relation Query Language (RQL)</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/annexes/faq.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="frequently-asked-questions-faq">
<h1>1. Frequently Asked Questions (FAQ)<a class="headerlink" href="#frequently-asked-questions-faq" title="Permalink to this headline">¶</a></h1>
<div class="section" id="generalities">
<h2>1.1. Generalities<a class="headerlink" href="#generalities" title="Permalink to this headline">¶</a></h2>
<div class="section" id="why-do-you-use-the-lgpl-license-to-prevent-me-from-doing-x">
<h3>1.1.1. Why do you use the LGPL license to prevent me from doing X ?<a class="headerlink" href="#why-do-you-use-the-lgpl-license-to-prevent-me-from-doing-x" title="Permalink to this headline">¶</a></h3>
<p>LGPL means that <em>if</em> you redistribute your application, you need to
redistribute the changes you made to CubicWeb under the LGPL licence.</p>
<p>Publishing a web site has nothing to do with redistributing source
code according to the terms of the LGPL. A fair amount of companies
use modified LGPL code for internal use. And someone could publish a
<em>CubicWeb</em> component under a BSD licence for others to plug into a
LGPL framework without any problem. The only thing we are trying to
prevent here is someone taking the framework and packaging it as
closed source to his own clients.</p>
</div>
<div class="section" id="why-does-not-cubicweb-have-a-template-language">
<h3>1.1.2. Why does not CubicWeb have a template language ?<a class="headerlink" href="#why-does-not-cubicweb-have-a-template-language" title="Permalink to this headline">¶</a></h3>
<p>There are enough template languages out there. You can use your
preferred template language if you want. [explain how to use a
template language]</p>
<p><em>CubicWeb</em> does not define its own templating language as this was
not our goal. Based on our experience, we realized that
we could gain productivity by letting designers use design tools
and developpers develop without the use of the templating language
as an intermediary that could not be anyway efficient for both parties.
Python is the templating language that we use in <em>CubicWeb</em>, but again,
it does not prevent you from using a templating language.</p>
<p>Moreover, CubicWeb currently supports <a class="reference external" href="http://www.owlfish.com/software/simpleTAL/">simpletal</a> out of the box and
it is also possible to use the <a class="reference external" href="http://www.cubicweb.org/project/cwtags">cwtags</a> library to build html trees
using the <a class="reference external" href="http://www.python.org/dev/peps/pep-0343/">with statement</a> with more comfort than raw strings.</p>
</div>
<div class="section" id="why-do-you-think-using-pure-python-is-better-than-using-a-template-language">
<h3>1.1.3. Why do you think using pure python is better than using a template language ?<a class="headerlink" href="#why-do-you-think-using-pure-python-is-better-than-using-a-template-language" title="Permalink to this headline">¶</a></h3>
<p>Python is an Object Oriented Programming language and as such it
already provides a consistent and strong architecture and syntax
a templating language would not reach.</p>
<p>Using Python instead of a template langage for describing the user interface
makes it to maintain with real functions/classes/contexts without the need of
learning a new dialect. By using Python, we use standard OOP techniques and
this is a key factor in a robust application.</p>
</div>
<div class="section" id="cubicweb-looks-pretty-recent-is-it-stable">
<h3>1.1.4. CubicWeb looks pretty recent. Is it stable ?<a class="headerlink" href="#cubicweb-looks-pretty-recent-is-it-stable" title="Permalink to this headline">¶</a></h3>
<p>It is constantly evolving, piece by piece.  The framework has evolved since
2001 and data has been migrated from one schema to the other ever since. There
is a well-defined way to handle data and schema migration.</p>
<p>You can see the roadmap there:
<a class="reference external" href="http://www.cubicweb.org/project/cubicweb?tab=projectroadmap_tab">http://www.cubicweb.org/project/cubicweb?tab=projectroadmap_tab</a>.</p>
</div>
<div class="section" id="why-is-the-rql-query-language-looking-similar-to-x">
<h3>1.1.5. Why is the RQL query language looking similar to X ?<a class="headerlink" href="#why-is-the-rql-query-language-looking-similar-to-x" title="Permalink to this headline">¶</a></h3>
<p>It may remind you of SQL but it is higher level than SQL, more like
SPARQL. Except that SPARQL did not exist when we started the project.
With version 3.4, CubicWeb has support for SPARQL.</p>
<p>The RQL language is what is going to make a difference with django-
like frameworks for several reasons.</p>
<ol class="arabic simple">
<li>accessing data is <em>much</em> easier with it. One can write complex
queries with RQL that would be tedious to define and hard to maintain
using an object/filter suite of method calls.</li>
<li>it offers an abstraction layer allowing your applications to run
on multiple back-ends. That means not only various SQL backends
(postgresql, sqlite, mysql), but also multiple databases at the
same time, and also non-SQL data stores like LDAP directories and
subversion/mercurial repositories (see the <cite>vcsfile</cite>
component). Google App Engine is yet another supported target for
RQL.</li>
</ol>
</div>
<div class="section" id="which-ajax-library-is-cubicweb-using">
<h3>1.1.6. Which ajax library is CubicWeb using ?<a class="headerlink" href="#which-ajax-library-is-cubicweb-using" title="Permalink to this headline">¶</a></h3>
<p>CubicWeb uses <a class="reference external" href="http://jquery.com">jQuery</a> and provides a few helpers on top of that. Additionally,
some jQuery plugins are provided (some are provided in specific cubes).</p>
</div>
</div>
<div class="section" id="development">
<h2>1.2. Development<a class="headerlink" href="#development" title="Permalink to this headline">¶</a></h2>
<div class="section" id="how-to-change-the-instance-logo">
<h3>1.2.1. How to change the instance logo ?<a class="headerlink" href="#how-to-change-the-instance-logo" title="Permalink to this headline">¶</a></h3>
<p>There are two ways of changing the logo.</p>
<ol class="arabic">
<li><p class="first">The easiest way to use a different logo is to replace the existing
<tt class="docutils literal"><span class="pre">logo.png</span></tt> in <tt class="docutils literal"><span class="pre">myapp/data</span></tt> by your prefered icon and refresh.
By default all instance will look for a <tt class="docutils literal"><span class="pre">logo.png</span></tt> to be
rendered in the logo section.</p>
<img alt="../_images/lax-book_06-main-template-logo_en.png" src="../_images/lax-book_06-main-template-logo_en.png" />
</li>
<li><p class="first">In your cube directory, you can specify which file to use for the logo.
This is configurable in <tt class="docutils literal"><span class="pre">mycube/uiprops.py</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">LOGO</span> <span class="o">=</span> <span class="n">data</span><span class="p">(</span><span class="s">&#39;mylogo.gif&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">mylogo.gif</span></tt> is in <tt class="docutils literal"><span class="pre">mycube/data</span></tt> directory.</p>
</li>
</ol>
</div>
<div class="section" id="how-to-create-an-anonymous-user">
<h3>1.2.2. How to create an anonymous user ?<a class="headerlink" href="#how-to-create-an-anonymous-user" title="Permalink to this headline">¶</a></h3>
<p>This allows to browse the site without being authenticated. In the
<tt class="docutils literal"><span class="pre">all-in-one.conf</span></tt> file of your instance, define the anonymous user
as follows</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># login of the CubicWeb user account to use for anonymous user (if you want to</span>
<span class="c"># allow anonymous)</span>
<span class="n">anonymous</span><span class="o">-</span><span class="n">user</span><span class="o">=</span><span class="n">anon</span>

<span class="c"># password of the CubicWeb user account matching login</span>
<span class="n">anonymous</span><span class="o">-</span><span class="n">password</span><span class="o">=</span><span class="n">anon</span>
</pre></div>
</div>
<p>You also must ensure that this <cite>anon</cite> user is a registered user of
the DB backend. If not, you can create through the administation
interface of your instance by adding a user with in the group <cite>guests</cite>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">While creating a new instance, you can decide to allow access
to anonymous user, which will automatically execute what is
decribed above.</p>
</div>
</div>
<div class="section" id="how-to-load-data-from-a-python-script">
<h3>1.2.3. How to load data from a python script ?<a class="headerlink" href="#how-to-load-data-from-a-python-script" title="Permalink to this headline">¶</a></h3>
<p>Please, refer to <a class="reference internal" href="../admin/pyro.html#usingpyro"><em>Working with a distributed client (using Pyro)</em></a>.</p>
</div>
<div class="section" id="how-to-format-an-entity-date-attribute">
<h3>1.2.4. How to format an entity date attribute ?<a class="headerlink" href="#how-to-format-an-entity-date-attribute" title="Permalink to this headline">¶</a></h3>
<p>If your schema has an attribute of type <cite>Date</cite> or <cite>Datetime</cite>, you usually want to
format it when displaying it. First, you should define your preferred format
using the site configuration panel
<tt class="docutils literal"><span class="pre">http://appurl/view?vid=systempropertiesform</span></tt> and then set <tt class="docutils literal"><span class="pre">ui.date</span></tt> and/or
<tt class="docutils literal"><span class="pre">ui.datetime</span></tt>.  Then in the view code, use:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">entity</span><span class="o">.</span><span class="n">printable_value</span><span class="p">(</span><span class="n">date_attribute</span><span class="p">)</span>
</pre></div>
</div>
<p>which will always return a string whatever the attribute&#8217;s type (so it&#8217;s
recommended also for other attribute types). By default it expects to generate
HTML, so it deals with rich text formating, xml escaping...</p>
</div>
<div class="section" id="how-to-update-a-database-after-a-schema-modification">
<h3>1.2.5. How to update a database after a schema modification ?<a class="headerlink" href="#how-to-update-a-database-after-a-schema-modification" title="Permalink to this headline">¶</a></h3>
<p>It depends on what has been modified in the schema.</p>
<ul class="simple">
<li>update the permissions and properties of an entity or a relation:
<tt class="docutils literal"><span class="pre">sync_schema_props_perms('MyEntityOrRelation')</span></tt>.</li>
<li>add an attribute: <tt class="docutils literal"><span class="pre">add_attribute('MyEntityType',</span> <span class="pre">'myattr')</span></tt>.</li>
<li>add a relation: <tt class="docutils literal"><span class="pre">add_relation_definition('SubjRelation',</span> <span class="pre">'MyRelation',</span> <span class="pre">'ObjRelation')</span></tt>.</li>
</ul>
</div>
<div class="section" id="i-get-noselectableobject-exceptions-how-do-i-debug-selectors">
<h3>1.2.6. I get <cite>NoSelectableObject</cite> exceptions, how do I debug selectors ?<a class="headerlink" href="#i-get-noselectableobject-exceptions-how-do-i-debug-selectors" title="Permalink to this headline">¶</a></h3>
<p>You just need to put the appropriate context manager around view/component
selection. One standard place for components is in cubicweb/vregistry.py:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">possible_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;return an iterator on possible objects in this registry for the given</span>
<span class="sd">    context</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">logilab.common.registry</span> <span class="kn">import</span> <span class="n">traced_selection</span>
    <span class="k">with</span> <span class="n">traced_selection</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">appobjects</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_select_best</span><span class="p">(</span><span class="n">appobjects</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">NoSelectableObject</span><span class="p">:</span>
                <span class="k">continue</span>
</pre></div>
</div>
<p>Don&#8217;t forget the &#8216;from __future__ import with_statement&#8217; at the module
top-level if you&#8217;re using python 2.5.</p>
<p>This will yield additional WARNINGs, like this:</p>
<div class="highlight-python"><pre>2009-01-09 16:43:52 - (cubicweb.selectors) WARNING: selector one_line_rset returned 0 for &lt;class 'cubicweb.web.views.basecomponents.WFHistoryVComponent'&gt;</pre>
</div>
<p>For views, you can put this context in <cite>cubicweb/web/views/basecontrollers.py</cite> in
the <cite>ViewController</cite>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">_select_view_and_rset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rset</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">logilab.common.registry</span> <span class="kn">import</span> <span class="n">traced_selection</span>
        <span class="k">with</span> <span class="n">traced_selection</span><span class="p">():</span>
            <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cw</span><span class="o">.</span><span class="n">vreg</span><span class="p">[</span><span class="s">&#39;views&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">vid</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="n">rset</span><span class="o">=</span><span class="n">rset</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">ObjectNotFound</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&quot;the view </span><span class="si">%s</span><span class="s"> could not be found&quot;</span><span class="p">,</span> <span class="n">vid</span><span class="p">)</span>
        <span class="n">req</span><span class="o">.</span><span class="n">set_message</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;The view </span><span class="si">%s</span><span class="s"> could not be found&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="n">vid</span><span class="p">)</span>
        <span class="n">vid</span> <span class="o">=</span> <span class="n">vid_from_rset</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">rset</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cw</span><span class="o">.</span><span class="n">vreg</span><span class="o">.</span><span class="n">schema</span><span class="p">)</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cw</span><span class="o">.</span><span class="n">vreg</span><span class="p">[</span><span class="s">&#39;views&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">vid</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="n">rset</span><span class="o">=</span><span class="n">rset</span><span class="p">)</span>
    <span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="i-get-database-is-locked-when-executing-tests">
<h3>1.2.7. I get &#8220;database is locked&#8221; when executing tests<a class="headerlink" href="#i-get-database-is-locked-when-executing-tests" title="Permalink to this headline">¶</a></h3>
<p>If you have &#8220;database is locked&#8221; as error when you are executing security tests,
it is usually because commit or rollback are missing before login() calls.</p>
<p>You can also use a context manager, to avoid such errors, as described
here: <a class="reference internal" href="../devrepo/testing.html#securitytest"><em>Managing connections or users</em></a>.</p>
</div>
<div class="section" id="what-are-hooks-used-for">
<h3>1.2.8. What are hooks used for ?<a class="headerlink" href="#what-are-hooks-used-for" title="Permalink to this headline">¶</a></h3>
<p>Hooks are executed around (actually before or after) events.  The most common
events are data creation, update and deletion.  They permit additional constraint
checking (those not expressible at the schema level), pre and post computations
depending on data movements.</p>
<p>As such, they are a vital part of the framework.</p>
<p>Other kinds of hooks, called Operations, are available
for execution just before commit.</p>
<p>For more information, read <a class="reference internal" href="../devrepo/repo/hooks.html#hooks"><em>Hooks and Operations</em></a> section.</p>
</div>
</div>
<div class="section" id="configuration">
<h2>1.3. Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<div class="section" id="how-to-configure-a-ldap-source">
<h3>1.3.1. How to configure a LDAP source ?<a class="headerlink" href="#how-to-configure-a-ldap-source" title="Permalink to this headline">¶</a></h3>
<p>See <a class="reference internal" href="../admin/ldap.html#ldap"><em>LDAP integration</em></a>.</p>
</div>
<div class="section" id="how-to-import-ldap-users-in-cubicweb">
<h3>1.3.2. How to import LDAP users in <em>CubicWeb</em> ?<a class="headerlink" href="#how-to-import-ldap-users-in-cubicweb" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div>Here is a useful script which enables you to import LDAP users
into your <em>CubicWeb</em> instance by running the following:</div></blockquote>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pwd</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">logilab.database</span> <span class="kn">import</span> <span class="n">get_connection</span>

<span class="k">def</span> <span class="nf">getlogin</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;avoid using os.getlogin() because of strange tty/stdin problems</span>
<span class="sd">    (man 3 getlogin)</span>
<span class="sd">    Another solution would be to use $LOGNAME, $USER or $USERNAME</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">pwd</span><span class="o">.</span><span class="n">getpwuid</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getuid</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>


<span class="k">try</span><span class="p">:</span>
    <span class="n">database</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&#39;USAGE: python ldap2system.py &lt;database&gt;&#39;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="k">if</span> <span class="nb">raw_input</span><span class="p">(</span><span class="s">&#39;update </span><span class="si">%s</span><span class="s"> db ? [y/n]: &#39;</span> <span class="o">%</span> <span class="n">database</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">):</span>
    <span class="n">cnx</span> <span class="o">=</span> <span class="n">get_connection</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">getlogin</span><span class="p">(),</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">)</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">cnx</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

    <span class="n">insert</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;INSERT INTO euser (creation_date, eid, modification_date, login, &#39;</span>
              <span class="s">&#39; firstname, surname, last_login_time, upassword) &#39;</span>
              <span class="s">&quot;VALUES (</span><span class="si">%(mtime)s</span><span class="s">, </span><span class="si">%(eid)s</span><span class="s">, </span><span class="si">%(mtime)s</span><span class="s">, </span><span class="si">%(login)s</span><span class="s">, </span><span class="si">%(firstname)s</span><span class="s">, &quot;</span>
              <span class="s">&quot;</span><span class="si">%(surname)s</span><span class="s">, </span><span class="si">%(mtime)s</span><span class="s">, &#39;./fqEz5LeZnT6&#39;);&quot;</span><span class="p">)</span>
    <span class="n">update</span> <span class="o">=</span> <span class="s">&quot;UPDATE entities SET source=&#39;system&#39; WHERE eid=</span><span class="si">%(eid)s</span><span class="s">;&quot;</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;SELECT eid,type,source,extid,mtime FROM entities WHERE source!=&#39;system&#39;&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">eid</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">extid</span><span class="p">,</span> <span class="n">mtime</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">type</span> <span class="o">!=</span> <span class="s">&#39;CWUser&#39;</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;don&#39;t know what to do with entity type&quot;</span><span class="p">,</span> <span class="nb">type</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">source</span> <span class="o">!=</span> <span class="s">&#39;ldapuser&#39;</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;don&#39;t know what to do with source type&quot;</span><span class="p">,</span> <span class="n">source</span>
            <span class="k">continue</span>
        <span class="n">ldapinfos</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">extid</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">))</span>
        <span class="n">login</span> <span class="o">=</span> <span class="n">ldapinfos</span><span class="p">[</span><span class="s">&#39;uid&#39;</span><span class="p">]</span>
        <span class="n">firstname</span> <span class="o">=</span> <span class="n">ldapinfos</span><span class="p">[</span><span class="s">&#39;uid&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="n">surname</span> <span class="o">=</span> <span class="n">ldapinfos</span><span class="p">[</span><span class="s">&#39;uid&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">login</span> <span class="o">!=</span> <span class="s">&#39;jcuissinat&#39;</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">eid</span><span class="o">=</span><span class="n">eid</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">type</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span> <span class="n">login</span><span class="o">=</span><span class="n">login</span><span class="p">,</span>
                        <span class="n">firstname</span><span class="o">=</span><span class="n">firstname</span><span class="p">,</span> <span class="n">surname</span><span class="o">=</span><span class="n">surname</span><span class="p">,</span> <span class="n">mtime</span><span class="o">=</span><span class="n">mtime</span><span class="p">)</span>
            <span class="k">print</span> <span class="n">args</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">insert</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">update</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>

    <span class="n">cnx</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="n">cnx</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="security">
<h2>1.4. Security<a class="headerlink" href="#security" title="Permalink to this headline">¶</a></h2>
<div class="section" id="how-to-reset-the-password-for-user-joe">
<h3>1.4.1. How to reset the password for user joe ?<a class="headerlink" href="#how-to-reset-the-password-for-user-joe" title="Permalink to this headline">¶</a></h3>
<p>If you want to reset the admin password for <tt class="docutils literal"><span class="pre">myinstance</span></tt>, do:</p>
<div class="highlight-python"><pre>$ cubicweb-ctl reset-admin-pwd myinstance</pre>
</div>
<p>You need to generate a new encrypted password:</p>
<div class="highlight-python"><pre>$ python
&gt;&gt;&gt; from cubicweb.server.utils import crypt_password
&gt;&gt;&gt; crypt_password('joepass')
'qHO8282QN5Utg'
&gt;&gt;&gt;</pre>
</div>
<p>and paste it in the database:</p>
<div class="highlight-python"><pre>$ psql mydb
mydb=&gt; update cw_cwuser set cw_upassword='qHO8282QN5Utg' where cw_login='joe';
UPDATE 1</pre>
</div>
<p>if you&#8217;re running over SQL Server, you need to use the CONVERT
function to convert the string to varbinary(255). The SQL query is
therefore:</p>
<div class="highlight-python"><pre>update cw_cwuser set cw_upassword=CONVERT(varbinary(255), 'qHO8282QN5Utg') where cw_login='joe';</pre>
</div>
<p>Be careful, the encryption algorithm is different on Windows and on
Unix. You cannot therefore use a hash generated on Unix to fill in a
Windows database, nor the other way round.</p>
<p>You can prefer use a migration script similar to this shell invocation instead:</p>
<div class="highlight-python"><pre>$ cubicweb-ctl shell &lt;instance&gt;
&gt;&gt;&gt; from cubicweb import Binary
&gt;&gt;&gt; from cubicweb.server.utils import crypt_password
&gt;&gt;&gt; crypted = crypt_password('joepass')
&gt;&gt;&gt; rset = rql('Any U WHERE U is CWUser, U login "joe"')
&gt;&gt;&gt; joe = rset.get_entity(0,0)
&gt;&gt;&gt; joe.cw_set(upassword=Binary(crypted))</pre>
</div>
<p>Please, refer to the script example is provided in the <cite>misc/examples/chpasswd.py</cite> file.</p>
<p>The more experimented people would use RQL request directly:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">rql</span><span class="p">(</span><span class="s">&#39;SET X upassword </span><span class="si">%(a)s</span><span class="s"> WHERE X is CWUser, X login &quot;joe&quot;&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="p">{</span><span class="s">&#39;a&#39;</span><span class="p">:</span> <span class="n">crypted</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="section" id="i-ve-just-created-a-user-in-a-group-and-it-doesn-t-work">
<h3>1.4.2. I&#8217;ve just created a user in a group and it doesn&#8217;t work !<a class="headerlink" href="#i-ve-just-created-a-user-in-a-group-and-it-doesn-t-work" title="Permalink to this headline">¶</a></h3>
<p>You are probably getting errors such as</p>
<div class="highlight-python"><pre>remove {'PR': 'Project', 'C': 'CWUser'} from solutions since your_user has no read access to cost</pre>
</div>
<p>This is because you have to put your user in the &#8220;users&#8221; group. The user has to
be in both groups.</p>
</div>
<div class="section" id="how-is-security-implemented">
<h3>1.4.3. How is security implemented ?<a class="headerlink" href="#how-is-security-implemented" title="Permalink to this headline">¶</a></h3>
<p>The basis for security is a mapping from operations to groups or
arbitrary RQL expressions. These mappings are scoped to entities and
relations.</p>
<p>This is an example for an Entity Type definition:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Version</span><span class="p">(</span><span class="n">EntityType</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;a version is defining the content of a particular project&#39;s</span>
<span class="sd">    release&quot;&quot;&quot;</span>
    <span class="c"># definition of attributes is voluntarily missing</span>
    <span class="n">__permissions__</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;read&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;managers&#39;</span><span class="p">,</span> <span class="s">&#39;users&#39;</span><span class="p">,</span> <span class="s">&#39;guests&#39;</span><span class="p">,),</span>
                       <span class="s">&#39;update&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;managers&#39;</span><span class="p">,</span> <span class="s">&#39;logilab&#39;</span><span class="p">,</span> <span class="s">&#39;owners&#39;</span><span class="p">),</span>
                       <span class="s">&#39;delete&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;managers&#39;</span><span class="p">,),</span>
                       <span class="s">&#39;add&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;managers&#39;</span><span class="p">,</span> <span class="s">&#39;logilab&#39;</span><span class="p">,</span>
                               <span class="n">ERQLExpression</span><span class="p">(</span><span class="s">&#39;X version_of PROJ, U in_group G, &#39;</span>
                                              <span class="s">&#39;PROJ require_permission P, &#39;</span>
                                              <span class="s">&#39;P name &quot;add_version&quot;, P require_group G&#39;</span><span class="p">),)}</span>
</pre></div>
</div>
<p>The above means that permission to read a Version is granted to any
user that is part of one of the groups &#8216;managers&#8217;, &#8216;users&#8217;, &#8216;guests&#8217;.
The &#8216;add&#8217; permission is granted to users in group &#8216;managers&#8217; or
&#8216;logilab&#8217; or to users in group G, if G is linked by a permission
entity named &#8220;add_version&#8221; to the version&#8217;s project.</p>
<p>An example for a Relation Definition (RelationType both defines a
relation type and implicitly one relation definition, on which the
permissions actually apply):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">version_of</span><span class="p">(</span><span class="n">RelationType</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;link a version to its project. A version is necessarily linked</span>
<span class="sd">    to one and only one project. &quot;&quot;&quot;</span>
    <span class="c"># some lines voluntarily missing</span>
    <span class="n">__permissions__</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;read&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;managers&#39;</span><span class="p">,</span> <span class="s">&#39;users&#39;</span><span class="p">,</span> <span class="s">&#39;guests&#39;</span><span class="p">,),</span>
                       <span class="s">&#39;delete&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;managers&#39;</span><span class="p">,</span> <span class="p">),</span>
                       <span class="s">&#39;add&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;managers&#39;</span><span class="p">,</span> <span class="s">&#39;logilab&#39;</span><span class="p">,</span>
                               <span class="n">RRQLExpression</span><span class="p">(</span><span class="s">&#39;O require_permission P, P name &quot;add_version&quot;, &#39;</span>
                                              <span class="s">&#39;U in_group G, P require_group G&#39;</span><span class="p">),)</span> <span class="p">}</span>
</pre></div>
</div>
<p>The main difference lies in the basic available operations (there is
no &#8216;update&#8217; operation) and the usage of an RRQLExpression (rql
expression for a relation) instead of an ERQLExpression (rql
expression for an entity).</p>
<p>You can find additional information in the section <a class="reference internal" href="../devrepo/datamodel/definition.html#securitymodel"><em>The security model</em></a>.</p>
</div>
<div class="section" id="is-it-possible-to-bypass-security-from-the-ui-web-front-part">
<h3>1.4.4. Is it possible to bypass security from the UI (web front) part ?<a class="headerlink" href="#is-it-possible-to-bypass-security-from-the-ui-web-front-part" title="Permalink to this headline">¶</a></h3>
<p>No. Only Hooks/Operations can do that.</p>
</div>
<div class="section" id="can-postgresql-and-cubicweb-authentication-work-with-kerberos">
<h3>1.4.5. Can PostgreSQL and CubicWeb authentication work with kerberos ?<a class="headerlink" href="#can-postgresql-and-cubicweb-authentication-work-with-kerberos" title="Permalink to this headline">¶</a></h3>
<p>If you have PostgreSQL set up to accept kerberos authentication, you can set
the db-host, db-name and db-user parameters in the <cite>sources</cite> configuration
file while leaving the password blank. It should be enough for your
instance to connect to postgresql with a kerberos ticket.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="rql/index.html" title="2. Relation Query Language (RQL)"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Appendixes"
             >previous</a> |</li>
        <li><a href="../index.html">CubicWeb 3.18.3</a> &raquo;</li>
          <li><a href="index.html" >Appendixes</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2001-2014, Logilab.
      Last updated on Mar 11, 2014.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>