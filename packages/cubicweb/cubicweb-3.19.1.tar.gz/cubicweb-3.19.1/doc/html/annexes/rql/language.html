
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>2.2. RQL syntax &mdash; CubicWeb 3.18.3</title>
    
    <link rel="stylesheet" href="../../_static/lglb-sphinx-doc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '3.18.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="CubicWeb 3.18.3" href="../../index.html" />
    <link rel="up" title="2. Relation Query Language (RQL)" href="index.html" />
    <link rel="next" title="2.3. Debugging RQL" href="debugging.html" />
    <link rel="prev" title="2.1. Introduction" href="intro.html" /> 
  </head>
  <body>
<div class="header">
 <a href="http://www.cubicweb.org">
  <img alt="cubicweb logo" src="../../_static/cubicweb.png"/>
 </a>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="debugging.html" title="2.3. Debugging RQL"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="intro.html" title="2.1. Introduction"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">CubicWeb 3.18.3</a> &raquo;</li>
          <li><a href="../index.html" >Appendixes</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">2. Relation Query Language (RQL)</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">2.2. RQL syntax</a><ul>
<li><a class="reference internal" href="#reserved-keywords">2.2.1. Reserved keywords</a></li>
<li><a class="reference internal" href="#case">2.2.2. Case</a></li>
<li><a class="reference internal" href="#variables-and-typing">2.2.3. Variables and typing</a></li>
<li><a class="reference internal" href="#virtual-relations">2.2.4. Virtual relations</a></li>
<li><a class="reference internal" href="#literal-expressions">2.2.5. Literal expressions</a></li>
<li><a class="reference internal" href="#operators">2.2.6. Operators</a><ul>
<li><a class="reference internal" href="#logical-operators">2.2.6.1. Logical operators</a></li>
<li><a class="reference internal" href="#mathematical-operators">2.2.6.2. Mathematical operators</a></li>
<li><a class="reference internal" href="#comparison-operators">2.2.6.3. Comparison operators</a></li>
<li><a class="reference internal" href="#string-operators">2.2.6.4. String operators</a></li>
<li><a class="reference internal" href="#operators-priority">2.2.6.5. Operators priority</a></li>
</ul>
</li>
<li><a class="reference internal" href="#search-query">2.2.7. Search Query</a><ul>
<li><a class="reference internal" href="#selection">2.2.7.1. Selection</a></li>
<li><a class="reference internal" href="#grouping-and-aggregating">2.2.7.2. Grouping and aggregating</a></li>
<li><a class="reference internal" href="#sorting">2.2.7.3. Sorting</a></li>
<li><a class="reference internal" href="#pagination">2.2.7.4. Pagination</a></li>
<li><a class="reference internal" href="#restrictions">2.2.7.5. Restrictions</a></li>
<li><a class="reference internal" href="#having-restrictions">2.2.7.6. Having restrictions</a></li>
<li><a class="reference internal" href="#sub-queries">2.2.7.7. Sub-queries</a></li>
<li><a class="reference internal" href="#union">2.2.7.8. Union</a></li>
</ul>
</li>
<li><a class="reference internal" href="#available-functions">2.2.8. Available functions</a><ul>
<li><a class="reference internal" href="#aggregate-functions">2.2.8.1. Aggregate functions</a></li>
<li><a class="reference internal" href="#string-transformation-functions">2.2.8.2. String transformation functions</a></li>
<li><a class="reference internal" href="#date-extraction-functions">2.2.8.3. Date extraction functions</a></li>
<li><a class="reference internal" href="#other-functions">2.2.8.4. Other functions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#examples">2.2.9. Examples</a></li>
<li><a class="reference internal" href="#insertion-query">2.2.10. Insertion query</a></li>
<li><a class="reference internal" href="#update-and-relation-creation-queries">2.2.11. Update and relation creation queries</a></li>
<li><a class="reference internal" href="#deletion-query">2.2.12. Deletion query</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="intro.html"
                        title="previous chapter">2.1. Introduction</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="debugging.html"
                        title="next chapter">2.3. Debugging RQL</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/annexes/rql/language.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="rql-syntax">
<span id="rql"></span><h1>2.2. RQL syntax<a class="headerlink" href="#rql-syntax" title="Permalink to this headline">¶</a></h1>
<div class="section" id="reserved-keywords">
<span id="rqlkeywords"></span><h2>2.2.1. Reserved keywords<a class="headerlink" href="#reserved-keywords" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="n">AND</span><span class="p">,</span> <span class="n">ASC</span><span class="p">,</span> <span class="n">BEING</span><span class="p">,</span> <span class="n">DELETE</span><span class="p">,</span> <span class="n">DESC</span><span class="p">,</span> <span class="n">DISTINCT</span><span class="p">,</span> <span class="n">EXISTS</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">GROUPBY</span><span class="p">,</span>
<span class="n">HAVING</span><span class="p">,</span> <span class="n">ILIKE</span><span class="p">,</span> <span class="n">INSERT</span><span class="p">,</span> <span class="n">LIKE</span><span class="p">,</span> <span class="n">LIMIT</span><span class="p">,</span> <span class="n">NOT</span><span class="p">,</span> <span class="n">NOW</span><span class="p">,</span> <span class="n">NULL</span><span class="p">,</span> <span class="n">OFFSET</span><span class="p">,</span>
<span class="n">OR</span><span class="p">,</span> <span class="n">ORDERBY</span><span class="p">,</span> <span class="n">SET</span><span class="p">,</span> <span class="n">TODAY</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">UNION</span><span class="p">,</span> <span class="n">WHERE</span><span class="p">,</span> <span class="n">WITH</span>
</pre></div>
</div>
<p>The keywords are not case sensitive. You should not use them when defining your
schema, or as RQL variable names.</p>
</div>
<div class="section" id="case">
<span id="rqlcase"></span><h2>2.2.2. Case<a class="headerlink" href="#case" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Variables should be all upper-cased.</li>
<li>Relation should be all lower-cased and match exactly names of relations defined
in the schema.</li>
<li>Entity types should start with an upper cased letter and be followed by at least
a lower cased latter.</li>
</ul>
</div>
<div class="section" id="variables-and-typing">
<span id="rqlvariables"></span><h2>2.2.3. Variables and typing<a class="headerlink" href="#variables-and-typing" title="Permalink to this headline">¶</a></h2>
<p>Entities and values to browse and/or select are represented in the query by
<em>variables</em> that must be written in capital letters.</p>
<p>With RQL, we do not distinguish between entities and attributes. The value of an
attribute is considered as an entity of a particular type (see below), linked to
one (real) entity by a relation called the name of the attribute, where the
entity is the subject and the attribute the object.</p>
<p>The possible type(s) for each variable is derived from the schema according to
the constraints expressed above and thanks to the relations between each
variable.</p>
<p>We can restrict the possible types for a variable using the special relation
<strong>is</strong> in the restrictions.</p>
</div>
<div class="section" id="virtual-relations">
<span id="virtualrelations"></span><h2>2.2.4. Virtual relations<a class="headerlink" href="#virtual-relations" title="Permalink to this headline">¶</a></h2>
<p>Those relations may only be used in RQL query but are not actual attributes of
your entities.</p>
<ul class="simple">
<li><cite>has_text</cite>: relation to use to query the full text index (only for entities
having fulltextindexed attributes).</li>
<li><cite>identity</cite>: relation to use to tell that a RQL variable is the same as another
when you&#8217;ve to use two different variables for querying purpose. On the
opposite it&#8217;s also useful together with the <tt class="docutils literal"><span class="pre">NOT</span></tt> operator to tell that two
variables should not identify the same entity</li>
</ul>
</div>
<div class="section" id="literal-expressions">
<span id="rqlliterals"></span><h2>2.2.5. Literal expressions<a class="headerlink" href="#literal-expressions" title="Permalink to this headline">¶</a></h2>
<p>Bases types supported by RQL are those supported by yams schema. Literal values
are expressed as explained below:</p>
<ul class="simple">
<li>string should be between double or single quotes. If the value contains a
quote, it should be preceded by a backslash &#8216;\&#8217;</li>
<li>floats separator is dot &#8216;.&#8217;</li>
<li>boolean values are <tt class="docutils literal"><span class="pre">TRUE</span></tt> and <tt class="docutils literal"><span class="pre">FALSE</span></tt> keywords</li>
<li>date and time should be expressed as a string with ISO notation : YYYY/MM/DD
[hh:mm], or using keywords <tt class="docutils literal"><span class="pre">TODAY</span></tt> and <tt class="docutils literal"><span class="pre">NOW</span></tt></li>
</ul>
<p>You may also use the <tt class="docutils literal"><span class="pre">NULL</span></tt> keyword, meaning &#8216;unspecified&#8217;.</p>
</div>
<div class="section" id="operators">
<span id="rqloperators"></span><h2>2.2.6. Operators<a class="headerlink" href="#operators" title="Permalink to this headline">¶</a></h2>
<div class="section" id="logical-operators">
<span id="rqllogicaloperators"></span><h3>2.2.6.1. Logical operators<a class="headerlink" href="#logical-operators" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="n">AND</span><span class="p">,</span> <span class="n">OR</span><span class="p">,</span> <span class="n">NOT</span><span class="p">,</span> <span class="s">&#39;,&#39;</span>
</pre></div>
</div>
<p>&#8216;,&#8217; is equivalent to &#8216;AND&#8217; but with the smallest among the priority of logical
operators (see <a class="reference internal" href="#rqloperatorspriority"><em>Operators priority</em></a>).</p>
</div>
<div class="section" id="mathematical-operators">
<span id="rqlmathematicaloperators"></span><h3>2.2.6.2. Mathematical operators<a class="headerlink" href="#mathematical-operators" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="42%" />
<col width="22%" />
<col width="16%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Operator</th>
<th class="head">Description</th>
<th class="head">Example</th>
<th class="head">Result</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><cite>+</cite></td>
<td>addition</td>
<td>2 + 3</td>
<td>5</td>
</tr>
<tr class="row-odd"><td><cite>-</cite></td>
<td>subtraction</td>
<td>2 - 3</td>
<td>-1</td>
</tr>
<tr class="row-even"><td><cite>*</cite></td>
<td>multiplication</td>
<td>2 * 3</td>
<td>6</td>
</tr>
<tr class="row-odd"><td>/</td>
<td>division</td>
<td>4 / 2</td>
<td>2</td>
</tr>
<tr class="row-even"><td>%</td>
<td>modulo (remainder)</td>
<td>5 % 4</td>
<td>1</td>
</tr>
<tr class="row-odd"><td>^</td>
<td>exponentiation</td>
<td>2.0 ^ 3.0</td>
<td>8</td>
</tr>
<tr class="row-even"><td>&amp;</td>
<td>bitwise AND</td>
<td>91 &amp; 15</td>
<td>11</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line"><br /></div>
</div>
</td>
<td>bitwise OR</td>
<td>32 | 3</td>
<td>35</td>
</tr>
<tr class="row-even"><td>#</td>
<td>bitwise XOR</td>
<td>17 # 5</td>
<td>20</td>
</tr>
<tr class="row-odd"><td>~</td>
<td>bitwise NOT</td>
<td>~1</td>
<td>-2</td>
</tr>
<tr class="row-even"><td>&lt;&lt;</td>
<td>bitwise shift left</td>
<td>1 &lt;&lt; 4</td>
<td>16</td>
</tr>
<tr class="row-odd"><td>&gt;&gt;</td>
<td>bitwise shift right</td>
<td>8 &gt;&gt; 2</td>
<td>2</td>
</tr>
</tbody>
</table>
<p>Notice integer division truncates results depending on the backend behaviour. For
instance, postgresql does.</p>
</div>
<div class="section" id="comparison-operators">
<span id="rqlcomparisonoperators"></span><h3>2.2.6.3. Comparison operators<a class="headerlink" href="#comparison-operators" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="highlight-python"><pre>=, !=, &lt;, &lt;=, &gt;=, &gt;, IN</pre>
</div>
</div></blockquote>
<p>The syntax to use comparison operators is:</p>
<blockquote>
<div><cite>VARIABLE attribute &lt;operator&gt; VALUE</cite></div></blockquote>
<p>The <cite>=</cite> operator is the default operator and can be omitted, i.e. :</p>
<blockquote>
<div><cite>VARIABLE attribute = VALUE</cite></div></blockquote>
<p>is equivalent to</p>
<blockquote>
<div><cite>VARIABLE attribute VALUE</cite></div></blockquote>
<p>The operator <cite>IN</cite> provides a list of possible values:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">Any</span> <span class="n">X</span> <span class="k">WHERE</span> <span class="n">X</span> <span class="n">name</span> <span class="k">IN</span> <span class="p">(</span><span class="s1">&#39;chauvat&#39;</span><span class="p">,</span> <span class="s1">&#39;fayolle&#39;</span><span class="p">,</span> <span class="s1">&#39;di mascio&#39;</span><span class="p">,</span> <span class="s1">&#39;thenault&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="string-operators">
<span id="rqlstringoperators"></span><h3>2.2.6.4. String operators<a class="headerlink" href="#string-operators" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><pre>LIKE, ILIKE, ~=, REGEXP</pre>
</div>
<p>The <tt class="docutils literal"><span class="pre">LIKE</span></tt> string operator can be used with the special character <cite>%</cite> in
a string as wild-card:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="c1">-- match every entity whose name starts with &#39;Th&#39;</span>
<span class="k">Any</span> <span class="n">X</span> <span class="k">WHERE</span> <span class="n">X</span> <span class="n">name</span> <span class="o">~=</span> <span class="s1">&#39;Th%&#39;</span>
<span class="c1">-- match every entity whose name endswith &#39;lt&#39;</span>
<span class="k">Any</span> <span class="n">X</span> <span class="k">WHERE</span> <span class="n">X</span> <span class="n">name</span> <span class="k">LIKE</span> <span class="s1">&#39;%lt&#39;</span>
<span class="c1">-- match every entity whose name contains a &#39;l&#39; and a &#39;t&#39;</span>
<span class="k">Any</span> <span class="n">X</span> <span class="k">WHERE</span> <span class="n">X</span> <span class="n">name</span> <span class="k">LIKE</span> <span class="s1">&#39;%l%t%&#39;</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">ILIKE</span></tt> is the case insensitive version of <tt class="docutils literal"><span class="pre">LIKE</span></tt>. It&#8217;s not
available on all backend (e.g. sqlite doesn&#8217;t support it). If not available for
your backend, <tt class="docutils literal"><span class="pre">ILIKE</span></tt> will behave like <tt class="docutils literal"><span class="pre">LIKE</span></tt>.</p>
<p><cite>~=</cite> is a shortcut version of <tt class="docutils literal"><span class="pre">ILIKE</span></tt>, or of <tt class="docutils literal"><span class="pre">LIKE</span></tt> when the
former is not available on the back-end.</p>
<p>The <tt class="docutils literal"><span class="pre">REGEXP</span></tt> is an alternative to <tt class="docutils literal"><span class="pre">LIKE</span></tt> that supports POSIX
regular expressions:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="c1">-- match entities whose title starts with a digit</span>
<span class="k">Any</span> <span class="n">X</span> <span class="k">WHERE</span> <span class="n">X</span> <span class="n">title</span> <span class="n">REGEXP</span> <span class="ss">&quot;^[0-9].*&quot;</span>
</pre></div>
</div>
<p>The underlying SQL operator used is back-end-dependent :</p>
<ul class="simple">
<li>the <tt class="docutils literal"><span class="pre">~</span></tt> operator is used for postgresql,</li>
<li>the <tt class="docutils literal"><span class="pre">REGEXP</span></tt> operator for mysql and sqlite.</li>
</ul>
<p>Other back-ends are not supported yet.</p>
</div>
<div class="section" id="operators-priority">
<span id="rqloperatorspriority"></span><h3>2.2.6.5. Operators priority<a class="headerlink" href="#operators-priority" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><cite>(</cite>, <cite>)</cite></li>
<li><cite>^</cite>, <cite>&lt;&lt;</cite>, <cite>&gt;&gt;</cite></li>
<li><cite>*</cite>, <cite>/</cite>, <cite>%</cite>, <cite>&amp;</cite></li>
<li><cite>+</cite>, <cite>-</cite>, <cite>|</cite>, <cite>#</cite></li>
<li><cite>NOT</cite></li>
<li><cite>AND</cite></li>
<li><cite>OR</cite></li>
<li><cite>,</cite></li>
</ol>
</div>
</div>
<div class="section" id="search-query">
<span id="rqlsearchquery"></span><h2>2.2.7. Search Query<a class="headerlink" href="#search-query" title="Permalink to this headline">¶</a></h2>
<p>Simplified grammar of search query:</p>
<div class="highlight-python"><pre>[ `DISTINCT`] `Any` V1 (, V2) \*
[ `GROUPBY` V1 (, V2) \*] [ `ORDERBY` &lt;orderterms&gt;]
[ `LIMIT` &lt;value&gt;] [ `OFFSET` &lt;value&gt;]
[ `WHERE` &lt;triplet restrictions&gt;]
[ `WITH` V1 (, V2)\* BEING (&lt;query&gt;)]
[ `HAVING` &lt;other restrictions&gt;]
[ `UNION` &lt;query&gt;]</pre>
</div>
<div class="section" id="selection">
<h3>2.2.7.1. Selection<a class="headerlink" href="#selection" title="Permalink to this headline">¶</a></h3>
<p>The fist occuring clause is the selection of terms that should be in the result
set.  Terms may be variable, literals, function calls, arithmetic, etc. and each
term is separated by a comma.</p>
<p>There will be as much column in the result set as term in this clause, respecting
order.</p>
<p>Syntax for function call is somewhat intuitive, for instance:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">Any</span> <span class="k">UPPER</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="k">WHERE</span> <span class="n">P</span> <span class="n">firstname</span> <span class="n">N</span>
</pre></div>
</div>
</div>
<div class="section" id="grouping-and-aggregating">
<h3>2.2.7.2. Grouping and aggregating<a class="headerlink" href="#grouping-and-aggregating" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">GROUPBY</span></tt> keyword is followed by a list of terms on which results
should be grouped. They are usually used with aggregate functions, responsible to
aggregate values for each group (see <a class="reference internal" href="#rqlaggregatefunctions"><em>Aggregate functions</em></a>).</p>
<p>For grouped queries, all selected variables must be either aggregated (i.e. used
by an aggregate function) or grouped (i.e. listed in the <tt class="docutils literal"><span class="pre">GROUPBY</span></tt>
clause).</p>
</div>
<div class="section" id="sorting">
<h3>2.2.7.3. Sorting<a class="headerlink" href="#sorting" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">ORDERBY</span></tt> keyword if followed by the definition of the selection
order: variable or column number followed by sorting method (<tt class="docutils literal"><span class="pre">ASC</span></tt>,
<tt class="docutils literal"><span class="pre">DESC</span></tt>), <tt class="docutils literal"><span class="pre">ASC</span></tt> being the default. If the sorting method is not
specified, then the sorting is ascendant (<cite>ASC</cite>).</p>
</div>
<div class="section" id="pagination">
<h3>2.2.7.4. Pagination<a class="headerlink" href="#pagination" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">LIMIT</span></tt> and <tt class="docutils literal"><span class="pre">OFFSET</span></tt> keywords may be respectively used to
limit the number of results and to tell from which result line to start (for
instance, use <cite>LIMIT 20</cite> to get the first 20 results, then <cite>LIMIT 20 OFFSET 20</cite>
to get the next 20.</p>
</div>
<div class="section" id="restrictions">
<h3>2.2.7.5. Restrictions<a class="headerlink" href="#restrictions" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">WHERE</span></tt> keyword introduce one of the &#8220;main&#8221; part of the query, where
you &#8220;define&#8221; variables and add some restrictions telling what you&#8217;re interested
in.</p>
<p>It&#8217;s a list of triplets &#8220;subject relation object&#8221;, e.g. <cite>V1 relation
(V2 | &lt;static value&gt;)</cite>. Triplets are separated using <a class="reference internal" href="#rqllogicaloperators"><em>Logical operators</em></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>About the negation operator (<tt class="docutils literal"><span class="pre">NOT</span></tt>):</p>
<ul class="last">
<li><p class="first"><tt class="docutils literal"><span class="pre">NOT</span> <span class="pre">X</span> <span class="pre">relation</span> <span class="pre">Y</span></tt> is equivalent to <tt class="docutils literal"><span class="pre">NOT</span> <span class="pre">EXISTS(X</span> <span class="pre">relation</span> <span class="pre">Y)</span></tt></p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">Any</span> <span class="pre">X</span> <span class="pre">WHERE</span> <span class="pre">NOT</span> <span class="pre">X</span> <span class="pre">owned_by</span> <span class="pre">U</span></tt> means &#8220;entities that have no relation
<tt class="docutils literal"><span class="pre">owned_by</span></tt>&#8221;.</p>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">Any</span> <span class="pre">X</span> <span class="pre">WHERE</span> <span class="pre">NOT</span> <span class="pre">X</span> <span class="pre">owned_by</span> <span class="pre">U,</span> <span class="pre">U</span> <span class="pre">login</span> <span class="pre">&quot;syt&quot;</span></tt> means &#8220;the entity have no</dt>
<dd><p class="first last">relation <tt class="docutils literal"><span class="pre">owned_by</span></tt> with the user syt&#8221;. They may have a relation &#8220;owned_by&#8221;
with another user.</p>
</dd>
</dl>
</li>
</ul>
</div>
<p>In this clause, you can also use <tt class="docutils literal"><span class="pre">EXISTS</span></tt> when you want to know if some
expression is true and do not need the complete set of elements that make it
true. Testing for existence is much faster than fetching the complete set of
results, especially when you think about using <tt class="docutils literal"><span class="pre">OR</span></tt> against several expressions. For instance
if you want to retrieve versions which are in state &#8220;ready&#8221; or tagged by
&#8220;priority&#8221;, you should write :</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">Any</span> <span class="n">X</span> <span class="n">ORDERBY</span> <span class="n">PN</span><span class="p">,</span><span class="n">N</span>
<span class="k">WHERE</span> <span class="n">X</span> <span class="n">num</span> <span class="n">N</span><span class="p">,</span> <span class="n">X</span> <span class="n">version_of</span> <span class="n">P</span><span class="p">,</span> <span class="n">P</span> <span class="n">name</span> <span class="n">PN</span><span class="p">,</span>
      <span class="k">EXISTS</span><span class="p">(</span><span class="n">X</span> <span class="n">in_state</span> <span class="n">S</span><span class="p">,</span> <span class="n">S</span> <span class="n">name</span> <span class="ss">&quot;ready&quot;</span><span class="p">)</span>
      <span class="k">OR</span> <span class="k">EXISTS</span><span class="p">(</span><span class="n">T</span> <span class="n">tags</span> <span class="n">X</span><span class="p">,</span> <span class="n">T</span> <span class="n">name</span> <span class="ss">&quot;priority&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>not</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">Any</span> <span class="n">X</span> <span class="n">ORDERBY</span> <span class="n">PN</span><span class="p">,</span><span class="n">N</span>
<span class="k">WHERE</span> <span class="n">X</span> <span class="n">num</span> <span class="n">N</span><span class="p">,</span> <span class="n">X</span> <span class="n">version_of</span> <span class="n">P</span><span class="p">,</span> <span class="n">P</span> <span class="n">name</span> <span class="n">PN</span><span class="p">,</span>
      <span class="p">(</span><span class="n">X</span> <span class="n">in_state</span> <span class="n">S</span><span class="p">,</span> <span class="n">S</span> <span class="n">name</span> <span class="ss">&quot;ready&quot;</span><span class="p">)</span>
      <span class="k">OR</span> <span class="p">(</span><span class="n">T</span> <span class="n">tags</span> <span class="n">X</span><span class="p">,</span> <span class="n">T</span> <span class="n">name</span> <span class="ss">&quot;priority&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Both queries aren&#8217;t at all equivalent :</p>
<ul class="simple">
<li>the former will retrieve all versions, then check for each one which are in the
matching state of or tagged by the expected tag,</li>
<li>the later will retrieve all versions, state and tags (cartesian product!),
compute join and then exclude each row which are in the matching state of or
tagged by the expected tag. This implies that : you won&#8217;t get any result if the
in_state or tag</li>
</ul>
<p>Another common case where you may want to use <tt class="docutils literal"><span class="pre">EXISTS</span></tt> is when you
find yourself using <tt class="docutils literal"><span class="pre">DISTINCT</span></tt> at the beginning of your query to
remove duplicate results. The typical case is when you have a
multivalued relation such as Version version_of Project and you want
to retrieve projects which have a version:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">Any</span> <span class="n">P</span> <span class="k">WHERE</span> <span class="n">V</span> <span class="n">version_of</span> <span class="n">P</span>
</pre></div>
</div>
<p>will return each project number of versions times. So you may be
tempted to use:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">DISTINCT</span> <span class="k">ANY</span> <span class="n">P</span> <span class="k">WHERE</span> <span class="n">V</span> <span class="n">version_of</span> <span class="n">P</span>
</pre></div>
</div>
<p>This will work, but is not efficient, as it will use the <tt class="docutils literal"><span class="pre">SELECT</span>
<span class="pre">DISTINCT</span></tt> SQL predicate, which needs to retrieve all projects, then
sort them and discard duplicates, which can have a very high cost for
large result sets. So the best way to write this is:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">ANY</span> <span class="n">P</span> <span class="k">WHERE</span> <span class="k">EXISTS</span> <span class="n">V</span> <span class="n">version_of</span> <span class="n">P</span>
</pre></div>
</div>
<p>You can also use the question mark (<cite>?</cite>) to mark optional relations. This allows
you to select entities related <strong>or not</strong> to another. It is a similar concept
to <a class="reference external" href="http://en.wikipedia.org/wiki/Join_(SQL)#Left_outer_join">Left outer join</a>:</p>
<blockquote>
<div>the result of a left outer join (or simply left join) for table A and B
always contains all records of the &#8220;left&#8221; table (A), even if the
join-condition does not find any matching record in the &#8220;right&#8221; table (B).</div></blockquote>
<p>You must use the <cite>?</cite> behind a variable to specify that the relation to
that variable is optional. For instance:</p>
<ul>
<li><p class="first">Bugs of a project attached or not to a version</p>
<blockquote>
<div><div class="highlight-sql"><div class="highlight"><pre><span class="k">Any</span> <span class="n">X</span><span class="p">,</span> <span class="n">V</span> <span class="k">WHERE</span> <span class="n">X</span> <span class="n">concerns</span> <span class="n">P</span><span class="p">,</span> <span class="n">P</span> <span class="n">eid</span> <span class="mi">42</span><span class="p">,</span> <span class="n">X</span> <span class="n">corrected_in</span> <span class="n">V</span><span class="o">?</span>
</pre></div>
</div>
</div></blockquote>
<p>You will get a result set containing all the project&#8217;s tickets, with either the
version in which it&#8217;s fixed or None for tickets not related to a version.</p>
</li>
<li><p class="first">All cards and the project they document if any</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">Any</span> <span class="k">C</span><span class="p">,</span> <span class="n">P</span> <span class="k">WHERE</span> <span class="k">C</span> <span class="k">is</span> <span class="n">Card</span><span class="p">,</span> <span class="n">P</span><span class="o">?</span> <span class="n">documented_by</span> <span class="k">C</span>
</pre></div>
</div>
</li>
</ul>
<p>Notice you may also use outer join:</p>
<ul>
<li><p class="first">on the RHS of attribute relation, e.g.</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">Any</span> <span class="n">X</span> <span class="k">WHERE</span> <span class="n">X</span> <span class="k">ref</span> <span class="n">XR</span><span class="p">,</span> <span class="n">Y</span> <span class="n">name</span> <span class="n">XR</span><span class="o">?</span>
</pre></div>
</div>
<p>so that Y is outer joined on X by ref/name attributes comparison</p>
</li>
<li><p class="first">on any side of an <tt class="docutils literal"><span class="pre">HAVING</span></tt> expression, e.g.</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">Any</span> <span class="n">X</span> <span class="k">WHERE</span> <span class="n">X</span> <span class="n">creation_date</span> <span class="n">XC</span><span class="p">,</span> <span class="n">Y</span> <span class="n">creation_date</span> <span class="n">YC</span>
<span class="k">HAVING</span> <span class="k">YEAR</span><span class="p">(</span><span class="n">XC</span><span class="p">)</span><span class="o">=</span><span class="k">YEAR</span><span class="p">(</span><span class="n">YC</span><span class="p">)</span><span class="o">?</span>
</pre></div>
</div>
<p>so that Y is outer joined on X by comparison of the year extracted from their
creation date.</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">Any</span> <span class="n">X</span> <span class="k">WHERE</span> <span class="n">X</span> <span class="n">creation_date</span> <span class="n">XC</span><span class="p">,</span> <span class="n">Y</span> <span class="n">creation_date</span> <span class="n">YC</span>
<span class="k">HAVING</span> <span class="k">YEAR</span><span class="p">(</span><span class="n">XC</span><span class="p">)</span><span class="o">?=</span><span class="k">YEAR</span><span class="p">(</span><span class="n">YC</span><span class="p">)</span>
</pre></div>
</div>
<p>would outer join X on Y instead.</p>
</li>
</ul>
</div>
<div class="section" id="having-restrictions">
<h3>2.2.7.6. Having restrictions<a class="headerlink" href="#having-restrictions" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">HAVING</span></tt> clause, as in SQL, may be used to restrict a query
according to value returned by an aggregate function, e.g.</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">Any</span> <span class="n">X</span> <span class="n">GROUPBY</span> <span class="n">X</span> <span class="k">WHERE</span> <span class="n">X</span> <span class="n">relation</span> <span class="n">Y</span> <span class="k">HAVING</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span>
</pre></div>
</div>
<p>It may however be used for something else: In the <tt class="docutils literal"><span class="pre">WHERE</span></tt> clause, we are
limited to triplet expressions, so some things may not be expressed there. Let&#8217;s
take an example : if you want to get people whose upper-cased first name equals to
another person upper-cased first name. There is no proper way to express this
using triplet, so you should use something like:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">Any</span> <span class="n">X</span> <span class="k">WHERE</span> <span class="n">X</span> <span class="n">firstname</span> <span class="n">XFN</span><span class="p">,</span> <span class="n">Y</span> <span class="n">firstname</span> <span class="n">YFN</span><span class="p">,</span> <span class="k">NOT</span> <span class="n">X</span> <span class="k">identity</span> <span class="n">Y</span> <span class="k">HAVING</span> <span class="k">UPPER</span><span class="p">(</span><span class="n">XFN</span><span class="p">)</span> <span class="o">=</span> <span class="k">UPPER</span><span class="p">(</span><span class="n">YFN</span><span class="p">)</span>
</pre></div>
</div>
<p>Another example: imagine you want person born in 2000:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">Any</span> <span class="n">X</span> <span class="k">WHERE</span> <span class="n">X</span> <span class="n">birthday</span> <span class="n">XB</span> <span class="k">HAVING</span> <span class="k">YEAR</span><span class="p">(</span><span class="n">XB</span><span class="p">)</span> <span class="o">=</span> <span class="mi">2000</span>
</pre></div>
</div>
<p>Notice that while we would like this to work without the HAVING clause, this
can&#8217;t be currently be done because it introduces an ambiguity in RQL&#8217;s grammar
that can&#8217;t be handled by <a class="reference external" href="http://theory.stanford.edu/~amitp/yapps/">Yapps</a>, the parser&#8217;s generator we&#8217;re using.</p>
</div>
<div class="section" id="sub-queries">
<h3>2.2.7.7. Sub-queries<a class="headerlink" href="#sub-queries" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">WITH</span></tt> keyword introduce sub-queries clause. Each sub-query has the
form:</p>
<blockquote>
<div>V1(,V2) BEING (rql query)</div></blockquote>
<p>Variables at the left of the <tt class="docutils literal"><span class="pre">BEING</span></tt> keyword defines into which
variables results from the sub-query will be mapped to into the outer query.
Sub-queries are separated from each other using a comma.</p>
<p>Let&#8217;s say we want to retrieve for each project its number of versions and its
number of tickets. Due to the nature of relational algebra behind the scene, this
can&#8217;t be achieved using a single query. You have to write something along the
line of:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">Any</span> <span class="n">X</span><span class="p">,</span> <span class="n">VC</span><span class="p">,</span> <span class="n">TC</span> <span class="k">WHERE</span> <span class="n">X</span> <span class="k">identity</span> <span class="n">XX</span>
<span class="k">WITH</span> <span class="n">X</span><span class="p">,</span> <span class="n">VC</span> <span class="n">BEING</span> <span class="p">(</span><span class="k">Any</span> <span class="n">X</span><span class="p">,</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">V</span><span class="p">)</span> <span class="n">GROUPBY</span> <span class="n">X</span> <span class="k">WHERE</span> <span class="n">V</span> <span class="n">version_of</span> <span class="n">X</span><span class="p">),</span>
     <span class="n">XX</span><span class="p">,</span> <span class="n">TC</span> <span class="n">BEING</span> <span class="p">(</span><span class="k">Any</span> <span class="n">X</span><span class="p">,</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">T</span><span class="p">)</span> <span class="n">GROUPBY</span> <span class="n">X</span> <span class="k">WHERE</span> <span class="n">T</span> <span class="n">ticket_of</span> <span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
<p>Notice that we can&#8217;t reuse a same variable name as alias for two different
sub-queries, hence the usage of &#8216;X&#8217; and &#8216;XX&#8217; in this example, which are then
unified using the special <cite>identity</cite> relation (see <a class="reference internal" href="#virtualrelations"><em>Virtual relations</em></a>).</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>Sub-queries define a new variable scope, so even if a variable has the same name
in the outer query and in the sub-query, they technically <strong>aren&#8217;t</strong> the same
variable. So:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">Any</span> <span class="n">W</span><span class="p">,</span> <span class="k">REF</span> <span class="k">WITH</span> <span class="n">W</span><span class="p">,</span> <span class="k">REF</span> <span class="n">BEING</span>
    <span class="p">(</span><span class="k">Any</span> <span class="n">W</span><span class="p">,</span> <span class="k">REF</span> <span class="k">WHERE</span> <span class="n">W</span> <span class="k">is</span> <span class="n">Workcase</span><span class="p">,</span> <span class="n">W</span> <span class="k">ref</span> <span class="k">REF</span><span class="p">,</span>
                      <span class="n">W</span> <span class="n">concerned_by</span> <span class="n">D</span><span class="p">,</span> <span class="n">D</span> <span class="n">name</span> <span class="ss">&quot;Logilab&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>could be written:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">Any</span> <span class="n">W</span><span class="p">,</span> <span class="k">REF</span> <span class="k">WITH</span> <span class="n">W</span><span class="p">,</span> <span class="k">REF</span> <span class="n">BEING</span>
   <span class="p">(</span><span class="k">Any</span> <span class="n">W1</span><span class="p">,</span> <span class="n">REF1</span> <span class="k">WHERE</span> <span class="n">W1</span> <span class="k">is</span> <span class="n">Workcase</span><span class="p">,</span> <span class="n">W1</span> <span class="k">ref</span> <span class="n">REF1</span><span class="p">,</span>
                       <span class="n">W1</span> <span class="n">concerned_by</span> <span class="n">D</span><span class="p">,</span> <span class="n">D</span> <span class="n">name</span> <span class="ss">&quot;Logilab&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Also, when a variable is coming from a sub-query, you currently can&#8217;t reference
its attribute or inlined relations in the outer query, you&#8217;ve to fetch them in
the sub-query. For instance, let&#8217;s say we want to sort by project name in our
first example, we would have to write:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">Any</span> <span class="n">X</span><span class="p">,</span> <span class="n">VC</span><span class="p">,</span> <span class="n">TC</span> <span class="n">ORDERBY</span> <span class="n">XN</span> <span class="k">WHERE</span> <span class="n">X</span> <span class="k">identity</span> <span class="n">XX</span>
<span class="k">WITH</span> <span class="n">X</span><span class="p">,</span> <span class="n">XN</span><span class="p">,</span> <span class="n">VC</span> <span class="n">BEING</span> <span class="p">(</span><span class="k">Any</span> <span class="n">X</span><span class="p">,</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">V</span><span class="p">)</span> <span class="n">GROUPBY</span> <span class="n">X</span><span class="p">,</span><span class="n">XN</span> <span class="k">WHERE</span> <span class="n">V</span> <span class="n">version_of</span> <span class="n">X</span><span class="p">,</span> <span class="n">X</span> <span class="n">name</span> <span class="n">XN</span><span class="p">),</span>
     <span class="n">XX</span><span class="p">,</span> <span class="n">TC</span> <span class="n">BEING</span> <span class="p">(</span><span class="k">Any</span> <span class="n">X</span><span class="p">,</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">T</span><span class="p">)</span> <span class="n">GROUPBY</span> <span class="n">X</span> <span class="k">WHERE</span> <span class="n">T</span> <span class="n">ticket_of</span> <span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
<p>instead of:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">Any</span> <span class="n">X</span><span class="p">,</span> <span class="n">VC</span><span class="p">,</span> <span class="n">TC</span> <span class="n">ORDERBY</span> <span class="n">XN</span> <span class="k">WHERE</span> <span class="n">X</span> <span class="k">identity</span> <span class="n">XX</span><span class="p">,</span> <span class="n">X</span> <span class="n">name</span> <span class="n">XN</span><span class="p">,</span>
<span class="k">WITH</span> <span class="n">X</span><span class="p">,</span> <span class="n">XN</span><span class="p">,</span> <span class="n">VC</span> <span class="n">BEING</span> <span class="p">(</span><span class="k">Any</span> <span class="n">X</span><span class="p">,</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">V</span><span class="p">)</span> <span class="n">GROUPBY</span> <span class="n">X</span> <span class="k">WHERE</span> <span class="n">V</span> <span class="n">version_of</span> <span class="n">X</span><span class="p">),</span>
     <span class="n">XX</span><span class="p">,</span> <span class="n">TC</span> <span class="n">BEING</span> <span class="p">(</span><span class="k">Any</span> <span class="n">X</span><span class="p">,</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">T</span><span class="p">)</span> <span class="n">GROUPBY</span> <span class="n">X</span> <span class="k">WHERE</span> <span class="n">T</span> <span class="n">ticket_of</span> <span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
<p class="last">which would result in a SQL execution error.</p>
</div>
</div>
<div class="section" id="union">
<h3>2.2.7.8. Union<a class="headerlink" href="#union" title="Permalink to this headline">¶</a></h3>
<p>You may get a result set containing the concatenation of several queries using
the <tt class="docutils literal"><span class="pre">UNION</span></tt>. The selection of each query should have the same number of
columns.</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="p">(</span><span class="k">Any</span> <span class="n">X</span><span class="p">,</span> <span class="n">XN</span> <span class="k">WHERE</span> <span class="n">X</span> <span class="k">is</span> <span class="n">Person</span><span class="p">,</span> <span class="n">X</span> <span class="n">surname</span> <span class="n">XN</span><span class="p">)</span> <span class="k">UNION</span> <span class="p">(</span><span class="k">Any</span> <span class="n">X</span><span class="p">,</span><span class="n">XN</span> <span class="k">WHERE</span> <span class="n">X</span> <span class="k">is</span> <span class="n">Company</span><span class="p">,</span> <span class="n">X</span> <span class="n">name</span> <span class="n">XN</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="available-functions">
<span id="rqlfunctions"></span><h2>2.2.8. Available functions<a class="headerlink" href="#available-functions" title="Permalink to this headline">¶</a></h2>
<p>Below is the list of aggregate and transformation functions that are supported
nativly by the framework. Notice that cubes may define additional functions.</p>
<div class="section" id="aggregate-functions">
<span id="rqlaggregatefunctions"></span><h3>2.2.8.1. Aggregate functions<a class="headerlink" href="#aggregate-functions" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><tt class="xref py py-func docutils literal"><span class="pre">COUNT()</span></tt></td>
<td>return the number of rows</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-func docutils literal"><span class="pre">MIN()</span></tt></td>
<td>return the minimum value</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-func docutils literal"><span class="pre">MAX()</span></tt></td>
<td>return the maximum value</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-func docutils literal"><span class="pre">AVG()</span></tt></td>
<td>return the average value</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-func docutils literal"><span class="pre">SUM()</span></tt></td>
<td>return the sum of values</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-func docutils literal"><span class="pre">COMMA_JOIN()</span></tt></td>
<td>return each value separated by a comma (for string only)</td>
</tr>
</tbody>
</table>
<p>All aggregate functions above take a single argument. Take care some aggregate
functions (e.g. <tt class="docutils literal"><span class="pre">MAX</span></tt>, <tt class="docutils literal"><span class="pre">MIN</span></tt>) may return <cite>None</cite> if there is no
result row.</p>
</div>
<div class="section" id="string-transformation-functions">
<span id="rqlstringfunctions"></span><h3>2.2.8.2. String transformation functions<a class="headerlink" href="#string-transformation-functions" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="44%" />
<col width="56%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><tt class="xref py py-func docutils literal"><span class="pre">UPPER(String)()</span></tt></td>
<td>upper case the string</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-func docutils literal"><span class="pre">LOWER(String)()</span></tt></td>
<td>lower case the string</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-func docutils literal"><span class="pre">LENGTH(String)()</span></tt></td>
<td>return the length of the string</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-func docutils literal"><span class="pre">SUBSTRING(String,</span> <span class="pre">start,</span> <span class="pre">length)()</span></tt></td>
<td>extract from the string a string starting at given index and of
given length</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-func docutils literal"><span class="pre">LIMIT_SIZE(String,</span> <span class="pre">max</span> <span class="pre">size)()</span></tt></td>
<td>if the length of the string is greater than given max size,
strip it and add ellipsis (&#8221;...&#8221;). The resulting string will
hence have max size + 3 characters</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-func docutils literal"><span class="pre">TEXT_LIMIT_SIZE(String,</span> <span class="pre">format,</span> <span class="pre">max</span> <span class="pre">size)()</span></tt></td>
<td>similar to the above, but allow to specify the MIME type of the
text contained by the string. Supported formats are text/html,
text/xhtml and text/xml. All others will be considered as plain
text. For non plain text format, sgml tags will be first removed
before limiting the string.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="date-extraction-functions">
<span id="rqldatefunctions"></span><h3>2.2.8.3. Date extraction functions<a class="headerlink" href="#date-extraction-functions" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="39%" />
<col width="61%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><tt class="xref py py-func docutils literal"><span class="pre">YEAR(Date)()</span></tt></td>
<td>return the year of a date or datetime</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-func docutils literal"><span class="pre">MONTH(Date)()</span></tt></td>
<td>return the month of a date or datetime</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-func docutils literal"><span class="pre">DAY(Date)()</span></tt></td>
<td>return the day of a date or datetime</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-func docutils literal"><span class="pre">HOUR(Datetime)()</span></tt></td>
<td>return the hours of a datetime</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-func docutils literal"><span class="pre">MINUTE(Datetime)()</span></tt></td>
<td>return the minutes of a datetime</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-func docutils literal"><span class="pre">SECOND(Datetime)()</span></tt></td>
<td>return the seconds of a datetime</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-func docutils literal"><span class="pre">WEEKDAY(Date)()</span></tt></td>
<td>return the day of week of a date or
datetime.  Sunday == 1, Saturday == 7.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="other-functions">
<span id="rqlotherfunctions"></span><h3>2.2.8.4. Other functions<a class="headerlink" href="#other-functions" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><tt class="xref py py-func docutils literal"><span class="pre">ABS(num)()</span></tt></td>
<td>return the absolute value of a number</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-func docutils literal"><span class="pre">RANDOM()</span></tt></td>
<td>return a pseudo-random value from 0.0 to 1.0</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-func docutils literal"><span class="pre">FSPATH(X)()</span></tt></td>
<td>expect X to be an attribute whose value is stored in a
<tt class="xref py py-class docutils literal"><span class="pre">BFSStorage</span></tt> and return its path on the file system</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-func docutils literal"><span class="pre">FTIRANK(X)()</span></tt></td>
<td>expect X to be an entity used in a has_text relation, and return a
number corresponding to the rank order of each resulting entity</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-func docutils literal"><span class="pre">CAST(Type,</span> <span class="pre">X)()</span></tt></td>
<td>expect X to be an attribute and return it casted into the given
final type</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="examples">
<span id="rqlexamples"></span><h2>2.2.9. Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first"><em>Search for the object of identifier 53</em></p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">Any</span> <span class="k">WHERE</span> <span class="n">X</span> <span class="n">eid</span> <span class="mi">53</span>
</pre></div>
</div>
</li>
<li><p class="first"><em>Search material such as comics, owned by syt and available</em></p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">Any</span> <span class="n">X</span> <span class="k">WHERE</span> <span class="n">X</span> <span class="k">is</span> <span class="n">Document</span><span class="p">,</span>
            <span class="n">X</span> <span class="n">occurence_of</span> <span class="n">F</span><span class="p">,</span> <span class="n">F</span> <span class="k">class</span> <span class="k">C</span><span class="p">,</span> <span class="k">C</span> <span class="n">name</span> <span class="s1">&#39;Comics&#39;</span><span class="p">,</span>
            <span class="n">X</span> <span class="n">owned_by</span> <span class="n">U</span><span class="p">,</span> <span class="n">U</span> <span class="n">login</span> <span class="s1">&#39;syt&#39;</span><span class="p">,</span>
            <span class="n">X</span> <span class="n">available</span> <span class="k">TRUE</span>
</pre></div>
</div>
</li>
<li><p class="first"><em>Looking for people working for eurocopter interested in training</em></p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">Any</span> <span class="n">P</span> <span class="k">WHERE</span> <span class="n">P</span> <span class="k">is</span> <span class="n">Person</span><span class="p">,</span> <span class="n">P</span> <span class="n">work_for</span> <span class="n">S</span><span class="p">,</span> <span class="n">S</span> <span class="n">name</span> <span class="s1">&#39;Eurocopter&#39;</span><span class="p">,</span>
            <span class="n">P</span> <span class="n">interested_by</span> <span class="n">T</span><span class="p">,</span> <span class="n">T</span> <span class="n">name</span> <span class="s1">&#39;training&#39;</span>
</pre></div>
</div>
</li>
<li><p class="first"><em>Search note less than 10 days old written by jphc or ocy</em></p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">Any</span> <span class="n">N</span> <span class="k">WHERE</span> <span class="n">N</span> <span class="k">is</span> <span class="n">Note</span><span class="p">,</span> <span class="n">N</span> <span class="n">written_on</span> <span class="n">D</span><span class="p">,</span> <span class="n">D</span> <span class="k">day</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">today</span> <span class="o">-</span><span class="mi">10</span><span class="p">),</span>
            <span class="n">N</span> <span class="n">written_by</span> <span class="n">P</span><span class="p">,</span> <span class="n">P</span> <span class="n">name</span> <span class="s1">&#39;jphc&#39;</span> <span class="k">or</span> <span class="n">P</span> <span class="n">name</span> <span class="s1">&#39;ocy&#39;</span>
</pre></div>
</div>
</li>
<li><p class="first"><em>Looking for people interested in training or living in Paris</em></p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">Any</span> <span class="n">P</span> <span class="k">WHERE</span> <span class="n">P</span> <span class="k">is</span> <span class="n">Person</span><span class="p">,</span> <span class="p">(</span><span class="n">P</span> <span class="n">interested_by</span> <span class="n">T</span><span class="p">,</span> <span class="n">T</span> <span class="n">name</span> <span class="s1">&#39;training&#39;</span><span class="p">)</span> <span class="k">OR</span>
            <span class="p">(</span><span class="n">P</span> <span class="n">city</span> <span class="s1">&#39;Paris&#39;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first"><em>The surname and firstname of all people</em></p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">Any</span> <span class="n">N</span><span class="p">,</span> <span class="n">P</span> <span class="k">WHERE</span> <span class="n">X</span> <span class="k">is</span> <span class="n">Person</span><span class="p">,</span> <span class="n">X</span> <span class="n">name</span> <span class="n">N</span><span class="p">,</span> <span class="n">X</span> <span class="n">firstname</span> <span class="n">P</span>
</pre></div>
</div>
<p>Note that the selection of several entities generally force
the use of &#8220;Any&#8221; because the type specification applies otherwise
to all the selected variables. We could write here</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="n">String</span> <span class="n">N</span><span class="p">,</span> <span class="n">P</span> <span class="k">WHERE</span> <span class="n">X</span> <span class="k">is</span> <span class="n">Person</span><span class="p">,</span> <span class="n">X</span> <span class="n">name</span> <span class="n">N</span><span class="p">,</span> <span class="n">X</span> <span class="n">first_name</span> <span class="n">P</span>
</pre></div>
</div>
<p>Note: You can not specify several types with * ... where X is FirstType or X is SecondType*.
To specify several types explicitly, you have to do</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">Any</span> <span class="n">X</span> <span class="k">WHERE</span> <span class="n">X</span> <span class="k">is</span> <span class="k">IN</span> <span class="p">(</span><span class="n">FirstType</span><span class="p">,</span> <span class="n">SecondType</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="insertion-query">
<span id="rqlinsertquery"></span><h2>2.2.10. Insertion query<a class="headerlink" href="#insertion-query" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><cite>INSERT</cite> &lt;entity type&gt; V1 (, &lt;entity type&gt; V2) * <cite>:</cite> &lt;assignments&gt;
[ <cite>WHERE</cite> &lt;restriction&gt;]</div></blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">assignments:</th><td class="field-body">list of relations to assign in the form <cite>V1 relationship V2 | &lt;static value&gt;</cite></td>
</tr>
</tbody>
</table>
<p>The restriction can define variables used in assignments.</p>
<p>Caution, if a restriction is specified, the insertion is done for
<em>each line result returned by the restriction</em>.</p>
<ul>
<li><p class="first"><em>Insert a new person named &#8216;foo&#8217;</em></p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">INSERT</span> <span class="n">Person</span> <span class="n">X</span><span class="p">:</span> <span class="n">X</span> <span class="n">name</span> <span class="s1">&#39;foo&#39;</span>
</pre></div>
</div>
</li>
<li><p class="first"><em>Insert a new person named &#8216;foo&#8217;, another called &#8216;nice&#8217; and a &#8216;friend&#8217; relation
between them</em></p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">INSERT</span> <span class="n">Person</span> <span class="n">X</span><span class="p">,</span> <span class="n">Person</span> <span class="n">Y</span><span class="p">:</span> <span class="n">X</span> <span class="n">name</span> <span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="n">Y</span> <span class="n">name</span> <span class="s1">&#39;nice&#39;</span><span class="p">,</span> <span class="n">X</span> <span class="n">friend</span> <span class="n">Y</span>
</pre></div>
</div>
</li>
<li><p class="first"><em>Insert a new person named &#8216;foo&#8217; and a &#8216;friend&#8217; relation with an existing
person called &#8216;nice&#8217;</em></p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">INSERT</span> <span class="n">Person</span> <span class="n">X</span><span class="p">:</span> <span class="n">X</span> <span class="n">name</span> <span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="n">X</span> <span class="n">friend</span>  <span class="n">Y</span> <span class="k">WHERE</span> <span class="n">Y</span> <span class="n">name</span> <span class="s1">&#39;nice&#39;</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="update-and-relation-creation-queries">
<span id="rqlsetquery"></span><h2>2.2.11. Update and relation creation queries<a class="headerlink" href="#update-and-relation-creation-queries" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><cite>SET</cite> &lt;assignements&gt;
[ <cite>WHERE</cite> &lt;restriction&gt;]</div></blockquote>
<p>Caution, if a restriction is specified, the update is done <em>for
each result line returned by the restriction</em>.</p>
<ul>
<li><p class="first"><em>Renaming of the person named &#8216;foo&#8217; to &#8216;bar&#8217; with the first name changed</em></p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SET</span> <span class="n">X</span> <span class="n">name</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">X</span> <span class="n">firstname</span> <span class="s1">&#39;original&#39;</span> <span class="k">WHERE</span> <span class="n">X</span> <span class="k">is</span> <span class="n">Person</span><span class="p">,</span> <span class="n">X</span> <span class="n">name</span> <span class="s1">&#39;foo&#39;</span>
</pre></div>
</div>
</li>
<li><p class="first"><em>Insert a relation of type &#8216;know&#8217; between objects linked by
the relation of type &#8216;friend&#8217;</em></p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SET</span> <span class="n">X</span> <span class="n">know</span> <span class="n">Y</span>  <span class="k">WHERE</span> <span class="n">X</span> <span class="n">friend</span> <span class="n">Y</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="deletion-query">
<span id="rqldeletequery"></span><h2>2.2.12. Deletion query<a class="headerlink" href="#deletion-query" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><cite>DELETE</cite> (&lt;entity type&gt; V) | (V1 relation v2 ),...
[ <cite>WHERE</cite> &lt;restriction&gt;]</div></blockquote>
<p>Caution, if a restriction is specified, the deletion is made <em>for
each line result returned by the restriction</em>.</p>
<ul>
<li><p class="first"><em>Deletion of the person named &#8216;foo&#8217;</em></p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">DELETE</span> <span class="n">Person</span> <span class="n">X</span> <span class="k">WHERE</span> <span class="n">X</span> <span class="n">name</span> <span class="s1">&#39;foo&#39;</span>
</pre></div>
</div>
</li>
<li><p class="first"><em>Removal of all relations of type &#8216;friend&#8217; from the person named &#8216;foo&#8217;</em></p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">DELETE</span> <span class="n">X</span> <span class="n">friend</span> <span class="n">Y</span> <span class="k">WHERE</span> <span class="n">X</span> <span class="k">is</span> <span class="n">Person</span><span class="p">,</span> <span class="n">X</span> <span class="n">name</span> <span class="s1">&#39;foo&#39;</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="debugging.html" title="2.3. Debugging RQL"
             >next</a> |</li>
        <li class="right" >
          <a href="intro.html" title="2.1. Introduction"
             >previous</a> |</li>
        <li><a href="../../index.html">CubicWeb 3.18.3</a> &raquo;</li>
          <li><a href="../index.html" >Appendixes</a> &raquo;</li>
          <li><a href="index.html" >2. Relation Query Language (RQL)</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2001-2014, Logilab.
      Last updated on Mar 11, 2014.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>