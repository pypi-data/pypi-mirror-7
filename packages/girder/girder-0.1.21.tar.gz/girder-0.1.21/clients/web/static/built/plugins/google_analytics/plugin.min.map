{"version":3,"file":"plugin.min.js","sources":["templates.js","../../../../../../plugins/google_analytics/web_client/js/ConfigView.js","../../../../../../plugins/google_analytics/web_client/js/backbone.analytics.js","../../../../../../plugins/google_analytics/web_client/js/setup.js"],"names":["this","buf","push","join","girder","views","google_analytics_ConfigView","View","extend","events","submit #g-google_analytics-form","event","preventDefault","$","empty","_saveSettings","key","value","val","trim","initialize","restRequest","type","path","data","list","JSON","stringify","done","_","bind","resp","render","$el","html","jade","templates","google_analytics_config","breadcrumb","PluginConfigBreadcrumbWidget","pluginName","el","settings","error","trigger","icon","text","timeout","responseJSON","message","router","route","factory","define","amd","exports","module","require","window","Backbone","loadUrl","History","prototype","matched","apply","arguments","gaFragment","fragment","options","silent","test","_gaq","ga","GoogleAnalyticsObject","exposePluginConfig","on","i","s","o","g","r","a","m","q","l","Date","createElement","getElementsByTagName","async","src","parentNode","insertBefore","document","args","curRoute"],"mappings":"AAAAA,KAAW,KAAIA,KAAW,SAC1BA,KAAW,KAAa,UAAIA,KAAW,KAAa,cAEpDA,KAAW,KAAa,UAA2B,wBAAI,WACvD,GAAIC,KAIspB,OAA1pBA,GAAIC,KAAK,gnBAAwpBD,EAAIE,KAAK,KCJ1qBC,OAAOC,MAAMC,4BAA8BF,OAAOG,KAAKC,QACnDC,QACIC,kCAAmC,SAAUC,GACzCA,EAAMC,iBACNZ,KAAKa,EAAE,qCAAqCC,QAE5Cd,KAAKe,gBACDC,IAAK,+BACLC,MAAOjB,KAAKa,EAAE,iCAAiCK,MAAMC,YAIjEC,WAAY,WACRhB,OAAOiB,aACHC,KAAM,MACNC,KAAM,iBACNC,MACEC,KAAMC,KAAKC,WAAW,oCAEzBC,KAAKC,EAAEC,KAAK,SAAUC,GACrB/B,KAAKgC,SACLhC,KAAKa,EAAE,iCAAiCK,IACpCa,EAAK,kCAEV/B,QAGPgC,OAAQ,WAUJ,MATAhC,MAAKiC,IAAIC,KAAKC,KAAKC,UAAUC,2BAExBrC,KAAKsC,aACNtC,KAAKsC,WAAa,GAAIlC,QAAOC,MAAMkC,8BAC/BC,WAAY,mBACZC,GAAIzC,KAAKa,EAAE,oCACZmB,UAGAhC,MAGXe,cAAe,SAAU2B,GACrBtC,OAAOiB,aACHC,KAAM,MACNC,KAAM,iBACNC,MACIC,KAAMC,KAAKC,UAAUe,IAEzBC,MAAO,OACRf,KAAKC,EAAEC,KAAK,WACX1B,OAAOK,OAAOmC,QAAQ,WAClBC,KAAM,KACNC,KAAM,kBACNxB,KAAM,UACNyB,QAAS,OAEd/C,OAAO2C,MAAMd,EAAEC,KAAK,SAAUC,GAC7B/B,KAAKa,EAAE,qCAAqCiC,KACxCf,EAAKiB,aAAaC,UACvBjD,UAIXI,OAAO8C,OAAOC,MAAM,kCAAmC,yBAA0B,WAC7E/C,OAAOK,OAAOmC,QAAQ,eAAgBxC,OAAOC,MAAMC,+BC/CvD,SAAU8C,GAER,YAEsB,mBAAXC,SAAyBA,OAAOC,IACzCD,QAAQ,YAAaD,GACO,gBAAZG,SAChBC,OAAOD,QAAUH,EAAQK,QAAQ,aAEjCL,EAAQM,OAAOC,WAEhB,SAASA,GAEV,YAEA,IAAIC,GAAUD,EAASE,QAAQC,UAAUF,OAEzCD,GAASE,QAAQC,UAAUF,QAAU,WACnC,GAAIG,GAAUH,EAAQI,MAAMhE,KAAMiE,WAC9BC,EAAalE,KAAKmE,QAEtB,KAAKnE,KAAKoE,QAAQC,OAEhB,MADArE,MAAKoE,QAAQC,QAAS,EACfN,CAGJ,OAAMO,KAAKJ,KACdA,EAAa,IAAMA,GAIM,mBAAhBR,QAAOa,MAChBb,OAAOa,KAAKrE,MAAM,iBAAkBgE,GAItC,IAAIM,EAUJ,OAREA,GADEd,OAAOe,uBAA0D,OAAjCf,OAAOe,sBACpCf,OAAOe,sBAEPf,OAAOc,GAGI,mBAAPA,IACTA,EAAG,OAAQ,WAAYN,GAElBH,KClEX3D,OAAOsE,mBAAmB,mBAAoB,mCAC9CtE,OAAOK,OAAOkE,GAAG,kBAAmB,YAOhC,SAAUC,EAAEC,EAAEC,EAAEC,EAAEC,EAAEC,EAAEC,GAAGN,EAAyB,sBAAEI,EAAEJ,EAAEI,GAAGJ,EAAEI,IAAI,YAChEJ,EAAEI,GAAGG,EAAEP,EAAEI,GAAGG,OAAOjF,KAAK+D,YAAYW,EAAEI,GAAGI,EAAE,EAAE,GAAIC,MAAOJ,EAAEJ,EAAES,cAAcR,GAC3EI,EAAEL,EAAEU,qBAAqBT,GAAG,GAAGG,EAAEO,MAAM,EAAEP,EAAEQ,IAAIV,EAAEG,EAAEQ,WAAWC,aAAaV,EAAEC,IAC1ExB,OAAOkC,SAAS,SAAS,0CAA0C,MAGtExF,OAAOiB,aACHC,KAAM,MACNC,KAAM,iBACNC,MACIC,KAAMC,KAAKC,WAAW,oCAE3BC,KAAKC,EAAEC,KAAK,SAAUC,GACrByC,GAAG,SAAUzC,EAAK,gCAAiC,SACpD/B,SAOPI,OAAOK,OAAOkE,GAAG,oBAAqB,SAAUkB,GAC5C,GAAIC,GAAWD,EAAK1C,KACf,OAAMmB,KAAKwB,KACdA,EAAW,IAAMA,GAEnBtB,GAAG,OAAQ,WAAYsB","sourcesContent":["this[\"jade\"] = this[\"jade\"] || {};\nthis[\"jade\"][\"templates\"] = this[\"jade\"][\"templates\"] || {};\n\nthis[\"jade\"][\"templates\"][\"google_analytics_config\"] = function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\nvar jade_interp;\n\nbuf.push(\"<div class=\\\"g-config-breadcrumb-container\\\"></div><div class=\\\"g-google-analytics-description\\\">To track pageviews in Girder, enter your Google Analytics tracking ID here.</div><form id=\\\"g-google_analytics-form\\\" role=\\\"form\\\"><div class=\\\"form-group\\\"><label for=\\\"google_analytics.tracking_id\\\" class=\\\"control-label\\\">Google Analytics Tracking ID</label><input id=\\\"google_analytics\\\" type=\\\"text\\\" placeholder=\\\"Tracking ID\\\" class=\\\"input-sm form-control tracking_id\\\"/></div><p id=\\\"g-oauth-provider-google-error-message\\\" class=\\\"g-validation-failed-message\\\"></p><input type=\\\"submit\\\" value=\\\"Save\\\" class=\\\"btn btn-sm btn-primary\\\"/></form>\");;return buf.join(\"\");\n};","/**\n * Administrative configuration view. Shows the global-level settings for this\n * plugin for setting the Google Analytics tracking ID.\n */\ngirder.views.google_analytics_ConfigView = girder.View.extend({\n    events: {\n        'submit #g-google_analytics-form': function (event) {\n            event.preventDefault();\n            this.$('#g-google_analytics-error-message').empty();\n\n            this._saveSettings([{\n                key: 'google_analytics.tracking_id',\n                value: this.$('#google_analytics.tracking_id').val().trim()\n            }]);\n        }\n    },\n    initialize: function () {\n        girder.restRequest({\n            type: 'GET',\n            path: 'system/setting',\n            data: {\n              list: JSON.stringify(['google_analytics.tracking_id'])\n            }\n        }).done(_.bind(function (resp) {\n            this.render();\n            this.$('#google_analytics.tracking_id').val(\n                resp['google_analytics.tracking_id']\n            );\n        }, this));\n    },\n\n    render: function () {\n        this.$el.html(jade.templates.google_analytics_config());\n\n        if (!this.breadcrumb) {\n            this.breadcrumb = new girder.views.PluginConfigBreadcrumbWidget({\n                pluginName: 'Google Analytics',\n                el: this.$('.g-config-breadcrumb-container')\n            }).render();\n        }\n\n        return this;\n    },\n\n    _saveSettings: function (settings) {\n        girder.restRequest({\n            type: 'PUT',\n            path: 'system/setting',\n            data: {\n                list: JSON.stringify(settings)\n            },\n            error: null\n        }).done(_.bind(function (resp) {\n            girder.events.trigger('g:alert', {\n                icon: 'ok',\n                text: 'Settings saved.',\n                type: 'success',\n                timeout: 4000\n            });\n        }, this)).error(_.bind(function (resp) {\n            this.$('#g-google_analytics-error-message').text(\n                resp.responseJSON.message);\n        }, this));\n    }\n});\n\ngirder.router.route('plugins/google_analytics/config', 'google_analyticsConfig', function () {\n    girder.events.trigger('g:navigateTo', girder.views.google_analytics_ConfigView);\n});\n","// Copyright (C) 2013 by Kendall Buchanan\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n/* jshint ignore:start */\n(function(factory) {\n\n  'use strict';\n\n  if (typeof define === 'function' && define.amd) {\n    define(['backbone'], factory);\n  } else if (typeof exports === 'object') {\n    module.exports = factory(require('backbone'));\n  } else {\n    factory(window.Backbone);\n  }\n})(function(Backbone) {\n\n  'use strict';\n\n  var loadUrl = Backbone.History.prototype.loadUrl;\n\n  Backbone.History.prototype.loadUrl = function(fragmentOverride) {\n    var matched = loadUrl.apply(this, arguments),\n        gaFragment = this.fragment;\n\n    if (!this.options.silent) {\n      this.options.silent = true;\n      return matched;\n    }\n\n    if (!/^\\//.test(gaFragment)) {\n      gaFragment = '/' + gaFragment;\n    }\n\n    // legacy version\n    if (typeof window._gaq !== \"undefined\") {\n      window._gaq.push(['_trackPageview', gaFragment]);\n    }\n\n    // Analytics.js\n    var ga;\n    if (window.GoogleAnalyticsObject && window.GoogleAnalyticsObject !== 'ga') {\n      ga = window.GoogleAnalyticsObject;\n    } else {\n      ga = window.ga;\n    }\n\n    if (typeof ga !== 'undefined') {\n      ga('send', 'pageview', gaFragment);\n    }\n    return matched;\n  };\n\n});\n/* jshint ignore:end */\n","girder.exposePluginConfig('google_analytics', 'plugins/google_analytics/config');\ngirder.events.on('g:appload.after', function () {\n\n    // We ignore this block of code as it is the standard Google Analytics\n    // snippet. We also make sure that JSHint knows we have a ga object for\n    // interacting with it.\n    /* global ga */\n    /* jshint ignore:start */\n    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){\n    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),\n    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)\n    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');\n    /* jshint ignore:end */\n\n    girder.restRequest({\n        type: 'GET',\n        path: 'system/setting',\n        data: {\n            list: JSON.stringify(['google_analytics.tracking_id'])\n        }\n    }).done(_.bind(function (resp) {\n        ga('create', resp['google_analytics.tracking_id'], 'none');\n    }, this));\n});\n\n/**\n * Add analytics for the hierarchy widget specifically since it routes without\n * triggering (calling navigate without {trigger: true}).\n */\ngirder.events.on('g:hierarchy.route', function (args) {\n    var curRoute = args.route;\n    if (!/^\\//.test(curRoute)) {\n      curRoute = '/' + curRoute;\n    }\n    ga('send', 'pageview', curRoute);\n});\n"]}