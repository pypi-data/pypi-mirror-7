function capitalize(t){var e=t.substr(0,1).toUpperCase();return e+=t.slice(1)}function month(t){switch(t){case 0:return"Jan";case 1:return"Feb";case 2:return"Mar";case 3:return"Apr";case 4:return"May";case 5:return"Jun";case 6:return"Jul";case 7:return"Aug";case 8:return"Sep";case 9:return"Oct";case 10:return"Nov";case 11:return"Dec"}}function padNum(t,e){for(t+="";t.length<e;)t=0+t;return t}function statusColor(t){switch(t){case"evaluating":return"warning";case"approved":return"info";case"paid":return"success";case"incomplete":case"rejected":return"danger";default:return""}}function flash(t,e){var n=$("<div></div>");n.addClass("alert alert-dismissable fade in"),n.addClass("alert-"+e);var i=$("<button>&times;</button>");i.attr("type","button"),i.attr("data-dismiss","alert"),i.addClass("close"),n.append(i),n.append(t),$("#content").prepend(n)}function renderRequest(t){var e,n=$("#actionMenu"),i=$("#actionList"),r=$("#request-status"),a=$("#modifierList"),o=$("#request-details"),s=$("#request-payout"),u=$("#request-division"),l=$(".evaluating-only");n.empty(),n.append(Handlebars.templates.action_menu(t)),i.empty(),i.append(Handlebars.templates.actions(t)),r.removeClass("label-warning label-info label-success label-danger"),r.addClass("label-"+statusColor(t.status)),r.text(capitalize(t.status)),e=$.map(t.modifiers,function(e){return e.void?Handlebars.templates.voided_modifier(e):"evaluating"===t.status&&-1!==t.valid_actions.indexOf("approved")?Handlebars.templates.voidable_modifier(e):Handlebars.templates.modifier(e)}),a.empty(),a.append(e),o.text(t.details),s.tooltip("destroy"),s.tooltip({title:"Base Payout: "+t.base_payout,placement:"right"}),s.text(t.payout),"evaluating"===t.status?l.prop("disabled",!1):l.prop("disabled",!0),u.text(t.division.name)}function submitAction(t){var e=$(t.target),n=e.closest("form");return n.find("input[name='type_']").attr("value",e.attr("id")),$.post(window.location.pathname,n.serialize(),function(e){n.find("textarea").val(""),$(t.target).hasClass("btn")||n.find("button.dropdown-toggle").dropdown("toggle"),renderRequest(e)}),!1}function pageNumbers(t,e,n){void 0===n&&(n={left_edge:2,left_current:2,right_current:5,right_edge:2});for(var i=[],r=0;t>r;++r)r<n.left_edge?i.push(r):e-n.left_current-1<r&&r<e+n.right_current?i.push(r):t-n.right_edge-1<r?i.push(r):null!==i[i.length-1]&&i.push(null);return i}function addRequestSorts(t){var e=PourOver.makeExplicitSort("status_asc",t,"status",["evaluating","incomplete","approved","rejected","paid"]),n=[e],i=PourOver.Sort.extend({fn:function(t,e){var n=t[this.attr],i=e[this.attr];return n.localeCompare(i)}});n=n.concat($.map(["alliance","corporation","pilot","ship","division","system"],function(t){return new i(t+"_asc",{attr:t})}));var r=PourOver.Sort.extend({fn:function(t,e){var n=t[this.attr].getTime(),i=e[this.attr].getTime();return i>n?-1:n>i?1:0}});n=n.concat($.map(["kill_timestamp","submit_timestamp"],function(t){return new r(t+"_asc",{attr:t})}));var a=PourOver.Sort.extend({fn:function(t,e){var n=t[this.attr],i=e[this.attr];return n-i}});n=n.concat($.map(["payout","id"],function(t){return new a(t+"_asc",{attr:t})}));var o=PourOver.Sort.extend({fn:function(t,e){return-1*this.base_sort.fn(t,e)}});n=n.concat($.map(n,function(t){return name=t.attr+"_dsc",new o(name,{base_sort:t})})),t.addSorts(n)}function modifyToken(t){function e(t){if(void 0===t.attr){var e=t.label.split(":");t.attr=e[0],t.real_value="status"===t.attr?e.slice(1).join(":").toLowerCase():e.slice(1).join(":")}t.label=t.value}if(t.attrs instanceof Array)for(var n=0;n<t.attrs.length;++n)e(t.attrs[n]);else e(t.attrs)}function addedToken(t){function e(t){requests.filters[t.attr].unionQuery(t.real_value)}if(t.attrs instanceof Array)for(var n=0;n<t.attrs.length;++n)e(t.attrs[n]);else e(t.attrs)}function removedToken(t){function e(t){requests.filters[t.attr].removeSingleQuery(t.real_value)}if(t.attrs instanceof Array)for(var n=0;n<t.attrs.length;++n)e(t.attrs[n]);else e(t.attrs)}function attachTokenfield(t){function e(e,n){var i=e.split(":");if(attribute=i[0],real_query=i.slice(1).join(":"),""===real_query&&(real_query=attribute,attribute=""),void 0!==t[attribute])t[attribute].get(real_query,n);else{var r=new Object;for(attr in t)t[attr].get(real_query,function(e){r[attr]=e;var i=!0;for(attr2 in t)if(void 0===r[attr2]){i=!1;break}if(i){var a=[];$.each(r,function(t){Array.prototype.push.apply(a,r[t])}),n(a)}})}}var n=[];n.push({hint:!1,highlight:!0}),n.push({name:"all_args",displayKey:function(t){if("status"===t.attr){var e=t.real_value.substr(0,1).toUpperCase();return e+=t.real_value.slice(1),t.attr+":"+e}return t.attr+":"+t.real_value},source:e}),$(".filter-tokenfield").tokenfield({typeahead:n}).on("tokenfield:createtoken",modifyToken).on("tokenfield:createdtoken",addedToken).on("tokenfield:removetoken",removedToken)}function addRequestFilters(t,e,n){function i(t,e){var i=$.map(e,function(e){return{real_value:e,attr:t}});n[t]=new Bloodhound({name:t,datumTokenizer:function(t){var e=t.real_value.split(/\s+/);return e.push(t.attr+":"+e[0]),e},queryTokenizer:Bloodhound.tokenizers.whitespace,local:i}),n[t].initialize(),o[t]=!0;for(var a=!0,s=0;s<r.length;++s)if(!o[r[s]]){a=!1;break}a&&attachTokenfield(n)}var r,a=["pilot","corporation","alliance","system","constellation","region","ship","status","division"];r=e.items.length?a.filter(function(t){return void 0!==e.items[0][t]}):a;for(var o=new Object,s=0;s<r.length;++s)o[r[s]]=!1;$.map(r,function(t){if("status"===t){var n=PourOver.makeExactFilter("status",["evaluating","approved","rejected","incomplete","paid"]);requests.addFilters(n),i(t,n.values)}else $.ajax($SCRIPT_ROOT+"/api/filter/"+t+"/",{dataType:"json",success:function(n){var r=PourOver.makeExactFilter(t,n[t]);e.addFilters(r),i(t,n[t])}})})}function payoutButton(){var t=$(this).closest("form");return $.post(t.attr("action"),{id_:t.find("#id_").val(),type_:t.find("#type_").val(),csrf_token:t.find("#csrf_token").val()},function(){var e=t.parents("tr"),n=e.find(".col-id").last().text();n=parseInt(n,10);var i=requests.getBy("id",n)[0];requests.updateItem(i.cid,"status","paid"),e.find("button").attr("disabled","disabled")}),!1}function pager_a_click(t){if("prev_page"===$(this).attr("id"))request_view.page(-1);else if("next_page"==$(this).attr("id"))request_view.page(1);else{var e=parseInt($(this).contents()[0].data,10);e-=1,request_view.setPage(e)}var n=window.location.pathname.replace(/\/?(?:\d+\/?)?$/,"");n=n+"/"+(request_view.current_page+1)+"/",History.pushState({page:request_view.current_page,sort:request_view.getSort()},null,n),t.preventDefault()}function get_columns(t){var e=t.first();return e.find("th").map(function(t,e){return $(e).attr("id").substring(4)})}function setEntityID(t,e){$(this).closest("form").find("input[name='id_']").attr("value",e.id)}function rebuild_entities(t){$.getJSON("/api"+window.location.pathname+t+"/",function(e){var n=$("#"+t).find("table"),i=Handlebars.templates.entity_table(e);n.replaceWith(i)})}+function(t){"use strict";function e(e){t(i).remove(),t(r).each(function(){var i=n(t(this)),r={relatedTarget:this};i.hasClass("open")&&(i.trigger(e=t.Event("hide.bs.dropdown",r)),e.isDefaultPrevented()||i.removeClass("open").trigger("hidden.bs.dropdown",r))})}function n(e){var n=e.attr("data-target");n||(n=e.attr("href"),n=n&&/#[A-Za-z]/.test(n)&&n.replace(/.*(?=#[^\s]*$)/,""));var i=n&&t(n);return i&&i.length?i:e.parent()}var i=".dropdown-backdrop",r="[data-toggle=dropdown]",a=function(e){t(e).on("click.bs.dropdown",this.toggle)};a.prototype.toggle=function(i){var r=t(this);if(!r.is(".disabled, :disabled")){var a=n(r),o=a.hasClass("open");if(e(),!o){"ontouchstart"in document.documentElement&&!a.closest(".navbar-nav").length&&t('<div class="dropdown-backdrop"/>').insertAfter(t(this)).on("click",e);var s={relatedTarget:this};if(a.trigger(i=t.Event("show.bs.dropdown",s)),i.isDefaultPrevented())return;a.toggleClass("open").trigger("shown.bs.dropdown",s),r.focus()}return!1}},a.prototype.keydown=function(e){if(/(38|40|27)/.test(e.keyCode)){var i=t(this);if(e.preventDefault(),e.stopPropagation(),!i.is(".disabled, :disabled")){var a=n(i),o=a.hasClass("open");if(!o||o&&27==e.keyCode)return 27==e.which&&a.find(r).focus(),i.click();var s=" li:not(.divider):visible a",u=a.find("[role=menu]"+s+", [role=listbox]"+s);if(u.length){var l=u.index(u.filter(":focus"));38==e.keyCode&&l>0&&l--,40==e.keyCode&&l<u.length-1&&l++,~l||(l=0),u.eq(l).focus()}}}};var o=t.fn.dropdown;t.fn.dropdown=function(e){return this.each(function(){var n=t(this),i=n.data("bs.dropdown");i||n.data("bs.dropdown",i=new a(this)),"string"==typeof e&&i[e].call(n)})},t.fn.dropdown.Constructor=a,t.fn.dropdown.noConflict=function(){return t.fn.dropdown=o,this},t(document).on("click.bs.dropdown.data-api",e).on("click.bs.dropdown.data-api",".dropdown form",function(t){t.stopPropagation()}).on("click.bs.dropdown.data-api",r,a.prototype.toggle).on("keydown.bs.dropdown.data-api",r+", [role=menu], [role=listbox]",a.prototype.keydown)}(jQuery),+function(t){"use strict";var e=function(e){this.element=t(e)};e.prototype.show=function(){var e=this.element,n=e.closest("ul:not(.dropdown-menu)"),i=e.data("target");if(i||(i=e.attr("href"),i=i&&i.replace(/.*(?=#[^\s]*$)/,"")),!e.parent("li").hasClass("active")){var r=n.find(".active:last a")[0],a=t.Event("show.bs.tab",{relatedTarget:r});if(e.trigger(a),!a.isDefaultPrevented()){var o=t(i);this.activate(e.parent("li"),n),this.activate(o,o.parent(),function(){e.trigger({type:"shown.bs.tab",relatedTarget:r})})}}},e.prototype.activate=function(e,n,i){function r(){a.removeClass("active").find("> .dropdown-menu > .active").removeClass("active"),e.addClass("active"),o?(e[0].offsetWidth,e.addClass("in")):e.removeClass("fade"),e.parent(".dropdown-menu")&&e.closest("li.dropdown").addClass("active"),i&&i()}var a=n.find("> .active"),o=i&&t.support.transition&&a.hasClass("fade");o?a.one(t.support.transition.end,r).emulateTransitionEnd(150):r(),a.removeClass("in")};var n=t.fn.tab;t.fn.tab=function(n){return this.each(function(){var i=t(this),r=i.data("bs.tab");r||i.data("bs.tab",r=new e(this)),"string"==typeof n&&r[n]()})},t.fn.tab.Constructor=e,t.fn.tab.noConflict=function(){return t.fn.tab=n,this},t(document).on("click.bs.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(e){e.preventDefault(),t(this).tab("show")})}(jQuery),+function(t){"use strict";function e(){var t=document.createElement("bootstrap"),e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var n in e)if(void 0!==t.style[n])return{end:e[n]};return!1}t.fn.emulateTransitionEnd=function(e){var n=!1,i=this;t(this).one(t.support.transition.end,function(){n=!0});var r=function(){n||t(i).trigger(t.support.transition.end)};return setTimeout(r,e),this},t(function(){t.support.transition=e()})}(jQuery),+function(t){"use strict";var e=function(n,i){this.$element=t(n),this.options=t.extend({},e.DEFAULTS,i),this.transitioning=null,this.options.parent&&(this.$parent=t(this.options.parent)),this.options.toggle&&this.toggle()};e.DEFAULTS={toggle:!0},e.prototype.dimension=function(){var t=this.$element.hasClass("width");return t?"width":"height"},e.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var e=t.Event("show.bs.collapse");if(this.$element.trigger(e),!e.isDefaultPrevented()){var n=this.$parent&&this.$parent.find("> .panel > .in");if(n&&n.length){var i=n.data("bs.collapse");if(i&&i.transitioning)return;n.collapse("hide"),i||n.data("bs.collapse",null)}var r=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[r](0),this.transitioning=1;var a=function(){this.$element.removeClass("collapsing").addClass("collapse in")[r]("auto"),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!t.support.transition)return a.call(this);var o=t.camelCase(["scroll",r].join("-"));this.$element.one(t.support.transition.end,t.proxy(a,this)).emulateTransitionEnd(350)[r](this.$element[0][o])}}},e.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var e=t.Event("hide.bs.collapse");if(this.$element.trigger(e),!e.isDefaultPrevented()){var n=this.dimension();this.$element[n](this.$element[n]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse").removeClass("in"),this.transitioning=1;var i=function(){this.transitioning=0,this.$element.trigger("hidden.bs.collapse").removeClass("collapsing").addClass("collapse")};return t.support.transition?void this.$element[n](0).one(t.support.transition.end,t.proxy(i,this)).emulateTransitionEnd(350):i.call(this)}}},e.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()};var n=t.fn.collapse;t.fn.collapse=function(n){return this.each(function(){var i=t(this),r=i.data("bs.collapse"),a=t.extend({},e.DEFAULTS,i.data(),"object"==typeof n&&n);!r&&a.toggle&&"show"==n&&(n=!n),r||i.data("bs.collapse",r=new e(this,a)),"string"==typeof n&&r[n]()})},t.fn.collapse.Constructor=e,t.fn.collapse.noConflict=function(){return t.fn.collapse=n,this},t(document).on("click.bs.collapse.data-api","[data-toggle=collapse]",function(e){var n,i=t(this),r=i.attr("data-target")||e.preventDefault()||(n=i.attr("href"))&&n.replace(/.*(?=#[^\s]+$)/,""),a=t(r),o=a.data("bs.collapse"),s=o?"toggle":i.data(),u=i.attr("data-parent"),l=u&&t(u);o&&o.transitioning||(l&&l.find('[data-toggle=collapse][data-parent="'+u+'"]').not(i).addClass("collapsed"),i[a.hasClass("in")?"addClass":"removeClass"]("collapsed")),a.collapse(s)})}(jQuery),+function(t){"use strict";var e=function(t,e){this.type=this.options=this.enabled=this.timeout=this.hoverState=this.$element=null,this.init("tooltip",t,e)};e.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1},e.prototype.init=function(e,n,i){this.enabled=!0,this.type=e,this.$element=t(n),this.options=this.getOptions(i);for(var r=this.options.trigger.split(" "),a=r.length;a--;){var o=r[a];if("click"==o)this.$element.on("click."+this.type,this.options.selector,t.proxy(this.toggle,this));else if("manual"!=o){var s="hover"==o?"mouseenter":"focusin",u="hover"==o?"mouseleave":"focusout";this.$element.on(s+"."+this.type,this.options.selector,t.proxy(this.enter,this)),this.$element.on(u+"."+this.type,this.options.selector,t.proxy(this.leave,this))}}this.options.selector?this._options=t.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},e.prototype.getDefaults=function(){return e.DEFAULTS},e.prototype.getOptions=function(e){return e=t.extend({},this.getDefaults(),this.$element.data(),e),e.delay&&"number"==typeof e.delay&&(e.delay={show:e.delay,hide:e.delay}),e},e.prototype.getDelegateOptions=function(){var e={},n=this.getDefaults();return this._options&&t.each(this._options,function(t,i){n[t]!=i&&(e[t]=i)}),e},e.prototype.enter=function(e){var n=e instanceof this.constructor?e:t(e.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type);return clearTimeout(n.timeout),n.hoverState="in",n.options.delay&&n.options.delay.show?void(n.timeout=setTimeout(function(){"in"==n.hoverState&&n.show()},n.options.delay.show)):n.show()},e.prototype.leave=function(e){var n=e instanceof this.constructor?e:t(e.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type);return clearTimeout(n.timeout),n.hoverState="out",n.options.delay&&n.options.delay.hide?void(n.timeout=setTimeout(function(){"out"==n.hoverState&&n.hide()},n.options.delay.hide)):n.hide()},e.prototype.show=function(){var e=t.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){if(this.$element.trigger(e),e.isDefaultPrevented())return;var n=this,i=this.tip();this.setContent(),this.options.animation&&i.addClass("fade");var r="function"==typeof this.options.placement?this.options.placement.call(this,i[0],this.$element[0]):this.options.placement,a=/\s?auto?\s?/i,o=a.test(r);o&&(r=r.replace(a,"")||"top"),i.detach().css({top:0,left:0,display:"block"}).addClass(r),this.options.container?i.appendTo(this.options.container):i.insertAfter(this.$element);var s=this.getPosition(),u=i[0].offsetWidth,l=i[0].offsetHeight;if(o){var c=this.$element.parent(),h=r,d=document.documentElement.scrollTop||document.body.scrollTop,p="body"==this.options.container?window.innerWidth:c.outerWidth(),f="body"==this.options.container?window.innerHeight:c.outerHeight(),g="body"==this.options.container?0:c.offset().left;r="bottom"==r&&s.top+s.height+l-d>f?"top":"top"==r&&s.top-d-l<0?"bottom":"right"==r&&s.right+u>p?"left":"left"==r&&s.left-u<g?"right":r,i.removeClass(h).addClass(r)}var m=this.getCalculatedOffset(r,s,u,l);this.applyPlacement(m,r),this.hoverState=null;var v=function(){n.$element.trigger("shown.bs."+n.type)};t.support.transition&&this.$tip.hasClass("fade")?i.one(t.support.transition.end,v).emulateTransitionEnd(150):v()}},e.prototype.applyPlacement=function(e,n){var i,r=this.tip(),a=r[0].offsetWidth,o=r[0].offsetHeight,s=parseInt(r.css("margin-top"),10),u=parseInt(r.css("margin-left"),10);isNaN(s)&&(s=0),isNaN(u)&&(u=0),e.top=e.top+s,e.left=e.left+u,t.offset.setOffset(r[0],t.extend({using:function(t){r.css({top:Math.round(t.top),left:Math.round(t.left)})}},e),0),r.addClass("in");var l=r[0].offsetWidth,c=r[0].offsetHeight;if("top"==n&&c!=o&&(i=!0,e.top=e.top+o-c),/bottom|top/.test(n)){var h=0;e.left<0&&(h=-2*e.left,e.left=0,r.offset(e),l=r[0].offsetWidth,c=r[0].offsetHeight),this.replaceArrow(h-a+l,l,"left")}else this.replaceArrow(c-o,c,"top");i&&r.offset(e)},e.prototype.replaceArrow=function(t,e,n){this.arrow().css(n,t?50*(1-t/e)+"%":"")},e.prototype.setContent=function(){var t=this.tip(),e=this.getTitle();t.find(".tooltip-inner")[this.options.html?"html":"text"](e),t.removeClass("fade in top bottom left right")},e.prototype.hide=function(){function e(){"in"!=n.hoverState&&i.detach(),n.$element.trigger("hidden.bs."+n.type)}var n=this,i=this.tip(),r=t.Event("hide.bs."+this.type);return this.$element.trigger(r),r.isDefaultPrevented()?void 0:(i.removeClass("in"),t.support.transition&&this.$tip.hasClass("fade")?i.one(t.support.transition.end,e).emulateTransitionEnd(150):e(),this.hoverState=null,this)},e.prototype.fixTitle=function(){var t=this.$element;(t.attr("title")||"string"!=typeof t.attr("data-original-title"))&&t.attr("data-original-title",t.attr("title")||"").attr("title","")},e.prototype.hasContent=function(){return this.getTitle()},e.prototype.getPosition=function(){var e=this.$element[0];return t.extend({},"function"==typeof e.getBoundingClientRect?e.getBoundingClientRect():{width:e.offsetWidth,height:e.offsetHeight},this.$element.offset())},e.prototype.getCalculatedOffset=function(t,e,n,i){return"bottom"==t?{top:e.top+e.height,left:e.left+e.width/2-n/2}:"top"==t?{top:e.top-i,left:e.left+e.width/2-n/2}:"left"==t?{top:e.top+e.height/2-i/2,left:e.left-n}:{top:e.top+e.height/2-i/2,left:e.left+e.width}},e.prototype.getTitle=function(){var t,e=this.$element,n=this.options;return t=e.attr("data-original-title")||("function"==typeof n.title?n.title.call(e[0]):n.title)},e.prototype.tip=function(){return this.$tip=this.$tip||t(this.options.template)},e.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},e.prototype.validate=function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},e.prototype.enable=function(){this.enabled=!0},e.prototype.disable=function(){this.enabled=!1},e.prototype.toggleEnabled=function(){this.enabled=!this.enabled},e.prototype.toggle=function(e){var n=e?t(e.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type):this;n.tip().hasClass("in")?n.leave(n):n.enter(n)},e.prototype.destroy=function(){clearTimeout(this.timeout),this.hide().$element.off("."+this.type).removeData("bs."+this.type)};var n=t.fn.tooltip;t.fn.tooltip=function(n){return this.each(function(){var i=t(this),r=i.data("bs.tooltip"),a="object"==typeof n&&n;(r||"destroy"!=n)&&(r||i.data("bs.tooltip",r=new e(this,a)),"string"==typeof n&&r[n]())})},t.fn.tooltip.Constructor=e,t.fn.tooltip.noConflict=function(){return t.fn.tooltip=n,this}}(jQuery),+function(t){"use strict";var e='[data-dismiss="alert"]',n=function(n){t(n).on("click",e,this.close)};n.prototype.close=function(e){function n(){a.trigger("closed.bs.alert").remove()}var i=t(this),r=i.attr("data-target");r||(r=i.attr("href"),r=r&&r.replace(/.*(?=#[^\s]*$)/,""));var a=t(r);e&&e.preventDefault(),a.length||(a=i.hasClass("alert")?i:i.parent()),a.trigger(e=t.Event("close.bs.alert")),e.isDefaultPrevented()||(a.removeClass("in"),t.support.transition&&a.hasClass("fade")?a.one(t.support.transition.end,n).emulateTransitionEnd(150):n())};var i=t.fn.alert;t.fn.alert=function(e){return this.each(function(){var i=t(this),r=i.data("bs.alert");r||i.data("bs.alert",r=new n(this)),"string"==typeof e&&r[e].call(i)})},t.fn.alert.Constructor=n,t.fn.alert.noConflict=function(){return t.fn.alert=i,this},t(document).on("click.bs.alert.data-api",e,n.prototype.close)}(jQuery),+function(t){"use strict";var e=function(e,n){this.options=n,this.$element=t(e),this.$backdrop=this.isShown=null,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,t.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};e.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},e.prototype.toggle=function(t){return this[this.isShown?"hide":"show"](t)},e.prototype.show=function(e){var n=this,i=t.Event("show.bs.modal",{relatedTarget:e});this.$element.trigger(i),this.isShown||i.isDefaultPrevented()||(this.isShown=!0,this.escape(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',t.proxy(this.hide,this)),this.backdrop(function(){var i=t.support.transition&&n.$element.hasClass("fade");n.$element.parent().length||n.$element.appendTo(document.body),n.$element.show().scrollTop(0),i&&n.$element[0].offsetWidth,n.$element.addClass("in").attr("aria-hidden",!1),n.enforceFocus();var r=t.Event("shown.bs.modal",{relatedTarget:e});i?n.$element.find(".modal-dialog").one(t.support.transition.end,function(){n.$element.focus().trigger(r)}).emulateTransitionEnd(300):n.$element.focus().trigger(r)}))},e.prototype.hide=function(e){e&&e.preventDefault(),e=t.Event("hide.bs.modal"),this.$element.trigger(e),this.isShown&&!e.isDefaultPrevented()&&(this.isShown=!1,this.escape(),t(document).off("focusin.bs.modal"),this.$element.removeClass("in").attr("aria-hidden",!0).off("click.dismiss.bs.modal"),t.support.transition&&this.$element.hasClass("fade")?this.$element.one(t.support.transition.end,t.proxy(this.hideModal,this)).emulateTransitionEnd(300):this.hideModal())},e.prototype.enforceFocus=function(){t(document).off("focusin.bs.modal").on("focusin.bs.modal",t.proxy(function(t){this.$element[0]===t.target||this.$element.has(t.target).length||this.$element.focus()},this))},e.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.bs.modal",t.proxy(function(t){27==t.which&&this.hide()},this)):this.isShown||this.$element.off("keyup.dismiss.bs.modal")},e.prototype.hideModal=function(){var t=this;this.$element.hide(),this.backdrop(function(){t.removeBackdrop(),t.$element.trigger("hidden.bs.modal")})},e.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},e.prototype.backdrop=function(e){var n=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var i=t.support.transition&&n;if(this.$backdrop=t('<div class="modal-backdrop '+n+'" />').appendTo(document.body),this.$element.on("click.dismiss.bs.modal",t.proxy(function(t){t.target===t.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus.call(this.$element[0]):this.hide.call(this))},this)),i&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!e)return;i?this.$backdrop.one(t.support.transition.end,e).emulateTransitionEnd(150):e()}else!this.isShown&&this.$backdrop?(this.$backdrop.removeClass("in"),t.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one(t.support.transition.end,e).emulateTransitionEnd(150):e()):e&&e()};var n=t.fn.modal;t.fn.modal=function(n,i){return this.each(function(){var r=t(this),a=r.data("bs.modal"),o=t.extend({},e.DEFAULTS,r.data(),"object"==typeof n&&n);a||r.data("bs.modal",a=new e(this,o)),"string"==typeof n?a[n](i):o.show&&a.show(i)})},t.fn.modal.Constructor=e,t.fn.modal.noConflict=function(){return t.fn.modal=n,this},t(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(e){var n=t(this),i=n.attr("href"),r=t(n.attr("data-target")||i&&i.replace(/.*(?=#[^\s]+$)/,"")),a=r.data("bs.modal")?"toggle":t.extend({remote:!/#/.test(i)&&i},r.data(),n.data());n.is("a")&&e.preventDefault(),r.modal(a,this).one("hide",function(){n.is(":visible")&&n.focus()})}),t(document).on("show.bs.modal",".modal",function(){t(document.body).addClass("modal-open")}).on("hidden.bs.modal",".modal",function(){t(document.body).removeClass("modal-open")})}(jQuery),this.Handlebars=function(){var t=function(){"use strict";function t(t){this.string=t}var e;return t.prototype.toString=function(){return""+this.string},e=t}(),e=function(t){"use strict";function e(t){return u[t]||"&amp;"}function n(t){for(var e=1;e<arguments.length;e++)for(var n in arguments[e])Object.prototype.hasOwnProperty.call(arguments[e],n)&&(t[n]=arguments[e][n]);return t}function i(t){return t instanceof s?t.toString():t||0===t?(t=""+t,c.test(t)?t.replace(l,e):t):""}function r(t){return t||0===t?p(t)&&0===t.length?!0:!1:!0}function a(t,e){return(t?t+".":"")+e}var o={},s=t,u={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},l=/[&<>"'`]/g,c=/[&<>"'`]/;o.extend=n;var h=Object.prototype.toString;o.toString=h;var d=function(t){return"function"==typeof t};d(/x/)&&(d=function(t){return"function"==typeof t&&"[object Function]"===h.call(t)});var d;o.isFunction=d;var p=Array.isArray||function(t){return t&&"object"==typeof t?"[object Array]"===h.call(t):!1};return o.isArray=p,o.escapeExpression=i,o.isEmpty=r,o.appendContextPath=a,o}(t),n=function(){"use strict";function t(t,e){var i;e&&e.firstLine&&(i=e.firstLine,t+=" - "+i+":"+e.firstColumn);for(var r=Error.prototype.constructor.call(this,t),a=0;a<n.length;a++)this[n[a]]=r[n[a]];i&&(this.lineNumber=i,this.column=e.firstColumn)}var e,n=["description","fileName","lineNumber","message","name","number","stack"];return t.prototype=new Error,e=t}(),i=function(t,e){"use strict";function n(t,e){this.helpers=t||{},this.partials=e||{},i(this)}function i(t){t.registerHelper("helperMissing",function(){if(1===arguments.length)return void 0;throw new s("Missing helper: '"+arguments[arguments.length-1].name+"'")}),t.registerHelper("blockHelperMissing",function(e,n){var i=n.inverse||function(){},r=n.fn;if(d(e)&&(e=e.call(this)),e===!0)return r(this);if(e===!1||null==e)return i(this);if(h(e))return e.length>0?(n.ids&&(n.ids=[n.name]),t.helpers.each(e,n)):i(this);if(n.data&&n.ids){var a=m(n.data);a.contextPath=o.appendContextPath(n.data.contextPath,n.name),n={data:a}}return r(e,n)}),t.registerHelper("each",function(t,e){e||(e=t,t=this);var n,i,r=e.fn,a=e.inverse,s=0,u="";if(e.data&&e.ids&&(i=o.appendContextPath(e.data.contextPath,e.ids[0])+"."),d(t)&&(t=t.call(this)),e.data&&(n=m(e.data)),t&&"object"==typeof t)if(h(t))for(var l=t.length;l>s;s++)n&&(n.index=s,n.first=0===s,n.last=s===t.length-1,i&&(n.contextPath=i+s)),u+=r(t[s],{data:n});else for(var c in t)t.hasOwnProperty(c)&&(n&&(n.key=c,n.index=s,n.first=0===s,i&&(n.contextPath=i+c)),u+=r(t[c],{data:n}),s++);return 0===s&&(u=a(this)),u}),t.registerHelper("if",function(t,e){return d(t)&&(t=t.call(this)),!e.hash.includeZero&&!t||o.isEmpty(t)?e.inverse(this):e.fn(this)}),t.registerHelper("unless",function(e,n){return t.helpers["if"].call(this,e,{fn:n.inverse,inverse:n.fn,hash:n.hash})}),t.registerHelper("with",function(t,e){d(t)&&(t=t.call(this));var n=e.fn;if(!o.isEmpty(t)){if(e.data&&e.ids){var i=m(e.data);i.contextPath=o.appendContextPath(e.data.contextPath,e.ids[0]),e={data:i}}return n(t,e)}}),t.registerHelper("log",function(e,n){var i=n.data&&null!=n.data.level?parseInt(n.data.level,10):1;t.log(i,e)}),t.registerHelper("lookup",function(t,e){return t&&t[e]})}function r(t,e){g.log(t,e)}var a={},o=t,s=e,u="2.0.0-alpha.4";a.VERSION=u;var l=5;a.COMPILER_REVISION=l;var c={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:"== 1.x.x",5:">= 2.0.0"};a.REVISION_CHANGES=c;var h=o.isArray,d=o.isFunction,p=o.toString,f="[object Object]";a.HandlebarsEnvironment=n,n.prototype={constructor:n,logger:g,log:r,registerHelper:function(t,e,n){if(p.call(t)===f){if(n||e)throw new s("Arg not supported with multiple helpers");o.extend(this.helpers,t)}else n&&(e.not=n),this.helpers[t]=e},unregisterHelper:function(t){delete this.helpers[t]},registerPartial:function(t,e){p.call(t)===f?o.extend(this.partials,t):this.partials[t]=e},unregisterPartial:function(t){delete this.partials[t]}};var g={methodMap:{0:"debug",1:"info",2:"warn",3:"error"},DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,log:function(t,e){if(g.level<=t){var n=g.methodMap[t];"undefined"!=typeof console&&console[n]&&console[n].call(console,e)}}};a.logger=g,a.log=r;var m=function(t){var e=o.extend({},t);return e._parent=t,e};return a.createFrame=m,a}(e,n),r=function(t,e,n){"use strict";function i(t){var e=t&&t[0]||1,n=p;if(e!==n){if(n>e){var i=f[n],r=f[e];throw new d("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+i+") or downgrade your runtime to an older version ("+r+").")}throw new d("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+t[1]+").")}}function r(t,e){if(!e)throw new d("No environment passed to template");e.VM.checkRevision(t.compiler);var n=function(t,n,i,r,a,o,s){r&&(i=h.extend({},i,r));var u=e.VM.invokePartial.call(this,t,n,i,a,o,s);if(null!=u)return u;if(e.compile){var l={helpers:a,partials:o,data:s};return o[n]=e.compile(t,{data:void 0!==s},e),o[n](i,l)}throw new d("The partial "+n+" could not be compiled when running in runtime-only mode")},i={escapeExpression:h.escapeExpression,invokePartial:n,fn:function(e){return t[e]},programs:[],program:function(t,e){var n=this.programs[t],i=this.fn(t);return e?n=o(this,t,i,e):n||(n=this.programs[t]=o(this,t,i)),n},programWithDepth:e.VM.programWithDepth,data:function(t,e){for(;t&&e--;)t=t._parent;return t},merge:function(t,e){var n=t||e;return t&&e&&t!==e&&(n=h.extend({},e,t)),n},noop:e.VM.noop,compilerInfo:t.compiler},r=function(e,n){n=n||{};var a=n.data;return r._setup(n),!n.partial&&t.useData&&(a=l(e,a)),t.main.call(i,e,i.helpers,i.partials,a)};return r._setup=function(n){n.partial?(i.helpers=n.helpers,i.partials=n.partials):(i.helpers=i.merge(n.helpers,e.helpers),t.usePartial&&(i.partials=i.merge(n.partials,e.partials)))},r._child=function(t){return i.programWithDepth(t)},r}function a(t,e){var n=Array.prototype.slice.call(arguments,2),i=this,r=i.fn(t),a=function(t,a){return a=a||{},r.apply(i,[t,i.helpers,i.partials,a.data||e].concat(n))};return a.program=t,a.depth=n.length,a}function o(t,e,n,i){var r=function(e,r){return r=r||{},n.call(t,e,t.helpers,t.partials,r.data||i)};return r.program=e,r.depth=0,r}function s(t,e,n,i,r,a){var o={partial:!0,helpers:i,partials:r,data:a};if(void 0===t)throw new d("The partial "+e+" could not be found");return t instanceof Function?t(n,o):void 0}function u(){return""}function l(t,e){return e&&"root"in e||(e=e?g(e):{},e.root=t),e}var c={},h=t,d=e,p=n.COMPILER_REVISION,f=n.REVISION_CHANGES,g=n.createFrame;return c.checkRevision=i,c.template=r,c.programWithDepth=a,c.program=o,c.invokePartial=s,c.noop=u,c}(e,n,i),a=function(t,e,n,i,r){"use strict";var a,o=t,s=e,u=n,l=i,c=r,h=function(){var t=new o.HandlebarsEnvironment;return l.extend(t,o),t.SafeString=s,t.Exception=u,t.Utils=l,t.VM=c,t.template=function(e){return c.template(e,t)
},t},d=h();return d.create=h,a=d}(i,t,n,e,r);return a}(),Handlebars.registerHelper("csrf",function(){return $("meta[name='csrf_token']").attr("content")}),Handlebars.registerHelper("capitalize",function(t){return capitalize(t)}),Handlebars.registerHelper("timefmt",function(t){return"string"==typeof t&&(t=new Date(t)),t.getUTCDate()+" "+month(t.getUTCMonth())+" "+t.getUTCFullYear()}),Handlebars.registerHelper("datefmt",function(t){return"string"==typeof t&&(t=new Date(t)),t.getUTCHours()+":"+padNum(t.getUTCMinutes(),2)}),Handlebars.registerHelper("status_color",function(t){return statusColor(t)}),Handlebars.registerHelper("compare",function(t,e,n){var i=n.hash.operator||"===",r={"==":function(t,e){return t==e},"!=":function(t,e){return t!=e},"===":function(t,e){return t===e},"!==":function(t,e){return t!==e},"<":function(t,e){return e>t},">":function(t,e){return t>e},"<=":function(t,e){return e>=t},">=":function(t,e){return t>=e},"in":function(t,e){return t in e}},a=r[i](t,e);return a?n.fn(this):n.inverse(this)}),$("form#actionForm ul").click(submitAction),$('form#actionForm button[type="submit"]').click(submitAction),$("ul#request-modifier-type li a").click(function(){var t=$(this),e=t.closest("form");return e.find("input[name='type_']").attr("value",t.attr("id")),e.submit(),e.find("button.dropdown-toggle").dropdown("toggle"),!1}),$("form#modifierForm").submit(function(){var t=$(this);return $.post(window.location.pathname,t.serialize(),function(e){t.find("textarea").val(""),t.find("input#value").val(""),renderRequest(e)}),!1}),$("form#payoutForm").submit(function(){var t=$(this);return $.post(window.location.pathname,t.serialize(),function(e){t.find("input#value").val(""),renderRequest(e)}),!1}),$("#detailsModal form").submit(function(){var t=$(this);return $.post(window.location.pathname,t.serialize(),function(){$("#request-details").text(t.find("textarea#details").val())}),$("#detailsModal").modal("hide"),!1}),$("#modifierList").submit(function(t){var e=$(t.target);return $.post(window.location.pathname,e.serialize(),function(t){renderRequest(t)}),!1}),$("#request-payout").tooltip({title:$("#request-payout").data("initial-title"),placement:"right"}),function(){var t=this,e=t._,n={},i=Array.prototype,r=Object.prototype,a=Function.prototype,o=i.push,s=i.slice,u=i.concat,l=r.toString,c=r.hasOwnProperty,h=i.forEach,d=i.map,p=i.reduce,f=i.reduceRight,g=i.filter,m=i.every,v=i.some,y=i.indexOf,b=i.lastIndexOf,_=Array.isArray,w=Object.keys,S=a.bind,x=function(t){return t instanceof x?t:this instanceof x?void(this._wrapped=t):new x(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=x),exports._=x):t._=x,x.VERSION="1.6.0";var $=x.each=x.forEach=function(t,e,i){if(null==t)return t;if(h&&t.forEach===h)t.forEach(e,i);else if(t.length===+t.length){for(var r=0,a=t.length;a>r;r++)if(e.call(i,t[r],r,t)===n)return}else for(var o=x.keys(t),r=0,a=o.length;a>r;r++)if(e.call(i,t[o[r]],o[r],t)===n)return;return t};x.map=x.collect=function(t,e,n){var i=[];return null==t?i:d&&t.map===d?t.map(e,n):($(t,function(t,r,a){i.push(e.call(n,t,r,a))}),i)};var k="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(t,e,n,i){var r=arguments.length>2;if(null==t&&(t=[]),p&&t.reduce===p)return i&&(e=x.bind(e,i)),r?t.reduce(e,n):t.reduce(e);if($(t,function(t,a,o){r?n=e.call(i,n,t,a,o):(n=t,r=!0)}),!r)throw new TypeError(k);return n},x.reduceRight=x.foldr=function(t,e,n,i){var r=arguments.length>2;if(null==t&&(t=[]),f&&t.reduceRight===f)return i&&(e=x.bind(e,i)),r?t.reduceRight(e,n):t.reduceRight(e);var a=t.length;if(a!==+a){var o=x.keys(t);a=o.length}if($(t,function(s,u,l){u=o?o[--a]:--a,r?n=e.call(i,n,t[u],u,l):(n=t[u],r=!0)}),!r)throw new TypeError(k);return n},x.find=x.detect=function(t,e,n){var i;return C(t,function(t,r,a){return e.call(n,t,r,a)?(i=t,!0):void 0}),i},x.filter=x.select=function(t,e,n){var i=[];return null==t?i:g&&t.filter===g?t.filter(e,n):($(t,function(t,r,a){e.call(n,t,r,a)&&i.push(t)}),i)},x.reject=function(t,e,n){return x.filter(t,function(t,i,r){return!e.call(n,t,i,r)},n)},x.every=x.all=function(t,e,i){e||(e=x.identity);var r=!0;return null==t?r:m&&t.every===m?t.every(e,i):($(t,function(t,a,o){return(r=r&&e.call(i,t,a,o))?void 0:n}),!!r)};var C=x.some=x.any=function(t,e,i){e||(e=x.identity);var r=!1;return null==t?r:v&&t.some===v?t.some(e,i):($(t,function(t,a,o){return r||(r=e.call(i,t,a,o))?n:void 0}),!!r)};x.contains=x.include=function(t,e){return null==t?!1:y&&t.indexOf===y?-1!=t.indexOf(e):C(t,function(t){return t===e})},x.invoke=function(t,e){var n=s.call(arguments,2),i=x.isFunction(e);return x.map(t,function(t){return(i?e:t[e]).apply(t,n)})},x.pluck=function(t,e){return x.map(t,x.property(e))},x.where=function(t,e){return x.filter(t,x.matches(e))},x.findWhere=function(t,e){return x.find(t,x.matches(e))},x.max=function(t,e,n){if(!e&&x.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.max.apply(Math,t);var i=-1/0,r=-1/0;return $(t,function(t,a,o){var s=e?e.call(n,t,a,o):t;s>r&&(i=t,r=s)}),i},x.min=function(t,e,n){if(!e&&x.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.min.apply(Math,t);var i=1/0,r=1/0;return $(t,function(t,a,o){var s=e?e.call(n,t,a,o):t;r>s&&(i=t,r=s)}),i},x.shuffle=function(t){var e,n=0,i=[];return $(t,function(t){e=x.random(n++),i[n-1]=i[e],i[e]=t}),i},x.sample=function(t,e,n){return null==e||n?(t.length!==+t.length&&(t=x.values(t)),t[x.random(t.length-1)]):x.shuffle(t).slice(0,Math.max(0,e))};var T=function(t){return null==t?x.identity:x.isFunction(t)?t:x.property(t)};x.sortBy=function(t,e,n){return e=T(e),x.pluck(x.map(t,function(t,i,r){return{value:t,index:i,criteria:e.call(n,t,i,r)}}).sort(function(t,e){var n=t.criteria,i=e.criteria;if(n!==i){if(n>i||void 0===n)return 1;if(i>n||void 0===i)return-1}return t.index-e.index}),"value")};var I=function(t){return function(e,n,i){var r={};return n=T(n),$(e,function(a,o){var s=n.call(i,a,o,e);t(r,s,a)}),r}};x.groupBy=I(function(t,e,n){x.has(t,e)?t[e].push(n):t[e]=[n]}),x.indexBy=I(function(t,e,n){t[e]=n}),x.countBy=I(function(t,e){x.has(t,e)?t[e]++:t[e]=1}),x.sortedIndex=function(t,e,n,i){n=T(n);for(var r=n.call(i,e),a=0,o=t.length;o>a;){var s=a+o>>>1;n.call(i,t[s])<r?a=s+1:o=s}return a},x.toArray=function(t){return t?x.isArray(t)?s.call(t):t.length===+t.length?x.map(t,x.identity):x.values(t):[]},x.size=function(t){return null==t?0:t.length===+t.length?t.length:x.keys(t).length},x.first=x.head=x.take=function(t,e,n){return null==t?void 0:null==e||n?t[0]:0>e?[]:s.call(t,0,e)},x.initial=function(t,e,n){return s.call(t,0,t.length-(null==e||n?1:e))},x.last=function(t,e,n){return null==t?void 0:null==e||n?t[t.length-1]:s.call(t,Math.max(t.length-e,0))},x.rest=x.tail=x.drop=function(t,e,n){return s.call(t,null==e||n?1:e)},x.compact=function(t){return x.filter(t,x.identity)};var O=function(t,e,n){return e&&x.every(t,x.isArray)?u.apply(n,t):($(t,function(t){x.isArray(t)||x.isArguments(t)?e?o.apply(n,t):O(t,e,n):n.push(t)}),n)};x.flatten=function(t,e){return O(t,e,[])},x.without=function(t){return x.difference(t,s.call(arguments,1))},x.partition=function(t,e){var n=[],i=[];return $(t,function(t){(e(t)?n:i).push(t)}),[n,i]},x.uniq=x.unique=function(t,e,n,i){x.isFunction(e)&&(i=n,n=e,e=!1);var r=n?x.map(t,n,i):t,a=[],o=[];return $(r,function(n,i){(e?i&&o[o.length-1]===n:x.contains(o,n))||(o.push(n),a.push(t[i]))}),a},x.union=function(){return x.uniq(x.flatten(arguments,!0))},x.intersection=function(t){var e=s.call(arguments,1);return x.filter(x.uniq(t),function(t){return x.every(e,function(e){return x.contains(e,t)})})},x.difference=function(t){var e=u.apply(i,s.call(arguments,1));return x.filter(t,function(t){return!x.contains(e,t)})},x.zip=function(){for(var t=x.max(x.pluck(arguments,"length").concat(0)),e=new Array(t),n=0;t>n;n++)e[n]=x.pluck(arguments,""+n);return e},x.object=function(t,e){if(null==t)return{};for(var n={},i=0,r=t.length;r>i;i++)e?n[t[i]]=e[i]:n[t[i][0]]=t[i][1];return n},x.indexOf=function(t,e,n){if(null==t)return-1;var i=0,r=t.length;if(n){if("number"!=typeof n)return i=x.sortedIndex(t,e),t[i]===e?i:-1;i=0>n?Math.max(0,r+n):n}if(y&&t.indexOf===y)return t.indexOf(e,n);for(;r>i;i++)if(t[i]===e)return i;return-1},x.lastIndexOf=function(t,e,n){if(null==t)return-1;var i=null!=n;if(b&&t.lastIndexOf===b)return i?t.lastIndexOf(e,n):t.lastIndexOf(e);for(var r=i?n:t.length;r--;)if(t[r]===e)return r;return-1},x.range=function(t,e,n){arguments.length<=1&&(e=t||0,t=0),n=arguments[2]||1;for(var i=Math.max(Math.ceil((e-t)/n),0),r=0,a=new Array(i);i>r;)a[r++]=t,t+=n;return a};var E=function(){};x.bind=function(t,e){var n,i;if(S&&t.bind===S)return S.apply(t,s.call(arguments,1));if(!x.isFunction(t))throw new TypeError;return n=s.call(arguments,2),i=function(){if(!(this instanceof i))return t.apply(e,n.concat(s.call(arguments)));E.prototype=t.prototype;var r=new E;E.prototype=null;var a=t.apply(r,n.concat(s.call(arguments)));return Object(a)===a?a:r}},x.partial=function(t){var e=s.call(arguments,1);return function(){for(var n=0,i=e.slice(),r=0,a=i.length;a>r;r++)i[r]===x&&(i[r]=arguments[n++]);for(;n<arguments.length;)i.push(arguments[n++]);return t.apply(this,i)}},x.bindAll=function(t){var e=s.call(arguments,1);if(0===e.length)throw new Error("bindAll must be passed function names");return $(e,function(e){t[e]=x.bind(t[e],t)}),t},x.memoize=function(t,e){var n={};return e||(e=x.identity),function(){var i=e.apply(this,arguments);return x.has(n,i)?n[i]:n[i]=t.apply(this,arguments)}},x.delay=function(t,e){var n=s.call(arguments,2);return setTimeout(function(){return t.apply(null,n)},e)},x.defer=function(t){return x.delay.apply(x,[t,1].concat(s.call(arguments,1)))},x.throttle=function(t,e,n){var i,r,a,o=null,s=0;n||(n={});var u=function(){s=n.leading===!1?0:x.now(),o=null,a=t.apply(i,r),i=r=null};return function(){var l=x.now();s||n.leading!==!1||(s=l);var c=e-(l-s);return i=this,r=arguments,0>=c?(clearTimeout(o),o=null,s=l,a=t.apply(i,r),i=r=null):o||n.trailing===!1||(o=setTimeout(u,c)),a}},x.debounce=function(t,e,n){var i,r,a,o,s,u=function(){var l=x.now()-o;e>l?i=setTimeout(u,e-l):(i=null,n||(s=t.apply(a,r),a=r=null))};return function(){a=this,r=arguments,o=x.now();var l=n&&!i;return i||(i=setTimeout(u,e)),l&&(s=t.apply(a,r),a=r=null),s}},x.once=function(t){var e,n=!1;return function(){return n?e:(n=!0,e=t.apply(this,arguments),t=null,e)}},x.wrap=function(t,e){return x.partial(e,t)},x.compose=function(){var t=arguments;return function(){for(var e=arguments,n=t.length-1;n>=0;n--)e=[t[n].apply(this,e)];return e[0]}},x.after=function(t,e){return function(){return--t<1?e.apply(this,arguments):void 0}},x.keys=function(t){if(!x.isObject(t))return[];if(w)return w(t);var e=[];for(var n in t)x.has(t,n)&&e.push(n);return e},x.values=function(t){for(var e=x.keys(t),n=e.length,i=new Array(n),r=0;n>r;r++)i[r]=t[e[r]];return i},x.pairs=function(t){for(var e=x.keys(t),n=e.length,i=new Array(n),r=0;n>r;r++)i[r]=[e[r],t[e[r]]];return i},x.invert=function(t){for(var e={},n=x.keys(t),i=0,r=n.length;r>i;i++)e[t[n[i]]]=n[i];return e},x.functions=x.methods=function(t){var e=[];for(var n in t)x.isFunction(t[n])&&e.push(n);return e.sort()},x.extend=function(t){return $(s.call(arguments,1),function(e){if(e)for(var n in e)t[n]=e[n]}),t},x.pick=function(t){var e={},n=u.apply(i,s.call(arguments,1));return $(n,function(n){n in t&&(e[n]=t[n])}),e},x.omit=function(t){var e={},n=u.apply(i,s.call(arguments,1));for(var r in t)x.contains(n,r)||(e[r]=t[r]);return e},x.defaults=function(t){return $(s.call(arguments,1),function(e){if(e)for(var n in e)void 0===t[n]&&(t[n]=e[n])}),t},x.clone=function(t){return x.isObject(t)?x.isArray(t)?t.slice():x.extend({},t):t},x.tap=function(t,e){return e(t),t};var A=function(t,e,n,i){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return t===e;t instanceof x&&(t=t._wrapped),e instanceof x&&(e=e._wrapped);var r=l.call(t);if(r!=l.call(e))return!1;switch(r){case"[object String]":return t==String(e);case"[object Number]":return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object RegExp]":return t.source==e.source&&t.global==e.global&&t.multiline==e.multiline&&t.ignoreCase==e.ignoreCase}if("object"!=typeof t||"object"!=typeof e)return!1;for(var a=n.length;a--;)if(n[a]==t)return i[a]==e;var o=t.constructor,s=e.constructor;if(o!==s&&!(x.isFunction(o)&&o instanceof o&&x.isFunction(s)&&s instanceof s)&&"constructor"in t&&"constructor"in e)return!1;n.push(t),i.push(e);var u=0,c=!0;if("[object Array]"==r){if(u=t.length,c=u==e.length)for(;u--&&(c=A(t[u],e[u],n,i)););}else{for(var h in t)if(x.has(t,h)&&(u++,!(c=x.has(e,h)&&A(t[h],e[h],n,i))))break;if(c){for(h in e)if(x.has(e,h)&&!u--)break;c=!u}}return n.pop(),i.pop(),c};x.isEqual=function(t,e){return A(t,e,[],[])},x.isEmpty=function(t){if(null==t)return!0;if(x.isArray(t)||x.isString(t))return 0===t.length;for(var e in t)if(x.has(t,e))return!1;return!0},x.isElement=function(t){return!(!t||1!==t.nodeType)},x.isArray=_||function(t){return"[object Array]"==l.call(t)},x.isObject=function(t){return t===Object(t)},$(["Arguments","Function","String","Number","Date","RegExp"],function(t){x["is"+t]=function(e){return l.call(e)=="[object "+t+"]"}}),x.isArguments(arguments)||(x.isArguments=function(t){return!(!t||!x.has(t,"callee"))}),"function"!=typeof/./&&(x.isFunction=function(t){return"function"==typeof t}),x.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},x.isNaN=function(t){return x.isNumber(t)&&t!=+t},x.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"==l.call(t)},x.isNull=function(t){return null===t},x.isUndefined=function(t){return void 0===t},x.has=function(t,e){return c.call(t,e)},x.noConflict=function(){return t._=e,this},x.identity=function(t){return t},x.constant=function(t){return function(){return t}},x.property=function(t){return function(e){return e[t]}},x.matches=function(t){return function(e){if(e===t)return!0;for(var n in t)if(t[n]!==e[n])return!1;return!0}},x.times=function(t,e,n){for(var i=Array(Math.max(0,t)),r=0;t>r;r++)i[r]=e.call(n,r);return i},x.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},x.now=Date.now||function(){return(new Date).getTime()};var P={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};P.unescape=x.invert(P.escape);var H={escape:new RegExp("["+x.keys(P.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(P.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(t){x[t]=function(e){return null==e?"":(""+e).replace(H[t],function(e){return P[t][e]})}}),x.result=function(t,e){if(null==t)return void 0;var n=t[e];return x.isFunction(n)?n.call(t):n},x.mixin=function(t){$(x.functions(t),function(e){var n=x[e]=t[e];x.prototype[e]=function(){var t=[this._wrapped];return o.apply(t,arguments),F.call(this,n.apply(x,t))}})};var D=0;x.uniqueId=function(t){var e=++D+"";return t?t+e:e},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var q=/(.)^/,j={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},z=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(t,e,n){var i;n=x.defaults({},n,x.templateSettings);var r=new RegExp([(n.escape||q).source,(n.interpolate||q).source,(n.evaluate||q).source].join("|")+"|$","g"),a=0,o="__p+='";t.replace(r,function(e,n,i,r,s){return o+=t.slice(a,s).replace(z,function(t){return"\\"+j[t]}),n&&(o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),i&&(o+="'+\n((__t=("+i+"))==null?'':__t)+\n'"),r&&(o+="';\n"+r+"\n__p+='"),a=s+e.length,e}),o+="';\n",n.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{i=new Function(n.variable||"obj","_",o)}catch(s){throw s.source=o,s}if(e)return i(e,x);var u=function(t){return i.call(this,t,x)};return u.source="function("+(n.variable||"obj")+"){\n"+o+"}",u},x.chain=function(t){return x(t).chain()};var F=function(t){return this._chain?x(t).chain():t};x.mixin(x),$(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=i[t];x.prototype[t]=function(){var n=this._wrapped;return e.apply(n,arguments),"shift"!=t&&"splice"!=t||0!==n.length||delete n[0],F.call(this,n)}}),$(["concat","join","slice"],function(t){var e=i[t];x.prototype[t]=function(){return F.call(this,e.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return x})}.call(this);var PourOver=function(){PourOver={union_sorted:function(t,e){for(var n,i,r=0,a=0,o=t.length,s=e.length,u=[];o>r||s>a;){if(n=t[r],i=e[a],_.isUndefined(n)&&(n=1/0),_.isUndefined(i)&&(i=1/0),r==o)return u.concat(e.slice(a,s));if(a==s)return u.concat(t.slice(r,o));n==i?(u.push(n),r++,a++):i>n?(u.push(n),r++):(u.push(i),a++)}return u},intersect_sorted:function(t,e){for(var n,i,r=0,a=0,o=t.length,s=e.length,u=[];o>r&&s>a;)n=t[r],i=e[a],n==i?(u.push(n),r++,a++):i>n?r++:a++;return u},subtract_sorted:function(t,e){for(var n,i,r=0,a=0,o=t.length,s=e.length,u=[];o>r||s>a;){if(n=t[r],i=e[a],o==r)return u;if(s==a)return u.concat(t.slice(r,o));n==i?(r++,a++):i>n?(u.push(n),r++):a++}return u},insert_sorted:function(t,e){var n=t.length,i=0,r=t[n-1];if(e>r)return t.push(e),t;for(;n>i;){if(e<t[i])return t.slice(0,i).concat([e]).concat(t.slice(i,n));i++}return t.push(e),t},build_permutation_array:function(t,e){var n=_(t).clone(),i=[];return n.sort("function"==typeof e?e:function(t,n){return e.fn.call(e,t,n)}),_(n).each(function(t,e){i[t.cid]=e}),i},permute_from_array:function(t,e){var n=[];return _(t).each("number"==typeof t[0]?function(t){n[e[t]]=t}:function(t){n[e[t.cid]]=t}),_(n).without(void 0)},remove_sorted:function(t,e){for(var n=t.length,i=0;n>i;){if(e==t[i])return t.slice(0,i).concat(t.slice(i+1,n));i++}return t},cacheMethods:{defaultCache:function(t){var e=this;_(e.possibilities).each(function(n){var i=_(t).filter(function(t){return e.fn(n,t)}),r=_(i).map(function(t){return t.cid});n.matching_cids=r})},defaultAddCache:function(t){var e=this;_(e.possibilities).each(function(n){var i=_(t).filter(function(t){return e.fn(n,t)}),r=_(i).map(function(t){return t.cid});n.matching_cids=PourOver.union_sorted(n.matching_cids,r)})},exactCache:function(t){var e=this,n=this.attr||this.name;_(t).each(function(t){var i=e.possibilities[t[n]];i&&(i.matching_cids=PourOver.insert_sorted(i.matching_cids,t.cid))})},exactAddCache:function(t){PourOver.cacheMethods.exactCache.call(this,t)},inclusionCache:function(t){var e=this,n=this.attr||this.name;_(t).each(function(t){_(t[n]).each(function(n){var i=e.possibilities[n];i&&(i.matching_cids=PourOver.insert_sorted(i.matching_cids,t.cid))})})},inclusionAddCache:function(t){PourOver.cacheMethods.inclusionCache.call(this,t)}}};var t=[],e=(t.push,t.slice),n=(t.splice,PourOver.Events={on:function(t,e,n){if(!r(this,"on",t,[e,n])||!e)return this;this._events||(this._events={});var i=this._events[t]||(this._events[t]=[]);return i.push({callback:e,context:n,ctx:n||this}),this},once:function(t,e,n){if(!r(this,"once",t,[e,n])||!e)return this;var i=this,a=_.once(function(){i.off(t,a),e.apply(this,arguments)});return a._callback=e,this.on(t,a,n)},off:function(t,e,n){var i,a,o,s,u,l,c,h;if(!this._events||!r(this,"off",t,[e,n]))return this;if(!t&&!e&&!n)return this._events=void 0,this;for(s=t?[t]:_.keys(this._events),u=0,l=s.length;l>u;u++)if(t=s[u],o=this._events[t]){if(this._events[t]=i=[],e||n)for(c=0,h=o.length;h>c;c++)a=o[c],(e&&e!==a.callback&&e!==a.callback._callback||n&&n!==a.context)&&i.push(a);i.length||delete this._events[t]}return this},trigger:function(t){if(!this._events)return this;var n=e.call(arguments,1);if(!r(this,"trigger",t,n))return this;var i=this._events[t],o=this._events.all;return i&&a(i,n),o&&a(o,arguments),this},stopListening:function(t,e,n){var i=this._listeningTo;if(!i)return this;var r=!e&&!n;n||"object"!=typeof e||(n=this),t&&((i={})[t._listenId]=t);for(var a in i)t=i[a],t.off(e,n,this),(r||_.isEmpty(t._events))&&delete this._listeningTo[a];return this}}),i=/\s+/,r=function(t,e,n,r){if(!n)return!0;if("object"==typeof n){for(var a in n)t[e].apply(t,[a,n[a]].concat(r));return!1}if(i.test(n)){for(var o=n.split(i),s=0,u=o.length;u>s;s++)t[e].apply(t,[o[s]].concat(r));return!1}return!0},a=function(t,e){var n,i=-1,r=t.length,a=e[0],o=e[1],s=e[2];switch(e.length){case 0:for(;++i<r;)(n=t[i]).callback.call(n.ctx);return;case 1:for(;++i<r;)(n=t[i]).callback.call(n.ctx,a);return;case 2:for(;++i<r;)(n=t[i]).callback.call(n.ctx,a,o);return;case 3:for(;++i<r;)(n=t[i]).callback.call(n.ctx,a,o,s);return;default:for(;++i<r;)(n=t[i]).callback.apply(n.ctx,e);return}},o={listenTo:"on",listenToOnce:"once"};return _.each(o,function(t,e){n[e]=function(e,n,i){var r=this._listeningTo||(this._listeningTo={}),a=e._listenId||(e._listenId=_.uniqueId("l"));return r[a]=e,i||"object"!=typeof n||(i=this),e[t](n,i,this),this}}),n.bind=n.on,n.unbind=n.off,_.extend(PourOver,n),PourOver.Collection=function(t){"undefined"==typeof t&&(t=[]),this.items=[],this.filters={},this.sorts={},this.addItems(t),this.on("change",function(){_(this.filters).each(function(t){t.current_query&&t.current_query.refresh()})}),this.initialize.apply(this,arguments)},_.extend(PourOver.Collection.prototype,PourOver.Events,{initialize:function(){},refresh:function(){this.trigger("queryChange")},get:function(t){return PourOver.Collection.prototype.getBy.call(this,"cid",t,!0)},getBy:function(t,e,n){if(!_.isArray(e))var e=[e];"undefined"==typeof n&&(n=!1);var i,r=0,a=this.items.length,o=0,s=e.length,u=[],l=this.items;if(1==n)for(;a>r&&s>o;)e[o]==(i=l[r])[t]?(u.push(i),r++,o++):e[o]<i[t]?o++:r++;else if("reverse"==n)for(;a>r&&s>o;)e[o]==(i=l[r])[t]?(u.push(i),r++,o++):e[o]>i[t]?o++:r++;else for(;a>r&&s>o;)_(e).include((i=l[r])[t])?(u.push(i),e=_(e).without(i[t]),r++,o++):r++;return u},addItems:function(t){if(this.trigger("will_change"),!_.isArray(t))var t=[t];var e,n=this.items.length>0?_(this.items).last().cid+1:0;e=_(t).map(function(t){var e=PourOver.Item(t);return e.cid=n++,e}),this.items=this.items.concat(e),this.regenerateFilterSets(e),this.trigger("change")},removeItems:function(t,e){if(this.trigger("will_change"),"undefined"==typeof e)var e=!1;if(!_.isArray(t))var t=[t];if(e){t=t.sort(function(t,e){return t.cid-e.cid});for(var n=[],i=this.items,r=t.length,a=this.items.length,o=0,s=0;a>s;){if(r>!o){n=n.concat(i.slice(s));break}i[s].cid===t[o].cid?(o++,s++):(n.push(i[s]),s++)}}else for(var n=[],i=this.items,a=this.items.length,s=0,u=_(t).pluck("cid");a>s&&u.length>0;)_(u).include(i[s].cid)||n.push(i[s]),s++;this.items=n,this.regenerateFilterSets(),this.trigger("change")},addFilters:function(t){var e,n=this;if(!_.isArray(t))var t=[t];e=_(t).reduce(function(t,e){return t[e.name]=_.clone(e),t[e.name].collection=n,t},{}),this.filters=_(this.filters).extend(e),_(e).each(function(t){t.on("queryChange",function(){n.trigger("queryChange")}),t.cacheResults(n.items),t.associated_attrs&&_(t.associated_attrs).each(function(e){n.on("change:"+e,function(e){t.removeFromCache(e),t.addCacheResults(e),t.current_query&&t.current_query.refresh()})})})},regenerateFilterSets:function(t){var e=this;_(this.filters).each("undefined"==typeof t?function(t){t.cacheResults(e.items)}:function(e){e.addCacheResults(t)})},getAllItems:function(){var t=_(this.items).map(function(t){return t.cid});return new PourOver.MatchSet(t,this,["all"])},getCurrentFilteredItems:function(t,e){return"undefined"==typeof e&&(e=!1),this.filters[t].current_query&&this.filters[t].current_query.stack.length>0?this.filters[t].current_query:e?new PourOver.MatchSet([],this,[]):this.getAllItems()},getFilteredItems:function(t,e){var n=this.filters[t];if(_.isUndefined(n))throw"The filter "+t+" does not exist.";return n.getFn(e)},addSort:function(t){var e=this;this.sorts[t.name]=t,t.collection=this,t.rebuild_sort(),this.on("change",function(){t.rebuild_sort()}),t.associated_attrs&&_(t.associated_attrs).each(function(n){e.on("change:"+n,function(){t.rebuild_sort()})})},addSorts:function(t){"undefined"==typeof opts&&(opts={}),_(t).isArray()||(t=[t]);var e=this;_(t).each(function(t){e.addSort(t)})},getSortedItems:function(t){var e=this.sorts[t];return e.sort(this.items)},getItemValue:function(t,e){var n=_(this.items).find(function(e){return e.cid===Number(t)});return n[e]},updateItem:function(t,e,n){this.trigger("will_incremental_change");var i=_(this.items).find(function(e){return e.cid===Number(t)});return i[e]=n,this.trigger("change:"+e,[i]),this.trigger("incremental_change",[e]),this.trigger("update","updateItem"),i.guid},batchUpdateItems:function(t,e,n){this.trigger("will_incremental_change");var i=this.get(t,!0);return _(i).each(function(t){t[e]=n}),this.trigger("change:"+e,i),this.trigger("incremental_change",[e]),this.trigger("update","batchUpdate"),_(i).pluck("guid")},updateAttributes:function(t,e){this.trigger("will_incremental_change");var n=_(this.items).find(function(e){return e.cid===Number(t)}),i=this;return _(e).each(function(t,e){n[e]=t,i.trigger("change:"+e,[n])}),this.trigger("incremental_change",_(e).keys()),this.trigger("update","updateAttribute"),n.guid},batchUpdateAttributes:function(t,e){this.trigger("will_incremental_change");var n=this.get(t,!0),i=this;return _(n).each(function(t){_(e).each(function(e,n){t[n]=e})}),_(e).each(function(t,e){i.trigger("change:"+e,n)}),this.trigger("incremental_change",_(e).keys()),this.trigger("update"),this.trigger("batchUpdateAttribute"),_(n).pluck("guid")},batchLoadItems:function(t){this.trigger("will_incremental_change"),_(t).each(_.bind(function(t){var e,n=this.getBy("guid",t.guid),i=this.items.length>0?_(this.items).last().cid+1:0;n&&n[0]?(e=n[0],_(t).each(function(t,n){e[n]=t})):(n=PourOver.Item(t),n.cid=i++,this.items=this.items.concat([n]))},this)),this.regenerateFilterSets(),this.trigger("incremental_change","*"),this.trigger("change"),this.trigger("update"),this.trigger("batchLoadItems")}}),PourOver.Item=function(t){return t},PourOver.Filter=function(t,e,n){"undefined"==typeof n&&(n={}),this.name=t,this.possibilities=this.create_possibilities(e),this.values=_(e).map(function(t){return t.value}),_.extend(this,n),this.initialize.apply(this,arguments)},_.extend(PourOver.Filter.prototype,PourOver.Events,{initialize:function(){},create_possibilities:function(t){var e={};return _(t).each(function(t){var n=t.name||String(t.value);e[n]=t,e[n].matching_cids=[]}),e},cacheResults:function(){throw"No cache function has been defined for this filter '"+this.name+"'."},addCacheResults:function(){throw"No add cache function has been defined for this filter '"+this.name+"'."},makeQueryMatchSet:function(t,e){return new PourOver.MatchSet(t,this.getCollection(),[[this,e]])},removeFromCache:function(t){var e=_(t).map(function(t){return t.cid}).sort(function(t,e){return t-e});_(this.possibilities).each(function(t){t.matching_cids=PourOver.subtract_sorted(t.matching_cids,e)})},query:function(t,e){if("undefined"==typeof e)var e=!1;var n=this.getFn(t);this.setQuery(n,e)},setQuery:function(t,e){if("undefined"==typeof e)var e=!1;this.current_query=t,e||this.trigger("queryChange")},clearQuery:function(t){if("undefined"==typeof t)var t=!1;this.current_query=!1,t||this.trigger("queryChange")},unionQuery:function(t,e){if("undefined"==typeof e)var e=!1;if("string"==typeof t||"number"==typeof t||_.isArray(t))var t=this.getFn(t);this.current_query=this.current_query?this.current_query.or(t):t,e||this.trigger("queryChange")},intersectQuery:function(t,e){if("undefined"==typeof e)var e=!1;if("string"==typeof t||"number"==typeof t||_.isArray(t))var t=this.getFn(t);this.current_query=this.current_query?this.current_query.and(t):t,e||this.trigger("queryChange")},subtractQuery:function(t,e){if("undefined"==typeof e)var e=!1;if("string"==typeof t||"number"==typeof t||_.isArray(t))var t=this.getFn(t);this.current_query=this.current_query?this.current_query.not(t):t,e||this.trigger("queryChange")},removeSingleQuery:function(t,e){if(!this.current_query)return!1;if("undefined"==typeof e)var e=!1;if("string"==typeof t||"number"==typeof t||_.isArray(t))var t=this.getFn(t);var n,i=[],r=this.current_query.stack,a=function(t){return _.isString(t)&&t.match(/^(or|and|not)$/)};n=_(r).reduce(function(e,n){return n[1]===t.stack[0][1]?e:a(n[0])&&n[1][0][1]===t.stack[0][1]?e:(e.push(n),e)},i),!n[0]||"and"!=n[0][0]&&"or"!=n[0][0]&&"not"!=n[0][0]||(n[0]=n[0][1][0]),this.current_query.stack=n,this.current_query.refresh(),e||this.trigger("queryChange")},getCollection:function(){return this.collection},getByPossibilityGroups:function(){var t=this.collection;return _(this.possibilities).reduce(function(e,n,i){return e[i]=t.get(n.matching_cids),e},{})}}),PourOver.Sort=function(t,e){this.name=t,_.extend(this,e),this.initialize.apply(this,arguments)},_.extend(PourOver.Sort.prototype,PourOver.Events,{initialize:function(){},view:!1,sort:function(t){return PourOver.permute_from_array(t,this.permutation_array)},rebuild_sort:function(){if(this.view)var t=this.view.match_set.all();else var t=this.collection.items;this.permutation_array=PourOver.build_permutation_array(t,this),this.trigger("resort")}}),PourOver.View=function(t,e,n){var i=this;this.name=t,"undefined"==typeof n&&(n={}),this.collection=e,this.match_set=new PourOver.MatchSet(_(this.collection.items).map(function(t){return t.cid}),this.collection,["all"]),n.template&&(this.template=n.template),this.collection.on("will_change will_incremental_change",function(){i.storeViewPosition()}),this.collection.on("change",function(){i.match_set.refresh(),i.setNaturalSelection(),i.resetPage()}),this.collection.on("incremental_change",function(t){i.match_set.refresh(),i.setNaturalSelection(t),i.resetPage()}),this.collection.on("update",function(t){i.trigger("update",t)}),this.collection.on("queryChange",function(){i.setNaturalSelection(),i.trigger("update","query")}),this.on("sortChange",function(){this.trigger("update","sort")}),this.on("pageChange",function(){this.trigger("update","page")}),this.view_sorts=[],_.extend(this,n),this.initialize.apply(this,arguments)},_.extend(PourOver.View.prototype,PourOver.Events,{initialize:function(){},current_page:0,page_size:1/0,current_sort:!1,removeSort:function(){this.current_sort.off&&this.current_sort.off("resort"),this.current_sort=!1,this.trigger("sortChange")},setSort:function(t,e){"undefined"==typeof e&&(e=!1);var n=this;this.current_sort.off&&this.current_sort.off("resort"),t&&e?(this.current_sort=this.view_sorts[t],this.current_sort.on("resort",function(){n.trigger("sortChange")})):t?(this.current_sort=this.collection.sorts[t],this.current_sort.on("resort",function(){n.trigger("sortChange")})):this.current_sort=!1,this.trigger("sortChange")},getSort:function(){return this.current_sort?this.current_sort.name:!1},addViewSorts:function(t){"undefined"==typeof opts&&(opts={}),_(t).isArray()||(t=[t]);var e=this;_(t).each(function(t){e.view_sorts[t.name]=t,t.collection=e.collection,t.view=e,t.rebuild_sort(),e.on("selectionChange",function(e){(void 0==t.associated_attrs||"*"===e)&&t.rebuild_sort(),t.associated_attrs&&_.intersection(t.associated_attrs,e).length>0&&t.rebuild_sort()})})},selectionFn:function(){var t=this.collection,e=_(t.filters).reduce(function(e,n){var i=n.current_query;return!e||i&&!_.isEmpty(i.stack)?e||i&&!_.isEmpty(i.stack)?e?e.and(i):i:t.getAllItems():e},!1);return e},setSelection:function(t,e){this.match_set=t,this.trigger("selectionChange",e)},setNaturalSelection:function(t){var e;e=this.selectionFn(),this.setSelection(e,t)},clearSelection:function(){this.match_set=this.collection.getAllItems()},getCurrentItems:function(t){if(!this.match_set)return[];if("undefined"==typeof t)var t=this.current_page;if(1/0==this.page_size)if(this.current_sort)var e=this.match_set.all_sorted(this.current_sort);else var e=this.match_set.all();else if(this.current_sort){var e=this.match_set.all_sorted_cids(this.current_sort);
e=e.slice(this.page_size*t,this.page_size*(t+1));var n=_(e).clone().sort(function(t,e){return t-e}),i=this.collection.get(n);e=_(e).map(function(t){return _(i).find(function(e){return e.cid===t})})}else{var e=this.match_set.cids;e=e.slice(this.page_size*t,this.page_size*(t+1)),e=this.collection.get(e)}return e},storeViewPosition:function(){var t=this.getCurrentItems()[0];t&&(this.last_head_cid=t.cid)},resetPage:function(){this.last_head_cid&&(this.current_sort&&this.current_sort.rebuild_sort(),this.pageTo(this.last_head_cid,!0)),this.last_head_cid=void 0},page:function(t){var e=t+this.current_page;0>e&&(e=0),e>Math.ceil(this.match_set.length()/this.page_size-1)&&(e=Math.ceil(this.match_set.length()/this.page_size-1)),this.current_page=e,this.trigger("pageChange")},pageTo:function(t,e){if("undefined"==typeof e)var e=!1;if(this.current_sort)var n=_(this.match_set.all_sorted_cids(this.current_sort)).indexOf(t),i=(this.match_set.cids.length,Math.floor(n/this.page_size));else var n=_(this.match_set.cids).indexOf(t),i=(this.match_set.cids.length,Math.floor(n/this.page_size));n>=0&&(this.current_page=i,e||this.trigger("pageChange"))},setPage:function(t){0>t&&(t=0),t>Math.ceil(this.match_set.length()/this.page_size-1)&&(t=Math.ceil(this.match_set.length()/this.page_size-1)),this.current_page=t,this.trigger("pageChange")},setPageSize:function(t){this.page_size=t,this.trigger("pageChange")},render:function(){}}),PourOver.MatchSet=function(t,e,n){this.cids=t,this.collection=e,this.stack=n,this.initialize.apply(this,arguments)},_.extend(PourOver.MatchSet.prototype,PourOver.Events,{initialize:function(){},refresh:function(t,e){if("undefined"==typeof t)var t=this.stack||[];if(t.length<1&&e)return this.cids=e.cids,this;if(t.length<1)return this.cids=!1,this;var n=t[0],i=n[0],r=function(t){return _.isString(t)&&t.match(/^(or|and|not)$/)};if("object"==typeof i){var e=i.getFn(n[1]);return this.refresh(_(t).rest(),e)}if("all"===i||"all"===n){var a=_(this.collection.items).map(function(t){return t.cid}),e=new PourOver.MatchSet(a,this,["all"]);return this.refresh(_(t).rest(),e)}if(r(i))var o=e[i](this.refresh(n[1]));else var o=this.refresh(n[1]);return this.refresh(_(t).rest(),o)},and:function(t){if(this.stack.length<1&&t)return t;if(t){var e=PourOver.intersect_sorted(this.cids,t.cids);return new PourOver.MatchSet(e,this.collection,this.stack.concat([["and",t.stack]]))}return this},or:function(t){if(this.stack.length<1&&t)return t;if(t){var e=PourOver.union_sorted(this.cids,t.cids);return new PourOver.MatchSet(e,this.collection,this.stack.concat([["or",t.stack]]))}return this},not:function(t){if(this.stack.length<1||!t)return this;var e=PourOver.subtract_sorted(this.cids,t.cids);return new PourOver.MatchSet(e,this.collection,this.stack.concat([["not",t.stack]]))},all:function(){return this.collection.get(this.cids)},slice:function(t,e){return this.collection.get(this.cids.slice(t,e))},all_sorted:function(t){var e=this.all();return t?t.sort(e):e},all_sorted_cids:function(t){var e=this.cids;return t?t.sort(e):e},length:function(){return this.cids.length}}),PourOver.UI={},PourOver.UI.Element=function(t){if("undefined"==typeof t)var t={};_.extend(this,t),this.initialize.apply(this,arguments)},_.extend(PourOver.UI.Element.prototype,PourOver.Events,{initialize:function(){},getMatchSet:function(){throw"No get match set function specified"},getFilterState:function(){throw"No get filter state specified"},template:function(){throw"No template specified"},render:function(){var t=this.getFilterState(),e=this.template({state:t});return e},getSimpleSelectState:function(t,e,n){if("undefined"==typeof t||!t||!t.stack)return!1;if("undefined"==typeof e)var e=t.stack;if("undefined"==typeof n)var n=[];if(e.length<1)return n;if("object"==typeof e[0][0])return n.push(e[0][1]),this.getSimpleSelectState(t,_(e).rest(),n);if("or"===e[0][0])return n=n.concat(this.getSimpleSelectState(t,e[0][1])),this.getSimpleSelectState(t,_(e).rest(),n);throw"This does not appear to be a valid, simple selectElement stack."},getIntersectedSelectState:function(t,e,n){if("undefined"==typeof t||!t||!t.stack)return!1;if("undefined"==typeof e)var e=t.stack;if("undefined"==typeof n)var n=[];if(e.length<1)return n;if("object"==typeof e[0][0])return n.push(e[0][1]),this.getIntersectedSelectState(t,_(e).rest(),n);if("and"===e[0][0])return n=n.concat(this.getIntersectedSelectState(t,e[0][1])),this.getIntersectedSelectState(t,_(e).rest(),n);throw"This does not appear to be a valid, simple selectElement stack."},getSimpleRangeState:function(t){if("undefined"==typeof t||!t||!t.stack)return!1;if(stack=t.stack,1!==stack.length||2!==stack[0][1].length)throw"The filter specified does not appear to have a simple range stack.";return stack[0][1]}}),PourOver.extend=function(t,e){var n,i=this;n=t&&_.has(t,"constructor")?t.constructor:function(){return i.apply(this,arguments)},_.extend(n,i,e);var r=function(){this.constructor=n};return r.prototype=i.prototype,n.prototype=new r,t&&_.extend(n.prototype,t),n.__super__=i.prototype,n},PourOver.Collection.extend=PourOver.View.extend=PourOver.Filter.extend=PourOver.Sort.extend=PourOver.MatchSet.extend=PourOver.UI.Element.extend=PourOver.extend,PourOver.BufferedCollection=PourOver.Collection.extend({buffered_items:{},stripFutures:function(t){return _(t).reduce(function(t,e,n){return"undefined"!=typeof e&&(t[n]=e),t},{})},get:function(t,e){if("undefined"==typeof e)var e=!1;var n=PourOver.Collection.prototype.get.call(this,t),i=this;return e?n:_(n).map(function(t){var e=t.guid;return i.buffered_items.hasOwnProperty(e)?_(i.buffered_items[e]).extend(i.stripFutures(t)):t})},getBy:function(t,e,n,i){if("undefined"==typeof i)var i=!1;var r=PourOver.Collection.prototype.getBy.call(this,t,e,n),a=this;return i?r:_(r).map(function(t){var e=t.guid;return a.buffered_items.hasOwnProperty(e)?_(a.buffered_items[e]).extend(a.stripFutures(t)):t})},getBufferedValue:function(t,e){return this.buffered_items.hasOwnProperty(t)?this.buffered_items[t][e]||!1:!1},clearBufferedItems:function(){var t=this.buffered_items;for(var e in t)t.hasOwnProperty(e)&&delete t[e]},getBufferUrl:function(){throw"You must override getBufferUrl;"},preprocessItem:function(t){return[t.guid,t]},bufferGuids:function(t){{var e=this,t=_(t).select(function(t){return t&&!e.buffered_items.hasOwnProperty(t)}),n=this.getBufferUrl(t),i=n[0];n[1]}return t.length>0?$.ajax({url:i,dataType:"jsonp",cache:!0}).always(function(t){_.isArray(t)&&(items=_(t).map(_.bind(e.preprocessItem,e)),_(items).each(function(t){e.buffered_items[t[0]]=t[1]}))}):$.Deferred().resolve(!1)}}),PourOver.BufferedView=PourOver.View.extend({buffer_pages:1,bufferAroundCurrentPage:function(){var t=this.current_page,e=t-this.buffer_pages>0?t-this.buffer_pages:0,n=t+this.buffer_pages,i=_.range(e,n+1),r=this;i=_(i).map(function(t){return _(r.getCurrentItems(t)).pluck("guid")});var a=_.flatten(i);buffer_deferred=this.collection.bufferGuids(a),buffer_deferred.done(function(t){t&&r.render()})},bufferRender:function(){var t=_(this.getCurrentItems()).pluck("guid"),e=this.collection.bufferGuids(t);e.done(_(function(){this.render()}).bind(this))},page:function(t){PourOver.View.prototype.page.call(this,t),this.bufferAroundCurrentPage()},pageTo:function(t,e){if("undefined"==typeof e)var e=!1;PourOver.View.prototype.pageTo.call(this,t,e),this.bufferAroundCurrentPage()}}),PourOver.manualFilter=PourOver.Filter.extend({cacheResults:function(){return!1},addCacheResults:function(){return!1},getFn:function(t){if(_(t).isArray())return t=t.sort(function(t,e){return t-e}),new PourOver.MatchSet(t,this.getCollection(),[[this,t]]);if("number"==typeof t)return new PourOver.MatchSet([t],this.getCollection(),[[this,t]]);throw"Manual filters only support querying by one or more cids"},addItems:function(t){if(_(t).isArray()||(t=[t]),t=t.sort(function(t,e){return t-e}),this.current_query)var e=this.current_query.cids,n=PourOver.union_sorted(e,t);else var n=t;this.query(n)},removeItems:function(t){_(t).isArray()||(t=[t]),t=t.sort(function(t,e){return t-e});var e=this.current_query.cids,n=PourOver.subtract_sorted(e,t);this.query(n)}}),PourOver.makeManualFilter=function(t){var e=new PourOver.manualFilter(t,[]);return e},PourOver.exactFilter=PourOver.Filter.extend({cacheResults:PourOver.cacheMethods.exactCache,addCacheResults:PourOver.cacheMethods.exactAddCache,getFn:function(t){var e=this;if(_(t).isArray()){var n=_(t).reduce(function(t,n){return t?t.or(e.getFn(n)):e.getFn(n)},!1);return n}var i=this.possibilities[t];if(_.isUndefined(i))throw"The filter "+this.name+" does not have a match for the query '"+t+"'.";return new PourOver.MatchSet(i.matching_cids,this.getCollection(),[[this,t]])}}),PourOver.makeExactFilter=function(t,e,n){"undefined"==typeof n&&(n={});var e=_(e).map(function(t){return{value:t}}),i=n.attr||t,n=_.extend({associated_attrs:[i]},n),r=new PourOver.exactFilter(t,e,n);return r},PourOver.inclusionFilter=PourOver.exactFilter.extend({cacheResults:PourOver.cacheMethods.inclusionCache,addCacheResults:PourOver.cacheMethods.inclusionAddCache}),PourOver.makeInclusionFilter=function(t,e,n){"undefined"==typeof n&&(n={});var e=_(e).map(function(t){return{value:t}}),i=n.attr||t,n=_.extend({associated_attrs:[i]},n),r=new PourOver.inclusionFilter(t,e,n);return r},PourOver.rangeFilter=PourOver.Filter.extend({cacheResults:PourOver.cacheMethods.defaultCache,addCacheResults:PourOver.cacheMethods.defaultAddCache,fn:function(t,e){var n=this.attr||this.name;return t.low<=e[n]&&t.high>=e[n]},getFn:function(t){var e=this.possibilities[t.join("-")];if(_.isUndefined(e))throw"The filter "+this.name+" does not have a match for the query '"+t+"'.";return new PourOver.MatchSet(e.matching_cids,this.getCollection(),[[this,t]])}}),PourOver.makeRangeFilter=function(t,e,n){"undefined"==typeof n&&(n={});var i=_(e).map(function(t){return{low:t[0],high:t[1],value:t.join("-")}}),r=n.attr||t,a=_.extend({associated_attrs:[r]},n),o=new PourOver.rangeFilter(t,i,a);return o},PourOver.dvrangeFilter=PourOver.Filter.extend({cacheResults:PourOver.cacheMethods.exactCache,addCacheResults:PourOver.cacheMethods.exactAddCache,getFn:function(t){if(!t[0]||!t[1])return new PourOver.MatchSet([],this.getCollection(),[[this,t]]);var e,n,i,r,a;return e=_(this.values).indexOf(t[0]),n=_(this.values).indexOf(t[1]),i=this,r=_(this.values.slice(e,n+1)).map(function(t){return i.possibilities[t]}),a=_(r).reduce(function(t,e){return PourOver.union_sorted(t,e.matching_cids)},[]),new PourOver.MatchSet(a,this.getCollection(),[[this,t]])}}),PourOver.makeDVrangeFilter=function(t,e,n){"undefined"==typeof n&&(n={});var i=_(e).map(function(t){return{value:t}}),r=n.attr||t,a=_.extend({associated_attrs:[r]},n),o=new PourOver.dvrangeFilter(t,i,a);return o},PourOver.explicitSort=PourOver.Sort.extend({fn:function(t,e){var n=_(this.order).indexOf(t[this.attr]),i=_(this.order).indexOf(e[this.attr]);return-1===n&&(n=1/0),-1===i&&(i=1/0),n-i},reset:function(t){this.order=_(t).pluck(this.attr),this.rebuild_sort()},insert:function(t,e){if("undefined"==typeof e)var e=this.order.length;_(t).isArray()||(t=[t]);var n=_(t).pluck(this.attr),i=[e,0].concat(n);this.order.splice.apply(this.order,i),this.rebuild_sort()},remove:function(t){_(t).isArray()||(t=[t]);var e=_(t).pluck(this.attr);this.order=_(this.order).difference(e),this.rebuild_sort()},move:function(t,e){_(t).isArray()||(t=[t]);var n=_(t).pluck(this.attr);this.order=_(this.order).map(function(t){return _(n).include(t)?null:t}),this.insert(t,e),this.order=_(this.order).compact()}}),PourOver.makeExplicitSort=function(t,e,n,i,r){var a=new PourOver.explicitSort(t,r);return a.attr=n,a.order=i,a},PourOver.reverseCidSort=PourOver.Sort.extend({fn:function(t,e){return e.cid-t.cid}}),PourOver.makeReverseCidSort=function(t){var e=new PourOver.reverseCidSort(t);return e.attr="cid",e},PourOver.UI.SimpleSelectElement=PourOver.UI.Element.extend({initialize:function(t){if(!t.filter)throw"A simple select element must have a filter specified";this.filter=t.filter},getMatchSet:function(){return this.filter.current_query},getFilterState:function(){var t=this.getMatchSet();return this.getSimpleSelectState(t)}}),PourOver.UI.SimpleDVRangeElement=PourOver.UI.Element.extend({initialize:function(t){if(!t.filter)throw"A simple dv range element must have a filter specified";this.filter=t.filter},getMatchSet:function(){return this.filter.current_query},getFilterState:function(){var t=this.getMatchSet();return this.getSimpleRangeState(t)}}),PourOver}();if("object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(t){return 10>t?"0"+t:t}function quote(t){return escapable.lastIndex=0,escapable.test(t)?'"'+t.replace(escapable,function(t){var e=meta[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function str(t,e){var n,i,r,a,o,s=gap,u=e[t];switch(u&&"object"==typeof u&&"function"==typeof u.toJSON&&(u=u.toJSON(t)),"function"==typeof rep&&(u=rep.call(e,t,u)),typeof u){case"string":return quote(u);case"number":return isFinite(u)?String(u):"null";case"boolean":case"null":return String(u);case"object":if(!u)return"null";if(gap+=indent,o=[],"[object Array]"===Object.prototype.toString.apply(u)){for(a=u.length,n=0;a>n;n+=1)o[n]=str(n,u)||"null";return r=0===o.length?"[]":gap?"[\n"+gap+o.join(",\n"+gap)+"\n"+s+"]":"["+o.join(",")+"]",gap=s,r}if(rep&&"object"==typeof rep)for(a=rep.length,n=0;a>n;n+=1)"string"==typeof rep[n]&&(i=rep[n],r=str(i,u),r&&o.push(quote(i)+(gap?": ":":")+r));else for(i in u)Object.prototype.hasOwnProperty.call(u,i)&&(r=str(i,u),r&&o.push(quote(i)+(gap?": ":":")+r));return r=0===o.length?"{}":gap?"{\n"+gap+o.join(",\n"+gap)+"\n"+s+"}":"{"+o.join(",")+"}",gap=s,r}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(t,e,n){var i;if(gap="",indent="","number"==typeof n)for(i=0;n>i;i+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=e,!e||"function"==typeof e||"object"==typeof e&&"number"==typeof e.length)return str("",{"":t});throw new Error("JSON.stringify")}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(t,e){var n,i,r=t[e];if(r&&"object"==typeof r)for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(i=walk(r,n),void 0!==i?r[n]=i:delete r[n]);return reviver.call(t,e,r)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(t,e){"use strict";var n=t.History=t.History||{},i=t.jQuery;if("undefined"!=typeof n.Adapter)throw new Error("History.js Adapter has already been loaded...");n.Adapter={bind:function(t,e,n){i(t).bind(e,n)},trigger:function(t,e,n){i(t).trigger(e,n)},extractEventData:function(t,n,i){var r=n&&n.originalEvent&&n.originalEvent[t]||i&&i[t]||e;return r},onDomLoad:function(t){i(t)}},"undefined"!=typeof n.init&&n.init()}(window),function(t){"use strict";var e=t.document,n=t.setTimeout||n,i=t.clearTimeout||i,r=t.setInterval||r,a=t.History=t.History||{};if("undefined"!=typeof a.initHtml4)throw new Error("History.js HTML4 Support has already been loaded...");a.initHtml4=function(){return"undefined"!=typeof a.initHtml4.initialized?!1:(a.initHtml4.initialized=!0,a.enabled=!0,a.savedHashes=[],a.isLastHash=function(t){var e,n=a.getHashByIndex();return e=t===n},a.isHashEqual=function(t,e){return t=encodeURIComponent(t).replace(/%25/g,"%"),e=encodeURIComponent(e).replace(/%25/g,"%"),t===e},a.saveHash=function(t){return a.isLastHash(t)?!1:(a.savedHashes.push(t),!0)},a.getHashByIndex=function(t){var e=null;return e="undefined"==typeof t?a.savedHashes[a.savedHashes.length-1]:0>t?a.savedHashes[a.savedHashes.length+t]:a.savedHashes[t]},a.discardedHashes={},a.discardedStates={},a.discardState=function(t,e,n){var i,r=a.getHashByState(t);return i={discardedState:t,backState:n,forwardState:e},a.discardedStates[r]=i,!0},a.discardHash=function(t,e,n){var i={discardedHash:t,backState:n,forwardState:e};return a.discardedHashes[t]=i,!0},a.discardedState=function(t){var e,n=a.getHashByState(t);return e=a.discardedStates[n]||!1},a.discardedHash=function(t){var e=a.discardedHashes[t]||!1;return e},a.recycleState=function(t){var e=a.getHashByState(t);return a.discardedState(t)&&delete a.discardedStates[e],!0},a.emulated.hashChange&&(a.hashChangeInit=function(){a.checkerFunction=null;var n,i,o,s,u="",l=Boolean(a.getHash());return a.isInternetExplorer()?(n="historyjs-iframe",i=e.createElement("iframe"),i.setAttribute("id",n),i.setAttribute("src","#"),i.style.display="none",e.body.appendChild(i),i.contentWindow.document.open(),i.contentWindow.document.close(),o="",s=!1,a.checkerFunction=function(){if(s)return!1;s=!0;var e=a.getHash(),n=a.getHash(i.contentWindow.document);return e!==u?(u=e,n!==e&&(o=n=e,i.contentWindow.document.open(),i.contentWindow.document.close(),i.contentWindow.document.location.hash=a.escapeHash(e)),a.Adapter.trigger(t,"hashchange")):n!==o&&(o=n,l&&""===n?a.back():a.setHash(n,!1)),s=!1,!0}):a.checkerFunction=function(){var e=a.getHash()||"";return e!==u&&(u=e,a.Adapter.trigger(t,"hashchange")),!0},a.intervalList.push(r(a.checkerFunction,a.options.hashChangeInterval)),!0},a.Adapter.onDomLoad(a.hashChangeInit)),a.emulated.pushState&&(a.onHashChange=function(e){var n,i=e&&e.newURL||a.getLocationHref(),r=a.getHashByUrl(i),o=null,s=null;return a.isLastHash(r)?(a.busy(!1),!1):(a.doubleCheckComplete(),a.saveHash(r),r&&a.isTraditionalAnchor(r)?(a.Adapter.trigger(t,"anchorchange"),a.busy(!1),!1):(o=a.extractState(a.getFullUrl(r||a.getLocationHref()),!0),a.isLastSavedState(o)?(a.busy(!1),!1):(s=a.getHashByState(o),n=a.discardedState(o),n?(a.getHashByIndex(-2)===a.getHashByState(n.forwardState)?a.back(!1):a.forward(!1),!1):(a.pushState(o.data,o.title,encodeURI(o.url),!1),!0))))},a.Adapter.bind(t,"hashchange",a.onHashChange),a.pushState=function(e,n,i,r){if(i=encodeURI(i).replace(/%25/g,"%"),a.getHashByUrl(i))throw new Error("History.js does not support states with fragment-identifiers (hashes/anchors).");if(r!==!1&&a.busy())return a.pushQueue({scope:a,callback:a.pushState,args:arguments,queue:r}),!1;a.busy(!0);var o=a.createStateObject(e,n,i),s=a.getHashByState(o),u=a.getState(!1),l=a.getHashByState(u),c=a.getHash(),h=a.expectedStateId==o.id;return a.storeState(o),a.expectedStateId=o.id,a.recycleState(o),a.setTitle(o),s===l?(a.busy(!1),!1):(a.saveState(o),h||a.Adapter.trigger(t,"statechange"),!a.isHashEqual(s,c)&&!a.isHashEqual(s,a.getShortUrl(a.getLocationHref()))&&a.setHash(s,!1),a.busy(!1),!0)},a.replaceState=function(e,n,i,r){if(i=encodeURI(i).replace(/%25/g,"%"),a.getHashByUrl(i))throw new Error("History.js does not support states with fragment-identifiers (hashes/anchors).");if(r!==!1&&a.busy())return a.pushQueue({scope:a,callback:a.replaceState,args:arguments,queue:r}),!1;a.busy(!0);var o=a.createStateObject(e,n,i),s=a.getHashByState(o),u=a.getState(!1),l=a.getHashByState(u),c=a.getStateByIndex(-2);return a.discardState(u,o,c),s===l?(a.storeState(o),a.expectedStateId=o.id,a.recycleState(o),a.setTitle(o),a.saveState(o),a.Adapter.trigger(t,"statechange"),a.busy(!1)):a.pushState(o.data,o.title,o.url,!1),!0}),a.emulated.pushState&&a.getHash()&&!a.emulated.hashChange&&a.Adapter.onDomLoad(function(){a.Adapter.trigger(t,"hashchange")}),void 0)},"undefined"!=typeof a.init&&a.init()}(window),function(t,e){"use strict";var n=t.console||e,i=t.document,r=t.navigator,a=t.sessionStorage||!1,o=t.setTimeout,s=t.clearTimeout,u=t.setInterval,l=t.clearInterval,c=t.JSON,h=t.alert,d=t.History=t.History||{},p=t.history;try{a.setItem("TEST","1"),a.removeItem("TEST")}catch(f){a=!1}if(c.stringify=c.stringify||c.encode,c.parse=c.parse||c.decode,"undefined"!=typeof d.init)throw new Error("History.js Core has already been loaded...");d.init=function(){return"undefined"==typeof d.Adapter?!1:("undefined"!=typeof d.initCore&&d.initCore(),"undefined"!=typeof d.initHtml4&&d.initHtml4(),!0)},d.initCore=function(){if("undefined"!=typeof d.initCore.initialized)return!1;if(d.initCore.initialized=!0,d.options=d.options||{},d.options.hashChangeInterval=d.options.hashChangeInterval||100,d.options.safariPollInterval=d.options.safariPollInterval||500,d.options.doubleCheckInterval=d.options.doubleCheckInterval||500,d.options.disableSuid=d.options.disableSuid||!1,d.options.storeInterval=d.options.storeInterval||1e3,d.options.busyDelay=d.options.busyDelay||250,d.options.debug=d.options.debug||!1,d.options.initialTitle=d.options.initialTitle||i.title,d.options.html4Mode=d.options.html4Mode||!1,d.options.delayInit=d.options.delayInit||!1,d.intervalList=[],d.clearAllIntervals=function(){var t,e=d.intervalList;if("undefined"!=typeof e&&null!==e){for(t=0;t<e.length;t++)l(e[t]);d.intervalList=null}},d.debug=function(){(d.options.debug||!1)&&d.log.apply(d,arguments)},d.log=function(){var t,e,r,a,o,s="undefined"!=typeof n&&"undefined"!=typeof n.log&&"undefined"!=typeof n.log.apply,u=i.getElementById("log");for(s?(a=Array.prototype.slice.call(arguments),t=a.shift(),"undefined"!=typeof n.debug?n.debug.apply(n,[t,a]):n.log.apply(n,[t,a])):t="\n"+arguments[0]+"\n",e=1,r=arguments.length;r>e;++e){if(o=arguments[e],"object"==typeof o&&"undefined"!=typeof c)try{o=c.stringify(o)}catch(l){}t+="\n"+o+"\n"}return u?(u.value+=t+"\n-----\n",u.scrollTop=u.scrollHeight-u.clientHeight):s||h(t),!0},d.getInternetExplorerMajorVersion=function(){var t=d.getInternetExplorerMajorVersion.cached="undefined"!=typeof d.getInternetExplorerMajorVersion.cached?d.getInternetExplorerMajorVersion.cached:function(){for(var t=3,e=i.createElement("div"),n=e.getElementsByTagName("i");(e.innerHTML="<!--[if gt IE "+ ++t+"]><i></i><![endif]-->")&&n[0];);return t>4?t:!1}();return t},d.isInternetExplorer=function(){var t=d.isInternetExplorer.cached="undefined"!=typeof d.isInternetExplorer.cached?d.isInternetExplorer.cached:Boolean(d.getInternetExplorerMajorVersion());return t},d.emulated=d.options.html4Mode?{pushState:!0,hashChange:!0}:{pushState:!Boolean(t.history&&t.history.pushState&&t.history.replaceState&&!/ Mobile\/([1-7][a-z]|(8([abcde]|f(1[0-8]))))/i.test(r.userAgent)&&!/AppleWebKit\/5([0-2]|3[0-2])/i.test(r.userAgent)),hashChange:Boolean(!("onhashchange"in t||"onhashchange"in i)||d.isInternetExplorer()&&d.getInternetExplorerMajorVersion()<8)},d.enabled=!d.emulated.pushState,d.bugs={setHash:Boolean(!d.emulated.pushState&&"Apple Computer, Inc."===r.vendor&&/AppleWebKit\/5([0-2]|3[0-3])/.test(r.userAgent)),safariPoll:Boolean(!d.emulated.pushState&&"Apple Computer, Inc."===r.vendor&&/AppleWebKit\/5([0-2]|3[0-3])/.test(r.userAgent)),ieDoubleCheck:Boolean(d.isInternetExplorer()&&d.getInternetExplorerMajorVersion()<8),hashEscape:Boolean(d.isInternetExplorer()&&d.getInternetExplorerMajorVersion()<7)},d.isEmptyObject=function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0},d.cloneObject=function(t){var e,n;return t?(e=c.stringify(t),n=c.parse(e)):n={},n},d.getRootUrl=function(){var t=i.location.protocol+"//"+(i.location.hostname||i.location.host);return i.location.port&&(t+=":"+i.location.port),t+="/"},d.getBaseHref=function(){var t=i.getElementsByTagName("base"),e=null,n="";return 1===t.length&&(e=t[0],n=e.href.replace(/[^\/]+$/,"")),n=n.replace(/\/+$/,""),n&&(n+="/"),n},d.getBaseUrl=function(){var t=d.getBaseHref()||d.getBasePageUrl()||d.getRootUrl();return t},d.getPageUrl=function(){var t,e=d.getState(!1,!1),n=(e||{}).url||d.getLocationHref();return t=n.replace(/\/+$/,"").replace(/[^\/]+$/,function(t){return/\./.test(t)?t:t+"/"})},d.getBasePageUrl=function(){var t=d.getLocationHref().replace(/[#\?].*/,"").replace(/[^\/]+$/,function(t){return/[^\/]$/.test(t)?"":t}).replace(/\/+$/,"")+"/";return t},d.getFullUrl=function(t,e){var n=t,i=t.substring(0,1);return e="undefined"==typeof e?!0:e,/[a-z]+\:\/\//.test(t)||(n="/"===i?d.getRootUrl()+t.replace(/^\/+/,""):"#"===i?d.getPageUrl().replace(/#.*/,"")+t:"?"===i?d.getPageUrl().replace(/[\?#].*/,"")+t:e?d.getBaseUrl()+t.replace(/^(\.\/)+/,""):d.getBasePageUrl()+t.replace(/^(\.\/)+/,"")),n.replace(/\#$/,"")},d.getShortUrl=function(t){var e=t,n=d.getBaseUrl(),i=d.getRootUrl();return d.emulated.pushState&&(e=e.replace(n,"")),e=e.replace(i,"/"),d.isTraditionalAnchor(e)&&(e="./"+e),e=e.replace(/^(\.\/)+/g,"./").replace(/\#$/,"")},d.getLocationHref=function(t){return t=t||i,t.URL===t.location.href?t.location.href:t.location.href===decodeURIComponent(t.URL)?t.URL:t.location.hash&&decodeURIComponent(t.location.href.replace(/^[^#]+/,""))===t.location.hash?t.location.href:-1==t.URL.indexOf("#")&&-1!=t.location.href.indexOf("#")?t.location.href:t.URL||t.location.href},d.store={},d.idToState=d.idToState||{},d.stateToId=d.stateToId||{},d.urlToId=d.urlToId||{},d.storedStates=d.storedStates||[],d.savedStates=d.savedStates||[],d.normalizeStore=function(){d.store.idToState=d.store.idToState||{},d.store.urlToId=d.store.urlToId||{},d.store.stateToId=d.store.stateToId||{}},d.getState=function(t,e){"undefined"==typeof t&&(t=!0),"undefined"==typeof e&&(e=!0);var n=d.getLastSavedState();return!n&&e&&(n=d.createStateObject()),t&&(n=d.cloneObject(n),n.url=n.cleanUrl||n.url),n},d.getIdByState=function(t){var e,n=d.extractId(t.url);if(!n)if(e=d.getStateString(t),"undefined"!=typeof d.stateToId[e])n=d.stateToId[e];else if("undefined"!=typeof d.store.stateToId[e])n=d.store.stateToId[e];else{for(;n=(new Date).getTime()+String(Math.random()).replace(/\D/g,""),"undefined"!=typeof d.idToState[n]||"undefined"!=typeof d.store.idToState[n];);d.stateToId[e]=n,d.idToState[n]=t}return n},d.normalizeState=function(t){var e,n;return t&&"object"==typeof t||(t={}),"undefined"!=typeof t.normalized?t:(t.data&&"object"==typeof t.data||(t.data={}),e={},e.normalized=!0,e.title=t.title||"",e.url=d.getFullUrl(t.url?t.url:d.getLocationHref()),e.hash=d.getShortUrl(e.url),e.data=d.cloneObject(t.data),e.id=d.getIdByState(e),e.cleanUrl=e.url.replace(/\??\&_suid.*/,""),e.url=e.cleanUrl,n=!d.isEmptyObject(e.data),(e.title||n)&&d.options.disableSuid!==!0&&(e.hash=d.getShortUrl(e.url).replace(/\??\&_suid.*/,""),/\?/.test(e.hash)||(e.hash+="?"),e.hash+="&_suid="+e.id),e.hashedUrl=d.getFullUrl(e.hash),(d.emulated.pushState||d.bugs.safariPoll)&&d.hasUrlDuplicate(e)&&(e.url=e.hashedUrl),e)},d.createStateObject=function(t,e,n){var i={data:t,title:e,url:n};return i=d.normalizeState(i)},d.getStateById=function(t){t=String(t);var n=d.idToState[t]||d.store.idToState[t]||e;return n},d.getStateString=function(t){var e,n,i;return e=d.normalizeState(t),n={data:e.data,title:t.title,url:t.url},i=c.stringify(n)},d.getStateId=function(t){var e,n;return e=d.normalizeState(t),n=e.id},d.getHashByState=function(t){var e,n;return e=d.normalizeState(t),n=e.hash},d.extractId=function(t){var e,n,i,r;return r=-1!=t.indexOf("#")?t.split("#")[0]:t,n=/(.*)\&_suid=([0-9]+)$/.exec(r),i=n?n[1]||t:t,e=n?String(n[2]||""):"",e||!1},d.isTraditionalAnchor=function(t){var e=!/[\/\?\.]/.test(t);return e},d.extractState=function(t,e){var n,i,r=null;return e=e||!1,n=d.extractId(t),n&&(r=d.getStateById(n)),r||(i=d.getFullUrl(t),n=d.getIdByUrl(i)||!1,n&&(r=d.getStateById(n)),!r&&e&&!d.isTraditionalAnchor(t)&&(r=d.createStateObject(null,null,i))),r},d.getIdByUrl=function(t){var n=d.urlToId[t]||d.store.urlToId[t]||e;return n},d.getLastSavedState=function(){return d.savedStates[d.savedStates.length-1]||e},d.getLastStoredState=function(){return d.storedStates[d.storedStates.length-1]||e},d.hasUrlDuplicate=function(t){var e,n=!1;return e=d.extractState(t.url),n=e&&e.id!==t.id},d.storeState=function(t){return d.urlToId[t.url]=t.id,d.storedStates.push(d.cloneObject(t)),t},d.isLastSavedState=function(t){var e,n,i,r=!1;return d.savedStates.length&&(e=t.id,n=d.getLastSavedState(),i=n.id,r=e===i),r},d.saveState=function(t){return d.isLastSavedState(t)?!1:(d.savedStates.push(d.cloneObject(t)),!0)},d.getStateByIndex=function(t){var e=null;return e="undefined"==typeof t?d.savedStates[d.savedStates.length-1]:0>t?d.savedStates[d.savedStates.length+t]:d.savedStates[t]},d.getCurrentIndex=function(){var t=null;return t=d.savedStates.length<1?0:d.savedStates.length-1},d.getHash=function(t){var e,n=d.getLocationHref(t);return e=d.getHashByUrl(n)},d.unescapeHash=function(t){var e=d.normalizeHash(t);return e=decodeURIComponent(e)},d.normalizeHash=function(t){var e=t.replace(/[^#]*#/,"").replace(/#.*/,"");return e},d.setHash=function(t,e){var n,r;return e!==!1&&d.busy()?(d.pushQueue({scope:d,callback:d.setHash,args:arguments,queue:e}),!1):(d.busy(!0),n=d.extractState(t,!0),n&&!d.emulated.pushState?d.pushState(n.data,n.title,n.url,!1):d.getHash()!==t&&(d.bugs.setHash?(r=d.getPageUrl(),d.pushState(null,null,r+"#"+t,!1)):i.location.hash=t),d)},d.escapeHash=function(e){var n=d.normalizeHash(e);return n=t.encodeURIComponent(n),d.bugs.hashEscape||(n=n.replace(/\%21/g,"!").replace(/\%26/g,"&").replace(/\%3D/g,"=").replace(/\%3F/g,"?")),n},d.getHashByUrl=function(t){var e=String(t).replace(/([^#]*)#?([^#]*)#?(.*)/,"$2");return e=d.unescapeHash(e)},d.setTitle=function(t){var e,n=t.title;n||(e=d.getStateByIndex(0),e&&e.url===t.url&&(n=e.title||d.options.initialTitle));try{i.getElementsByTagName("title")[0].innerHTML=n.replace("<","&lt;").replace(">","&gt;").replace(" & "," &amp; ")}catch(r){}return i.title=n,d},d.queues=[],d.busy=function(t){if("undefined"!=typeof t?d.busy.flag=t:"undefined"==typeof d.busy.flag&&(d.busy.flag=!1),!d.busy.flag){s(d.busy.timeout);var e=function(){var t,n,i;if(!d.busy.flag)for(t=d.queues.length-1;t>=0;--t)n=d.queues[t],0!==n.length&&(i=n.shift(),d.fireQueueItem(i),d.busy.timeout=o(e,d.options.busyDelay))};d.busy.timeout=o(e,d.options.busyDelay)}return d.busy.flag},d.busy.flag=!1,d.fireQueueItem=function(t){return t.callback.apply(t.scope||d,t.args||[])},d.pushQueue=function(t){return d.queues[t.queue||0]=d.queues[t.queue||0]||[],d.queues[t.queue||0].push(t),d},d.queue=function(t,e){return"function"==typeof t&&(t={callback:t}),"undefined"!=typeof e&&(t.queue=e),d.busy()?d.pushQueue(t):d.fireQueueItem(t),d},d.clearQueue=function(){return d.busy.flag=!1,d.queues=[],d},d.stateChanged=!1,d.doubleChecker=!1,d.doubleCheckComplete=function(){return d.stateChanged=!0,d.doubleCheckClear(),d},d.doubleCheckClear=function(){return d.doubleChecker&&(s(d.doubleChecker),d.doubleChecker=!1),d},d.doubleCheck=function(t){return d.stateChanged=!1,d.doubleCheckClear(),d.bugs.ieDoubleCheck&&(d.doubleChecker=o(function(){return d.doubleCheckClear(),d.stateChanged||t(),!0},d.options.doubleCheckInterval)),d},d.safariStatePoll=function(){var e,n=d.extractState(d.getLocationHref());return d.isLastSavedState(n)?void 0:(e=n,e||(e=d.createStateObject()),d.Adapter.trigger(t,"popstate"),d)},d.back=function(t){return t!==!1&&d.busy()?(d.pushQueue({scope:d,callback:d.back,args:arguments,queue:t}),!1):(d.busy(!0),d.doubleCheck(function(){d.back(!1)}),p.go(-1),!0)},d.forward=function(t){return t!==!1&&d.busy()?(d.pushQueue({scope:d,callback:d.forward,args:arguments,queue:t}),!1):(d.busy(!0),d.doubleCheck(function(){d.forward(!1)}),p.go(1),!0)},d.go=function(t,e){var n;if(t>0)for(n=1;t>=n;++n)d.forward(e);else{if(!(0>t))throw new Error("History.go: History.go requires a positive or negative integer passed.");
for(n=-1;n>=t;--n)d.back(e)}return d},d.emulated.pushState){var f=function(){};d.pushState=d.pushState||f,d.replaceState=d.replaceState||f}else d.onPopState=function(e,n){var i,r,a=!1,o=!1;return d.doubleCheckComplete(),i=d.getHash(),i?(r=d.extractState(i||d.getLocationHref(),!0),r?d.replaceState(r.data,r.title,r.url,!1):(d.Adapter.trigger(t,"anchorchange"),d.busy(!1)),d.expectedStateId=!1,!1):(a=d.Adapter.extractEventData("state",e,n)||!1,o=a?d.getStateById(a):d.expectedStateId?d.getStateById(d.expectedStateId):d.extractState(d.getLocationHref()),o||(o=d.createStateObject(null,null,d.getLocationHref())),d.expectedStateId=!1,d.isLastSavedState(o)?(d.busy(!1),!1):(d.storeState(o),d.saveState(o),d.setTitle(o),d.Adapter.trigger(t,"statechange"),d.busy(!1),!0))},d.Adapter.bind(t,"popstate",d.onPopState),d.pushState=function(e,n,i,r){if(d.getHashByUrl(i)&&d.emulated.pushState)throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(r!==!1&&d.busy())return d.pushQueue({scope:d,callback:d.pushState,args:arguments,queue:r}),!1;d.busy(!0);var a=d.createStateObject(e,n,i);return d.isLastSavedState(a)?d.busy(!1):(d.storeState(a),d.expectedStateId=a.id,p.pushState(a.id,a.title,a.url),d.Adapter.trigger(t,"popstate")),!0},d.replaceState=function(e,n,i,r){if(d.getHashByUrl(i)&&d.emulated.pushState)throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(r!==!1&&d.busy())return d.pushQueue({scope:d,callback:d.replaceState,args:arguments,queue:r}),!1;d.busy(!0);var a=d.createStateObject(e,n,i);return d.isLastSavedState(a)?d.busy(!1):(d.storeState(a),d.expectedStateId=a.id,p.replaceState(a.id,a.title,a.url),d.Adapter.trigger(t,"popstate")),!0};if(a){try{d.store=c.parse(a.getItem("History.store"))||{}}catch(g){d.store={}}d.normalizeStore()}else d.store={},d.normalizeStore();d.Adapter.bind(t,"unload",d.clearAllIntervals),d.saveState(d.storeState(d.extractState(d.getLocationHref(),!0))),a&&(d.onUnload=function(){var t,e,n;try{t=c.parse(a.getItem("History.store"))||{}}catch(i){t={}}t.idToState=t.idToState||{},t.urlToId=t.urlToId||{},t.stateToId=t.stateToId||{};for(e in d.idToState)d.idToState.hasOwnProperty(e)&&(t.idToState[e]=d.idToState[e]);for(e in d.urlToId)d.urlToId.hasOwnProperty(e)&&(t.urlToId[e]=d.urlToId[e]);for(e in d.stateToId)d.stateToId.hasOwnProperty(e)&&(t.stateToId[e]=d.stateToId[e]);d.store=t,d.normalizeStore(),n=c.stringify(t);try{a.setItem("History.store",n)}catch(r){if(r.code!==DOMException.QUOTA_EXCEEDED_ERR)throw r;a.length&&(a.removeItem("History.store"),a.setItem("History.store",n))}},d.intervalList.push(u(d.onUnload,d.options.storeInterval)),d.Adapter.bind(t,"beforeunload",d.onUnload),d.Adapter.bind(t,"unload",d.onUnload)),d.emulated.pushState||(d.bugs.safariPoll&&d.intervalList.push(u(d.safariStatePoll,d.options.safariPollInterval)),("Apple Computer, Inc."===r.vendor||"Mozilla"===(r.appCodeName||""))&&(d.Adapter.bind(t,"hashchange",function(){d.Adapter.trigger(t,"popstate")}),d.getHash()&&d.Adapter.onDomLoad(function(){d.Adapter.trigger(t,"hashchange")})))},(!d.options||!d.options.delayInit)&&d.init()}(window),function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?module.exports=global.window&&global.window.$?t(global.window.$):function(e){if(!e.$&&!e.fn)throw new Error("Tokenfield requires a window object with jQuery or a jQuery instance");return t(e.$||e)}:t(jQuery)}(function(t,e){"use strict";var n=function(n,i){var r=this;this.$element=t(n),this.textDirection=this.$element.css("direction"),this.options=t.extend(!0,{},t.fn.tokenfield.defaults,{tokens:this.$element.val()},this.$element.data(),i),this._delimiters="string"==typeof this.options.delimiter?[this.options.delimiter]:this.options.delimiter,this._triggerKeys=t.map(this._delimiters,function(t){return t.charCodeAt(0)}),this._firstDelimiter=this._delimiters[0];var a=t.inArray(" ",this._delimiters),o=t.inArray("-",this._delimiters);a>=0&&(this._delimiters[a]="\\s"),o>=0&&(delete this._delimiters[o],this._delimiters.unshift("-"));var s=["\\","$","[","{","^",".","|","?","*","+","(",")"];t.each(this._delimiters,function(e,n){var i=t.inArray(n,s);i>=0&&(r._delimiters[e]="\\"+n)});var u,l=e&&"function"==typeof e.getMatchedCSSRules?e.getMatchedCSSRules(n):null,c=n.style.width,h=this.$element.width();l&&t.each(l,function(t,e){e.style.width&&(u=e.style.width)});var d="rtl"===t("body").css("direction")?"right":"left",p={position:this.$element.css("position")};p[d]=this.$element.css(d),this.$element.data("original-styles",p).data("original-tabindex",this.$element.prop("tabindex")).css("position","absolute").css(d,"-10000px").prop("tabindex",-1),this.$wrapper=t('<div class="tokenfield form-control" />'),this.$element.hasClass("input-lg")&&this.$wrapper.addClass("input-lg"),this.$element.hasClass("input-sm")&&this.$wrapper.addClass("input-sm"),"rtl"===this.textDirection&&this.$wrapper.addClass("rtl");var f=this.$element.prop("id")||(new Date).getTime()+""+Math.floor(100*(1+Math.random()));this.$input=t('<input type="text" class="token-input" autocomplete="off" />').appendTo(this.$wrapper).prop("placeholder",this.$element.prop("placeholder")).prop("id",f+"-tokenfield").prop("tabindex",this.$element.data("original-tabindex"));var g=t('label[for="'+this.$element.prop("id")+'"]');if(g.length&&g.prop("for",this.$input.prop("id")),this.$copyHelper=t('<input type="text" />').css("position","absolute").css(d,"-10000px").prop("tabindex",-1).prependTo(this.$wrapper),c?this.$wrapper.css("width",c):u?this.$wrapper.css("width",u):this.$element.parents(".form-inline").length&&this.$wrapper.width(h),(this.$element.prop("disabled")||this.$element.parents("fieldset[disabled]").length)&&this.disable(),this.$element.prop("readonly")&&this.readonly(),this.$mirror=t('<span style="position:absolute; top:-999px; left:0; white-space:pre;"/>'),this.$input.css("min-width",this.options.minWidth+"px"),t.each(["fontFamily","fontSize","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent"],function(t,e){r.$mirror[0].style[e]=r.$input.css(e)}),this.$mirror.appendTo("body"),this.$wrapper.insertBefore(this.$element),this.$element.prependTo(this.$wrapper),this.update(),this.setTokens(this.options.tokens,!1,!1),this.listen(),!t.isEmptyObject(this.options.autocomplete)){var m="rtl"===this.textDirection?"right":"left",v=t.extend({minLength:this.options.showAutocompleteOnFocus?0:null,position:{my:m+" top",at:m+" bottom",of:this.$wrapper}},this.options.autocomplete);this.$input.autocomplete(v)}if(!t.isEmptyObject(this.options.typeahead)){var y=this.options.typeahead,b={minLength:this.options.showAutocompleteOnFocus?0:null},_=t.isArray(y)?y:[y,y];_[0]=t.extend({},b,_[0]),this.$input.typeahead.apply(this.$input,_),this.typeahead=!0}this.$element.trigger("tokenfield:initialize")};n.prototype={constructor:n,createToken:function(e,n){var i=this;if(e="string"==typeof e?{value:e,label:e}:t.extend({},e),"undefined"==typeof n&&(n=!0),e.value=t.trim(e.value),e.label=e.label&&e.label.length?t.trim(e.label):e.value,!(!e.value.length||!e.label.length||e.label.length<=this.options.minLength||this.options.limit&&this.getTokens().length>=this.options.limit)){var r=t.Event("tokenfield:createtoken",{attrs:e});if(this.$element.trigger(r),r.attrs&&!r.isDefaultPrevented()){var a=t('<div class="token" />').append('<span class="token-label" />').append('<a href="#" class="close" tabindex="-1">&times;</a>').data("attrs",e);this.$input.hasClass("tt-input")?this.$input.parent().before(a):this.$input.before(a),this.$input.css("width",this.options.minWidth+"px");var o=a.find(".token-label"),s=a.find(".close");return this.maxTokenWidth||(this.maxTokenWidth=this.$wrapper.width()-s.outerWidth()-parseInt(s.css("margin-left"),10)-parseInt(s.css("margin-right"),10)-parseInt(a.css("border-left-width"),10)-parseInt(a.css("border-right-width"),10)-parseInt(a.css("padding-left"),10)-parseInt(a.css("padding-right"),10),parseInt(o.css("border-left-width"),10)-parseInt(o.css("border-right-width"),10)-parseInt(o.css("padding-left"),10)-parseInt(o.css("padding-right"),10),parseInt(o.css("margin-left"),10)-parseInt(o.css("margin-right"),10)),o.text(e.label).css("max-width",this.maxTokenWidth),a.on("mousedown",function(){return i._disabled||i._readonly?!1:void(i.preventDeactivation=!0)}).on("click",function(t){return i._disabled||i._readonly?!1:(i.preventDeactivation=!1,t.ctrlKey||t.metaKey?(t.preventDefault(),i.toggle(a)):void i.activate(a,t.shiftKey,t.shiftKey))}).on("dblclick",function(){return i._disabled||i._readonly||!i.options.allowEditing?!1:void i.edit(a)}),s.on("click",t.proxy(this.remove,this)),this.$element.trigger(t.Event("tokenfield:createdtoken",{attrs:e,relatedTarget:a.get(0)})),n&&this.$element.val(this.getTokensList()).trigger(t.Event("change",{initiator:"tokenfield"})),this.update(),this.$element.get(0)}}},setTokens:function(e,n,i){if(e){n||this.$wrapper.find(".token").remove(),"undefined"==typeof i&&(i=!0),"string"==typeof e&&(e=this._delimiters.length?e.split(new RegExp("["+this._delimiters.join("")+"]")):[e]);var r=this;return t.each(e,function(t,e){r.createToken(e,i)}),this.$element.get(0)}},getTokenData:function(e){var n=e.map(function(){var e=t(this);return e.data("attrs")}).get();return 1==n.length&&(n=n[0]),n},getTokens:function(e){var n=this,i=[],r=e?".active":"";return this.$wrapper.find(".token"+r).each(function(){i.push(n.getTokenData(t(this)))}),i},getTokensList:function(e,n,i){e=e||this._firstDelimiter,n="undefined"!=typeof n&&null!==n?n:this.options.beautify;var r=e+(n&&" "!==e?" ":"");return t.map(this.getTokens(i),function(t){return t.value}).join(r)},getInput:function(){return this.$input.val()},listen:function(){var n=this;this.$element.on("change",t.proxy(this.change,this)),this.$wrapper.on("mousedown",t.proxy(this.focusInput,this)),this.$input.on("focus",t.proxy(this.focus,this)).on("blur",t.proxy(this.blur,this)).on("paste",t.proxy(this.paste,this)).on("keydown",t.proxy(this.keydown,this)).on("keypress",t.proxy(this.keypress,this)).on("keyup",t.proxy(this.keyup,this)),this.$copyHelper.on("focus",t.proxy(this.focus,this)).on("blur",t.proxy(this.blur,this)).on("keydown",t.proxy(this.keydown,this)).on("keyup",t.proxy(this.keyup,this)),this.$input.on("keypress",t.proxy(this.update,this)).on("keyup",t.proxy(this.update,this)),this.$input.on("autocompletecreate",function(){var e=t(this).data("ui-autocomplete").menu.element,i=n.$wrapper.outerWidth()-parseInt(e.css("border-left-width"),10)-parseInt(e.css("border-right-width"),10);e.css("min-width",i+"px")}).on("autocompleteselect",function(t,e){return n.createToken(e.item)&&(n.$input.val(""),n.$input.data("edit")&&n.unedit(!0)),!1}).on("typeahead:selected typeahead:autocompleted",function(t,e){e.value=n.$input.typeahead("val"),n.createToken(e)&&(n.$input.typeahead("val",""),n.$input.data("edit")&&n.unedit(!0))}),t(e).on("resize",t.proxy(this.update,this))},keydown:function(e){function n(t){if(r.$input.is(document.activeElement)){if(r.$input.val().length>0)return;t+="All";var n=r.$input.hasClass("tt-input")?r.$input.parent()[t](".token:first"):r.$input[t](".token:first");if(!n.length)return;r.preventInputFocus=!0,r.preventDeactivation=!0,r.activate(n),e.preventDefault()}else r[t](e.shiftKey),e.preventDefault()}function i(n){if(e.shiftKey){if(r.$input.is(document.activeElement)){if(r.$input.val().length>0)return;var i=r.$input.hasClass("tt-input")?r.$input.parent()[n+"All"](".token:first"):r.$input[n+"All"](".token:first");if(!i.length)return;r.activate(i)}var a="prev"===n?"next":"prev",o="prev"===n?"first":"last";r.firstActiveToken[a+"All"](".token").each(function(){r.deactivate(t(this))}),r.activate(r.$wrapper.find(".token:"+o),!0,!0),e.preventDefault()}}if(this.focused){var r=this;switch(e.keyCode){case 8:if(!this.$input.is(document.activeElement))break;this.lastInputValue=this.$input.val();break;case 37:n("rtl"===this.textDirection?"next":"prev");break;case 38:i("prev");break;case 39:n("rtl"===this.textDirection?"prev":"next");break;case 40:i("next");break;case 65:if(this.$input.val().length>0||!e.ctrlKey&&!e.metaKey)break;this.activateAll(),e.preventDefault();break;case 9:case 13:if(this.$input.data("ui-autocomplete")&&this.$input.data("ui-autocomplete").menu.element.find("li:has(a.ui-state-focus)").length)break;if(this.$input.hasClass("tt-input")&&this.$wrapper.find(".tt-cursor").length)break;if(this.$input.hasClass("tt-input")&&this.$wrapper.find(".tt-hint").val().length)break;if(this.$input.is(document.activeElement)&&this.$input.val().length||this.$input.data("edit"))return this.createTokensFromInput(e,this.$input.data("edit"));if(13===e.keyCode){if(!this.$copyHelper.is(document.activeElement)||1!==this.$wrapper.find(".token.active").length)break;if(!r.options.allowEditing)break;this.edit(this.$wrapper.find(".token.active"))}}this.lastKeyDown=e.keyCode}},keypress:function(e){return this.lastKeyPressCode=e.keyCode,this.lastKeyPressCharCode=e.charCode,-1!==t.inArray(e.charCode,this._triggerKeys)&&this.$input.is(document.activeElement)?(this.$input.val()&&this.createTokensFromInput(e),!1):void 0},keyup:function(t){if(this.preventInputFocus=!1,this.focused){switch(t.keyCode){case 8:if(this.$input.is(document.activeElement)){if(this.$input.val().length||this.lastInputValue.length&&8===this.lastKeyDown)break;this.preventDeactivation=!0;var e=this.$input.hasClass("tt-input")?this.$input.parent().prevAll(".token:first"):this.$input.prevAll(".token:first");if(!e.length)break;this.activate(e)}else this.remove(t);break;case 46:this.remove(t,"next")}this.lastKeyUp=t.keyCode}},focus:function(){this.focused=!0,this.$wrapper.addClass("focus"),this.$input.is(document.activeElement)&&(this.$wrapper.find(".active").removeClass("active"),this.$firstActiveToken=null,this.options.showAutocompleteOnFocus&&this.search())},blur:function(t){this.focused=!1,this.$wrapper.removeClass("focus"),this.preventDeactivation||this.$element.is(document.activeElement)||(this.$wrapper.find(".active").removeClass("active"),this.$firstActiveToken=null),!this.preventCreateTokens&&(this.$input.data("edit")&&!this.$input.is(document.activeElement)||this.options.createTokensOnBlur)&&this.createTokensFromInput(t),this.preventDeactivation=!1,this.preventCreateTokens=!1},paste:function(t){var e=this;setTimeout(function(){e.createTokensFromInput(t)},1)},change:function(t){"tokenfield"!==t.initiator&&this.setTokens(this.$element.val())},createTokensFromInput:function(t,e){if(!(this.$input.val().length<this.options.minLength)){var n=this.getTokensList();return this.setTokens(this.$input.val(),!0),n==this.getTokensList()&&this.$input.val().length?!1:(this.$input.hasClass("tt-input")?this.$input.typeahead("val",""):this.$input.val(""),this.$input.data("edit")&&this.unedit(e),!1)}},next:function(t){if(t){var e=this.$wrapper.find(".active:first"),n=e&&this.$firstActiveToken?e.index()<this.$firstActiveToken.index():!1;if(n)return this.deactivate(e)}var i=this.$wrapper.find(".active:last"),r=i.nextAll(".token:first");return r.length?void this.activate(r,t):void this.$input.focus()},prev:function(t){if(t){var e=this.$wrapper.find(".active:last"),n=e&&this.$firstActiveToken?e.index()>this.$firstActiveToken.index():!1;if(n)return this.deactivate(e)}var i=this.$wrapper.find(".active:first"),r=i.prevAll(".token:first");return r.length||(r=this.$wrapper.find(".token:first")),r.length||t?void this.activate(r,t):void this.$input.focus()},activate:function(e,n,i,r){if(e){if("undefined"==typeof r)var r=!0;if(i)var n=!0;if(this.$copyHelper.focus(),n||(this.$wrapper.find(".active").removeClass("active"),r?this.$firstActiveToken=e:delete this.$firstActiveToken),i&&this.$firstActiveToken){var a=this.$firstActiveToken.index()-2,o=e.index()-2,s=this;this.$wrapper.find(".token").slice(Math.min(a,o)+1,Math.max(a,o)).each(function(){s.activate(t(this),!0)})}e.addClass("active"),this.$copyHelper.val(this.getTokensList(null,null,!0)).select()}},activateAll:function(){var e=this;this.$wrapper.find(".token").each(function(n){e.activate(t(this),0!==n,!1,!1)})},deactivate:function(t){t&&(t.removeClass("active"),this.$copyHelper.val(this.getTokensList(null,null,!0)).select())},toggle:function(t){t&&(t.toggleClass("active"),this.$copyHelper.val(this.getTokensList(null,null,!0)).select())},edit:function(e){if(e){var n=e.data("attrs"),i={attrs:n,relatedTarget:e.get(0)},r=t.Event("tokenfield:edittoken",i);if(this.$element.trigger(r),!r.isDefaultPrevented()){e.find(".token-label").text(n.value);var a=e.outerWidth(),o=this.$input.hasClass("tt-input")?this.$input.parent():this.$input;e.replaceWith(o),this.preventCreateTokens=!0,this.$input.val(n.value).select().data("edit",!0).width(a),this.update(),this.$element.trigger(t.Event("tokenfield:editedtoken",i))}}},unedit:function(t){var e=this.$input.hasClass("tt-input")?this.$input.parent():this.$input;if(e.appendTo(this.$wrapper),this.$input.data("edit",!1),this.$mirror.text(""),this.update(),t){var n=this;setTimeout(function(){n.$input.focus()},1)}},remove:function(e,n){if(!(this.$input.is(document.activeElement)||this._disabled||this._readonly)){var i="click"===e.type?t(e.target).closest(".token"):this.$wrapper.find(".token.active");if("click"!==e.type){if(!n)var n="prev";if(this[n](),"prev"===n)var r=0===i.first().prevAll(".token:first").length}var a={attrs:this.getTokenData(i),relatedTarget:i.get(0)},o=t.Event("tokenfield:removetoken",a);if(this.$element.trigger(o),!o.isDefaultPrevented()){var s=t.Event("tokenfield:removedtoken",a),u=t.Event("change",{initiator:"tokenfield"});i.remove(),this.$element.val(this.getTokensList()).trigger(s).trigger(u),(!this.$wrapper.find(".token").length||"click"===e.type||r)&&this.$input.focus(),this.$input.css("width",this.options.minWidth+"px"),this.update(),e.preventDefault(),e.stopPropagation()}}},update:function(){var t=this.$input.val(),e=parseInt(this.$input.css("padding-left"),10),n=parseInt(this.$input.css("padding-right"),10),i=e+n;if(this.$input.data("edit")){if(t||(t=this.$input.prop("placeholder")),t===this.$mirror.text())return;this.$mirror.text(t);var r=this.$mirror.width()+10;if(r>this.$wrapper.width())return this.$input.width(this.$wrapper.width());this.$input.width(r)}else{if(this.$input.css("width",this.options.minWidth+"px"),"rtl"===this.textDirection)return this.$input.width(this.$input.offset().left+this.$input.outerWidth()-this.$wrapper.offset().left-parseInt(this.$wrapper.css("padding-left"),10)-i-1);this.$input.width(this.$wrapper.offset().left+this.$wrapper.width()+parseInt(this.$wrapper.css("padding-left"),10)-this.$input.offset().left-i)}},focusInput:function(e){if(!(t(e.target).closest(".token").length||t(e.target).closest(".token-input").length||t(e.target).closest(".tt-dropdown-menu").length)){var n=this;setTimeout(function(){n.$input.focus()},0)}},search:function(){this.$input.data("ui-autocomplete")&&this.$input.autocomplete("search")},disable:function(){this.setProperty("disabled",!0)},enable:function(){this.setProperty("disabled",!1)},readonly:function(){this.setProperty("readonly",!0)},writeable:function(){this.setProperty("readonly",!1)},setProperty:function(t,e){this["_"+t]=e,this.$input.prop(t,e),this.$element.prop(t,e),this.$wrapper[e?"addClass":"removeClass"](t)},destroy:function(){this.$element.val(this.getTokensList()),this.$element.css(this.$element.data("original-styles")),this.$element.prop("tabindex",this.$element.data("original-tabindex"));var e=t('label[for="'+this.$input.prop("id")+'"]');e.length&&e.prop("for",this.$element.prop("id")),this.$element.insertBefore(this.$wrapper),this.$element.removeData("original-styles").removeData("original-tabindex").removeData("bs.tokenfield"),this.$wrapper.remove();var n=this.$element;return delete this,n}};var i=t.fn.tokenfield;return t.fn.tokenfield=function(e,i){var r,a=[];Array.prototype.push.apply(a,arguments);var o=this.each(function(){var o=t(this),s=o.data("bs.tokenfield"),u="object"==typeof e&&e;"string"==typeof e&&s&&s[e]?(a.shift(),r=s[e].apply(s,a)):s||"string"==typeof e||i||o.data("bs.tokenfield",s=new n(this,u))});return"undefined"!=typeof r?r:o},t.fn.tokenfield.defaults={minWidth:60,minLength:0,allowEditing:!0,limit:0,autocomplete:{},typeahead:{},showAutocompleteOnFocus:!1,createTokensOnBlur:!1,delimiter:",",beautify:!0},t.fn.tokenfield.Constructor=n,t.fn.tokenfield.noConflict=function(){return t.fn.tokenfield=i,this},n}),function(t){"use strict";function e(t){return t.replace(/,/g,".").replace(/[^0-9\.]/g,"")}function n(t){return parseFloat(e(t))>=10}var i,r={bridge:null,version:"0.0.0",disabled:null,outdated:null,ready:null},a={},o=0,s={},u=0,l={},c=null,h=null,d=function(){var t,e,n,i,r="ZeroClipboard.swf";if(document.currentScript&&(i=document.currentScript.src));else{var a=document.getElementsByTagName("script");if("readyState"in a[0])for(t=a.length;t--&&("interactive"!==a[t].readyState||!(i=a[t].src)););else if("loading"===document.readyState)i=a[a.length-1].src;else{for(t=a.length;t--;){if(n=a[t].src,!n){e=null;break}if(n=n.split("#")[0].split("?")[0],n=n.slice(0,n.lastIndexOf("/")+1),null==e)e=n;else if(e!==n){e=null;break}}null!==e&&(i=e)}}return i&&(i=i.split("#")[0].split("?")[0],r=i.slice(0,i.lastIndexOf("/")+1)+r),r}(),p=function(){var t=/\-([a-z])/g,e=function(t,e){return e.toUpperCase()};return function(n){return n.replace(t,e)}}(),f=function(e,n){var i,r,a;return t.getComputedStyle?i=t.getComputedStyle(e,null).getPropertyValue(n):(r=p(n),i=e.currentStyle?e.currentStyle[r]:e.style[r]),"cursor"!==n||i&&"auto"!==i||(a=e.tagName.toLowerCase(),"a"!==a)?i:"pointer"},g=function(e){e||(e=t.event);var n;this!==t?n=this:e.target?n=e.target:e.srcElement&&(n=e.srcElement),j.activate(n)},m=function(t,e,n){t&&1===t.nodeType&&(t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent&&t.attachEvent("on"+e,n))},v=function(t,e,n){t&&1===t.nodeType&&(t.removeEventListener?t.removeEventListener(e,n,!1):t.detachEvent&&t.detachEvent("on"+e,n))},y=function(t,e){if(!t||1!==t.nodeType)return t;if(t.classList)return t.classList.contains(e)||t.classList.add(e),t;if(e&&"string"==typeof e){var n=(e||"").split(/\s+/);if(1===t.nodeType)if(t.className){for(var i=" "+t.className+" ",r=t.className,a=0,o=n.length;o>a;a++)i.indexOf(" "+n[a]+" ")<0&&(r+=" "+n[a]);t.className=r.replace(/^\s+|\s+$/g,"")}else t.className=e}return t},b=function(t,e){if(!t||1!==t.nodeType)return t;if(t.classList)return t.classList.contains(e)&&t.classList.remove(e),t;if(e&&"string"==typeof e||void 0===e){var n=(e||"").split(/\s+/);if(1===t.nodeType&&t.className)if(e){for(var i=(" "+t.className+" ").replace(/[\n\t]/g," "),r=0,a=n.length;a>r;r++)i=i.replace(" "+n[r]+" "," ");t.className=i.replace(/^\s+|\s+$/g,"")}else t.className=""}return t},_=function(){var t,e,n,i=1;return"function"==typeof document.body.getBoundingClientRect&&(t=document.body.getBoundingClientRect(),e=t.right-t.left,n=document.body.offsetWidth,i=Math.round(e/n*100)/100),i},w=function(e,n){var i={left:0,top:0,width:0,height:0,zIndex:T(n)-1};if(e.getBoundingClientRect){var r,a,o,s=e.getBoundingClientRect();"pageXOffset"in t&&"pageYOffset"in t?(r=t.pageXOffset,a=t.pageYOffset):(o=_(),r=Math.round(document.documentElement.scrollLeft/o),a=Math.round(document.documentElement.scrollTop/o));var u=document.documentElement.clientLeft||0,l=document.documentElement.clientTop||0;i.left=s.left+r-u,i.top=s.top+a-l,i.width="width"in s?s.width:s.right-s.left,i.height="height"in s?s.height:s.bottom-s.top}return i},S=function(t,e){var n=null==e||e&&e.cacheBust===!0&&e.useNoCache===!0;return n?(-1===t.indexOf("?")?"?":"&")+"noCache="+(new Date).getTime():""},x=function(e){var n,i,r,a=[],o=[],s=[];if(e.trustedOrigins&&("string"==typeof e.trustedOrigins?o.push(e.trustedOrigins):"object"==typeof e.trustedOrigins&&"length"in e.trustedOrigins&&(o=o.concat(e.trustedOrigins))),e.trustedDomains&&("string"==typeof e.trustedDomains?o.push(e.trustedDomains):"object"==typeof e.trustedDomains&&"length"in e.trustedDomains&&(o=o.concat(e.trustedDomains))),o.length)for(n=0,i=o.length;i>n;n++)if(o.hasOwnProperty(n)&&o[n]&&"string"==typeof o[n]){if(r=E(o[n]),!r)continue;if("*"===r){s=[r];break}s.push.apply(s,[r,"//"+r,t.location.protocol+"//"+r])}return s.length&&a.push("trustedOrigins="+encodeURIComponent(s.join(","))),"string"==typeof e.jsModuleId&&e.jsModuleId&&a.push("jsModuleId="+encodeURIComponent(e.jsModuleId)),a.join("&")},$=function(t,e,n){if("function"==typeof e.indexOf)return e.indexOf(t,n);var i,r=e.length;for("undefined"==typeof n?n=0:0>n&&(n=r+n),i=n;r>i;i++)if(e.hasOwnProperty(i)&&e[i]===t)return i;return-1},k=function(t){if("string"==typeof t)throw new TypeError("ZeroClipboard doesn't accept query strings.");return t.length?t:[t]},C=function(e,n,i,r){r?t.setTimeout(function(){e.apply(n,i)},0):e.apply(n,i)},T=function(t){var e,n;return t&&("number"==typeof t&&t>0?e=t:"string"==typeof t&&(n=parseInt(t,10))&&!isNaN(n)&&n>0&&(e=n)),e||("number"==typeof M.zIndex&&M.zIndex>0?e=M.zIndex:"string"==typeof M.zIndex&&(n=parseInt(M.zIndex,10))&&!isNaN(n)&&n>0&&(e=n)),e||0},I=function(t,e){if(t&&e!==!1&&"undefined"!=typeof console&&console&&(console.warn||console.log)){var n="`"+t+"` is deprecated. See docs for more info:\n    https://github.com/zeroclipboard/zeroclipboard/blob/master/docs/instructions.md#deprecations";console.warn?console.warn(n):console.log(n)}},O=function(){var t,e,n,i,r,a,o=arguments[0]||{};for(t=1,e=arguments.length;e>t;t++)if(null!=(n=arguments[t]))for(i in n)if(n.hasOwnProperty(i)){if(r=o[i],a=n[i],o===a)continue;void 0!==a&&(o[i]=a)}return o},E=function(t){if(null==t||""===t)return null;if(t=t.replace(/^\s+|\s+$/g,""),""===t)return null;var e=t.indexOf("//");t=-1===e?t:t.slice(e+2);var n=t.indexOf("/");return t=-1===n?t:-1===e||0===n?null:t.slice(0,n),t&&".swf"===t.slice(-4).toLowerCase()?null:t||null},A=function(){var t=function(t,e){var n,i,r;if(null!=t&&"*"!==e[0]&&("string"==typeof t&&(t=[t]),"object"==typeof t&&"length"in t))for(n=0,i=t.length;i>n;n++)if(t.hasOwnProperty(n)&&(r=E(t[n]))){if("*"===r){e.length=0,e.push("*");break}-1===$(r,e)&&e.push(r)}},e={always:"always",samedomain:"sameDomain",never:"never"};return function(n,i){var r,a=i.allowScriptAccess;if("string"==typeof a&&(r=a.toLowerCase())&&/^always|samedomain|never$/.test(r))return e[r];var o=E(i.moviePath);null===o&&(o=n);var s=[];t(i.trustedOrigins,s),t(i.trustedDomains,s);var u=s.length;if(u>0){if(1===u&&"*"===s[0])return"always";if(-1!==$(n,s))return 1===u&&n===o?"sameDomain":"always"}return"never"}}(),P=function(t){if(null==t)return[];if(Object.keys)return Object.keys(t);var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(n);return e},H=function(t){if(t)for(var e in t)t.hasOwnProperty(e)&&delete t[e];return t},D=function(){try{return document.activeElement}catch(t){}return null},q=function(){var t=!1;if("boolean"==typeof r.disabled)t=r.disabled===!1;else{if("function"==typeof ActiveXObject)try{new ActiveXObject("ShockwaveFlash.ShockwaveFlash")&&(t=!0)}catch(e){}!t&&navigator.mimeTypes["application/x-shockwave-flash"]&&(t=!0)}return t},j=function(t,e){return this instanceof j?(this.id=""+o++,s[this.id]={instance:this,elements:[],handlers:{}},t&&this.clip(t),"undefined"!=typeof e&&(I("new ZeroClipboard(elements, options)",M.debug),j.config(e)),this.options=j.config(),"boolean"!=typeof r.disabled&&(r.disabled=!q()),void(r.disabled===!1&&r.outdated!==!0&&null===r.bridge&&(r.outdated=!1,r.ready=!1,L()))):new j(t,e)};j.prototype.setText=function(t){return t&&""!==t&&(a["text/plain"]=t,r.ready===!0&&r.bridge&&"function"==typeof r.bridge.setText?r.bridge.setText(t):r.ready=!1),this},j.prototype.setSize=function(t,e){return r.ready===!0&&r.bridge&&"function"==typeof r.bridge.setSize?r.bridge.setSize(t,e):r.ready=!1,this};var z=function(t){r.ready===!0&&r.bridge&&"function"==typeof r.bridge.setHandCursor?r.bridge.setHandCursor(t):r.ready=!1};j.prototype.destroy=function(){this.unclip(),this.off(),delete s[this.id]};var F=function(){var t,e,n,i=[],r=P(s);for(t=0,e=r.length;e>t;t++)n=s[r[t]].instance,n&&n instanceof j&&i.push(n);return i};j.version="1.3.5";var M={swfPath:d,trustedDomains:t.location.host?[t.location.host]:[],cacheBust:!0,forceHandCursor:!1,zIndex:999999999,debug:!0,title:null,autoActivate:!0};j.config=function(t){"object"==typeof t&&null!==t&&O(M,t);{if("string"!=typeof t||!t){var e={};for(var n in M)M.hasOwnProperty(n)&&(e[n]="object"==typeof M[n]&&null!==M[n]?"length"in M[n]?M[n].slice(0):O({},M[n]):M[n]);return e}if(M.hasOwnProperty(t))return M[t]}},j.destroy=function(){j.deactivate();for(var t in s)if(s.hasOwnProperty(t)&&s[t]){var e=s[t].instance;e&&"function"==typeof e.destroy&&e.destroy()}var n=R(r.bridge);n&&n.parentNode&&(n.parentNode.removeChild(n),r.ready=null,r.bridge=null)},j.activate=function(t){i&&(b(i,M.hoverClass),b(i,M.activeClass)),i=t,y(t,M.hoverClass),B();var e=M.title||t.getAttribute("title");if(e){var n=R(r.bridge);n&&n.setAttribute("title",e)}var a=M.forceHandCursor===!0||"pointer"===f(t,"cursor");z(a)},j.deactivate=function(){var t=R(r.bridge);t&&(t.style.left="0px",t.style.top="-9999px",t.removeAttribute("title")),i&&(b(i,M.hoverClass),b(i,M.activeClass),i=null)};var L=function(){var e,n,i=document.getElementById("global-zeroclipboard-html-bridge");if(!i){var a=j.config();a.jsModuleId="string"==typeof c&&c||"string"==typeof h&&h||null;var o=A(t.location.host,M),s=x(a),u=M.moviePath+S(M.moviePath,M),l='      <object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" id="global-zeroclipboard-flash-bridge" width="100%" height="100%">         <param name="movie" value="'+u+'"/>         <param name="allowScriptAccess" value="'+o+'"/>         <param name="scale" value="exactfit"/>         <param name="loop" value="false"/>         <param name="menu" value="false"/>         <param name="quality" value="best" />         <param name="bgcolor" value="#ffffff"/>         <param name="wmode" value="transparent"/>         <param name="flashvars" value="'+s+'"/>         <embed src="'+u+'"           loop="false" menu="false"           quality="best" bgcolor="#ffffff"           width="100%" height="100%"           name="global-zeroclipboard-flash-bridge"           allowScriptAccess="'+o+'"           allowFullScreen="false"           type="application/x-shockwave-flash"           wmode="transparent"           pluginspage="http://www.macromedia.com/go/getflashplayer"           flashvars="'+s+'"           scale="exactfit">         </embed>       </object>';i=document.createElement("div"),i.id="global-zeroclipboard-html-bridge",i.setAttribute("class","global-zeroclipboard-container"),i.style.position="absolute",i.style.left="0px",i.style.top="-9999px",i.style.width="15px",i.style.height="15px",i.style.zIndex=""+T(M.zIndex),document.body.appendChild(i),i.innerHTML=l}e=document["global-zeroclipboard-flash-bridge"],e&&(n=e.length)&&(e=e[n-1]),r.bridge=e||i.children[0].lastElementChild},R=function(t){for(var e=/^OBJECT|EMBED$/,n=t&&t.parentNode;n&&e.test(n.nodeName)&&n.parentNode;)n=n.parentNode;return n||null},B=function(){if(i){var t=w(i,M.zIndex),e=R(r.bridge);e&&(e.style.top=t.top+"px",e.style.left=t.left+"px",e.style.width=t.width+"px",e.style.height=t.height+"px",e.style.zIndex=t.zIndex+1),r.ready===!0&&r.bridge&&"function"==typeof r.bridge.setSize?r.bridge.setSize(t.width,t.height):r.ready=!1}return this};j.prototype.on=function(t,e){var n,i,a,o={},u=s[this.id]&&s[this.id].handlers;if("string"==typeof t&&t)a=t.toLowerCase().split(/\s+/);else if("object"==typeof t&&t&&"undefined"==typeof e)for(n in t)t.hasOwnProperty(n)&&"string"==typeof n&&n&&"function"==typeof t[n]&&this.on(n,t[n]);if(a&&a.length){for(n=0,i=a.length;i>n;n++)t=a[n].replace(/^on/,""),o[t]=!0,u[t]||(u[t]=[]),u[t].push(e);o.noflash&&r.disabled&&V.call(this,"noflash",{}),o.wrongflash&&r.outdated&&V.call(this,"wrongflash",{flashVersion:r.version}),o.load&&r.ready&&V.call(this,"load",{flashVersion:r.version})}return this},j.prototype.off=function(t,e){var n,i,r,a,o,u=s[this.id]&&s[this.id].handlers;if(0===arguments.length)a=P(u);
else if("string"==typeof t&&t)a=t.split(/\s+/);else if("object"==typeof t&&t&&"undefined"==typeof e)for(n in t)t.hasOwnProperty(n)&&"string"==typeof n&&n&&"function"==typeof t[n]&&this.off(n,t[n]);if(a&&a.length)for(n=0,i=a.length;i>n;n++)if(t=a[n].toLowerCase().replace(/^on/,""),o=u[t],o&&o.length)if(e)for(r=$(e,o);-1!==r;)o.splice(r,1),r=$(e,o,r);else u[t].length=0;return this},j.prototype.handlers=function(t){var e,n=null,i=s[this.id]&&s[this.id].handlers;if(i){if("string"==typeof t&&t)return i[t]?i[t].slice(0):null;n={};for(e in i)i.hasOwnProperty(e)&&i[e]&&(n[e]=i[e].slice(0))}return n};var N=function(e,n,i,r){var a=s[this.id]&&s[this.id].handlers[e];if(a&&a.length){var o,u,l,c=n||this;for(o=0,u=a.length;u>o;o++)l=a[o],n=c,"string"==typeof l&&"function"==typeof t[l]&&(l=t[l]),"object"==typeof l&&l&&"function"==typeof l.handleEvent&&(n=l,l=l.handleEvent),"function"==typeof l&&C(l,n,i,r)}return this};j.prototype.clip=function(t){t=k(t);for(var e=0;e<t.length;e++)if(t.hasOwnProperty(e)&&t[e]&&1===t[e].nodeType){t[e].zcClippingId?-1===$(this.id,l[t[e].zcClippingId])&&l[t[e].zcClippingId].push(this.id):(t[e].zcClippingId="zcClippingId_"+u++,l[t[e].zcClippingId]=[this.id],M.autoActivate===!0&&m(t[e],"mouseover",g));var n=s[this.id].elements;-1===$(t[e],n)&&n.push(t[e])}return this},j.prototype.unclip=function(t){var e=s[this.id];if(e){var n,i=e.elements;t="undefined"==typeof t?i.slice(0):k(t);for(var r=t.length;r--;)if(t.hasOwnProperty(r)&&t[r]&&1===t[r].nodeType){for(n=0;-1!==(n=$(t[r],i,n));)i.splice(n,1);var a=l[t[r].zcClippingId];if(a){for(n=0;-1!==(n=$(this.id,a,n));)a.splice(n,1);0===a.length&&(M.autoActivate===!0&&v(t[r],"mouseover",g),delete t[r].zcClippingId)}}}return this},j.prototype.elements=function(){var t=s[this.id];return t&&t.elements?t.elements.slice(0):[]};var U=function(t){var e,n,i,r,a,o=[];if(t&&1===t.nodeType&&(e=t.zcClippingId)&&l.hasOwnProperty(e)&&(n=l[e],n&&n.length))for(i=0,r=n.length;r>i;i++)a=s[n[i]].instance,a&&a instanceof j&&o.push(a);return o};M.hoverClass="zeroclipboard-is-hover",M.activeClass="zeroclipboard-is-active",M.trustedOrigins=null,M.allowScriptAccess=null,M.useNoCache=!0,M.moviePath="ZeroClipboard.swf",j.detectFlashSupport=function(){return I("ZeroClipboard.detectFlashSupport",M.debug),q()},j.dispatch=function(t,e){if("string"==typeof t&&t){var n=t.toLowerCase().replace(/^on/,"");if(n)for(var r=i&&M.autoActivate===!0?U(i):F(),a=0,o=r.length;o>a;a++)V.call(r[a],n,e)}},j.prototype.setHandCursor=function(t){return I("ZeroClipboard.prototype.setHandCursor",M.debug),t="boolean"==typeof t?t:!!t,z(t),M.forceHandCursor=t,this},j.prototype.reposition=function(){return I("ZeroClipboard.prototype.reposition",M.debug),B()},j.prototype.receiveEvent=function(t,e){if(I("ZeroClipboard.prototype.receiveEvent",M.debug),"string"==typeof t&&t){var n=t.toLowerCase().replace(/^on/,"");n&&V.call(this,n,e)}},j.prototype.setCurrent=function(t){return I("ZeroClipboard.prototype.setCurrent",M.debug),j.activate(t),this},j.prototype.resetBridge=function(){return I("ZeroClipboard.prototype.resetBridge",M.debug),j.deactivate(),this},j.prototype.setTitle=function(t){if(I("ZeroClipboard.prototype.setTitle",M.debug),t=t||M.title||i&&i.getAttribute("title")){var e=R(r.bridge);e&&e.setAttribute("title",t)}return this},j.setDefaults=function(t){I("ZeroClipboard.setDefaults",M.debug),j.config(t)},j.prototype.addEventListener=function(t,e){return I("ZeroClipboard.prototype.addEventListener",M.debug),this.on(t,e)},j.prototype.removeEventListener=function(t,e){return I("ZeroClipboard.prototype.removeEventListener",M.debug),this.off(t,e)},j.prototype.ready=function(){return I("ZeroClipboard.prototype.ready",M.debug),r.ready===!0};var V=function(t,o){t=t.toLowerCase().replace(/^on/,"");var s=o&&o.flashVersion&&e(o.flashVersion)||null,u=i,l=!0;switch(t){case"load":if(s){if(!n(s))return void V.call(this,"onWrongFlash",{flashVersion:s});r.outdated=!1,r.ready=!0,r.version=s}break;case"wrongflash":s&&!n(s)&&(r.outdated=!0,r.ready=!1,r.version=s);break;case"mouseover":y(u,M.hoverClass);break;case"mouseout":M.autoActivate===!0&&j.deactivate();break;case"mousedown":y(u,M.activeClass);break;case"mouseup":b(u,M.activeClass);break;case"datarequested":if(u){var c=u.getAttribute("data-clipboard-target"),h=c?document.getElementById(c):null;if(h){var d=h.value||h.textContent||h.innerText;d&&this.setText(d)}else{var p=u.getAttribute("data-clipboard-text");p&&this.setText(p)}}l=!1;break;case"complete":H(a),u&&u!==D()&&u.focus&&u.focus()}var f=u,g=[this,o];return N.call(this,t,f,g,l)};"function"==typeof define&&define.amd?define(["require","exports","module"],function(t,e,n){return c=n&&n.id||null,j}):"object"==typeof module&&module&&"object"==typeof module.exports&&module.exports&&"function"==typeof t.require?(h=module.id||null,module.exports=j):t.ZeroClipboard=j}(function(){return this}()),$(".copy-btn").length){ZeroClipboard.config({moviePath:$SCRIPT_ROOT+"/static/ZeroClipboard.swf"});var clipboard_client=new ZeroClipboard($(".copy-btn"));$(".copy-btn").tooltip({trigger:"manual"}),$(".paid-btn").click(payoutButton),clipboard_client.on("mouseover",function(){$(this).tooltip("show")}).on("mouseout",function(){$(this).tooltip("hide")})}if($("div#request-list").length){var RequestsView=PourOver.View.extend({page_size:20,render:function(){var t=$("table#requests tr").not($(".popover tr")),e=t.parent(),n=(t.first().find("th"),get_columns(t),t.not(":first")),i=!1;0!=n.length&&(old_copy_buttons=n.find(".copy-btn"),0!=old_copy_buttons.length&&(i=!0,clipboard_client.unclip(old_copy_buttons),old_copy_buttons.each(function(t,e){$(e).tooltip("destroy")})),n.remove());var r;r=i?Handlebars.templates.payout_rows(this.getCurrentItems()):Handlebars.templates.request_rows(this.getCurrentItems()),e.append(r);var a=Math.ceil(this.match_set.length()/this.page_size-1)+1,o=$("ul.pagination");if(o.empty(),1===a)o.attr("style","display: none;");else{o.append(0===this.current_page?'<li class="disabled"><span>&laquo;</span></li>':'<li><a id="prev_page" href="#">&laquo;</a></li>');for(var s=pageNumbers(a,this.current_page),u=0;u<s.length;++u)o.append(null!==s[u]?s[u]!==this.current_page?'<li><a href="#">'+(s[u]+1)+"</a></li>":'<li class="active"><a href="#">'+(s[u]+1)+'<span class="sr-only"> (current)</span></a></li>':'<li class="disabled"><span>&hellip;</span></li>');o.append(this.current_page===a-1?'<li class="disabled"><span>&raquo;</span></li>':'<li><a id="next_page" href="#">&raquo;</a></li>')}o.find("li > a").click(pager_a_click)}});$.ajax($SCRIPT_ROOT+"/api/filter"+window.location.pathname,{dataType:"json",success:function(t){var e=$.map(t.requests,function(t){return t.kill_timestamp=new Date(t.kill_timestamp),t.submit_timestamp=new Date(t.submit_timestamp),t});requests=new PourOver.Collection(e),column_bloodhounds=new Object,addRequestFilters(get_columns($("table#requests tr")),requests,column_bloodhounds),addRequestSorts(requests),request_view=new RequestsView("requests",requests),request_view.on("update",request_view.render),$("ul.pagination > li > a").click(pager_a_click),$(window).on("statechange",function(){var t=History.getState();t.data.page!==request_view.current_page&&request_view.setPage(t.data.page),t.data.sort!==request_view.getSort()&&request_view.setSort(t.data.sort)})}}),$("th a.heading").click(function(){var t=$(this).parent("th").attr("id").substring(4),e=request_view.getSort(),n="";if(e!==!1){if(e.slice(0,-4)===t){var i=e.slice(-3);"asc"===i?n=t+"_dsc":"dsc"===i&&(newsort=t+"_asc")}$(this).parent("th").siblings("th").find("i.fa").removeClass()}""===n&&(n=t+"_asc");var i=n.slice(-3);"asc"===i?$(this).children("i").attr("class","fa fa-chevron-down"):"dsc"===i&&$(this).children("i").attr("class","fa fa-chevron-up"),request_view.setSort(n)})}if(function(t){var e={isMsie:function(){return/(msie|trident)/i.test(navigator.userAgent)?navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2]:!1},isBlankString:function(t){return!t||/^\s*$/.test(t)},escapeRegExChars:function(t){return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t},isArray:t.isArray,isFunction:t.isFunction,isObject:t.isPlainObject,isUndefined:function(t){return"undefined"==typeof t},bind:t.proxy,each:function(e,n){function i(t,e){return n(e,t)}t.each(e,i)},map:t.map,filter:t.grep,every:function(e,n){var i=!0;return e?(t.each(e,function(t,r){return(i=n.call(null,r,t,e))?void 0:!1}),!!i):i},some:function(e,n){var i=!1;return e?(t.each(e,function(t,r){return(i=n.call(null,r,t,e))?!1:void 0}),!!i):i},mixin:t.extend,getUniqueId:function(){var t=0;return function(){return t++}}(),templatify:function(e){function n(){return String(e)}return t.isFunction(e)?e:n},defer:function(t){setTimeout(t,0)},debounce:function(t,e,n){var i,r;return function(){var a,o,s=this,u=arguments;return a=function(){i=null,n||(r=t.apply(s,u))},o=n&&!i,clearTimeout(i),i=setTimeout(a,e),o&&(r=t.apply(s,u)),r}},throttle:function(t,e){var n,i,r,a,o,s;return o=0,s=function(){o=new Date,r=null,a=t.apply(n,i)},function(){var u=new Date,l=e-(u-o);return n=this,i=arguments,0>=l?(clearTimeout(r),r=null,o=u,a=t.apply(n,i)):r||(r=setTimeout(s,l)),a}},noop:function(){}},n="0.10.2",i=function(){function t(t){return t.split(/\s+/)}function e(t){return t.split(/\W+/)}function n(t){return function(e){return function(n){return t(n[e])}}}return{nonword:e,whitespace:t,obj:{nonword:n(e),whitespace:n(t)}}}(),r=function(){function t(t){this.maxSize=t||100,this.size=0,this.hash={},this.list=new n}function n(){this.head=this.tail=null}function i(t,e){this.key=t,this.val=e,this.prev=this.next=null}return e.mixin(t.prototype,{set:function(t,e){var n,r=this.list.tail;this.size>=this.maxSize&&(this.list.remove(r),delete this.hash[r.key]),(n=this.hash[t])?(n.val=e,this.list.moveToFront(n)):(n=new i(t,e),this.list.add(n),this.hash[t]=n,this.size++)},get:function(t){var e=this.hash[t];return e?(this.list.moveToFront(e),e.val):void 0}}),e.mixin(n.prototype,{add:function(t){this.head&&(t.next=this.head,this.head.prev=t),this.head=t,this.tail=this.tail||t},remove:function(t){t.prev?t.prev.next=t.next:this.head=t.next,t.next?t.next.prev=t.prev:this.tail=t.prev},moveToFront:function(t){this.remove(t),this.add(t)}}),t}(),a=function(){function t(t){this.prefix=["__",t,"__"].join(""),this.ttlKey="__ttl__",this.keyMatcher=new RegExp("^"+this.prefix)}function n(){return(new Date).getTime()}function i(t){return JSON.stringify(e.isUndefined(t)?null:t)}function r(t){return JSON.parse(t)}var a,o;try{a=window.localStorage,a.setItem("~~~","!"),a.removeItem("~~~")}catch(s){a=null}return o=a&&window.JSON?{_prefix:function(t){return this.prefix+t},_ttlKey:function(t){return this._prefix(t)+this.ttlKey},get:function(t){return this.isExpired(t)&&this.remove(t),r(a.getItem(this._prefix(t)))},set:function(t,r,o){return e.isNumber(o)?a.setItem(this._ttlKey(t),i(n()+o)):a.removeItem(this._ttlKey(t)),a.setItem(this._prefix(t),i(r))},remove:function(t){return a.removeItem(this._ttlKey(t)),a.removeItem(this._prefix(t)),this},clear:function(){var t,e,n=[],i=a.length;for(t=0;i>t;t++)(e=a.key(t)).match(this.keyMatcher)&&n.push(e.replace(this.keyMatcher,""));for(t=n.length;t--;)this.remove(n[t]);return this},isExpired:function(t){var i=r(a.getItem(this._ttlKey(t)));return e.isNumber(i)&&n()>i?!0:!1}}:{get:e.noop,set:e.noop,remove:e.noop,clear:e.noop,isExpired:e.noop},e.mixin(t.prototype,o),t}(),o=function(){function n(e){e=e||{},this._send=e.transport?i(e.transport):t.ajax,this._get=e.rateLimiter?e.rateLimiter(this._get):this._get}function i(n){return function(i,r){function a(t){e.defer(function(){s.resolve(t)})}function o(t){e.defer(function(){s.reject(t)})}var s=t.Deferred();return n(i,r,a,o),s}}var a=0,o={},s=6,u=new r(10);return n.setMaxPendingRequests=function(t){s=t},n.resetCache=function(){u=new r(10)},e.mixin(n.prototype,{_get:function(t,e,n){function i(e){n&&n(null,e),u.set(t,e)}function r(){n&&n(!0)}function l(){a--,delete o[t],h.onDeckRequestArgs&&(h._get.apply(h,h.onDeckRequestArgs),h.onDeckRequestArgs=null)}var c,h=this;(c=o[t])?c.done(i).fail(r):s>a?(a++,o[t]=this._send(t,e).done(i).fail(r).always(l)):this.onDeckRequestArgs=[].slice.call(arguments,0)},get:function(t,n,i){var r;return e.isFunction(n)&&(i=n,n={}),(r=u.get(t))?e.defer(function(){i&&i(null,r)}):this._get(t,n,i),!!r}}),n}(),s=function(){function n(e){e=e||{},e.datumTokenizer&&e.queryTokenizer||t.error("datumTokenizer and queryTokenizer are both required"),this.datumTokenizer=e.datumTokenizer,this.queryTokenizer=e.queryTokenizer,this.reset()}function i(t){return t=e.filter(t,function(t){return!!t}),t=e.map(t,function(t){return t.toLowerCase()})}function r(){return{ids:[],children:{}}}function a(t){for(var e={},n=[],i=0;i<t.length;i++)e[t[i]]||(e[t[i]]=!0,n.push(t[i]));return n}function o(t,e){function n(t,e){return t-e}var i=0,r=0,a=[];for(t=t.sort(n),e=e.sort(n);i<t.length&&r<e.length;)t[i]<e[r]?i++:t[i]>e[r]?r++:(a.push(t[i]),i++,r++);return a}return e.mixin(n.prototype,{bootstrap:function(t){this.datums=t.datums,this.trie=t.trie},add:function(t){var n=this;t=e.isArray(t)?t:[t],e.each(t,function(t){var a,o;a=n.datums.push(t)-1,o=i(n.datumTokenizer(t)),e.each(o,function(t){var e,i,o;for(e=n.trie,i=t.split("");o=i.shift();)e=e.children[o]||(e.children[o]=r()),e.ids.push(a)})})},get:function(t){var n,r,s=this;return n=i(this.queryTokenizer(t)),e.each(n,function(t){var e,n,i,a;if(r&&0===r.length)return!1;for(e=s.trie,n=t.split("");e&&(i=n.shift());)e=e.children[i];return e&&0===n.length?(a=e.ids.slice(0),void(r=r?o(r,a):a)):(r=[],!1)}),r?e.map(a(r),function(t){return s.datums[t]}):[]},reset:function(){this.datums=[],this.trie=r()},serialize:function(){return{datums:this.datums,trie:this.trie}}}),n}(),u=function(){function i(t){return t.local||null}function r(i){var r,a;return a={url:null,thumbprint:"",ttl:864e5,filter:null,ajax:{}},(r=i.prefetch||null)&&(r=e.isString(r)?{url:r}:r,r=e.mixin(a,r),r.thumbprint=n+r.thumbprint,r.ajax.type=r.ajax.type||"GET",r.ajax.dataType=r.ajax.dataType||"json",!r.url&&t.error("prefetch requires url to be set")),r}function a(n){function i(t){return function(n){return e.debounce(n,t)}}function r(t){return function(n){return e.throttle(n,t)}}var a,o;return o={url:null,wildcard:"%QUERY",replace:null,rateLimitBy:"debounce",rateLimitWait:300,send:null,filter:null,ajax:{}},(a=n.remote||null)&&(a=e.isString(a)?{url:a}:a,a=e.mixin(o,a),a.rateLimiter=/^throttle$/i.test(a.rateLimitBy)?r(a.rateLimitWait):i(a.rateLimitWait),a.ajax.type=a.ajax.type||"GET",a.ajax.dataType=a.ajax.dataType||"json",delete a.rateLimitBy,delete a.rateLimitWait,!a.url&&t.error("remote requires url to be set")),a}return{local:i,prefetch:r,remote:a}}();!function(n){function r(e){e&&(e.local||e.prefetch||e.remote)||t.error("one of local, prefetch, or remote is required"),this.limit=e.limit||5,this.sorter=l(e.sorter),this.dupDetector=e.dupDetector||c,this.local=u.local(e),this.prefetch=u.prefetch(e),this.remote=u.remote(e),this.cacheKey=this.prefetch?this.prefetch.cacheKey||this.prefetch.url:null,this.index=new s({datumTokenizer:e.datumTokenizer,queryTokenizer:e.queryTokenizer}),this.storage=this.cacheKey?new a(this.cacheKey):null}function l(t){function n(e){return e.sort(t)}function i(t){return t}return e.isFunction(t)?n:i}function c(){return!1}var h,d;return h=n.Bloodhound,d={data:"data",protocol:"protocol",thumbprint:"thumbprint"},n.Bloodhound=r,r.noConflict=function(){return n.Bloodhound=h,r},r.tokenizers=i,e.mixin(r.prototype,{_loadPrefetch:function(e){function n(t){a.clear(),a.add(e.filter?e.filter(t):t),a._saveToStorage(a.index.serialize(),e.thumbprint,e.ttl)}var i,r,a=this;return(i=this._readFromStorage(e.thumbprint))?(this.index.bootstrap(i),r=t.Deferred().resolve()):r=t.ajax(e.url,e.ajax).done(n),r},_getFromRemote:function(t,e){function n(t,n){e(t?[]:a.remote.filter?a.remote.filter(n):n)}var i,r,a=this;return t=t||"",r=encodeURIComponent(t),i=this.remote.replace?this.remote.replace(this.remote.url,t):this.remote.url.replace(this.remote.wildcard,r),this.transport.get(i,this.remote.ajax,n)},_saveToStorage:function(t,e,n){this.storage&&(this.storage.set(d.data,t,n),this.storage.set(d.protocol,location.protocol,n),this.storage.set(d.thumbprint,e,n))},_readFromStorage:function(t){var e,n={};return this.storage&&(n.data=this.storage.get(d.data),n.protocol=this.storage.get(d.protocol),n.thumbprint=this.storage.get(d.thumbprint)),e=n.thumbprint!==t||n.protocol!==location.protocol,n.data&&!e?n.data:null},_initialize:function(){function n(){r.add(e.isFunction(a)?a():a)}var i,r=this,a=this.local;return i=this.prefetch?this._loadPrefetch(this.prefetch):t.Deferred().resolve(),a&&i.done(n),this.transport=this.remote?new o(this.remote):null,this.initPromise=i.promise()},initialize:function(t){return!this.initPromise||t?this._initialize():this.initPromise},add:function(t){this.index.add(t)},get:function(t,n){function i(t){var i=a.slice(0);e.each(t,function(t){var n;return n=e.some(i,function(e){return r.dupDetector(t,e)}),!n&&i.push(t),i.length<r.limit}),n&&n(r.sorter(i))}var r=this,a=[],o=!1;a=this.index.get(t),a=this.sorter(a).slice(0,this.limit),a.length<this.limit&&this.transport&&(o=this._getFromRemote(t,i)),o||(a.length>0||!this.transport)&&n&&n(a)},clear:function(){this.index.reset()},clearPrefetchCache:function(){this.storage&&this.storage.clear()},clearRemoteCache:function(){this.transport&&o.resetCache()},ttAdapter:function(){return e.bind(this.get,this)}}),r}(this);var l={wrapper:'<span class="twitter-typeahead"></span>',dropdown:'<span class="tt-dropdown-menu"></span>',dataset:'<div class="tt-dataset-%CLASS%"></div>',suggestions:'<span class="tt-suggestions"></span>',suggestion:'<div class="tt-suggestion"></div>'},c={wrapper:{position:"relative",display:"inline-block"},hint:{position:"absolute",top:"0",left:"0",borderColor:"transparent",boxShadow:"none"},input:{position:"relative",verticalAlign:"top",backgroundColor:"transparent"},inputWithNoHint:{position:"relative",verticalAlign:"top"},dropdown:{position:"absolute",top:"100%",left:"0",zIndex:"100",display:"none"},suggestions:{display:"block"},suggestion:{whiteSpace:"nowrap",cursor:"pointer"},suggestionChild:{whiteSpace:"normal"},ltr:{left:"0",right:"auto"},rtl:{left:"auto",right:" 0"}};e.isMsie()&&e.mixin(c.input,{backgroundImage:"url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)"}),e.isMsie()&&e.isMsie()<=7&&e.mixin(c.input,{marginTop:"-1px"});var h=function(){function n(e){e&&e.el||t.error("EventBus initialized without el"),this.$el=t(e.el)}var i="typeahead:";return e.mixin(n.prototype,{trigger:function(t){var e=[].slice.call(arguments,1);this.$el.trigger(i+t,e)}}),n}(),d=function(){function t(t,e,n,i){var r;if(!n)return this;for(e=e.split(u),n=i?s(n,i):n,this._callbacks=this._callbacks||{};r=e.shift();)this._callbacks[r]=this._callbacks[r]||{sync:[],async:[]},this._callbacks[r][t].push(n);return this}function e(e,n,i){return t.call(this,"async",e,n,i)}function n(e,n,i){return t.call(this,"sync",e,n,i)}function i(t){var e;if(!this._callbacks)return this;for(t=t.split(u);e=t.shift();)delete this._callbacks[e];return this}function r(t){var e,n,i,r,o;if(!this._callbacks)return this;for(t=t.split(u),i=[].slice.call(arguments,1);(e=t.shift())&&(n=this._callbacks[e]);)r=a(n.sync,this,[e].concat(i)),o=a(n.async,this,[e].concat(i)),r()&&l(o);return this}function a(t,e,n){function i(){for(var i,r=0;!i&&r<t.length;r+=1)i=t[r].apply(e,n)===!1;return!i}return i}function o(){var t;return t=window.setImmediate?function(t){setImmediate(function(){t()})}:function(t){setTimeout(function(){t()},0)}}function s(t,e){return t.bind?t.bind(e):function(){t.apply(e,[].slice.call(arguments,0))}}var u=/\s+/,l=o();return{onSync:n,onAsync:e,off:i,trigger:r}}(),p=function(t){function n(t,n,i){for(var r,a=[],o=0;o<t.length;o++)a.push(e.escapeRegExChars(t[o]));return r=i?"\\b("+a.join("|")+")\\b":"("+a.join("|")+")",n?new RegExp(r):new RegExp(r,"i")}var i={node:null,pattern:null,tagName:"strong",className:null,wordsOnly:!1,caseSensitive:!1};return function(r){function a(e){var n,i;return(n=s.exec(e.data))&&(wrapperNode=t.createElement(r.tagName),r.className&&(wrapperNode.className=r.className),i=e.splitText(n.index),i.splitText(n[0].length),wrapperNode.appendChild(i.cloneNode(!0)),e.parentNode.replaceChild(wrapperNode,i)),!!n}function o(t,e){for(var n,i=3,r=0;r<t.childNodes.length;r++)n=t.childNodes[r],n.nodeType===i?r+=e(n)?1:0:o(n,e)}var s;r=e.mixin({},i,r),r.node&&r.pattern&&(r.pattern=e.isArray(r.pattern)?r.pattern:[r.pattern],s=n(r.pattern,r.caseSensitive,r.wordsOnly),o(r.node,a))}}(window.document),f=function(){function n(n){var r,a,s,u,l=this;n=n||{},n.input||t.error("input is missing"),r=e.bind(this._onBlur,this),a=e.bind(this._onFocus,this),s=e.bind(this._onKeydown,this),u=e.bind(this._onInput,this),this.$hint=t(n.hint),this.$input=t(n.input).on("blur.tt",r).on("focus.tt",a).on("keydown.tt",s),0===this.$hint.length&&(this.setHint=this.getHint=this.clearHint=this.clearHintIfInvalid=e.noop),e.isMsie()?this.$input.on("keydown.tt keypress.tt cut.tt paste.tt",function(t){o[t.which||t.keyCode]||e.defer(e.bind(l._onInput,l,t))}):this.$input.on("input.tt",u),this.query=this.$input.val(),this.$overflowHelper=i(this.$input)}function i(e){return t('<pre aria-hidden="true"></pre>').css({position:"absolute",visibility:"hidden",whiteSpace:"pre",fontFamily:e.css("font-family"),fontSize:e.css("font-size"),fontStyle:e.css("font-style"),fontVariant:e.css("font-variant"),fontWeight:e.css("font-weight"),wordSpacing:e.css("word-spacing"),letterSpacing:e.css("letter-spacing"),textIndent:e.css("text-indent"),textRendering:e.css("text-rendering"),textTransform:e.css("text-transform")}).insertAfter(e)}function r(t,e){return n.normalizeQuery(t)===n.normalizeQuery(e)}function a(t){return t.altKey||t.ctrlKey||t.metaKey||t.shiftKey}var o;return o={9:"tab",27:"esc",37:"left",39:"right",13:"enter",38:"up",40:"down"},n.normalizeQuery=function(t){return(t||"").replace(/^\s*/g,"").replace(/\s{2,}/g," ")},e.mixin(n.prototype,d,{_onBlur:function(){this.resetInputValue(),this.trigger("blurred")},_onFocus:function(){this.trigger("focused")},_onKeydown:function(t){var e=o[t.which||t.keyCode];this._managePreventDefault(e,t),e&&this._shouldTrigger(e,t)&&this.trigger(e+"Keyed",t)},_onInput:function(){this._checkInputValue()},_managePreventDefault:function(t,e){var n,i,r;switch(t){case"tab":i=this.getHint(),r=this.getInputValue(),n=i&&i!==r&&!a(e);break;case"up":case"down":n=!a(e);break;default:n=!1}n&&e.preventDefault()},_shouldTrigger:function(t,e){var n;switch(t){case"tab":n=!a(e);break;default:n=!0}return n},_checkInputValue:function(){var t,e,n;t=this.getInputValue(),e=r(t,this.query),n=e?this.query.length!==t.length:!1,e?n&&this.trigger("whitespaceChanged",this.query):this.trigger("queryChanged",this.query=t)},focus:function(){this.$input.focus()},blur:function(){this.$input.blur()},getQuery:function(){return this.query},setQuery:function(t){this.query=t},getInputValue:function(){return this.$input.val()},setInputValue:function(t,e){this.$input.val(t),e?this.clearHint():this._checkInputValue()},resetInputValue:function(){this.setInputValue(this.query,!0)},getHint:function(){return this.$hint.val()},setHint:function(t){this.$hint.val(t)},clearHint:function(){this.setHint("")},clearHintIfInvalid:function(){var t,e,n,i;t=this.getInputValue(),e=this.getHint(),n=t!==e&&0===e.indexOf(t),i=""!==t&&n&&!this.hasOverflow(),!i&&this.clearHint()},getLanguageDirection:function(){return(this.$input.css("direction")||"ltr").toLowerCase()},hasOverflow:function(){var t=this.$input.width()-2;return this.$overflowHelper.text(this.getInputValue()),this.$overflowHelper.width()>=t},isCursorAtEnd:function(){var t,n,i;return t=this.$input.val().length,n=this.$input[0].selectionStart,e.isNumber(n)?n===t:document.selection?(i=document.selection.createRange(),i.moveStart("character",-t),t===i.text.length):!0},destroy:function(){this.$hint.off(".tt"),this.$input.off(".tt"),this.$hint=this.$input=this.$overflowHelper=null}}),n}(),g=function(){function n(n){n=n||{},n.templates=n.templates||{},n.source||t.error("missing source"),n.name&&!a(n.name)&&t.error("invalid dataset name: "+n.name),this.query=null,this.highlight=!!n.highlight,this.name=n.name||e.getUniqueId(),this.source=n.source,this.displayFn=i(n.display||n.displayKey),this.templates=r(n.templates,this.displayFn),this.$el=t(l.dataset.replace("%CLASS%",this.name))}function i(t){function n(e){return e[t]}return t=t||"value",e.isFunction(t)?t:n}function r(t,n){function i(t){return"<p>"+n(t)+"</p>"}return{empty:t.empty&&e.templatify(t.empty),header:t.header&&e.templatify(t.header),footer:t.footer&&e.templatify(t.footer),suggestion:t.suggestion||i}}function a(t){return/^[_a-zA-Z0-9-]+$/.test(t)}var o="ttDataset",s="ttValue",u="ttDatum";return n.extractDatasetName=function(e){return t(e).data(o)},n.extractValue=function(e){return t(e).data(s)},n.extractDatum=function(e){return t(e).data(u)},e.mixin(n.prototype,d,{_render:function(n,i){function r(){return g.templates.empty({query:n,isEmpty:!0})}function a(){function r(e){var n;return n=t(l.suggestion).append(g.templates.suggestion(e)).data(o,g.name).data(s,g.displayFn(e)).data(u,e),n.children().each(function(){t(this).css(c.suggestionChild)}),n}var a,h;return a=t(l.suggestions).css(c.suggestions),h=e.map(i,r),a.append.apply(a,h),g.highlight&&p({node:a[0],pattern:n}),a}function h(){return g.templates.header({query:n,isEmpty:!f})}function d(){return g.templates.footer({query:n,isEmpty:!f})}if(this.$el){var f,g=this;this.$el.empty(),f=i&&i.length,!f&&this.templates.empty?this.$el.html(r()).prepend(g.templates.header?h():null).append(g.templates.footer?d():null):f&&this.$el.html(a()).prepend(g.templates.header?h():null).append(g.templates.footer?d():null),this.trigger("rendered")}},getRoot:function(){return this.$el},update:function(t){function e(e){n.canceled||t!==n.query||n._render(t,e)}var n=this;this.query=t,this.canceled=!1,this.source(t,e)},cancel:function(){this.canceled=!0},clear:function(){this.cancel(),this.$el.empty(),this.trigger("rendered")},isEmpty:function(){return this.$el.is(":empty")},destroy:function(){this.$el=null}}),n}(),m=function(){function n(n){var r,a,o,s=this;n=n||{},n.menu||t.error("menu is required"),this.isOpen=!1,this.isEmpty=!0,this.datasets=e.map(n.datasets,i),r=e.bind(this._onSuggestionClick,this),a=e.bind(this._onSuggestionMouseEnter,this),o=e.bind(this._onSuggestionMouseLeave,this),this.$menu=t(n.menu).on("click.tt",".tt-suggestion",r).on("mouseenter.tt",".tt-suggestion",a).on("mouseleave.tt",".tt-suggestion",o),e.each(this.datasets,function(t){s.$menu.append(t.getRoot()),t.onSync("rendered",s._onRendered,s)})}function i(t){return new g(t)}return e.mixin(n.prototype,d,{_onSuggestionClick:function(e){this.trigger("suggestionClicked",t(e.currentTarget))},_onSuggestionMouseEnter:function(e){this._removeCursor(),this._setCursor(t(e.currentTarget),!0)},_onSuggestionMouseLeave:function(){this._removeCursor()},_onRendered:function(){function t(t){return t.isEmpty()}this.isEmpty=e.every(this.datasets,t),this.isEmpty?this._hide():this.isOpen&&this._show(),this.trigger("datasetRendered")},_hide:function(){this.$menu.hide()},_show:function(){this.$menu.css("display","block")},_getSuggestions:function(){return this.$menu.find(".tt-suggestion")},_getCursor:function(){return this.$menu.find(".tt-cursor").first()},_setCursor:function(t,e){t.first().addClass("tt-cursor"),!e&&this.trigger("cursorMoved")},_removeCursor:function(){this._getCursor().removeClass("tt-cursor")},_moveCursor:function(t){var e,n,i,r;if(this.isOpen){if(n=this._getCursor(),e=this._getSuggestions(),this._removeCursor(),i=e.index(n)+t,i=(i+1)%(e.length+1)-1,-1===i)return void this.trigger("cursorRemoved");-1>i&&(i=e.length-1),this._setCursor(r=e.eq(i)),this._ensureVisible(r)}},_ensureVisible:function(t){var e,n,i,r;e=t.position().top,n=e+t.outerHeight(!0),i=this.$menu.scrollTop(),r=this.$menu.height()+parseInt(this.$menu.css("paddingTop"),10)+parseInt(this.$menu.css("paddingBottom"),10),0>e?this.$menu.scrollTop(i+e):n>r&&this.$menu.scrollTop(i+(n-r))},close:function(){this.isOpen&&(this.isOpen=!1,this._removeCursor(),this._hide(),this.trigger("closed"))},open:function(){this.isOpen||(this.isOpen=!0,!this.isEmpty&&this._show(),this.trigger("opened"))},setLanguageDirection:function(t){this.$menu.css("ltr"===t?c.ltr:c.rtl)},moveCursorUp:function(){this._moveCursor(-1)},moveCursorDown:function(){this._moveCursor(1)},getDatumForSuggestion:function(t){var e=null;return t.length&&(e={raw:g.extractDatum(t),value:g.extractValue(t),datasetName:g.extractDatasetName(t)}),e},getDatumForCursor:function(){return this.getDatumForSuggestion(this._getCursor().first())},getDatumForTopSuggestion:function(){return this.getDatumForSuggestion(this._getSuggestions().first())},update:function(t){function n(e){e.update(t)}e.each(this.datasets,n)},empty:function(){function t(t){t.clear()}e.each(this.datasets,t),this.isEmpty=!0},isVisible:function(){return this.isOpen&&!this.isEmpty},destroy:function(){function t(t){t.destroy()}this.$menu.off(".tt"),this.$menu=null,e.each(this.datasets,t)}}),n}(),v=function(){function n(n){var r,a,o;n=n||{},n.input||t.error("missing input"),this.isActivated=!1,this.autoselect=!!n.autoselect,this.minLength=e.isNumber(n.minLength)?n.minLength:1,this.$node=i(n.input,n.withHint),r=this.$node.find(".tt-dropdown-menu"),a=this.$node.find(".tt-input"),o=this.$node.find(".tt-hint"),a.on("blur.tt",function(t){var n,i,o;n=document.activeElement,i=r.is(n),o=r.has(n).length>0,e.isMsie()&&(i||o)&&(t.preventDefault(),t.stopImmediatePropagation(),e.defer(function(){a.focus()}))}),r.on("mousedown.tt",function(t){t.preventDefault()}),this.eventBus=n.eventBus||new h({el:a}),this.dropdown=new m({menu:r,datasets:n.datasets}).onSync("suggestionClicked",this._onSuggestionClicked,this).onSync("cursorMoved",this._onCursorMoved,this).onSync("cursorRemoved",this._onCursorRemoved,this).onSync("opened",this._onOpened,this).onSync("closed",this._onClosed,this).onAsync("datasetRendered",this._onDatasetRendered,this),this.input=new f({input:a,hint:o}).onSync("focused",this._onFocused,this).onSync("blurred",this._onBlurred,this).onSync("enterKeyed",this._onEnterKeyed,this).onSync("tabKeyed",this._onTabKeyed,this).onSync("escKeyed",this._onEscKeyed,this).onSync("upKeyed",this._onUpKeyed,this).onSync("downKeyed",this._onDownKeyed,this).onSync("leftKeyed",this._onLeftKeyed,this).onSync("rightKeyed",this._onRightKeyed,this).onSync("queryChanged",this._onQueryChanged,this).onSync("whitespaceChanged",this._onWhitespaceChanged,this),this._setLanguageDirection()}function i(e,n){var i,a,s,u;i=t(e),a=t(l.wrapper).css(c.wrapper),s=t(l.dropdown).css(c.dropdown),u=i.clone().css(c.hint).css(r(i)),u.val("").removeData().addClass("tt-hint").removeAttr("id name placeholder").prop("disabled",!0).attr({autocomplete:"off",spellcheck:"false"}),i.data(o,{dir:i.attr("dir"),autocomplete:i.attr("autocomplete"),spellcheck:i.attr("spellcheck"),style:i.attr("style")}),i.addClass("tt-input").attr({autocomplete:"off",spellcheck:!1}).css(n?c.input:c.inputWithNoHint);try{!i.attr("dir")&&i.attr("dir","auto")}catch(h){}return i.wrap(a).parent().prepend(n?u:null).append(s)}function r(t){return{backgroundAttachment:t.css("background-attachment"),backgroundClip:t.css("background-clip"),backgroundColor:t.css("background-color"),backgroundImage:t.css("background-image"),backgroundOrigin:t.css("background-origin"),backgroundPosition:t.css("background-position"),backgroundRepeat:t.css("background-repeat"),backgroundSize:t.css("background-size")}}function a(t){var n=t.find(".tt-input");e.each(n.data(o),function(t,i){e.isUndefined(t)?n.removeAttr(i):n.attr(i,t)}),n.detach().removeData(o).removeClass("tt-input").insertAfter(t),t.remove()}var o="ttAttrs";return e.mixin(n.prototype,{_onSuggestionClicked:function(t,e){var n;(n=this.dropdown.getDatumForSuggestion(e))&&this._select(n)
},_onCursorMoved:function(){var t=this.dropdown.getDatumForCursor();this.input.setInputValue(t.value,!0),this.eventBus.trigger("cursorchanged",t.raw,t.datasetName)},_onCursorRemoved:function(){this.input.resetInputValue(),this._updateHint()},_onDatasetRendered:function(){this._updateHint()},_onOpened:function(){this._updateHint(),this.eventBus.trigger("opened")},_onClosed:function(){this.input.clearHint(),this.eventBus.trigger("closed")},_onFocused:function(){this.isActivated=!0,this.dropdown.open()},_onBlurred:function(){this.isActivated=!1,this.dropdown.empty(),this.dropdown.close()},_onEnterKeyed:function(t,e){var n,i;n=this.dropdown.getDatumForCursor(),i=this.dropdown.getDatumForTopSuggestion(),n?(this._select(n),e.preventDefault()):this.autoselect&&i&&(this._select(i),e.preventDefault())},_onTabKeyed:function(t,e){var n;(n=this.dropdown.getDatumForCursor())?(this._select(n),e.preventDefault()):this._autocomplete(!0)},_onEscKeyed:function(){this.dropdown.close(),this.input.resetInputValue()},_onUpKeyed:function(){var t=this.input.getQuery();this.dropdown.isEmpty&&t.length>=this.minLength?this.dropdown.update(t):this.dropdown.moveCursorUp(),this.dropdown.open()},_onDownKeyed:function(){var t=this.input.getQuery();this.dropdown.isEmpty&&t.length>=this.minLength?this.dropdown.update(t):this.dropdown.moveCursorDown(),this.dropdown.open()},_onLeftKeyed:function(){"rtl"===this.dir&&this._autocomplete()},_onRightKeyed:function(){"ltr"===this.dir&&this._autocomplete()},_onQueryChanged:function(t,e){this.input.clearHintIfInvalid(),e.length>=this.minLength?this.dropdown.update(e):this.dropdown.empty(),this.dropdown.open(),this._setLanguageDirection()},_onWhitespaceChanged:function(){this._updateHint(),this.dropdown.open()},_setLanguageDirection:function(){var t;this.dir!==(t=this.input.getLanguageDirection())&&(this.dir=t,this.$node.css("direction",t),this.dropdown.setLanguageDirection(t))},_updateHint:function(){var t,n,i,r,a,o;t=this.dropdown.getDatumForTopSuggestion(),t&&this.dropdown.isVisible()&&!this.input.hasOverflow()?(n=this.input.getInputValue(),i=f.normalizeQuery(n),r=e.escapeRegExChars(i),a=new RegExp("^(?:"+r+")(.+$)","i"),o=a.exec(t.value),o?this.input.setHint(n+o[1]):this.input.clearHint()):this.input.clearHint()},_autocomplete:function(t){var e,n,i,r;e=this.input.getHint(),n=this.input.getQuery(),i=t||this.input.isCursorAtEnd(),e&&n!==e&&i&&(r=this.dropdown.getDatumForTopSuggestion(),r&&this.input.setInputValue(r.value),this.eventBus.trigger("autocompleted",r.raw,r.datasetName))},_select:function(t){this.input.setQuery(t.value),this.input.setInputValue(t.value,!0),this._setLanguageDirection(),this.eventBus.trigger("selected",t.raw,t.datasetName),this.dropdown.close(),e.defer(e.bind(this.dropdown.empty,this.dropdown))},open:function(){this.dropdown.open()},close:function(){this.dropdown.close()},setVal:function(t){this.isActivated?this.input.setInputValue(t):(this.input.setQuery(t),this.input.setInputValue(t,!0)),this._setLanguageDirection()},getVal:function(){return this.input.getQuery()},destroy:function(){this.input.destroy(),this.dropdown.destroy(),a(this.$node),this.$node=null}}),n}();!function(){var n,i,r;n=t.fn.typeahead,i="ttTypeahead",r={initialize:function(n,r){function a(){var a,o,s=t(this);e.each(r,function(t){t.highlight=!!n.highlight}),o=new v({input:s,eventBus:a=new h({el:s}),withHint:e.isUndefined(n.hint)?!0:!!n.hint,minLength:n.minLength,autoselect:n.autoselect,datasets:r}),s.data(i,o)}return r=e.isArray(r)?r:[].slice.call(arguments,1),n=n||{},this.each(a)},open:function(){function e(){var e,n=t(this);(e=n.data(i))&&e.open()}return this.each(e)},close:function(){function e(){var e,n=t(this);(e=n.data(i))&&e.close()}return this.each(e)},val:function(e){function n(){var n,r=t(this);(n=r.data(i))&&n.setVal(e)}function r(t){var e,n;return(e=t.data(i))&&(n=e.getVal()),n}return arguments.length?this.each(n):r(this.first())},destroy:function(){function e(){var e,n=t(this);(e=n.data(i))&&(e.destroy(),n.removeData(i))}return this.each(e)}},t.fn.typeahead=function(t){return r[t]?r[t].apply(this,[].slice.call(arguments,1)):r.initialize.apply(this,arguments)},t.fn.typeahead.noConflict=function(){return t.fn.typeahead=n,this}}()}(window.jQuery),$(".entity-typeahead").length){var users=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.nonword("name"),queryTokenizer:Bloodhound.tokenizers.nonword,prefetch:{url:$SCRIPT_ROOT+"/api/user/",filter:function(t){return t.users}}}),groups=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.nonword("name"),queryTokenizer:Bloodhound.tokenizers.nonword,prefetch:{url:$SCRIPT_ROOT+"/api/group/",filter:function(t){return t.groups}}});groups.initialize(),users.initialize(),$(".entity-typeahead").typeahead({hint:!0,highlight:!0},{name:"users",displayKey:"name",source:users.ttAdapter(),templates:{suggestion:function(t){return"<p>"+t.name+' <small class="text-muted">User</small></p>'}}},{name:"groups",displayKey:"name",source:groups.ttAdapter(),templates:{suggestion:function(t){return"<p>"+t.name+' <small class="text-muted">Group</small></p>'}}}).on("typeahead:autocompleted",setEntityID).on("typeahead:cursorchanged",setEntityID).on("typeahead:selected",function(t,e,n){setEntityID(t,e,n),$(this).closest("form").submit()})}$("select#attribute").change(function(){var t=$(this).find("option:selected").val();""!==t&&$(this).find("option[value='']").remove(),$.getJSON(window.location.pathname+"transformers/"+t+"/",function(e){var n=$("select#transformer");n.empty();var i=e[t];1===i.length?n.prop("disabled",!0):n.prop("disabled",!1),$.each(i,function(t,e){var i=$("<option></option>");i.append(e[1]),i.attr("value",e[0]),e[2]===!0&&i.prop("selected",!0),n.append(i)})})}),$("select#transformer").change(function(){var t=$("select#attribute option:selected").text(),e=$(this).find("option:selected").text(),n=$(this).parents("form");$.post(window.location.pathname,n.serialize(),function(){flash('"'+t+'" transformer set to "'+e+'".',"info")})}),$(".permission").submit(function(t){var e;e=$("originalEvent"in t?t.originalEvent.target:t.target);var n=$(this).attr("id"),i=$(this).children("h2").text().slice(0,-1),r=e.find("input[name='name']").val();return void 0===r&&(r=e.closest("tr").find("td").first().text()),$.post(window.location.pathname,e.serialize(),function(){var t,a=e.find("input[name='action']").val();"add"===a?t="' is now a ":"delete"===a&&(t="' is no longer a "),flash("'"+r+t+i.toLowerCase(),"info");e.find(".typeahead").typeahead("val","");rebuild_entities(n)}),!1}),function(){var t=Handlebars.template,e=Handlebars.templates=Handlebars.templates||{};e.action_menu=t({1:function(t,e,n,i){var r,a="function",o=this.escapeExpression,s=e.helperMissing;return'\n<li>\n  <a href="#" id="'+o(typeof t===a?t.apply(t):t)+'">'+o((r=e.capitalize||t&&t.capitalize||s,r.call(t,t,{name:"capitalize",hash:{},data:i})))+"</a>\n</li>\n"},compiler:[5,">= 2.0.0"],main:function(t,e,n,i){var r,a="";return r=e.each.call(t,t&&t.valid_actions,{name:"each",hash:{},fn:this.program(1,i),inverse:this.noop,data:i}),(r||0===r)&&(a+=r),a+"\n"},useData:!0}),e.actions=t({1:function(t,e,n,i){var r,a,o=e.helperMissing,s="function",u=this.escapeExpression,l='\n<div class="list-group-item">\n  ';return a=e.status_color||t&&t.status_color||o,r=a.call(t,t&&t.type,{name:"status_color",hash:{},data:i}),r=e["if"].call(t,r,{name:"if",hash:{},fn:this.program(2,i),inverse:this.program(4,i),data:i}),(r||0===r)&&(l+=r),l+'\n  <blockquote class="list-group-item-text">\n    <p>'+u((a=e.note||t&&t.note,typeof a===s?a.call(t,{name:"note",hash:{},data:i}):a))+"</p>\n    <footer>"+u((r=t&&t.user,r=null==r||r===!1?r:r.name,typeof r===s?r.apply(t):r))+" ("+u((a=e.timefmt||t&&t.timefmt||o,a.call(t,t&&t.timestamp,{name:"timefmt",hash:{},data:i})))+" @ "+u((a=e.datefmt||t&&t.datefmt||o,a.call(t,t&&t.timestamp,{name:"datefmt",hash:{},data:i})))+")</footer>\n  </blockquote>\n</div>\n"},2:function(t,e,n,i){var r,a=e.helperMissing,o=this.escapeExpression;return'\n  <h4 class="list-group-item-heading text-'+o((r=e.status_color||t&&t.status_color||a,r.call(t,t&&t.type,{name:"status_color",hash:{},data:i})))+'">'+o((r=e.capitalize||t&&t.capitalize||a,r.call(t,t&&t.type,{name:"capitalize",hash:{},data:i})))+"</h4>\n  "},4:function(){return'\n  <h4 class="list-group-item-heading"></h4>\n  '},compiler:[5,">= 2.0.0"],main:function(t,e,n,i){var r,a="";return r=e.each.call(t,t&&t.actions,{name:"each",hash:{},fn:this.program(1,i),inverse:this.noop,data:i}),(r||0===r)&&(a+=r),a+"\n"},useData:!0}),e.entity_table=t({1:function(t,e,n,i,r){var a,o="function",s=this.escapeExpression,u="\n  <tr>\n    <td>"+s((a=t&&t.name,typeof a===o?a.apply(t):a))+"</td>\n    ";return a=e["if"].call(t,t&&t.length,{name:"if",hash:{},fn:this.program(2,i),inverse:this.program(4,i),data:i}),(a||0===a)&&(u+=a),u+"\n    <td>"+s((a=t&&t.source,typeof a===o?a.apply(t):a))+'</td>\n    <td>\n      <form method="post">\n        <input id="csrf_token" name="csrf_token" type="hidden" value="'+s(e.csrf.call(t,{name:"csrf",hash:{},data:i}))+'">\n        <input id="id_" name="id_" type="hidden" value="'+s((a=t&&t.id,typeof a===o?a.apply(t):a))+'">\n        <input id="permission" name="permission" type="hidden" value="'+s((a=r&&r.name,typeof a===o?a.apply(t):a))+'">\n        <input id="action" name="action" type="hidden" value="delete">\n        <input id="form_id" name="form_id" type="hidden" value="entity">\n        <button class="close" type="submit">&times;</button>\n      </form>\n  </tr>\n  '},2:function(t){var e,n="function",i=this.escapeExpression;return"\n    <td>Group ("+i((e=t&&t.length,typeof e===n?e.apply(t):e))+")</td>\n    "},4:function(){return"\n    <td>User</td>\n    "},compiler:[5,">= 2.0.0"],main:function(t,e,n,i){var r,a='<table class="table table-condensed">\n  <tr>\n    <th>Name</th>\n    <th>Type</th>\n    <th>Authentication Source</th>\n    <th>Remove</th>\n  </tr>\n  ';return r=e.each.call(t,t&&t.entities,{name:"each",hash:{},fn:this.programWithDepth(1,i,t),inverse:this.noop,data:i}),(r||0===r)&&(a+=r),a+"\n</table>\n"},useData:!0}),e.modifier=t({1:function(){return'\n<div class="panel panel-danger">\n'},3:function(){return'\n<div class="panel panel-success">\n'},5:function(t,e,n,i){var r,a="function",o=this.escapeExpression;return'\n    <div class="panel-body">\n      '+o((r=e.note||t&&t.note,typeof r===a?r.call(t,{name:"note",hash:{},data:i}):r))+"\n    </div>\n    "},compiler:[5,">= 2.0.0"],main:function(t,e,n,i){var r,a,o=e.helperMissing,s="function",u=this.escapeExpression,l="";return a=e.compare||t&&t.compare||o,r=a.call(t,t&&t.value,0,{name:"compare",hash:{operator:"<"},fn:this.program(1,i),inverse:this.program(3,i),data:i}),(r||0===r)&&(l+=r),l+='\n  <div class="panel-heading" data-toggle="collapse" data-target="#modifier'+u((a=e.id||t&&t.id,typeof a===s?a.call(t,{name:"id",hash:{},data:i}):a))+'">\n    <h4 class="panel-title">'+u((a=e.value_str||t&&t.value_str,typeof a===s?a.call(t,{name:"value_str",hash:{},data:i}):a))+'</h4>\n  </div>\n  <div id="modifier'+u((a=e.id||t&&t.id,typeof a===s?a.call(t,{name:"id",hash:{},data:i}):a))+'" class="collapse in">\n    ',r=e["if"].call(t,t&&t.note,{name:"if",hash:{},fn:this.program(5,i),inverse:this.noop,data:i}),(r||0===r)&&(l+=r),l+'\n    <div class="panel-footer">\n      '+u((r=t&&t.user,r=null==r||r===!1?r:r.name,typeof r===s?r.apply(t):r))+" at "+u((a=e.timefmt||t&&t.timefmt||o,a.call(t,t&&t.timestamp,{name:"timefmt",hash:{},data:i})))+" "+u((a=e.datefmt||t&&t.datefmt||o,a.call(t,t&&t.timestamp,{name:"datefmt",hash:{},data:i})))+"\n    </div>\n  </div>\n</div>\n"},useData:!0}),e.payout_rows=t({1:function(t,e,n,i){var r,a=e.helperMissing,o=this.escapeExpression,s="function";return'\n<tr class="'+o((r=e.status_color||t&&t.status_color||a,r.call(t,t&&t.status,{name:"status_color",hash:{},data:i})))+'">\n  <td><button class="btn btn-default btn-sm copy-btn" data-clipboard-text="'+o((r=e.pilot||t&&t.pilot,typeof r===s?r.call(t,{name:"pilot",hash:{},data:i}):r))+'" data-toggle="tooltip" title="Copy \''+o((r=e.pilot||t&&t.pilot,typeof r===s?r.call(t,{name:"pilot",hash:{},data:i}):r))+"' to clipboard\">"+o((r=e.pilot||t&&t.pilot,typeof r===s?r.call(t,{name:"pilot",hash:{},data:i}):r))+'</button></td>\n  <td><button class="btn btn-default btn-sm copy-btn" data-clipboard-text="'+o((r=e.id||t&&t.id,typeof r===s?r.call(t,{name:"id",hash:{},data:i}):r))+'" data-toggle="tooltip" title="Copy \''+o((r=e.id||t&&t.id,typeof r===s?r.call(t,{name:"id",hash:{},data:i}):r))+"' to clipboard\">"+o((r=e.id||t&&t.id,typeof r===s?r.call(t,{name:"id",hash:{},data:i}):r))+'</button></td>\n  <td><button class="btn btn-default btn-sm copy-btn" data-clipboard-text="'+o((r=e.payout||t&&t.payout,typeof r===s?r.call(t,{name:"payout",hash:{},data:i}):r))+'" data-toggle="tooltip" title="Copy \''+o((r=e.payout||t&&t.payout,typeof r===s?r.call(t,{name:"payout",hash:{},data:i}):r))+"' to clipboard\">"+o((r=e.payout_str||t&&t.payout_str,typeof r===s?r.call(t,{name:"payout_str",hash:{},data:i}):r))+'</button></td>\n  <td>\n    <form method="post" action="'+o((r=e.href||t&&t.href,typeof r===s?r.call(t,{name:"href",hash:{},data:i}):r))+'">\n      <input id="id_" name="id_" type="hidden" value="action">\n      <input id="type_" name="type_" type="hidden" value="paid">\n      <input id="csrf_token" name="csrf_token" type="hidden" value="'+o(e.csrf.call(t,{name:"csrf",hash:{},data:i}))+'">\n      <button class="btn btn-success btn-sm paid-btn" tpye="submit">Paid</button>\n    </form>\n  </td>\n  <td><a href="'+o((r=e.href||t&&t.href,typeof r===s?r.call(t,{name:"href",hash:{},data:i}):r))+'">'+o((r=e.id||t&&t.id,typeof r===s?r.call(t,{name:"id",hash:{},data:i}):r))+"</a></td>\n  <td>"+o((r=e.capitalize||t&&t.capitalize||a,r.call(t,t&&t.status,{name:"capitalize",hash:{},data:i})))+"</td>\n  <td>"+o((r=e.division||t&&t.division,typeof r===s?r.call(t,{name:"division",hash:{},data:i}):r))+"</td>\n</tr>\n"},compiler:[5,">= 2.0.0"],main:function(t,e,n,i){var r,a="";return r=e.each.call(t,t,{name:"each",hash:{},fn:this.program(1,i),inverse:this.noop,data:i}),(r||0===r)&&(a+=r),a+"\n"},useData:!0}),e.request_rows=t({1:function(t,e,n,i){var r,a=e.helperMissing,o=this.escapeExpression,s="function";return'\n<tr class="'+o((r=e.status_color||t&&t.status_color||a,r.call(t,t&&t.status,{name:"status_color",hash:{},data:i})))+'">\n  <td><a href="'+o((r=e.href||t&&t.href,typeof r===s?r.call(t,{name:"href",hash:{},data:i}):r))+'">'+o((r=e.id||t&&t.id,typeof r===s?r.call(t,{name:"id",hash:{},data:i}):r))+"</a></td>\n  <td>"+o((r=e.pilot||t&&t.pilot,typeof r===s?r.call(t,{name:"pilot",hash:{},data:i}):r))+"</td>\n  <td>"+o((r=e.ship||t&&t.ship,typeof r===s?r.call(t,{name:"ship",hash:{},data:i}):r))+"</td>\n  <td>"+o((r=e.system||t&&t.system,typeof r===s?r.call(t,{name:"system",hash:{},data:i}):r))+"</td>\n  <td>"+o((r=e.capitalize||t&&t.capitalize||a,r.call(t,t&&t.status,{name:"capitalize",hash:{},data:i})))+"</td>\n  <td>"+o((r=e.payout_str||t&&t.payout_str,typeof r===s?r.call(t,{name:"payout_str",hash:{},data:i}):r))+"</td>\n  <td>"+o((r=e.datefmt||t&&t.datefmt||a,r.call(t,t&&t.submit_timestamp,{name:"datefmt",hash:{},data:i})))+" @ "+o((r=e.timefmt||t&&t.timefmt||a,r.call(t,t&&t.submit_timestamp,{name:"timefmt",hash:{},data:i})))+"</td>\n  <td>"+o((r=e.division||t&&t.division,typeof r===s?r.call(t,{name:"division",hash:{},data:i}):r))+"</td>\n</tr>\n"},compiler:[5,">= 2.0.0"],main:function(t,e,n,i){var r,a="";return r=e.each.call(t,t,{name:"each",hash:{},fn:this.program(1,i),inverse:this.noop,data:i}),(r||0===r)&&(a+=r),a+"\n"},useData:!0}),e.voidable_modifier=t({1:function(){return'\n<div class="panel panel-danger">\n'},3:function(){return'\n<div class="panel panel-success">\n'},5:function(t,e,n,i){var r,a="function",o=this.escapeExpression;return'\n    <div class="panel-body">\n      '+o((r=e.note||t&&t.note,typeof r===a?r.call(t,{name:"note",hash:{},data:i}):r))+"\n    </div>\n    "},compiler:[5,">= 2.0.0"],main:function(t,e,n,i){var r,a,o=e.helperMissing,s="function",u=this.escapeExpression,l="";return a=e.compare||t&&t.compare||o,r=a.call(t,t&&t.value,0,{name:"compare",hash:{operator:"<"},fn:this.program(1,i),inverse:this.program(3,i),data:i}),(r||0===r)&&(l+=r),l+='\n  <div class="panel-heading" data-toggle="collapse" data-target="#modifier'+u((a=e.id||t&&t.id,typeof a===s?a.call(t,{name:"id",hash:{},data:i}):a))+'">\n    <form class="form" method="post">\n      <input id="csrf_token" name="csrf_token" type="hidden" value="'+u(e.csrf.call(t,{name:"csrf",hash:{},data:i}))+'">\n      <input id="id_" name="id_" type="hidden" value="void">\n      <input id="modifier_id_'+u((a=e.id||t&&t.id,typeof a===s?a.call(t,{name:"id",hash:{},data:i}):a))+'" name="modifier_id" type="hidden" value="'+u((a=e.id||t&&t.id,typeof a===s?a.call(t,{name:"id",hash:{},data:i}):a))+'">\n      <button class="close" type="submit" name="void_modifier">&times;</button>\n    </form>\n    <h4 class="panel-title">'+u((a=e.value_str||t&&t.value_str,typeof a===s?a.call(t,{name:"value_str",hash:{},data:i}):a))+'</h4>\n  </div>\n  <div id="modifier'+u((a=e.id||t&&t.id,typeof a===s?a.call(t,{name:"id",hash:{},data:i}):a))+'" class="collapse in">\n    ',r=e["if"].call(t,t&&t.note,{name:"if",hash:{},fn:this.program(5,i),inverse:this.noop,data:i}),(r||0===r)&&(l+=r),l+'\n    <div class="panel-footer">\n      '+u((r=t&&t.user,r=null==r||r===!1?r:r.name,typeof r===s?r.apply(t):r))+" at "+u((a=e.datefmt||t&&t.datefmt||o,a.call(t,t&&t.timestamp,{name:"datefmt",hash:{},data:i})))+" "+u((a=e.timefmt||t&&t.timefmt||o,a.call(t,t&&t.timestamp,{name:"timefmt",hash:{},data:i})))+"\n    </div>\n  </div>\n</div>\n"},useData:!0}),e.voided_modifier=t({compiler:[5,">= 2.0.0"],main:function(t,e,n,i){var r,a,o="function",s=this.escapeExpression,u=e.helperMissing;return'<div class="panel panel-default">\n  <div class="panel-heading" data-toggle="collapse" data-target="#modifier'+s((a=e.id||t&&t.id,typeof a===o?a.call(t,{name:"id",hash:{},data:i}):a))+'">\n    <del><h4 class="panel-title">'+s((a=e.value_str||t&&t.value_str,typeof a===o?a.call(t,{name:"value_str",hash:{},data:i}):a))+'</h4></del>\n  </div>\n  <div id="modifier'+s((a=e.id||t&&t.id,typeof a===o?a.call(t,{name:"id",hash:{},data:i}):a))+'" class="collapse">\n    <div class="panel-body">\n      <del>\n        '+s((a=e.note||t&&t.note,typeof a===o?a.call(t,{name:"note",hash:{},data:i}):a))+" (voided by "+s((r=t&&t["void"],r=null==r||r===!1?r:r.user,r=null==r||r===!1?r:r.name,typeof r===o?r.apply(t):r))+" at "+s((a=e.datefmt||t&&t.datefmt||u,a.call(t,(r=t&&t["void"],null==r||r===!1?r:r.timestamp),{name:"datefmt",hash:{},data:i})))+" "+s((a=e.timefmt||t&&t.timefmt||u,a.call(t,(r=t&&t["void"],null==r||r===!1?r:r.timestamp),{name:"timefmt",hash:{},data:i})))+')\n      </del>\n    </div>\n    <div class="panel-footer">\n      '+s((r=t&&t.user,r=null==r||r===!1?r:r.name,typeof r===o?r.apply(t):r))+" at "+s((a=e.timefmt||t&&t.timefmt||u,a.call(t,t&&t.timestamp,{name:"timefmt",hash:{},data:i})))+" "+s((a=e.datefmt||t&&t.datefmt||u,a.call(t,t&&t.timestamp,{name:"datefmt",hash:{},data:i})))+"\n    </div>\n  </div>\n</div>\n"},useData:!0})}();
//# sourceMappingURL=evesrp.min.js.map