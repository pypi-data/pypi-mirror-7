<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Getting Started &mdash; BatchOpenMPI 0.2.2 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.2.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="BatchOpenMPI 0.2.2 documentation" href="index.html" />
    <link rel="prev" title="Welcome to BatchOpenMPI’s documentation!" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="index.html" title="Welcome to BatchOpenMPI’s documentation!"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">BatchOpenMPI 0.2.2 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="getting-started">
<h1>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h1>
<p>batchOpenMPI requires mpi4py which in turn requires <a class="reference external" href="http://mpi4py.scipy.org/">mpi4py</a>.
Once these are installed, you are good to go.</p>
<p>The way batchOpenMPI works is as follows</p>
<ul class="simple">
<li>all processes run the script up until the <strong>batchOpenMPI.begin_MPI_loop()</strong> call. Afterwhithe master process continue processing the script, while the worker processes wait for jobs from the master.</li>
<li>jobs are managed using <strong>batchOpenMPI.batchFunction</strong> wrapper, which has the <strong>addtoBatch</strong> method. When addtoBatch is called on the master process, a job is created, which is later excuted on a worker process when the <strong>batchOpenMPI.processBatch()</strong> is called.</li>
<li>when a <strong>batchOpenMPI.batchFunction</strong> is called on the master process, the batch processing results are checked against the requested input. If the input has been processed the already processed result is returned, otherwise the output is calculated on the master. Calculating on the master is not ideal, but occasionally is unavoidable.</li>
</ul>
<p>Basic example script (<em>ex1.py</em>):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">batchOpenMPI</span>
<span class="k">def</span> <span class="nf">f_inv_org</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">:</span> 
    <span class="s">&quot;function returns the inverse of a number&quot;</span>
    <span class="k">return</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">x</span>
<span class="n">f_inv</span> <span class="o">=</span> <span class="n">batchOpenMPI</span><span class="o">.</span><span class="n">batchFunction</span><span class="p">(</span><span class="n">f_inv_org</span><span class="p">,</span> <span class="n">permissible_exceptions</span> <span class="o">=</span> <span class="p">[</span><span class="ne">ZeroDivisionError</span><span class="p">])</span> <span class="c">#creating function wrapper</span>

<span class="n">batchOpenMPI</span><span class="o">.</span><span class="n">begin_MPI_loop</span><span class="p">()</span> <span class="c"># both the workers and the master process run the same code up until here</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;this example script prints in the inverse of the integers from 0 to 9&#39;</span><span class="p">)</span>
<span class="n">no</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c"># creates [0,1,2,3,4,5,6,7,8,9]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">no</span> <span class="p">:</span><span class="c"># adding all f_inv input and queing them for parallel processing</span>
    <span class="n">f_inv</span><span class="o">.</span><span class="n">addtoBatch</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="n">batchOpenMPI</span><span class="o">.</span><span class="n">processBatch</span><span class="p">()</span> <span class="c">#get the workers to calculate all the inputs</span>
<span class="n">res</span> <span class="o">=</span> <span class="p">[]</span> <span class="c">#used for storing results</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">no</span> <span class="p">:</span>
    <span class="k">try</span> <span class="p">:</span>
        <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f_inv</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">ZeroDivisionError</span> <span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;couldn&#39;t inverse &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; due to 0 division error&quot;</span><span class="p">)</span> 
<span class="k">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>

<span class="n">batchOpenMPI</span><span class="o">.</span><span class="n">end_MPI_loop</span><span class="p">(</span><span class="n">print_stats</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c">#release workers, and print stats</span>
</pre></div>
</div>
<p>Which is can be run on Linux as follows</p>
<div class="highlight-python"><div class="highlight"><pre>$ mpirun -np 4 python ex1.py
</pre></div>
</div>
<p>The <strong>batchOpenMPI.end_MPI_loop</strong> call because of the <em>print_stats=True</em> should produce an output similar to</p>
<div class="highlight-python"><div class="highlight"><pre>--------- batchOpenMPI Stats ---------
process    jobs completed      time: uW/ sR/ wI* (s)    utilisation(%)
   1              1            0.00/    0.00/    0.00       33.88
   2              5            0.00/    0.00/    0.00        0.78
   3              4            0.00/    0.00/    0.00        0.56
   * time doing; uW - useful work, sR - sending results, wI - waiting for instructions, Total
  time running master (s) :             0.003
  total CPU time (s) :                  0.011
  total CPU time actually used (s) :    0.002
  overall utilization : 21.85 %
function stats :
- solved on master  [0]
- solved on workers [10]
- jobs uncollected  [0]
- jobs dropped      [0]
</pre></div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Welcome to BatchOpenMPI&#8217;s documentation!</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/gettingStarted.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="index.html" title="Welcome to BatchOpenMPI’s documentation!"
             >previous</a> |</li>
        <li><a href="index.html">BatchOpenMPI 0.2.2 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2009, Antoine Dymond.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>