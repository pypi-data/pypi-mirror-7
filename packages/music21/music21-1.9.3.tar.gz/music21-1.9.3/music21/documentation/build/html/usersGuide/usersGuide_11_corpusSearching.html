
<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>User’s Guide: Chapter 11: Corpus Searching &mdash; music21 Documentation</title>
    
    <link rel="stylesheet" href="../_static/m21.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.9.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <link rel="top" title="music21 Documentation" href="../index.html" />
    <link rel="up" title="Users Guide" href="index.html" />
    <link rel="next" title="User’s Guide: Chapter 14: Time Signatures" href="usersGuide_14_timeSignatures.html" />
    <link rel="prev" title="User’s Guide: Chapter 9: Chordify" href="usersGuide_09_chordify.html" /><link href='http://fonts.googleapis.com/css?family=Source+Code+Pro|Open+Sans:300italic,400italic,700italic,400,300,700' rel='stylesheet' type='text/css'>
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="usersGuide_14_timeSignatures.html" title="User’s Guide: Chapter 14: Time Signatures"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="usersGuide_09_chordify.html" title="User’s Guide: Chapter 9: Chordify"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">music21</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Users Guide</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="usersGuide_09_chordify.html"
                        title="previous chapter">User&#8217;s Guide: Chapter 9: Chordify</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="usersGuide_14_timeSignatures.html"
                        title="next chapter">User&#8217;s Guide: Chapter 14: Time Signatures</a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">User&#8217;s Guide: Chapter 11: Corpus Searching</a><ul>
<li><a class="reference internal" href="#types-of-corpora">Types of corpora</a></li>
<li><a class="reference internal" href="#creating-local-corpora">Creating local corpora</a></li>
<li><a class="reference internal" href="#simple-searches-of-the-corpus">Simple searches of the corpus</a></li>
<li><a class="reference internal" href="#metadata-search-fields">Metadata search fields</a></li>
<li><a class="reference internal" href="#inspecting-metadata-bundle-search-results">Inspecting metadata bundle search results</a></li>
<li><a class="reference internal" href="#manipulating-multiple-metadata-bundles">Manipulating multiple metadata bundles</a></li>
<li><a class="reference internal" href="#getting-a-metadata-bundle">Getting a metadata bundle</a></li>
<li><a class="reference internal" href="#creating-persistent-metadata-bundles">Creating persistent metadata bundles</a></li>
</ul>
</li>
</ul>

<h3><a href="../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../about/index.html">About Music21</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview/index.html">Music21 Concepts Overview</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installing/index.html">Installation</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Users Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="usersGuide_99_Table_of_Contents.html">User&#8217;s Guide, Table of Contents</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_00_introduction.html">User&#8217;s Guide: Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_01_installing.html">User&#8217;s Guide, Chapter 1: Installing and Getting Started with <tt class="docutils literal"><span class="pre">music21</span></tt></a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_02_notes.html">User&#8217;s Guide, Chapter 2: Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_03_pitches.html">User&#8217;s Guide, Chapter 3: Pitches, Durations, and Notes again</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_04_stream1.html">User&#8217;s Guide, Chapter 4: Lists, Streams (I) and Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_05_listsOfLists.html">User&#8217;s Guide, Chapter 5: Lists of Lists, Functions, and Recursion</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_06_stream2.html">User&#8217;s Guide, Chapter 6: Streams (II): Hierarchies, Recursion, and Flattening</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_07_chords.html">User&#8217;s Guide, Chapter 7: Chords</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_09_chordify.html">User&#8217;s Guide: Chapter 9: Chordify</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">User&#8217;s Guide: Chapter 11: Corpus Searching</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_14_timeSignatures.html">User&#8217;s Guide: Chapter 14: Time Signatures</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_17_derivations.html">User&#8217;s Guide: Chapter 17: Derivations</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_54_extendingConverter.html">User&#8217;s Guide: Chapter 54: Extending Converter with New Formats</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../systemReference/index.html">System Reference</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../moduleReference/index.html">Module Reference</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../developerReference/index.html">Developer Reference</a></li>
</ul>

<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/usersGuide/usersGuide_11_corpusSearching.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="user-s-guide-chapter-11-corpus-searching">
<span id="usersguide-11-corpussearching"></span><h1>User&#8217;s Guide: Chapter 11: Corpus Searching<a class="headerlink" href="#user-s-guide-chapter-11-corpus-searching" title="Permalink to this headline">¶</a></h1>
<p>One of music21&#8217;s important features is its capability to help users examine
large bodies of musical works, or <em>corpora</em>.</p>
<p>Music21 comes with a substantial corpus called the <em>core</em> corpus. When you
download music21 you can immediately start working with the files in the
corpus directory, including the complete chorales of Bach, many Haydn and
Beethoven string quartets, three books of madrigals by Monteverdi, thousands
of folk songs from the Essen and various ABC databases, and many more.</p>
<p>To load a file from the corpus, simply call <em>corpus.parse</em> and assign that
file to a variable:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">music21</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bach</span> <span class="o">=</span> <span class="n">corpus</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s">&#39;bach/bwv66.6&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Users can also build their own corpora to index and quickly search their own
collections on disk.  Version 1.7 of music21 introduces the ability to have
multiple local corpora that can be accessed individually.</p>
<p>This user&#8217;s guide will cover more about the corpus&#8217;s basic features soon.  This
chapter focuses on music21&#8217;s tools for extracting useful metadata - titles,
locations, composers names, the key signatures used in each piece, total
durations, ambitus (range) and so forth.</p>
<p>This metadata is collected in <em>metadata bundles</em> for each corpus. The <em>corpus</em>
module has tools to search these bundles and persist them disk for later
research.</p>
<div class="section" id="types-of-corpora">
<h2>Types of corpora<a class="headerlink" href="#types-of-corpora" title="Permalink to this headline">¶</a></h2>
<p>Music21 works with three categories of <em>corpora</em>, made explicit via the
<tt class="docutils literal"><span class="pre">corpus.Corpus</span></tt> abstract class.</p>
<p>The first category is the <em>core</em> corpus, a large collection of musical works
packaged with most music21 installations, including many works from the common
practice era, and inumerable folk songs, in a variety of formats:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">coreCorpus</span> <span class="o">=</span> <span class="n">corpus</span><span class="o">.</span><span class="n">CoreCorpus</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">coreCorpus</span><span class="o">.</span><span class="n">getPaths</span><span class="p">())</span>
<span class="go">3045</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If you&#8217;ve installed a &#8220;no corpus&#8221; version of music21, you can still access
the <em>core</em> corpus with a little work.  Download the <em>core</em> corpus from
music21&#8217;s website, and install it on your system somewhere. Then, teach
music21 where you installed it like this:</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">coreCorpus</span> <span class="o">=</span> <span class="n">corpus</span><span class="o">.</span><span class="n">CoreCorpus</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">coreCorpus</span><span class="o">.</span><span class="n">manualCoreCorpusPath</span> <span class="o">=</span> <span class="s">&#39;path/to/core/corpus&#39;</span>
</pre></div>
</div>
</div>
<p>Music21 also has the notion of a <em>virtual</em> corpus: a collection of musical
works to be found at various locations online which, for reasons of licensing,
haven&#8217;t been included in the <em>core</em> corpus:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">virtualCorpus</span> <span class="o">=</span> <span class="n">corpus</span><span class="o">.</span><span class="n">VirtualCorpus</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">virtualCorpus</span><span class="o">.</span><span class="n">getPaths</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">&#39;http://kern.ccarh.org/cgi-bin/ksdata?l=cc/bach/cello&amp;file=bwv1007-01.krn&amp;f=xml&#39;</span>
</pre></div>
</div>
<p>Finally, music21 allows for <em>local</em> corpora: bodies of works provided and
configured by individual music21 users for their own research. <em>Local</em> corpora
behave identically to the <em>core</em> and <em>virtual</em> corpora, and can be searched and
cached in the same manner:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">localCorpus</span> <span class="o">=</span> <span class="n">corpus</span><span class="o">.</span><span class="n">LocalCorpus</span><span class="p">()</span>
</pre></div>
</div>
<p>You can add and remove paths from a <em>local</em> corpus with the <tt class="docutils literal"><span class="pre">addPath()</span></tt> and
<tt class="docutils literal"><span class="pre">removePath()</span></tt> methods:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">localCorpus</span><span class="o">.</span><span class="n">addPath</span><span class="p">(</span><span class="s">&#39;~/Desktop&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">localCorpus</span><span class="o">.</span><span class="n">directoryPaths</span>
<span class="go">(&#39;/Users/josiah/Desktop&#39;,)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">localCorpus</span><span class="o">.</span><span class="n">removePath</span><span class="p">(</span><span class="s">&#39;~/Desktop&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>By default, a call to <tt class="docutils literal"><span class="pre">corpus.parse</span></tt> or <tt class="docutils literal"><span class="pre">corpus.search</span></tt> will look for
files in any corpus, core, local, or virtual.</p>
</div>
<div class="section" id="creating-local-corpora">
<h2>Creating local corpora<a class="headerlink" href="#creating-local-corpora" title="Permalink to this headline">¶</a></h2>
<p>In addition to the default local corpus, music21 allows users to create
and save as many named local corpora as they like, which will persist from
session to session.</p>
<p>Let&#8217;s create a new <em>local</em> corpus, give it a directory to find music files in,
and then save it:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">aNewLocalCorpus</span> <span class="o">=</span> <span class="n">corpus</span><span class="o">.</span><span class="n">LocalCorpus</span><span class="p">(</span><span class="s">u&#39;A new corpus&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">aNewLocalCorpus</span><span class="o">.</span><span class="n">existsInSettings</span>
<span class="go">False</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">aNewLocalCorpus</span><span class="o">.</span><span class="n">addPath</span><span class="p">(</span><span class="s">&#39;~/Desktop&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">aNewLocalCorpus</span><span class="o">.</span><span class="n">directoryPaths</span>
<span class="go">(&#39;/Users/josiah/Desktop&#39;,)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">aNewLocalCorpus</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">aNewLocalCorpus</span><span class="o">.</span><span class="n">existsInSettings</span>
<span class="go">True</span>
</pre></div>
</div>
<p>We can see that our new <em>local</em> corpus is saved by checking for the names of
all saved <em>local</em> corpora:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">corpus</span><span class="o">.</span><span class="n">LocalCorpus</span><span class="o">.</span><span class="n">listLocalCorporaNames</span><span class="p">()</span>
<span class="go">[None, u&#39;trecento&#39;, u&#39;A new corpus&#39;, u&#39;bach&#39;, u&#39;fake&#39;]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When running <tt class="docutils literal"><span class="pre">listLocalCorporaNames()</span></tt>, you will see <tt class="docutils literal"><span class="pre">None</span></tt> -
indicating the default <em>local</em> corpus - along with the names of any
non-default <em>local</em> corpora you&#8217;ve manually created yourself. In the above
example, a number of other corpora have already been created.</p>
</div>
<p>Finally, we can delete the <em>local</em> corpus we previously created like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">aNewLocalCorpus</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">aNewLocalCorpus</span><span class="o">.</span><span class="n">existsInSettings</span>
<span class="go">False</span>
</pre></div>
</div>
</div>
<div class="section" id="simple-searches-of-the-corpus">
<h2>Simple searches of the corpus<a class="headerlink" href="#simple-searches-of-the-corpus" title="Permalink to this headline">¶</a></h2>
<p>When you search the corpus, music21 examines each metadata object in the
metadata bundle for the whole corpus and attempts to match your search string
against the contents of
the various search fields saved in that metadata object.</p>
<p>You can use <tt class="docutils literal"><span class="pre">corpus.search()</span></tt> to search the metadata associated with all
known corpora, <em>core</em>, <em>virtual</em> and even each <em>local</em> corpus:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">sixEight</span> <span class="o">=</span> <span class="n">corpus</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;6/8&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sixEight</span>
<span class="go">&lt;music21.metadata.bundles.MetadataBundle {2211 entries}&gt;</span>
</pre></div>
</div>
<p>To work with these 2211 pieces, you can parse treat the MetadataBundle
like a list and call <tt class="docutils literal"><span class="pre">.parse()</span></tt> on any element:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">myPiece</span> <span class="o">=</span> <span class="n">sixEight</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">parse</span><span class="p">()</span>
</pre></div>
</div>
<p>This will return a <tt class="docutils literal"><span class="pre">music21.stream.Score</span></tt> object which you can work
with like any other stream. Or if you just want to see it, there&#8217;s a
convenience <tt class="docutils literal"><span class="pre">.show()</span></tt> method you can call directly on a MetadataEntry.</p>
<p>You can also search against a single <tt class="docutils literal"><span class="pre">Corpus</span></tt> instance, like this one
which ignores anything in your local corpus:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">corpus</span><span class="o">.</span><span class="n">CoreCorpus</span><span class="p">()</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;6/8&#39;</span><span class="p">)</span>
<span class="go">&lt;music21.metadata.bundles.MetadataBundle {2211 entries}&gt;</span>
</pre></div>
</div>
<p>Because the result of every metadata search is also a metadata bundle, you can
search your search results to do more complex searches.  Remember that
bachBundle is a collection of all works where the composer is Bach.  Here we
will limit to those pieces in 3/4 time:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">bachBundle</span> <span class="o">=</span> <span class="n">corpus</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;bach&#39;</span><span class="p">,</span> <span class="s">&#39;composer&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bachBundle</span>
<span class="go">&lt;music21.metadata.bundles.MetadataBundle {21 entries}&gt;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">bachBundle</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;3/4&#39;</span><span class="p">)</span>
<span class="go">&lt;music21.metadata.bundles.MetadataBundle {4 entries}&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>There are actually many more pieces by Bach in the music21 corpus,
but many of them are without the metadata specifying him as a
composer; his name is only in the filename. To get all the pieces
by Bach use:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">allBach</span> <span class="o">=</span> <span class="n">corpus</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;bach&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p class="last">This will search filenames as well.  We will aim to get more complete
metadata in the core corpus in the near future, and would appreciate
community help to achieve this goal.</p>
</div>
</div>
<div class="section" id="metadata-search-fields">
<h2>Metadata search fields<a class="headerlink" href="#metadata-search-fields" title="Permalink to this headline">¶</a></h2>
<p>When you search metadata bundles, you can search either through every search
field in every metadata instance, or through a single, specific search field.
As we mentioned above, searching for &#8220;bach&#8221; as a composer renders different
results from searching for the word &#8220;bach&#8221; in general:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">corpus</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;bach&#39;</span><span class="p">,</span> <span class="s">&#39;composer&#39;</span><span class="p">)</span>
<span class="go">&lt;music21.metadata.bundles.MetadataBundle {21 entries}&gt;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">corpus</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;bach&#39;</span><span class="p">,</span> <span class="s">&#39;title&#39;</span><span class="p">)</span>
<span class="go">&lt;music21.metadata.bundles.MetadataBundle {20 entries}&gt;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">corpus</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;bach&#39;</span><span class="p">)</span>
<span class="go">&lt;music21.metadata.bundles.MetadataBundle {150 entries}&gt;</span>
</pre></div>
</div>
<p>So what fields can we actually search through? You can find out like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">corpus</span><span class="o">.</span><span class="n">Corpus</span><span class="o">.</span><span class="n">listSearchFields</span><span class="p">():</span>
<span class="gp">... </span>    <span class="n">field</span>
<span class="gp">...</span>
<span class="go">&#39;alternativeTitle&#39;</span>
<span class="go">&#39;ambitus&#39;</span>
<span class="go">&#39;composer&#39;</span>
<span class="go">&#39;date&#39;</span>
<span class="go">&#39;keySignatureFirst&#39;</span>
<span class="go">&#39;keySignatures&#39;</span>
<span class="go">&#39;localeOfComposition&#39;</span>
<span class="go">&#39;movementName&#39;</span>
<span class="go">&#39;movementNumber&#39;</span>
<span class="go">&#39;noteCount&#39;</span>
<span class="go">&#39;number&#39;</span>
<span class="go">&#39;opusNumber&#39;</span>
<span class="go">&#39;pitchHighest&#39;</span>
<span class="go">&#39;pitchLowest&#39;</span>
<span class="go">&#39;quarterLength&#39;</span>
<span class="go">&#39;tempoFirst&#39;</span>
<span class="go">&#39;tempos&#39;</span>
<span class="go">&#39;timeSignatureFirst&#39;</span>
<span class="go">&#39;timeSignatures&#39;</span>
<span class="go">&#39;title&#39;</span>
</pre></div>
</div>
<p>This field will grow in the near future now that the development team is seeing
how useful this searching method can be! Now that we know what all the search
fields are, we can search through some of the more obscure corners of the
<em>core</em> corpus:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">corpus</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;taiwan&#39;</span><span class="p">,</span> <span class="s">&#39;locale&#39;</span><span class="p">)</span>
<span class="go">&lt;music21.metadata.bundles.MetadataBundle {27 entries}&gt;</span>
</pre></div>
</div>
<p>What if you are not searching for an exact match?  If you&#8217;re searching for
short pieces, you probably don&#8217;t want to find pieces with exactly 1 note then
union that set with pieces with exactly 2 notes, etc.  Or for pieces from the
19th century, you won&#8217;t want to search for 1801, 1802, etc.  What you can do is
set up a &#8220;predicate callable&#8221; which is a function (either a full python <tt class="docutils literal"><span class="pre">def</span></tt>
statement or a short <tt class="docutils literal"><span class="pre">lambda</span></tt> function) to filter the results.  Each piece
will be checked against your predicate and only those that return true.  Here
we&#8217;ll search for pieces with between 400 and 500 notes, only in the <tt class="docutils literal"><span class="pre">core</span></tt>
corpus:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">predicate</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">400</span> <span class="o">&lt;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">500</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">corpus</span><span class="o">.</span><span class="n">CoreCorpus</span><span class="p">()</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">predicate</span><span class="p">,</span> <span class="s">&#39;noteCount&#39;</span><span class="p">)</span>
<span class="go">&lt;music21.metadata.bundles.MetadataBundle {60 entries}&gt;</span>
</pre></div>
</div>
<p>You can also pass in compiled regular expressions into the search:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">re</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">haydnOrHandel</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&#39;ha.d.*&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bundle</span> <span class="o">=</span> <span class="n">corpus</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">haydnOrHandel</span><span class="p">)</span>
</pre></div>
</div>
<p>Though what you mostly get are Shandys.  Best to use a <em>^</em> to match
at the beginning of the word next time.</p>
</div>
<div class="section" id="inspecting-metadata-bundle-search-results">
<h2>Inspecting metadata bundle search results<a class="headerlink" href="#inspecting-metadata-bundle-search-results" title="Permalink to this headline">¶</a></h2>
<p>Now let&#8217;s take a closer look at some search results:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">bachBundle</span> <span class="o">=</span> <span class="n">corpus</span><span class="o">.</span><span class="n">CoreCorpus</span><span class="p">()</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;bach&#39;</span><span class="p">,</span> <span class="s">&#39;composer&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bachBundle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">&lt;music21.metadata.bundles.MetadataEntry: bach_choraleAnalyses_riemenschneider014_rntxt&gt;</span>
</pre></div>
</div>
<p>Metadata bundles are composed of metadata <em>entries</em>. These <em>entries</em> allow us
to associate a given <tt class="docutils literal"><span class="pre">RichMetadata</span></tt> object with a file name, and as we said earlier
also allow us to parse the associated file into a music21 score:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">bachBundle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sourcePath</span>
<span class="go">u&#39;bach/choraleAnalyses/riemenschneider014.rntxt&#39;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">bachBundle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">metadataPayload</span>
<span class="go">&lt;music21.metadata.RichMetadata object at 0x...&gt;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">bachBundle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">parse</span><span class="p">()</span>
<span class="go">&lt;music21.stream.Score ...&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="manipulating-multiple-metadata-bundles">
<h2>Manipulating multiple metadata bundles<a class="headerlink" href="#manipulating-multiple-metadata-bundles" title="Permalink to this headline">¶</a></h2>
<p>Another useful feature of music21&#8217;s metadata bundles is that they can be
operated on as though they were sets, allowing you to union, intersect and
difference multiple metadata bundles, thereby creating more complex search
results:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">beethovenBundle</span> <span class="o">=</span> <span class="n">corpus</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;beethoven&#39;</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s">&#39;composer&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">beethovenBundle</span>
<span class="go">&lt;music21.metadata.bundles.MetadataBundle {16 entries}&gt;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">bachBundle</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">beethovenBundle</span><span class="p">)</span>
<span class="go">&lt;music21.metadata.bundles.MetadataBundle {37 entries}&gt;</span>
</pre></div>
</div>
<p>Consult <a class="reference internal" href="../moduleReference/moduleMetadataBundles.html#music21.metadata.bundles.MetadataBundle" title="music21.metadata.bundles.MetadataBundle"><tt class="xref py py-class docutils literal"><span class="pre">MetadataBundle</span></tt></a>&#8216;s API for a more
in depth look at how this works.</p>
</div>
<div class="section" id="getting-a-metadata-bundle">
<h2>Getting a metadata bundle<a class="headerlink" href="#getting-a-metadata-bundle" title="Permalink to this headline">¶</a></h2>
<p>In music21, metadata is information <em>about</em> a score, such as its composer,
title, initial key signature or ambitus. A metadata <em>bundle</em> is a collection of
metadata pulled from an arbitrarily large group of different scores. Users can
search through metadata bundles to find scores with certain qualities, such as
all scores in a given corpus with a time signature of <tt class="docutils literal"><span class="pre">6/8</span></tt>, or all scores
composed by Monteverdi.</p>
<p>There are a number of different ways to acquire a metadata bundle.  The easiest way
to get the metadataBundle for the core corpus is simply to download music21: we
include a pre-made metadataBundle (in <tt class="docutils literal"><span class="pre">corpus/metadataCache/core.json</span></tt>) so
that this step is unnecessary for the core corpus unless you&#8217;re contributing to
the project.  But you may want to create metadata bundles for your own local corpora.
Access the <tt class="docutils literal"><span class="pre">metadataBundle</span></tt> attribute of any <tt class="docutils literal"><span class="pre">Corpus</span></tt> instance to get its
corresponding metadata bundle:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">coreCorpus</span> <span class="o">=</span> <span class="n">corpus</span><span class="o">.</span><span class="n">CoreCorpus</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">coreCorpus</span><span class="o">.</span><span class="n">metadataBundle</span>
<span class="go">&lt;music21.metadata.bundles.MetadataBundle &#39;core&#39;: {14958 entries}&gt;</span>
</pre></div>
</div>
<p>Music21 also provides a handful of convenience methods for getting metadata
bundles associated with the <em>virtual</em>, <em>local</em> or <em>core</em> corpora:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">coreBundle</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">MetadataBundle</span><span class="o">.</span><span class="n">fromCoreCorpus</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">localBundle</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">MetadataBundle</span><span class="o">.</span><span class="n">fromLocalCorpus</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">otherLocalBundle</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">MetadataBundle</span><span class="o">.</span><span class="n">fromLocalCorpus</span><span class="p">(</span><span class="s">&#39;blah&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">virtualBundle</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">MetadataBundle</span><span class="o">.</span><span class="n">fromVirtualCorpus</span><span class="p">()</span>
</pre></div>
</div>
<p>We strongly recommend using the above <tt class="docutils literal"><span class="pre">from*()</span></tt> methods. Some of these
metadata bundles can become quite large, and methods like <tt class="docutils literal"><span class="pre">fromCoreCorpus()</span></tt>
will cache the metadata bundle in memory once it has been read from disk,
potentially saving you a lot of time.</p>
<p>Advanced users can also make metadata bundles manually, by passing in the name of the
corpus you want the bundle to refer to, or an actual <tt class="docutils literal"><span class="pre">Corpus</span></tt> instance
itself:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">coreBundle</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">MetadataBundle</span><span class="p">(</span><span class="s">&#39;core&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">coreBundle</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">MetadataBundle</span><span class="p">(</span><span class="n">corpus</span><span class="o">.</span><span class="n">CoreCorpus</span><span class="p">())</span>
</pre></div>
</div>
<p>However, you&#8217;ll need to read the bundle&#8217;s saved data from disk before you can
do anything useful with the bundle. Bundles don&#8217;t read their associated JSON
files automatically when they&#8217;re manually instantiated.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">coreBundle</span>
<span class="go">&lt;music21.metadata.bundles.MetadataBundle &#39;core&#39;: {0 entries}&gt;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">coreBundle</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="go">&lt;music21.metadata.bundles.MetadataBundle &#39;core&#39;: {14958 entries}&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-persistent-metadata-bundles">
<h2>Creating persistent metadata bundles<a class="headerlink" href="#creating-persistent-metadata-bundles" title="Permalink to this headline">¶</a></h2>
<p>Metadata bundles can be written to and read from disk.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">coreBundle</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">MetadataBundle</span><span class="p">(</span><span class="s">&#39;core&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">coreBundle</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="go">    &lt;music21.metadata.bundles.MetadataBundle &#39;core&#39;: {14958 entries}&gt;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">coreBundle</span><span class="o">.</span><span class="n">write</span><span class="p">()</span>
</pre></div>
</div>
<p>They can also be completely rebuilt, as you will want to do for local
corpora. To add information to a bundle, use the <tt class="docutils literal"><span class="pre">addFromPaths()</span></tt> method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">newBundle</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">MetadataBundle</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">paths</span> <span class="o">=</span> <span class="n">corpus</span><span class="o">.</span><span class="n">CoreCorpus</span><span class="p">()</span><span class="o">.</span><span class="n">getBachChorales</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">failedPaths</span> <span class="o">=</span> <span class="n">newBundle</span><span class="o">.</span><span class="n">addFromPaths</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">failedPaths</span>
<span class="go">[]</span>
</pre></div>
</div>
<p>then call <tt class="docutils literal"><span class="pre">.write()</span></tt> to save to disk.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">newBundle</span>
<span class="go">&lt;music21.metadata.bundles.MetadataBundle {402 entries}&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Building metadata information can be an incredibly intensive process. For
example, building the <em>core</em> metadata bundle can easily take as long as an
hour! Please use caution, and be patient, when building metadata bundles
from large corpora. To monitor the corpus-building progress, make sure to
set &#8216;debug&#8217; to True in your user settings:</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">environment</span><span class="o">.</span><span class="n">UserSettings</span><span class="p">()[</span><span class="s">&#39;debug&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
</pre></div>
</div>
</div>
<p>You can delete, rebuild and save a metadata bundle in one go with the
<tt class="docutils literal"><span class="pre">rebuild()</span></tt> method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">virtualBundle</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">MetadataBundle</span><span class="o">.</span><span class="n">fromVirtualCorpus</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">virtualBundle</span><span class="o">.</span><span class="n">rebuild</span><span class="p">()</span>
</pre></div>
</div>
<p>The process of rebuilding will store the file as it goes so at the end there is
no need to call <tt class="docutils literal"><span class="pre">.write()</span></tt>.</p>
<p>To delete a metadata bundle&#8217;s cached-to-disk JSON file, use the <tt class="docutils literal"><span class="pre">delete()</span></tt>
method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">virtualBundle</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</pre></div>
</div>
<p>Deleting a metadata bundle&#8217;s JSON file won&#8217;t empty the in-memory contents of
that bundle. For that, use <tt class="docutils literal"><span class="pre">clear()</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">virtualBundle</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="usersGuide_14_timeSignatures.html" title="User’s Guide: Chapter 14: Time Signatures"
             >next</a> |</li>
        <li class="right" >
          <a href="usersGuide_09_chordify.html" title="User’s Guide: Chapter 9: Chordify"
             >previous</a> |</li>
        <li><a href="../index.html">music21</a> &raquo;</li>
          <li><a href="index.html" >Users Guide</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2008-2013, Michael Scott Cuthbert and the music21 Project.
      Last updated on Jun 25, 2014.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>