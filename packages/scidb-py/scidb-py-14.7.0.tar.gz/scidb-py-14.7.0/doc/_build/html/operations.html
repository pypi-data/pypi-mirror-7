

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Operations on SciDB array objects &mdash; SciDB-Py 14.7.0 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="SciDB-Py 14.7.0 documentation" href="index.html"/>
        <link rel="up" title="Basic Use" href="tutorial.html"/>
        <link rel="next" title="Comparing and Filtering Arrays" href="comparison_and_filtering.html"/>
        <link rel="prev" title="Accessing array data" href="access.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="index.html" class="fa fa-home"> SciDB-Py</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installing SciDB-Py</a><ul>
<li class="toctree-l2"><a class="reference internal" href="install.html#software-prerequisites">Software prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#python-prerequisites">Python Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#scidb-py-package-installation">SciDB-Py Package Installation</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="tutorial.html">Basic Use</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="connection.html">Introduction to SciDB arrays</a></li>
<li class="toctree-l2"><a class="reference internal" href="connection.html#loading-the-scidbpy-package-and-connecting-to-scidb">Loading the scidbpy package and connecting to SciDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="creation.html">Creating arrays</a></li>
<li class="toctree-l2"><a class="reference internal" href="access.html">Accessing array data</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Operations on SciDB array objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="comparison_and_filtering.html">Comparing and Filtering Arrays</a></li>
<li class="toctree-l2"><a class="reference internal" href="query.html">The SciDB Query Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="conversion.html">Downloading SciDBArrays</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="demos.html">Demos and Other Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="classes.html">Class Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="afl.html">AFL Operator Reference</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">SciDB-Py</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
          <li><a href="tutorial.html">Basic Use</a> &raquo;</li>
      
    <li>Operations on SciDB array objects</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="_sources/operations.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="operations-on-scidb-array-objects">
<h1>Operations on SciDB array objects<a class="headerlink" href="#operations-on-scidb-array-objects" title="Permalink to this headline">¶</a></h1>
<p>Operations on <a class="reference internal" href="classes.html#scidbpy.SciDBArray" title="scidbpy.SciDBArray"><tt class="xref py py-class docutils literal"><span class="pre">SciDBArray</span></tt></a> objects generally return new
<a class="reference internal" href="classes.html#scidbpy.SciDBArray" title="scidbpy.SciDBArray"><tt class="xref py py-class docutils literal"><span class="pre">SciDBArray</span></tt></a> objects.
The general idea is to promote function composition involving
<a class="reference internal" href="classes.html#scidbpy.SciDBArray" title="scidbpy.SciDBArray"><tt class="xref py py-class docutils literal"><span class="pre">SciDBArray</span></tt></a> objects without moving data between SciDB and Python.</p>
<p>The <tt class="docutils literal"><span class="pre">scidbpy</span></tt> package provides quite a few common operations including
subsetting, pointwise application of scalar functions, aggregations, and
pointwise and matrix arithmetic.</p>
<p>Standard numpy attributes like <tt class="docutils literal"><span class="pre">shape</span></tt>, <tt class="docutils literal"><span class="pre">ndim</span></tt> and <tt class="docutils literal"><span class="pre">size</span></tt> are defined for
<a class="reference internal" href="classes.html#scidbpy.SciDBArray" title="scidbpy.SciDBArray"><tt class="xref py py-class docutils literal"><span class="pre">SciDBArray</span></tt></a> objects:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">X</span> <span class="o">=</span> <span class="n">sdb</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">X</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(5, 10)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">X</span><span class="o">.</span><span class="n">size</span>
<span class="go">50</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">X</span><span class="o">.</span><span class="n">ndim</span>
<span class="go">2</span>
</pre></div>
</div>
<p>Many SciDB-specific attributes are also defined,
including <tt class="docutils literal"><span class="pre">chunk_size</span></tt>, <tt class="docutils literal"><span class="pre">chunk_overlap</span></tt>, and <tt class="docutils literal"><span class="pre">sdbtype</span></tt>,</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">X</span><span class="o">.</span><span class="n">chunk_size</span>
<span class="go">[1000, 1000]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">X</span><span class="o">.</span><span class="n">chunk_overlap</span>
<span class="go">[0, 0]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">X</span><span class="o">.</span><span class="n">sdbtype</span>
<span class="go">sdbtype(&#39;&lt;f0:double&gt;&#39;)</span>
</pre></div>
</div>
<p>SciDBArrays also contain a <tt class="docutils literal"><span class="pre">datashape</span></tt> object, which encapsulates much of the
interface between Python and SciDB data, including the full array schema:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Xds</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">datashape</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Xds</span><span class="o">.</span><span class="n">schema</span>
<span class="go">&#39;&lt;f0:double&gt; [i0=0:4,1000,0,i1=0:9,1000,0]&#39;</span>
</pre></div>
</div>
<div class="section" id="scalar-functions-of-scidbarray-objects-aggregations">
<h2>Scalar functions of SciDBArray objects (aggregations)<a class="headerlink" href="#scalar-functions-of-scidbarray-objects-aggregations" title="Permalink to this headline">¶</a></h2>
<p>The package exposes the following aggregations:</p>
<table border="1" class="docutils">
<colgroup>
<col width="38%" />
<col width="62%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="xref py py-meth docutils literal"><span class="pre">min()</span></tt></td>
<td>minimum value</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-meth docutils literal"><span class="pre">max()</span></tt></td>
<td>maximum value</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-meth docutils literal"><span class="pre">sum()</span></tt></td>
<td>sum of values</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-meth docutils literal"><span class="pre">var()</span></tt></td>
<td>variance of values</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-meth docutils literal"><span class="pre">stdev()</span></tt></td>
<td>standard deviation of values</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-meth docutils literal"><span class="pre">std()</span></tt></td>
<td>standard deviation of values</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-meth docutils literal"><span class="pre">avg()</span></tt></td>
<td>average/mean of values</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-meth docutils literal"><span class="pre">mean()</span></tt></td>
<td>average/mean of values</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-meth docutils literal"><span class="pre">count()</span></tt></td>
<td>count of nonempty cells</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-meth docutils literal"><span class="pre">approxdc()</span></tt></td>
<td>fast estimate of the number of distinct values</td>
</tr>
</tbody>
</table>
<p><strong>Examples: Minimum Aggregates</strong></p>
<p>Each operation can be computed across the entire array, or across specified
dimensions by passing the index or indices of the desired dimensions.
For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">X</span> <span class="o">=</span> <span class="n">sdb</span><span class="o">.</span><span class="n">from_array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">X</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
<span class="go">array([[ 0.5488135 ,  0.71518937,  0.60276338],</span>
<span class="go">       [ 0.54488318,  0.4236548 ,  0.64589411],</span>
<span class="go">       [ 0.43758721,  0.891773  ,  0.96366276],</span>
<span class="go">       [ 0.38344152,  0.79172504,  0.52889492],</span>
<span class="go">       [ 0.56804456,  0.92559664,  0.07103606]])</span>
</pre></div>
</div>
<p>Here we&#8217;ll find the minimum of all values in the array.  The returned result
is a new SciDBArray, so we select the first element:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">X</span><span class="o">.</span><span class="n">min</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">0.071036058197886942</span>
</pre></div>
</div>
<p>Like numpy, passing index 0 gives us the minimum within every column:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">X</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
<span class="go">array([ 0.38344152,  0.4236548 ,  0.07103606])</span>
</pre></div>
</div>
<p>Passing index 1 gives us the minimum within every row:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">X</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
<span class="go">array([ 0.5488135 ,  0.4236548 ,  0.43758721,  0.38344152,  0.07103606])</span>
</pre></div>
</div>
<p>Note that the convention for specifying aggregate indices here is designed
to match numpy, and is <em>opposite the convention used within SciDB</em>.
To recover SciDB-style aggregates, you can use the <tt class="docutils literal"><span class="pre">scidb_syntax</span></tt> flag:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">X</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">scidb_syntax</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
<span class="go">array([ 0.38344152,  0.4236548 ,  0.07103606])</span>
</pre></div>
</div>
<p><strong>Further Examples</strong></p>
<p>These operations return new <tt class="xref py py-class docutils literal"><span class="pre">SciDBArray</span></tt> objects consisting of
scalar values.  Here are a few examples that materialize their results to
Python:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">tridiag</span><span class="o">.</span><span class="n">count</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">28</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tridiag</span><span class="o">.</span><span class="n">sum</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">20.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tridiag</span><span class="o">.</span><span class="n">var</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">1.6190476190476193</span>
</pre></div>
</div>
<p>Note that a count of nonempty cells is also directly available from the
<tt class="xref py py-func docutils literal"><span class="pre">nonempty()</span></tt> function:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">tridiag</span><span class="o">.</span><span class="n">nonempty</span><span class="p">()</span>
<span class="go">28</span>
</pre></div>
</div>
<p>A related function is <tt class="xref py py-func docutils literal"><span class="pre">nonnull()</span></tt>, which counts the number of nonempty
cells which do not contain a null value.  In this case, the result is the
same as <tt class="xref py py-func docutils literal"><span class="pre">nonempty()</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">tridiag</span><span class="o">.</span><span class="n">nonnull</span><span class="p">()</span>
<span class="go">28</span>
</pre></div>
</div>
</div>
<div class="section" id="pointwise-application-of-scalar-functions">
<h2>Pointwise application of scalar functions<a class="headerlink" href="#pointwise-application-of-scalar-functions" title="Permalink to this headline">¶</a></h2>
<p>The package exposes SciDB scalar-valued scalar functions that can be applied
element-wise to SciDB arrays:</p>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="77%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Function</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="xref py py-func docutils literal"><span class="pre">sin()</span></tt></td>
<td>Trigonometric sine</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-func docutils literal"><span class="pre">asin()</span></tt></td>
<td>Trigonometric arc-sine / inverse sine</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-func docutils literal"><span class="pre">cos()</span></tt></td>
<td>Trigonometric cosine</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-func docutils literal"><span class="pre">acos()</span></tt></td>
<td>Trigonometric arc-cosine / inverse cosine</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-func docutils literal"><span class="pre">tan()</span></tt></td>
<td>Trigonometric tangent</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-func docutils literal"><span class="pre">atan()</span></tt></td>
<td>Trigonometric arc-tangent / inverse tagent</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-func docutils literal"><span class="pre">exp()</span></tt></td>
<td>Natural exponent</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-func docutils literal"><span class="pre">log()</span></tt></td>
<td>Natural logarithm</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-func docutils literal"><span class="pre">log10()</span></tt></td>
<td>Base-10 logarithm</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-func docutils literal"><span class="pre">sqrt()</span></tt></td>
<td>Square root</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-func docutils literal"><span class="pre">ceil()</span></tt></td>
<td>Ceiling function</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-func docutils literal"><span class="pre">floor()</span></tt></td>
<td>Floor function</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-func docutils literal"><span class="pre">is_nan()</span></tt></td>
<td>Test for NaN values</td>
</tr>
</tbody>
</table>
<p>All trigonometric functions assume arguments are given in radians.
Here is a simple example that compares a computation in SciDB with
a local one (using the &#8216;tridiag` array defined in the last examples):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">sin_tri</span> <span class="o">=</span> <span class="n">sdb</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">tridiag</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">sin_tri</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">tridiag</span><span class="o">.</span><span class="n">toarray</span><span class="p">()))</span>
<span class="go">0.0</span>
</pre></div>
</div>
</div>
<div class="section" id="shape-and-layout-functions">
<h2>Shape and layout functions<a class="headerlink" href="#shape-and-layout-functions" title="Permalink to this headline">¶</a></h2>
<p>Arrays may be transposed and their data re-arranged into new shapes
with the usual <tt class="xref py py-meth docutils literal"><span class="pre">transpose()</span></tt> and <tt class="xref py py-meth docutils literal"><span class="pre">reshape()</span></tt>
functions:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">tri_reshape</span> <span class="o">=</span> <span class="n">tridiag</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">20</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tri_reshape</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(20, 5)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tri_reshape</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(5, 20)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tri_reshape</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">shape</span>  <span class="c"># shortcut for transpose</span>
<span class="go">(5, 20)</span>
</pre></div>
</div>
</div>
<div class="section" id="arithmetic">
<h2>Arithmetic<a class="headerlink" href="#arithmetic" title="Permalink to this headline">¶</a></h2>
<p>The package defines elementwise operations on all arrays and linear algebra
operations on matrices and vectors. Scalar multiplication is supported.</p>
<p>Element-wise sums and products:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">X</span> <span class="o">=</span> <span class="n">sdb</span><span class="o">.</span><span class="n">from_array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Y</span> <span class="o">=</span> <span class="n">sdb</span><span class="o">.</span><span class="n">from_array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">S</span> <span class="o">=</span> <span class="n">X</span> <span class="o">+</span> <span class="n">Y</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">D</span> <span class="o">=</span> <span class="n">X</span> <span class="o">-</span> <span class="n">Y</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">M</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">X</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">S</span> <span class="o">+</span> <span class="n">D</span> <span class="o">-</span> <span class="n">M</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">-1.1102230246251565e-16</span>
</pre></div>
</div>
<p>We can combine operations as well:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Z</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">X</span> <span class="o">+</span> <span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
<p>There are also linear algebra operations (matrix-matrix product, matrix-vector
product) using the <tt class="xref py py-func docutils literal"><span class="pre">dot()</span></tt> function:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">XY</span> <span class="o">=</span> <span class="n">sdb</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">XY1</span> <span class="o">=</span> <span class="n">sdb</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">XTX</span> <span class="o">=</span> <span class="n">sdb</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="broadcasting">
<h2>Broadcasting<a class="headerlink" href="#broadcasting" title="Permalink to this headline">¶</a></h2>
<p>Numpy broadcasting conventions are generally followed in operations involving
differently-sized <tt class="xref py py-class docutils literal"><span class="pre">SciDBArray</span></tt> objects. Consider the following example
that centers a matrix by subtracting its column average from each column.</p>
<p>First we create a test array with 5 columns:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">X</span> <span class="o">=</span> <span class="n">sdb</span><span class="o">.</span><span class="n">from_array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">)))</span>
</pre></div>
</div>
<p>Now create a vector of column means:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">xcolmean</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">xcolmean</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(5,)</span>
</pre></div>
</div>
<p>Subtract these means from the columns &#8211; this is a broadcasting operation:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">XC</span> <span class="o">=</span> <span class="n">X</span> <span class="o">-</span> <span class="n">xcolmean</span>
</pre></div>
</div>
<p>To check that the columns are now centered,
we compute the column mean of <tt class="docutils literal"><span class="pre">XC</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">XC</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
<span class="go">array([ -2.22044605e-17,   4.44089210e-17,  -1.11022302e-17,</span>
<span class="go">         1.11022302e-16,  -3.33066907e-17])</span>
</pre></div>
</div>
<p>The broadcasting operation which creates <tt class="docutils literal"><span class="pre">XC</span></tt> is implemented using a
join operation along dimension 1.</p>
</div>
<div class="section" id="lazy-evaluation">
<h2>Lazy Evaluation<a class="headerlink" href="#lazy-evaluation" title="Permalink to this headline">¶</a></h2>
<p id="lazy">When possible, SciDB-Py defers actual database computation
until data are needed. It does this by using <strong>lazy arrays</strong>, which are
references to  as-yet unevaluated SciDB queries. Many array methods
actually return lazy arrays:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">sdb</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">name</span>  <span class="c"># an array in the database</span>
<span class="go">&#39;py1102522658694_00001&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span><span class="o">.</span><span class="n">name</span>  <span class="c"># not yet in the database</span>
<span class="go">&#39;aggregate(py1102522658694_00001,avg(f0),i1)&#39;</span>
</pre></div>
</div>
<p>Note that y&#8217;s name doesn&#8217;t refer to an array in the database, but
rather a query on x. Lazy arrays can also be identified by their non-null
<cite>query</cite> attribute:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span><span class="o">.</span><span class="n">query</span>
<span class="go">&#39;aggregate(py1102522658694_00001,avg(f0),i1)&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">query</span> <span class="ow">is</span> <span class="bp">None</span>
<span class="go">True</span>
</pre></div>
</div>
<p>Calling <tt class="xref py py-meth docutils literal"><span class="pre">eval()</span></tt> forces lazy-arrays to be evaluated (it has no effect
on non-lazy arrays):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span><span class="o">.</span><span class="n">name</span>
<span class="go">&#39;py1102522658694_00014&#39;</span>
</pre></div>
</div>
<p>In most cases you don&#8217;t need to worry about whether an array is lazy or not &#8211;
lazy arrays have all the same methods as regular arrays, and normally the
difference is transparent to the user. However, lazy arrays can be more
efficient with regard to compound queries. Consider an equation like
the law of cosines:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">c2</span> <span class="o">=</span> <span class="n">a</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">b</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span> <span class="o">*</span> <span class="n">sdb</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
</pre></div>
</div>
<p>This equation involves creating 7 intermediate data products:</p>
<blockquote>
<div><ul class="simple">
<li><tt class="docutils literal"><span class="pre">t1</span> <span class="pre">=</span> <span class="pre">a</span> <span class="pre">**</span> <span class="pre">2</span></tt></li>
<li><tt class="docutils literal"><span class="pre">t2</span> <span class="pre">=</span> <span class="pre">b</span> <span class="pre">**</span> <span class="pre">2</span></tt></li>
<li><tt class="docutils literal"><span class="pre">t3</span> <span class="pre">=</span> <span class="pre">2</span> <span class="pre">*</span> <span class="pre">a</span></tt></li>
<li><tt class="docutils literal"><span class="pre">t4</span> <span class="pre">=</span> <span class="pre">t3</span> <span class="pre">*</span> <span class="pre">b</span></tt></li>
<li><tt class="docutils literal"><span class="pre">t5</span> <span class="pre">=</span> <span class="pre">sdb.cos(C)</span></tt></li>
<li><tt class="docutils literal"><span class="pre">t6</span> <span class="pre">=</span> <span class="pre">t4</span> <span class="pre">*</span> <span class="pre">t5</span></tt></li>
<li><tt class="docutils literal"><span class="pre">t7</span> <span class="pre">=</span> <span class="pre">t1</span> <span class="pre">+</span> <span class="pre">t2</span></tt></li>
<li><tt class="docutils literal"><span class="pre">c2</span> <span class="pre">=</span> <span class="pre">t7</span> <span class="pre">-</span> <span class="pre">t3</span></tt></li>
</ul>
</div></blockquote>
<p>If <tt class="docutils literal"><span class="pre">a</span></tt>, <tt class="docutils literal"><span class="pre">b</span></tt>, and <tt class="docutils literal"><span class="pre">C</span></tt> are large SciDBArrays, this involves many
round-trip communiciations to the databse, several passes over the data,
and the storage of 7 arrays. Lazy arrays reduce this overhead by representing
some of these temporary arrays as unevaluated sub-queries. Passing larger
queries to SciDB at once also gives the database more opportunity to optimize
the final query, performing the computation in fewer passes over the data.</p>
<p>In some situations it&#8217;s necessary or more efficient to
force evaluation of lazy arrays (often places where an array appears
several times in a complex query). Some SciDB-Py methods perform this
evaluation internally. You should also consider calling <tt class="xref py py-meth docutils literal"><span class="pre">eval()</span></tt> on lazy
arrays if you think the unevaluated queries are becoming too cumbersome.</p>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="comparison_and_filtering.html" class="btn btn-neutral float-right" title="Comparing and Filtering Arrays"/>Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="access.html" class="btn btn-neutral" title="Accessing array data"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2013-2014, SciDB-Py Developers.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'14.7.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>