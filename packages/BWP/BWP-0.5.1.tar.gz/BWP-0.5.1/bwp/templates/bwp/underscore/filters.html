{# Шаблон Underscore #}{% load bwp_verbatim %}{% verbatim %}

<table data-id="{{ data.id }}"
    class="well well-small table table-condensed table-bordered">
    <thead>
        <tr>
            <th colspan="6">
                Фильтры
                <button data-action="filter_append" data-id="{{ data.id }}" class="btn btn-mini">
                        <i class="icon-plus"></i>
                </button>
            </th>
        </tr>
    </thead>
    <tbody>
    {% _.each(data.filters, function(item, index) { %}
        <tr data-filter_index="{{ index }}">

            {%/* Поле фильтра */%}
            <td class="input-micro">
                <select data-action="filter_change_field"
                    {% if (item.active) { %} disabled{% } %}
                    data-id="{{ data.id }}"
                    data-filter_index="{{ index }}">
            {% _.each(data.meta.filters, function(filter) { %}
                {% if (item.field == filter.field) { %}
                    <option selected value="{{ filter.field }}">{{ filter.field_title }}</option>
                {% } else { %}
                    <option value="{{ filter.field }}">{{ filter.field_title }}</option>
                {% } %} 
            {% }); %}
                </select>
            </td>

            {%/* Тип фильтра */%}
            <td class="input-micro">
                <select data-action="filter_change_type"
                    {% if (item.active) { %} disabled{% } %}
                    data-id="{{ data.id }}"
                    data-filter_index="{{ index }}">
            {% _.each(FILTER_TYPES, function(type, i) { %}
                    <option
                        {% if (item.type == type) { %} selected{% } %}
                        value="{{ type[0] }}">
                        {{ type[1] }}
                    </option>
            {% }); %}
                </select>
            </td>

            {%/* Значения фильтра */%}
            <td data-place="filter_values" data-filter_index="{{ index }}">
                {{ item.values_html }}
            </td>

            {%/* Активность фильтра */%}
            <td class="input-micro">
                <button
                    class="btn{% if (item.active) { %} active{% } %}"
                    data-toggle="button"
                    data-action="filter_change_active"
                    data-filter_index="{{ index }}"
                    data-id="{{ data.id }}"
                    title="Активный">
                    <i class="icon-ok"></i>
                </button>
            </td>

            {%/* Инверсия фильтра */%}
            <td class="input-micro">
                <button
                    class="btn{% if (item.inverse) { %} active{% } %}"
                    data-toggle="button"
                    data-action="filter_change_inverse"
                    data-filter_index="{{ index }}"
                    data-id="{{ data.id }}"
                    title="Инверсия">
                    <i class="icon-random"></i>
                </button>
            </td>

            {%/* Удаление фильтра */%}
            <td class="input-micro">
                <button
                    class="btn"
                    data-action="filter_remove" 
                    data-id="{{ data.id }}"
                    data-filter_index="{{ index }}"
                    title="Удалить фильтр">
                    <i class="icon-remove"></i>
                </button>
            </td>

        </tr>
    {% }); %}
        
    </tbody>
</table>

{% endverbatim %}
