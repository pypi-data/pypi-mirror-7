<?xml version="1.0"?>
<axiome>
	<plugin name="qiime_even" type="rarefy_otu_table">
		<!-- Define what the plugin needs -->
		<!-- This is used to create the UI -->
		<input>
			<!--file label="Exclude OTU List" name="exclude_list" command_prefix="-e"/-->
		</input>
		<!-- Define what the plugin is going to do -->
		<!-- Special variables available to "source" types: previous_output_file, current_output_file -->
		<process>
			<input name="otu_table.biom"/>
			<input name="otu_table.tab"/>
			<output name="otu_table_auto.biom" report_label="BIOM Format Rarefied (Subsampled) OTU Table"/>
			<command label="Rarefy OTU Table to Even Depth" cmd="single_rarefaction.py -i ${i} -o ${o} -d $$(awk -F '\t' 'NR == 1 { } NR == 2 { for (i = 2; i &lt;= NF; i++) { if ($$i ~ /^[0-9]*$$/) { max = i; } } } NR &gt; 2 { for (i = 2; i &lt;= max; i++) { c[i] += $$i; } } END { smallest = c[2]; for (i = 3; i &lt;= max; i++) { if (c[i] &lt; smallest) { smallest = c[i]; }} print smallest; }' ${i})" input="otu_table.biom,otu_table.tab" output="otu_table_auto.biom"/>
		</process>
		<!-- Version check command for involved programs -->
		<info>
			<command label="BIOM Version" cmd="print_qiime_config.py | grep 'biom-format'"/>
			<help text="Uses QIIME's single_rarefaction.py to randomly subsample an OTU table to even sampling depth, and then makes legacy OTU table with the BIOM toolkit"/>
		</info>
	</plugin>
</axiome>
