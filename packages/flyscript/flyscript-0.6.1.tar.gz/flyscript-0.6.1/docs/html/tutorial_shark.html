<html>
<head>
<link rel="stylesheet" href="ridl.css" />
<link rel="stylesheet" href="flyscript.css" />
<title>FlyScript Documentation</title>
</head>

<body>
<div class="header">
<a href="http://www.riverbed.com"><img src="rb-logo.png" align="left"></a>
<div>
<p class="headerleft">FlyScript Documentation</p>
<p class="headerright"> Version 0.6.1
 - last updated May 01, 2014 at 01:05 PM</p>

</div>

</div>

<div class="navbar">

<div class="links" markdown="1">

<p><span class="toctitle">Quick Links:</span></p>
<ul>
<li><a href="index.html">Home</a></li>
<li><a href="tutorials.html">Tutorials</a></li>
<li>Modules<ul>
<li><a href="common.html"><code>rvbd.common</code></a></li>
<li><a href="shark.html"><code>rvbd.shark</code></a></li>
<li><a href="profiler.html"><code>rvbd.profiler</code></a></li>
</ul>
</li>
<li><a href="rest_apis.html">REST APIs</a></li>
<li><a href="glossary.html">Glossary</a></li>
</ul>
</div>

<div class="toc"><span class="toctitle">On this page:</span><ul>
<li><a href="#tutorial">Tutorial</a><ul>
<li><a href="#shark-objects">Shark Objects</a></li>
<li><a href="#views">Views</a></li>
<li><a href="#data-objects">Data Objects</a></li>
<li><a href="#aggregated-or-not">Aggregated or Not</a></li>
<li><a href="#processing-view-data">Processing View Data</a></li>
<li><a href="#existing-views">Existing Views</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div class="content">

<h1 id="tutorial">Tutorial</h1>
<p>This tutorial will show you how to interface with a <a href="glossary.html#shark">Cascade Shark</a> 
using the FlyScript Python SDK.  This tutorial assumes a basic understanding of Python 
(if not, see the <a href="http://wiki.python.org/moin/BeginnersGuide">Beginner's Guide to Python</a>).
In addition, if you should be familiar with Shark and <a href="glossary.html#pilot">Pilot</a>.
If you have never used Shark and Pilot, it may be helpful to first read
<a href="background.html">a brief introduction</a> to the Shark architecture.</p>
<p>The tutorial has been organized so you can follow it sequentially.  Throughout the 
examples, you will be expected to fill in details specific to your environment.  These
will be called out using a dollar sign <code>$&lt;name&gt;</code> -- for example <code>$sharkhost</code> indicates you
should fill in the host name or IP address of a Shark appliance.</p>
<p>Whenever you see <code>&gt;&gt;&gt;</code>, this indicates an interactive session using the Python
shell.  The command that you are expected to type follows the <code>&gt;&gt;&gt;</code>.  The result of
the command follows.  Any lines with a <code>#</code> are just comments to describe what 
is happening.  In many cases the exact output will depend on your environment,
so it may not match precisely what you see in this tutorial.</p>
<h2 id="shark-objects">Shark Objects</h2>
<p>As with any Python code, the first step is to import the module(s)
we intend to use.
The FlyScript code for working with Shark appliances resides in a
module called <code>rvbd.shark</code>.
The main class in this module is <a href="shark.html#sharkobjects"><code>Shark</code></a>.
This object represents a connection to a Shark appliance.</p>
<p>To start, start python from the shell or command line:</p>
<div class="codehilite"><pre><span class="go">$ python</span>
<span class="go">Python 2.7.3 (default, Apr 19 2012, 00:55:09) </span>
<span class="go">[GCC 4.2.1 (Based on Apple Inc. build 5658) (LLVM build 2335.15.00)] on darwin</span>
<span class="go">Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>


<p>Once in the python shell, let's create a Shark object:</p>
<div class="codehilite"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">rvbd.shark</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">sk</span> <span class="o">=</span> <span class="n">rvbd</span><span class="o">.</span><span class="n">shark</span><span class="o">.</span><span class="n">Shark</span><span class="p">(</span><span class="s">&#39;$sharkhost&#39;</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="n">rvbd</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">UserAuth</span><span class="p">(</span><span class="s">&#39;$username&#39;</span><span class="p">,</span> <span class="s">&#39;$password&#39;</span><span class="p">))</span>
</pre></div>


<p>The first argument is the hostname or IP address of the Shark appliance.  The
second argument is a named parameter and identifies the authentication method
to use -- in this case, simple username/password is used.</p>
<p>As soon as the Shark object is created, a connection is established to the Shark appliance,
and the authentication credentials are validated.  If the username and password are 
not correct, you will immediately see an exception.</p>
<p>The <code>sk</code> object is the basis for all communication with the Shark appliance, whether 
that is running views, checking configuration, or simply retrieving information
about the appliance.  Lets take a look at some basic information about the
shark that we just connected to:</p>
<div class="codehilite"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">info</span> <span class="o">=</span> <span class="n">sk</span><span class="o">.</span><span class="n">get_serverinfo</span><span class="p">()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">info</span><span class="p">[</span><span class="s">&#39;version&#39;</span><span class="p">]</span>
<span class="go">&#39;10.0&#39;</span>

<span class="go"># Returns the uptime in nanoseconds</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">info</span><span class="p">[</span><span class="s">&#39;uptime&#39;</span><span class="p">]</span>
<span class="go">1747209615759000</span>

<span class="go"># Returns the local_time in nanoseconds since Jan 1, 1970</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">info</span><span class="p">[</span><span class="s">&#39;local_time&#39;</span><span class="p">]</span>
<span class="go">1355803849818051000</span>

<span class="go"># Utility function to print convert this time into a datetime object...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rvbd.common.timeutils</span> <span class="kn">import</span> <span class="n">nsec_string_to_datetime</span>

<span class="go"># Now let&#39;s see what that time really is...    </span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">nsec_string_to_datetime</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;local_time&#39;</span><span class="p">]))</span>
<span class="go">&#39;2012-12-18 04:10:49.818051+00:00&#39;</span>

<span class="go"># Let&#39;s see the entire info structure</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">info</span>
<span class="go">{&#39;build_time&#39;: &#39;Nov 27 2012 16:10:50&#39;,</span>
<span class="go"> &#39;build_type&#39;: &#39;Final&#39;,</span>
<span class="go"> &#39;build_variant&#39;: &#39;TurboCap&#39;,</span>
<span class="go"> &#39;has_webui&#39;: True,</span>
<span class="go"> &#39;hostname&#39;: &#39;shark&#39;,</span>
<span class="go"> &#39;internal_version&#39;: &#39;10.0.1005.0241&#39;,</span>
<span class="go"> &#39;local_time&#39;: 1355803849818051000,</span>
<span class="go"> &#39;protocol_version&#39;: &#39;4.0&#39;,</span>
<span class="go"> &#39;start_time&#39;: 1354056640202292000,</span>
<span class="go"> &#39;system_type&#39;: &#39;Linux&#39;,</span>
<span class="go"> &#39;timezone&#39;: &#39;-0800&#39;,</span>
<span class="go"> &#39;uptime&#39;: 1747209615759000,</span>
<span class="go"> &#39;version&#39;: &#39;10.0&#39;,</span>
<span class="go"> &#39;view_version&#39;: &#39;3.5&#39;,</span>
<span class="go"> &#39;webui_SSL&#39;: True,</span>
<span class="go"> &#39;webui_port&#39;: 443,</span>
<span class="go"> &#39;webui_root_path&#39;: &#39;/&#39;}</span>
</pre></div>


<p>Before moving on, exit the python interactive shell:</p>
<div class="codehilite"><pre><span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">Ctrl</span><span class="o">-</span><span class="n">D</span><span class="p">]</span>
<span class="go">$</span>
</pre></div>


<h2 id="views">Views</h2>
<p>Let's create our first script.  We're going write a simple script that creates
and applies a view on the first capture interface on our shark appliance.</p>
<p>This script will use packets in a pcap file.  To start, download a copy of 
<a href="tutorial-1.pcap">tutorial-1.pcap</a> and save it in a new directory.</p>
<p>In the same directory as the pcap file, create a file called <code>view.py</code> 
and insert the following code:</p>
<div class="codehilite"><pre><span class="kn">import</span> <span class="nn">rvbd.shark</span>
<span class="kn">from</span> <span class="nn">rvbd.shark.types</span> <span class="kn">import</span> <span class="n">Value</span><span class="p">,</span> <span class="n">Key</span>
<span class="kn">import</span> <span class="nn">pprint</span>

<span class="c"># Fill these in with appropriate values</span>
<span class="n">sharkhost</span> <span class="o">=</span> <span class="s">&#39;$sharkhost&#39;</span>
<span class="n">username</span> <span class="o">=</span> <span class="s">&#39;$username&#39;</span>
<span class="n">password</span> <span class="o">=</span> <span class="s">&#39;$password&#39;</span>

<span class="c"># Open a connection to the appliance and authenticate</span>
<span class="n">sk</span> <span class="o">=</span> <span class="n">rvbd</span><span class="o">.</span><span class="n">shark</span><span class="o">.</span><span class="n">Shark</span><span class="p">(</span><span class="n">sharkhost</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="n">rvbd</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">UserAuth</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">))</span>

<span class="c"># First, upload our pcap file, if it&#39;s not already present</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">sk</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s">&#39;/{0}/tutorial-1.pcap&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">username</span><span class="p">)):</span>
    <span class="n">homedir</span> <span class="o">=</span> <span class="n">sk</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>
    <span class="n">tracefile</span> <span class="o">=</span> <span class="n">homedir</span><span class="o">.</span><span class="n">upload_trace_file</span><span class="p">(</span><span class="s">&#39;tutorial-1.pcap&#39;</span><span class="p">,</span> <span class="s">&#39;tutorial-1.pcap&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c"># If it&#39;s already there, just grab a handle to it</span>
    <span class="n">tracefile</span> <span class="o">=</span> <span class="n">sk</span><span class="o">.</span><span class="n">get_file</span><span class="p">(</span><span class="s">&#39;/{0}/tutorial-1.pcap&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">username</span><span class="p">))</span>

<span class="c"># Now create a view on this tracefile.  Start by selecting the columns of interest</span>
<span class="n">columns</span> <span class="o">=</span> <span class="p">[</span> <span class="n">Key</span><span class="p">(</span><span class="n">sk</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">ip</span><span class="o">.</span><span class="n">address</span><span class="p">),</span>
            <span class="n">Value</span><span class="p">(</span><span class="n">sk</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">generic</span><span class="o">.</span><span class="n">packets</span><span class="p">),</span>
            <span class="n">Value</span><span class="p">(</span><span class="n">sk</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">generic</span><span class="o">.</span><span class="n">bytes</span><span class="p">)</span> <span class="p">]</span>

<span class="n">view</span> <span class="o">=</span> <span class="n">sk</span><span class="o">.</span><span class="n">create_view</span><span class="p">(</span><span class="n">tracefile</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;tutorial view&quot;</span><span class="p">)</span>

<span class="c"># Retrieve the data</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">aggregated</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c"># Close the view</span>
<span class="n">view</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c"># Print the output to the screen</span>
<span class="n">printer</span> <span class="o">=</span> <span class="n">pprint</span><span class="o">.</span><span class="n">PrettyPrinter</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">printer</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>


<p>Be sure to fill in appropriate values for <code>$sharkhost</code>, <code>$username</code> and <code>$password</code>.
Run this script as follows and you should see something like the following:</p>
<div class="codehilite"><pre>$ python view.py
[ { &#39;p&#39;: 388,
    &#39;t&#39;: datetime.datetime(2012, 12, 18, 12, 41, 33, 808202, tzinfo=tzutc()),
    &#39;vals&#39;: [ [&#39;11.1.1.90&#39;, 384, 255208],
              [&#39;173.194.75.106&#39;, 13, 1025],
              [&#39;216.34.181.45&#39;, 48, 39486],
              [&#39;184.31.179.172&#39;, 263, 195713],
              [&#39;74.125.226.220&#39;, 10, 1446],
              [&#39;208.70.199.49&#39;, 16, 2960],
              [&#39;23.66.231.51&#39;, 3, 198],
              [&#39;23.66.231.41&#39;, 7, 1253],
              [&#39;74.125.226.219&#39;, 16, 10555],
              [&#39;11.1.1.100&#39;, 2, 100],
              [&#39;204.93.70.150&#39;, 6, 2472]]}]
</pre></div>


<p>Let's take a closer look at what this script is doing.  The first few
lines are simply importing a few libraries that we'll be using:</p>
<div class="codehilite"><pre><span class="kn">import</span> <span class="nn">rvbd.shark</span>
<span class="kn">from</span> <span class="nn">rvbd.shark.types</span> <span class="kn">import</span> <span class="n">Value</span><span class="p">,</span> <span class="n">Key</span>
<span class="kn">import</span> <span class="nn">pprint</span>
</pre></div>


<p>Next, we create a Shark object that establishes our connection to the target
appliance:</p>
<div class="codehilite"><pre><span class="cp"># Open a connection to the appliance and authenticate</span>
<span class="n">sk</span> <span class="o">=</span> <span class="n">rvbd</span><span class="p">.</span><span class="n">shark</span><span class="p">.</span><span class="n">Shark</span><span class="p">(</span><span class="n">sharkhost</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="n">rvbd</span><span class="p">.</span><span class="n">common</span><span class="p">.</span><span class="n">UserAuth</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">))</span>
</pre></div>


<p>This next section ensures that the pcap file that we want to analyze is up
on the appliance.</p>
<div class="codehilite"><pre><span class="c"># First, upload our pcap file, if it&#39;s not already present</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">sk</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s">&#39;/{0}/tutorial-1.pcap&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">username</span><span class="p">)):</span>
    <span class="n">homedir</span> <span class="o">=</span> <span class="n">sk</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>
    <span class="n">tracefile</span> <span class="o">=</span> <span class="n">homedir</span><span class="o">.</span><span class="n">upload_trace_file</span><span class="p">(</span><span class="s">&#39;tutorial-1.pcap&#39;</span><span class="p">,</span> <span class="s">&#39;tutorial-1.pcap&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c"># If it&#39;s already there, just grab a handle to it</span>
    <span class="n">tracefile</span> <span class="o">=</span> <span class="n">sk</span><span class="o">.</span><span class="n">get_file</span><span class="p">(</span><span class="s">&#39;/{0}/tutorial-1.pcap&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">username</span><span class="p">))</span>
</pre></div>


<p>At this point, the variable <code>tracefile</code> is a handle to the tracefile 'tutorial-1.pacap' 
that now present on the filesystem of the shark appliance. </p>
<p>Next, we're going to actually create a view.  The first step is to select the set
of columns that we're interested in collecting:</p>
<div class="codehilite"><pre><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span> <span class="n">Key</span><span class="p">(</span><span class="n">sk</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">ip</span><span class="o">.</span><span class="n">address</span><span class="p">),</span>
            <span class="n">Value</span><span class="p">(</span><span class="n">sk</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">generic</span><span class="o">.</span><span class="n">packets</span><span class="p">),</span>
            <span class="n">Value</span><span class="p">(</span><span class="n">sk</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">generic</span><span class="o">.</span><span class="n">bytes</span><span class="p">)</span> <span class="p">]</span>
</pre></div>


<p>Shark supports numerous columns, and any column can be either a key column or a value column. 
Each row of data will be aggregated according to the set of key columns selected.  The 
value columns define the set of additional data to collect per row.  In this
example, we are asking to collect total packets and bytes for each IP address
seen in the pcap file.</p>
<p>Now create the view:</p>
<div class="codehilite"><pre><span class="n">view</span> <span class="o">=</span> <span class="n">sk</span><span class="o">.</span><span class="n">create_view</span><span class="p">(</span><span class="n">tracefile</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;tutorial view&quot;</span><span class="p">)</span>
</pre></div>


<p>The first argument is the <code>packet source</code>.  When creating a view, the packet source can 
be one of four types of source objects: Interfaces, Trace Files, Capture Jobs
and Trace Clips.  A packet source can be live (e.g. a Shark capture port) or 
offline (e.g. a Trace Clip). General information about packet sources can be 
found in the <a href="glossary.html">glossary</a>.  See the <a href="shark.html#sourceobjects">Python classes</a>
for details on how to work with the various source types as objects.</p>
<p>We can now use the view object to get data:</p>
<div class="codehilite"><pre><span class="c"># Retrieve the data</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">aggregated</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>


<h2 id="data-objects">Data Objects</h2>
<p>The data object returned by the <code>get_data()</code> method contains the key and value columns 
requested, but also returns a few addition fields of meta data.</p>
<p>First, edit <code>view.py</code> and comment out the line that closes the view - add a '#' in front of <code>view.close()</code>:</p>
<div class="codehilite"><pre><span class="c"># Close the view</span>
<span class="c"># view.close()</span>
</pre></div>


<p>Now rerun the python script, but pass the <code>-i</code> argument to python to drop into an interactive
shell after running the script.  This will allow us to inspect the data that
was returned:</p>
<div class="codehilite"><pre><span class="go">$ python -i view.py</span>
<span class="go">[ { &#39;p&#39;: 388,</span>
<span class="go">    &#39;t&#39;: datetime.datetime(2012, 12, 18, 12, 41, 33, 808202, tzinfo=tzutc()),</span>
<span class="go">    &#39;vals&#39;: [ [&#39;11.1.1.90&#39;, 384, 255208],</span>
<span class="go">              [&#39;173.194.75.106&#39;, 13, 1025],</span>
<span class="go">              [&#39;216.34.181.45&#39;, 48, 39486],</span>
<span class="go">              [&#39;184.31.179.172&#39;, 263, 195713],</span>
<span class="go">              [&#39;74.125.226.220&#39;, 10, 1446],</span>
<span class="go">              [&#39;208.70.199.49&#39;, 16, 2960],</span>
<span class="go">              [&#39;23.66.231.51&#39;, 3, 198],</span>
<span class="go">              [&#39;23.66.231.41&#39;, 7, 1253],</span>
<span class="go">              [&#39;74.125.226.219&#39;, 16, 10555],</span>
<span class="go">              [&#39;11.1.1.100&#39;, 2, 100],</span>
<span class="go">              [&#39;204.93.70.150&#39;, 6, 2472]],</span>
<span class="go">    &#39;value_count&#39;: 11}]</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>


<p>We are now back at the python prompt, but all the variables assigned in the 
script are available to use for inspection.</p>
<p>First of all, note that the data object itself is a list of length 1:</p>
<div class="codehilite"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="go">&lt;type &#39;list&#39;&gt;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="go">1</span>
</pre></div>


<p>Each element in the list is called a <code>sample</code>.  We only have a single sample 
in this output - we'll cover more about samples later. </p>
<p>A sample has 3 fields in it:</p>
<ul>
<li><code>p</code> - number of packets processed</li>
<li><code>t</code> - timestamp of the beginning of the sample interval</li>
<li><code>vals</code> - the key and value columns that were requested when the view was created</li>
</ul>
<p>For this output, there is only one sample.  In the sample interval, 388
packets were processed.  The sample interval started as 12:41:33.808202 on Dec 18, 2012.</p>
<p>The <code>get_data()</code> method supports a number of additional options that
allow us to change how the data is returned. For example, we can ask
for the data to be sorted by bytes, the third column (index 2 starting
from 0):</p>
<div class="codehilite"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">aggregated</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">sortby</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="go"># Look only at the &#39;vals&#39; for the first and only sample (index 0)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">printer</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;vals&#39;</span><span class="p">])</span>
<span class="go">[ [&#39;11.1.1.90&#39;, 384, 255208],</span>
<span class="go">  [&#39;184.31.179.172&#39;, 263, 195713],</span>
<span class="go">  [&#39;216.34.181.45&#39;, 48, 39486],</span>
<span class="go">  [&#39;74.125.226.219&#39;, 16, 10555],</span>
<span class="go">  [&#39;208.70.199.49&#39;, 16, 2960],</span>
<span class="go">  [&#39;204.93.70.150&#39;, 6, 2472],</span>
<span class="go">  [&#39;74.125.226.220&#39;, 10, 1446],</span>
<span class="go">  [&#39;23.66.231.41&#39;, 7, 1253],</span>
<span class="go">  [&#39;173.194.75.106&#39;, 13, 1025],</span>
<span class="go">  [&#39;23.66.231.51&#39;, 3, 198],</span>
<span class="go">  [&#39;11.1.1.100&#39;, 2, 100]]</span>
</pre></div>


<p>Or sort by packets (index 1), in ascending order:</p>
<div class="codehilite"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">aggregated</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">sortby</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sorttype</span><span class="o">=</span><span class="s">&quot;ascending&quot;</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">printer</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;vals&#39;</span><span class="p">])</span>
<span class="go">[ [&#39;11.1.1.100&#39;, 2, 100],</span>
<span class="go">  [&#39;23.66.231.51&#39;, 3, 198],</span>
<span class="go">  [&#39;204.93.70.150&#39;, 6, 2472],</span>
<span class="go">  [&#39;23.66.231.41&#39;, 7, 1253],</span>
<span class="go">  [&#39;74.125.226.220&#39;, 10, 1446],</span>
<span class="go">  [&#39;173.194.75.106&#39;, 13, 1025],</span>
<span class="go">  [&#39;208.70.199.49&#39;, 16, 2960],</span>
<span class="go">  [&#39;74.125.226.219&#39;, 16, 10555],</span>
<span class="go">  [&#39;216.34.181.45&#39;, 48, 39486],</span>
<span class="go">  [&#39;184.31.179.172&#39;, 263, 195713],</span>
<span class="go">  [&#39;11.1.1.90&#39;, 384, 255208]]</span>
</pre></div>


<p>Note that the list of columns has the same order as requested when the view was created.</p>
<h2 id="aggregated-or-not">Aggregated or Not</h2>
<p>Notice that with each call to <code>get_data()</code>, we are passing the argument <code>aggregated=True</code>.
This argument indicates that we are not interested in time-series data, we want 
only care about the <code>Key()</code> columns that were used to create the view.  But what happens
if you set <code>aggregated=False</code>?</p>
<p>Normally all data on the Shark appliance is collected in time intervals and will
return that data by time.  This is what happens when <code>aggregrated=False</code>.  The 
time interval must be set when you create the view, but by default it is 1 second.</p>
<p>Let's see what the output would look like when it's not aggregated.  Change the True to False 
and rerun the script:</p>
<div class="codehilite"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">aggregated</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>


<p>The output should look like this:</p>
<div class="codehilite"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="go">6</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">printer</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="go">[ { &#39;p&#39;: 15,</span>
<span class="go">    &#39;t&#39;: datetime.datetime(2012, 12, 18, 12, 41, 33, 808202, tzinfo=tzutc()),</span>
<span class="go">    &#39;vals&#39;: [[&#39;11.1.1.90&#39;, 13, 1025], [&#39;173.194.75.106&#39;, 13, 1025]]},</span>
<span class="go">  { &#39;p&#39;: 289,</span>
<span class="go">    &#39;t&#39;: datetime.datetime(2012, 12, 18, 12, 41, 34, 808202, tzinfo=tzutc()),</span>
<span class="go">    &#39;vals&#39;: [ [&#39;11.1.1.90&#39;, 289, 193299],</span>
<span class="go">              [&#39;216.34.181.45&#39;, 44, 39222],</span>
<span class="go">              [&#39;184.31.179.172&#39;, 203, 139597],</span>
<span class="go">              [&#39;74.125.226.220&#39;, 10, 1446],</span>
<span class="go">              [&#39;208.70.199.49&#39;, 6, 1028],</span>
<span class="go">              [&#39;23.66.231.51&#39;, 3, 198],</span>
<span class="go">              [&#39;23.66.231.41&#39;, 7, 1253],</span>
<span class="go">              [&#39;74.125.226.219&#39;, 16, 10555]]},</span>
<span class="go">  { &#39;p&#39;: 60,</span>
<span class="go">    &#39;t&#39;: datetime.datetime(2012, 12, 18, 12, 41, 35, 808202, tzinfo=tzutc()),</span>
<span class="go">    &#39;vals&#39;: [[&#39;184.31.179.172&#39;, 60, 56116], [&#39;11.1.1.90&#39;, 60, 56116]]},</span>
<span class="go">  { &#39;p&#39;: 3,</span>
<span class="go">    &#39;t&#39;: datetime.datetime(2012, 12, 18, 12, 41, 36, 808202, tzinfo=tzutc()),</span>
<span class="go">    &#39;vals&#39;: [[&#39;11.1.1.90&#39;, 2, 380], [&#39;208.70.199.49&#39;, 2, 380]]},</span>
<span class="go">  { &#39;p&#39;: 11,</span>
<span class="go">    &#39;t&#39;: datetime.datetime(2012, 12, 18, 12, 41, 37, 808202, tzinfo=tzutc()),</span>
<span class="go">    &#39;vals&#39;: [ [&#39;11.1.1.100&#39;, 2, 100],</span>
<span class="go">              [&#39;11.1.1.90&#39;, 10, 2904],</span>
<span class="go">              [&#39;208.70.199.49&#39;, 2, 332],</span>
<span class="go">              [&#39;204.93.70.150&#39;, 6, 2472]]},</span>
<span class="go">  { &#39;p&#39;: 10,</span>
<span class="go">    &#39;t&#39;: datetime.datetime(2012, 12, 18, 12, 41, 39, 808202, tzinfo=tzutc()),</span>
<span class="go">    &#39;vals&#39;: [ [&#39;208.70.199.49&#39;, 6, 1220],</span>
<span class="go">              [&#39;11.1.1.90&#39;, 10, 1484],</span>
<span class="go">              [&#39;216.34.181.45&#39;, 4, 264]]}]</span>
</pre></div>


<p>Where as before <code>data</code> was a list of length one, it now has multiple
samples.  Each sample provides a snapshot of the key and value columns requested for
one interval starting at the time indicated by <code>t</code>. </p>
<p>Looking in detail at the second sample:</p>
<div class="codehilite"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="go">{&#39;p&#39;: 289,</span>
<span class="go"> &#39;t&#39;: datetime.datetime(2012, 12, 18, 12, 41, 34, 808202, tzinfo=tzutc()),</span>
<span class="go"> &#39;vals&#39;: [[&#39;11.1.1.90&#39;, 289, 193299],</span>
<span class="go">  [&#39;216.34.181.45&#39;, 44, 39222],</span>
<span class="go">  [&#39;184.31.179.172&#39;, 203, 139597],</span>
<span class="go">  [&#39;74.125.226.220&#39;, 10, 1446],</span>
<span class="go">  [&#39;208.70.199.49&#39;, 6, 1028],</span>
<span class="go">  [&#39;23.66.231.51&#39;, 3, 198],</span>
<span class="go">  [&#39;23.66.231.41&#39;, 7, 1253],</span>
<span class="go">  [&#39;74.125.226.219&#39;, 16, 10555]]}</span>

<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rvbd.common.timeutils</span> <span class="kn">import</span> <span class="o">*</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;t&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%x</span><span class="s"> </span><span class="si">%X</span><span class="s">&quot;</span><span class="p">)</span>
<span class="go">&#39;12/18/12 12:41:34&#39;</span>
</pre></div>


<p>From this, we can tell that the sample covers the time from 12:41:34 to 12:41:35. 
(Note, to be precise, it actually covers from 12:41:34.808202 to 12:41:35.808202)
Within that interval 289 packets were processed and host 11.1.1.90 was involved in each and
every one of those packets accountoing for 193,299 bytes.</p>
<p>Let's take a look at the time range covered for each sample using a little Python magic.</p>
<div class="codehilite"><pre><span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
<span class="o">...</span>     <span class="k">print</span> <span class="s">&quot;Start: {0}, processed {1} packets&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sample</span><span class="p">[</span><span class="s">&#39;t&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%x</span><span class="s"> </span><span class="si">%X</span><span class="s">&quot;</span><span class="p">),</span> <span class="n">sample</span><span class="p">[</span><span class="s">&#39;p&#39;</span><span class="p">])</span>
<span class="o">...</span>
<span class="n">Start</span><span class="p">:</span> <span class="mi">12</span><span class="o">/</span><span class="mi">18</span><span class="o">/</span><span class="mi">12</span> <span class="mi">12</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">33</span><span class="p">,</span> <span class="n">processed</span> <span class="mi">15</span> <span class="n">packets</span>
<span class="n">Start</span><span class="p">:</span> <span class="mi">12</span><span class="o">/</span><span class="mi">18</span><span class="o">/</span><span class="mi">12</span> <span class="mi">12</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">34</span><span class="p">,</span> <span class="n">processed</span> <span class="mi">289</span> <span class="n">packets</span>
<span class="n">Start</span><span class="p">:</span> <span class="mi">12</span><span class="o">/</span><span class="mi">18</span><span class="o">/</span><span class="mi">12</span> <span class="mi">12</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">35</span><span class="p">,</span> <span class="n">processed</span> <span class="mi">60</span> <span class="n">packets</span>
<span class="n">Start</span><span class="p">:</span> <span class="mi">12</span><span class="o">/</span><span class="mi">18</span><span class="o">/</span><span class="mi">12</span> <span class="mi">12</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">36</span><span class="p">,</span> <span class="n">processed</span> <span class="mi">3</span> <span class="n">packets</span>
<span class="n">Start</span><span class="p">:</span> <span class="mi">12</span><span class="o">/</span><span class="mi">18</span><span class="o">/</span><span class="mi">12</span> <span class="mi">12</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">37</span><span class="p">,</span> <span class="n">processed</span> <span class="mi">11</span> <span class="n">packets</span>
<span class="n">Start</span><span class="p">:</span> <span class="mi">12</span><span class="o">/</span><span class="mi">18</span><span class="o">/</span><span class="mi">12</span> <span class="mi">12</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">39</span><span class="p">,</span> <span class="n">processed</span> <span class="mi">10</span> <span class="n">packets</span>
</pre></div>


<blockquote>
<p>Note: do not type in the leading <code>...</code> for the second and third
lines above.  After typing in the first line (<code>for sample</code>), and press
enter, Python will prompt you with <code>...</code> for additional commands to
be executed for each iteration of the for loop.  You <em>must</em> type in
the 4 leading spaces before <code>print</code>.  At the end of the second
line, when you press enter it will prompt again with <code>...</code>,
indicating that you may enter additional commands.  In this case, we are
done so just press enter again, and Python will execute the for loop.
See <a href="http://www.diveintopython.net/getting_to_know_python/indenting_code.html">Dive Into Python - 2.5: Indenting Code</a> for more information.</p>
</blockquote>
<p>Notice that 12:41:38 is missing?  This is not a bug -- it just means that there were no
packets in the trace file during that sample interval, so there is no data to show.</p>
<p>Before continuing on, exit from the Python shell:</p>
<p>Before moving on, exit the python interactive shell:</p>
<div class="codehilite"><pre><span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">Ctrl</span><span class="o">-</span><span class="n">D</span><span class="p">]</span>
<span class="go">$</span>
</pre></div>


<h2 id="processing-view-data">Processing View Data</h2>
<p>Ok, now let's enhance the script to do a bit more:</p>
<ul>
<li>compute average packet size (bytes / packets)</li>
<li>select hosts sending small packets (&lt; 100 bytes)</li>
<li>for each host, print out the protocols in use</li>
</ul>
<p>Open up view.py and add a new import to the top of the file:</p>
<div class="codehilite"><pre><span class="kn">import</span> <span class="nn">rvbd.shark</span>
<span class="kn">from</span> <span class="nn">rvbd.shark.types</span> <span class="kn">import</span> <span class="n">Value</span><span class="p">,</span> <span class="n">Key</span>
<span class="kn">from</span> <span class="nn">rvbd.shark.filters</span> <span class="kn">import</span> <span class="o">*</span>            <span class="c"># &lt;--- Add this line</span>
<span class="kn">import</span> <span class="nn">pprint</span>
</pre></div>


<p>Next, uncomment the line the closes the view, delete the lines that print the data 
and replace the last section that prints the output to the screen with the following code:</p>
<div class="codehilite"><pre><span class="c"># Close the view</span>
<span class="n">view</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c"># Print the output to the screen            # &lt;--- delete these three lines</span>
<span class="c"># printer = pprint.PrettyPrinter(2)</span>
<span class="c"># printer.pprint(data)</span>

<span class="c"># Compute avg bytes/packet, and resort      # &lt;--- add the rest of this to the script</span>
<span class="n">rows</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">vals</span>
<span class="n">filtered_rows</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span> <span class="k">if</span> <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">]</span>

<span class="k">print</span> <span class="s">&quot;{0} Hosts are sending small packets (avg size &lt; 100 bytes)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">filtered_rows</span><span class="p">))</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">filtered_rows</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;{0}</span><span class="se">\t</span><span class="s">{1} bytes/pkt&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="c"># Now create a new view that breaks out the protocol / port for each host above</span>
<span class="n">columns</span> <span class="o">=</span> <span class="p">[</span> <span class="n">Key</span><span class="p">(</span><span class="n">sk</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">ip</span><span class="o">.</span><span class="n">protocol_name</span><span class="p">),</span>
            <span class="n">Value</span><span class="p">(</span><span class="n">sk</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">generic</span><span class="o">.</span><span class="n">packets</span><span class="p">),</span>
            <span class="n">Value</span><span class="p">(</span><span class="n">sk</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">generic</span><span class="o">.</span><span class="n">bytes</span><span class="p">)</span> <span class="p">]</span>

<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">filtered_rows</span><span class="p">:</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="p">[</span><span class="n">SharkFilter</span><span class="p">(</span><span class="s">&#39;ip.address=&quot;{0}&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]))]</span>
    <span class="n">view</span> <span class="o">=</span> <span class="n">sk</span><span class="o">.</span><span class="n">create_view</span><span class="p">(</span><span class="n">tracefile</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;tutorial view - ip {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">aggregated</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">view</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">Host {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">pp_row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">vals</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;{0}</span><span class="se">\t</span><span class="s">{1} bytes/pkt&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pp_row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pp_row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">pp_row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>


<p>Save your changes and rerun the script (without the <code>-i</code> this time):</p>
<div class="codehilite"><pre>$ python view.py
3 Hosts are sending small packets (avg size &lt; 100 bytes)
173.194.75.106  78 bytes/pkt
23.66.231.51    66 bytes/pkt
11.1.1.100  50 bytes/pkt

Host 173.194.75.106
TCP 78 bytes/pkt

Host 23.66.231.51
TCP 66 bytes/pkt

Host 11.1.1.100
ICMP    50 bytes/pkt
</pre></div>


<p>This script now runs a total of 4 views, the first view collects bytes and packets per IP address.
The subsequent views collect bytes and packets per protocol for an individual IP address
using a <code>SharkFilter</code>:</p>
<div class="codehilite"><pre><span class="n">filters</span> <span class="o">=</span> <span class="p">[</span><span class="n">SharkFilter</span><span class="p">(</span><span class="s">&#39;ip.address=&quot;{0}&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]))]</span>
</pre></div>


<p>A SharkFilter allows you to form complex expressions using operators and various fields
within a packet.</p>
<h2 id="existing-views">Existing Views</h2>
<p>In the above examples, we have always created a new view from scratch, then
closed that view when we were done.  Often, a view may be created and 
running for a longer period of time.  For example, a live view is 
continually being updated as new traffic is received.  Views may also be
created using the <code>Pilot</code> application.</p>
<p>If there are already open views on the Shark appliance,
we can access them with the <code>get_open_views()</code> method.  Start up a new
Python shell and lets give this a try:</p>
<div class="codehilite"><pre><span class="go">$ python</span>
<span class="go">Python 2.7.3 (default, Apr 19 2012, 00:55:09) </span>
<span class="go">[GCC 4.2.1 (Based on Apple Inc. build 5658) (LLVM build 2335.15.00)] on darwin</span>
<span class="go">Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.</span>

<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">rvbd.shark</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">sk</span> <span class="o">=</span> <span class="n">rvbd</span><span class="o">.</span><span class="n">shark</span><span class="o">.</span><span class="n">Shark</span><span class="p">(</span><span class="s">&#39;$sharkhost&#39;</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="n">rvbd</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">UserAuth</span><span class="p">(</span><span class="s">&#39;$username&#39;</span><span class="p">,</span> <span class="s">&#39;$password&#39;</span><span class="p">))</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">views</span> <span class="o">=</span> <span class="n">sk</span><span class="o">.</span><span class="n">get_open_views</span><span class="p">()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">views</span>
<span class="go">[&lt;View source=&quot;fs/admin/noon.cap&quot; title=&quot;Bandwidth Over Time&quot;&gt;,</span>
<span class="go"> &lt;View source=&quot;fs/admin/noon.cap&quot; title=&quot;TCP Flags by Protocol Over Time&quot;</span>
<span class="go"> &lt;View source=&quot;fs/admin/tutorial-1.pcap&quot;&gt;]</span>
</pre></div>


<blockquote>
<p>Your appliance will likely show a different set of open views.  You should
at least see the tutorail-1.pcap view in the list.  </p>
</blockquote>
<p>This method returns a list of objects, one representing each open
view.  We can get information about the time interval covered by the
view with the <code>get_timeinfo()</code> method:</p>
<div class="codehilite"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">view</span> <span class="o">=</span> <span class="n">views</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">view</span><span class="o">.</span><span class="n">get_timeinfo</span><span class="p">()</span>
<span class="go">{&#39;delta&#39;: 1000000000, &#39;end&#39;: 1195590918719742000, &#39;start&#39;: 1195590481719742000}</span>
</pre></div>


<p>This method returns a struct with 3 fields:</p>
<ul>
<li><code>start</code> and <code>end</code> indicate the timestamp of the first and last samples
   covered by the view</li>
<li><code>delta</code> specifies the interval of time covered by a single sample
   in nanoseconds (defaults to 1 second)</li>
</ul>
<p>For a view applied to a <code>trace clip</code> or a static file,
the <code>start</code> and <code>end</code> times will be fixed for a particular view.
For a view applied to a <code>capture port</code> or the virtual device
associated with a <code>capture job</code>, the <code>end</code> time will be
regularly updated as new packets arrive and are processed.</p>
<p>The views created above by the view.py script had only a single <code>output</code>
associated with it.  In general, 
a view may have multiple outputs associated with it.
Each output has the same basic structure - it contains a list of samples as
described above.</p>
<p>In this example, we are looking at the "TCP Flags by Protocol Over Time"
view which has separate outputs for the different flags that can appear
in TCP headers.
In <code>Pilot</code>, these outputs show up as separate graphs.
In FlyScript, there is a separate <code>output object &lt;outputobjects&gt;</code>
for each output, we can get at them with the <code>all_outputs()</code> method:</p>
<div class="codehilite"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">view</span><span class="o">.</span><span class="n">all_outputs</span><span class="p">()</span>
<span class="go">[&lt;view output OUID_Fin&gt;,</span>
<span class="go"> &lt;view output OUID_Psh&gt;,</span>
<span class="go"> &lt;view output OUID_Urg&gt;,</span>
<span class="go"> &lt;view output OUID_Ack&gt;,</span>
<span class="go"> &lt;view output OUID_Rst&gt;,</span>
<span class="go"> &lt;view output OUID_Syn&gt;]</span>
</pre></div>


<blockquote>
<p>The number of outputs returned is based upon the view selected.  The view
created above as part of the tutorial only has a single output at index 0. 
Note that if the view you have selected does not have 6 outputs, adjust the 
array index below.</p>
</blockquote>
<p>Let's use the helper routine <code>print_data()</code> in the module
<code>rvbd.shark.viewutils</code> to print the data in the view to the console:</p>
<div class="codehilite"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rvbd.shark.viewutils</span> <span class="kn">import</span> <span class="n">print_data</span>

<span class="go"># Grab the 6th output corresponding to the SYN flag, adjust as necessary</span>
<span class="go"># for the view selected</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">output</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">all_outputs</span><span class="p">()[</span><span class="mi">5</span><span class="p">]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">output</span>
<span class="go">&lt;view output OUID_Syn&gt;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">print_data</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">get_legend</span><span class="p">(),</span> <span class="n">output</span><span class="o">.</span><span class="n">get_data</span><span class="p">())</span>
<span class="go">Time                        Protocol            Packets</span>
<span class="go">2012/05/10 12:31:37.502796  http                1      </span>
<span class="go">2012/05/10 12:31:51.502796  http                1      </span>
<span class="go">2012/05/10 12:32:51.502796  http                1      </span>
<span class="go">2012/05/10 12:32:56.502796  http                1      </span>
<span class="go">2012/05/10 12:33:16.502796  https               1      </span>
<span class="go">2012/05/10 12:33:27.502796  http                2      </span>
<span class="go">2012/05/10 12:33:51.502796  http                1      </span>
<span class="gp">...</span>
</pre></div>


<p>Note that the method <code>View.get_data()</code> simply calls the get_data() function for 
the first output of a view.  As such, the following are equivalent:</p>
<div class="codehilite"><pre><span class="go"># Retrieving the data for the first output:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">output0</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">get_output</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data0</span> <span class="o">=</span> <span class="n">output0</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>

<span class="go"># Equivalent shortcut from the view object:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
</pre></div>


</div>

<div class="footer">
Copyright &copy; 2013 Riverbed Technology
</div></body>
</html>
